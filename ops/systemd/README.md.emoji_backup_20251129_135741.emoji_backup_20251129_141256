# Systemd Service Files

## Editing Service Files

Systemd service files in `/etc/systemd/system/` are owned by `root` and cannot
be edited directly by regular users.

### Workflow for Editing Service Files

1. **Edit the source file** in this directory:

   ```bash
   vim /data/dsa110-contimg/ops/systemd/contimg-pointing-monitor.service
   ```

2. **Deploy to systemd** using the deployment script:

   ```bash
   cd /data/dsa110-contimg/ops/systemd
   ./deploy_service.sh
   ```

3. **Restart the service** (if needed):
   ```bash
   sudo systemctl restart contimg-pointing-monitor.service
   ```

### Manual Deployment

If you prefer to deploy manually:

```bash
# Copy service file
sudo cp /data/dsa110-contimg/ops/systemd/contimg-pointing-monitor.service \
       /etc/systemd/system/contimg-pointing-monitor.service

# Reload systemd
sudo systemctl daemon-reload

# Restart service (if needed)
sudo systemctl restart contimg-pointing-monitor.service
```

### Checking Service Status

```bash
# View service status
sudo systemctl status contimg-pointing-monitor.service

# View service logs
sudo journalctl -u contimg-pointing-monitor.service -n 50

# View real-time logs
sudo journalctl -u contimg-pointing-monitor.service -f
```

## Service Files

- `contimg-pointing-monitor.service` - Pointing monitor service that watches
  `/data/incoming/` for new HDF5 files
- `contimg.env` - Environment variables used by all contimg services
- `deploy_service.sh` - Helper script to deploy service files

## Important Notes

- **Always edit the source file in this directory**, not the file in
  `/etc/systemd/system/`
- The source file is version controlled and the proper record of the service
  configuration
- The file in `/etc/systemd/system/` is a deployed copy and may be overwritten
- After editing, always run `deploy_service.sh` to deploy changes
- Don't forget to reload systemd with `systemctl daemon-reload` after deployment

## Systemd Version Compatibility

This system runs **systemd v237**, which has some limitations:

- :cross_mark: `StandardOutput=append:` syntax not supported (requires v240+)
- :white_heavy_check_mark: Use journalctl for logs instead of file redirection
- :white_heavy_check_mark: All logs available via `journalctl -u service-name`
