# Common environment for contimg services
# Edit these paths for your deployment

CONTIMG_INPUT_DIR=/data/ingest
CONTIMG_OUTPUT_DIR=/data/ms
CONTIMG_SCRATCH_DIR=/scratch/dsa110-contimg
CONTIMG_QUEUE_DB=/data/dsa110-contimg/state/ingest.sqlite3
CONTIMG_REGISTRY_DB=/data/dsa110-contimg/state/cal_registry.sqlite3
CONTIMG_PRODUCTS_DB=/data/dsa110-contimg/state/products.sqlite3
CONTIMG_STATE_DIR=/data/dsa110-contimg/state

# Threading and CASA/HDF5 stability
OMP_NUM_THREADS=4
MKL_NUM_THREADS=4
HDF5_USE_FILE_LOCKING=FALSE

# Ensure all temporary files (e.g., casacore TempLattice*) go to scratch
TMPDIR=${CONTIMG_SCRATCH_DIR}/tmp
TMP=${CONTIMG_SCRATCH_DIR}/tmp
TEMP=${CONTIMG_SCRATCH_DIR}/tmp
CASA_TMPDIR=${CONTIMG_SCRATCH_DIR}/tmp

# Streaming config
CONTIMG_EXPECTED_SUBBANDS=16
CONTIMG_CHUNK_MINUTES=5
CONTIMG_LOG_LEVEL=INFO
CONTIMG_MONITOR_INTERVAL=60

# API
CONTIMG_API_PORT=8000

# Telescope identity
# Use DSA_110 for EveryBeam compatibility (recognized by EveryBeam 0.7.4+)
PIPELINE_TELESCOPE_NAME=DSA_110
# Optional: if using a local Measures overlay, set CASACORE_DATA to that root
# CASACORE_DATA=/data/dsa110-contimg/data/measures

# Staging optimization (default: enabled for performance)
# tmpfs staging provides 3-5x speedup over SSD-only
# Set to false only if tmpfs space is constrained
CONTIMG_STAGE_TO_TMPFS=true
CONTIMG_TMPFS_PATH=/dev/shm

# Disk space monitoring
CONTIMG_DISK_WARN_GB=200
CONTIMG_DISK_CRITICAL_GB=100
CONTIMG_TMPFS_WARN_PERCENT=90
CONTIMG_TMPFS_CRITICAL_PERCENT=95

# Data retention policy
# CRITICAL: Currently INDEFINITE - no automatic deletion
CONTIMG_AUTO_CLEANUP_ENABLED=false
# Future retention settings (not currently enforced):
# CONTIMG_INCOMING_RETENTION_DAYS=7
# CONTIMG_MS_RETENTION_DAYS=30
# CONTIMG_IMAGE_RETENTION_DAYS=90

# Calibration strategy
CONTIMG_CAL_BANDPASS_INTERVAL_HOURS=24
CONTIMG_CAL_GAIN_INTERVAL_HOURS=1
CONTIMG_CAL_USE_NVSS_SKYMODEL=true

# Quality assurance thresholds
# MS quality
CONTIMG_QA_MS_MAX_FLAGGED=0.5
CONTIMG_QA_MS_MAX_ZEROS=0.3
CONTIMG_QA_MS_MIN_AMP=1e-6

# Calibration quality
CONTIMG_QA_CAL_MAX_FLAGGED=0.3
CONTIMG_QA_CAL_MIN_AMP=0.1
CONTIMG_QA_CAL_MAX_AMP=10.0
CONTIMG_QA_CAL_MAX_PHASE_SCATTER=90.0

# Image quality
CONTIMG_QA_IMG_MIN_DYNAMIC_RANGE=5.0
CONTIMG_QA_IMG_MIN_PEAK_SNR=5.0
CONTIMG_QA_IMG_MIN_5SIGMA_PIXELS=10

# Alerting configuration
# To enable Slack alerts, set webhook URL (get from Slack app settings)
# CONTIMG_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
# Minimum severity for Slack: DEBUG, INFO, WARNING, ERROR, CRITICAL
CONTIMG_SLACK_MIN_SEVERITY=WARNING

# Email alerts (optional)
# CONTIMG_SMTP_HOST=smtp.example.com
# CONTIMG_SMTP_PORT=587
# CONTIMG_SMTP_USER=pipeline@example.com
# CONTIMG_SMTP_PASSWORD=your_password
# CONTIMG_ALERT_FROM_EMAIL=dsa110-pipeline@example.com
# CONTIMG_ALERT_TO_EMAILS=ops@example.com,admin@example.com

# API compatibility (explicit values for API-consumed names)
# The API reads PIPELINE_* and CAL_REGISTRY_DB variables; mirror values here explicitly.
PIPELINE_QUEUE_DB=/data/dsa110-contimg/state/ingest.sqlite3
PIPELINE_PRODUCTS_DB=/data/dsa110-contimg/state/products.sqlite3
PIPELINE_STATE_DIR=/data/dsa110-contimg/state
PIPELINE_EXPECTED_SUBBANDS=16
CAL_REGISTRY_DB=/data/dsa110-contimg/state/cal_registry.sqlite3
