#!/bin/bash
# Pre-commit hook: Validate file locations
# This ensures files are created in correct directories

# Get all staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM || true)

if [ -z "$STAGED_FILES" ]; then
    exit 0
fi

ERRORS=0

# Check for markdown files in root (should be in docs/)
for file in $STAGED_FILES; do
    # Skip if file is deleted
    if [ ! -f "$file" ]; then
        continue
    fi
    
    # Check for markdown files in root
    if [[ "$file" =~ ^[^/]+\.md$ ]] && [[ "$file" != "README.md" ]] && [[ "$file" != "CHANGELOG.md" ]]; then
        echo ":cross_mark: ERROR: Markdown file in root directory: $file" >&2
        echo "   Documentation files should be in docs/ structure" >&2
        echo "   See: docs/DOCUMENTATION_QUICK_REFERENCE.md" >&2
        ERRORS=$((ERRORS + 1))
    fi
    
    # Check for test files in root
    if [[ "$file" =~ ^test_.*\.py$ ]] && [[ ! "$file" =~ ^tests/ ]]; then
        echo ":cross_mark: ERROR: Test file in root directory: $file" >&2
        echo "   Test files should be in tests/ structure" >&2
        echo "   See: docs/concepts/TEST_ORGANIZATION.md" >&2
        ERRORS=$((ERRORS + 1))
    fi
done

if [ $ERRORS -gt 0 ]; then
    echo "" >&2
    echo "Please move files to correct locations before committing." >&2
    exit 1
fi

exit 0
