#!/bin/bash
# Setup QA Output Directory Structure
# This script creates the directory hierarchy for all visualization outputs

set -e

QA_BASE="/data/dsa110-contimg/qa_outputs"

echo "Creating QA output directory structure..."

# Create base directories for each monitoring category
for category in performance antenna_health queue_health mosaic_quality calibration_quality disk_usage ese_candidates dashboards; do
    echo "  Creating ${category}..."
    mkdir -p "${QA_BASE}/${category}/current"
    mkdir -p "${QA_BASE}/${category}/daily"
    mkdir -p "${QA_BASE}/${category}/archive"
done

# Create specialized subdirectories
echo "  Creating specialized subdirectories..."
mkdir -p "${QA_BASE}/antenna_health/refant_rankings"
mkdir -p "${QA_BASE}/antenna_health/alerts"
mkdir -p "${QA_BASE}/queue_health/incidents"
mkdir -p "${QA_BASE}/mosaic_quality/per_mosaic"
mkdir -p "${QA_BASE}/calibration_quality/per_calibration"
mkdir -p "${QA_BASE}/disk_usage/alerts"
mkdir -p "${QA_BASE}/ese_candidates/per_candidate"

# Create archive directory with year/month structure
mkdir -p "${QA_BASE}/archive/$(date +%Y/%m)"

# Create temporary directory for API-generated plots
echo "  Creating temporary directory..."
mkdir -p /tmp/dsa110_monitoring_plots/cache

# Set permissions (assuming dsa user)
echo "  Setting permissions..."
chown -R dsa:dsa "${QA_BASE}" 2>/dev/null || true
chmod -R 755 "${QA_BASE}"

echo ":check_mark: QA directory structure created successfully!"
echo ""
echo "Base directory: ${QA_BASE}"
echo "Temporary plots: /tmp/dsa110_monitoring_plots"
echo ""
echo "To view structure:"
echo "  tree -L 2 ${QA_BASE}"
