#!/usr/bin/env bash
# Quick verification script for GitHub Actions fix
# Tests that pytest and dependencies can be installed correctly

set -euo pipefail

echo "=== DSA-110 GitHub Actions Fix Verification ==="
echo

# Create a temporary virtual environment
TEST_DIR=$(mktemp -d)
trap "rm -rf $TEST_DIR" EXIT

cd "$TEST_DIR"

echo "1. Creating test virtual environment..."
python3 -m venv test_env
source test_env/bin/activate

echo "2. Installing pip..."
python -m pip install --upgrade pip -q

echo "3. Installing pytest and test dependencies..."
pip install pytest pytest-cov pytest-xdist pytest-timeout pytest-mock -q

echo "4. Verifying pytest installation..."
python -m pytest --version

echo "5. Installing from requirements-test.txt..."
pip install -r /workspaces/dsa110-contimg/requirements-test.txt -q

echo "6. Verifying all test tools..."
python -c "import pytest; print(':check_mark: pytest imported successfully')"
pytest --version
pytest --markers | head -20

echo
echo "=== Verification PASSED ==="
echo "The GitHub Actions fast-tests job should now work correctly."
