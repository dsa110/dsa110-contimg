#!/bin/bash
# Developer Setup Script
# Source this at the start of any agentic/developer session to ensure:
# 1. Error detection is enabled
# 2. casa6 environment is enforced for all Python operations

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Source casa6 environment enforcement FIRST (before error detection)
# Check in casa/ directory (correct location) first, then fallback to dev/ directory
CASA6_ENV_PATH="${SCRIPT_DIR}/../casa/casa6-env.sh"
if [ ! -f "${CASA6_ENV_PATH}" ]; then
    CASA6_ENV_PATH="${SCRIPT_DIR}/casa6-env.sh"
fi

if [ -f "${CASA6_ENV_PATH}" ]; then
    source "${CASA6_ENV_PATH}"
    CASA6_STATUS=":white_heavy_check_mark:"
else
    echo ":warning_sign::variation_selector-16:  WARNING: casa6-env.sh not found at ${CASA6_ENV_PATH}" >&2
    CASA6_STATUS=":cross_mark:"
fi

# Set BASH_ENV if not already set
if [ -z "${BASH_ENV:-}" ]; then
    export BASH_ENV="/data/dsa110-contimg/scripts/auto-error-detection-env.sh"
fi

# Source error detection if not already enabled
if [ -z "${AUTO_ERROR_DETECTION:-}" ]; then
    if [ -f "/data/dsa110-contimg/scripts/auto-error-detection.sh" ]; then
        source "/data/dsa110-contimg/scripts/auto-error-detection.sh" >/dev/null 2>&1
    fi
fi

echo ":white_heavy_check_mark: Developer setup complete"
echo "   Error detection: ${AUTO_ERROR_DETECTION:-:cross_mark: not enabled}"
echo "   Casa6 enforcement: ${CASA6_ENV_ENFORCED:-:cross_mark: not enabled}"
echo "   Casa6 Python: ${CASA6_PYTHON:-:cross_mark: not set}"
echo "   BASH_ENV: ${BASH_ENV}"
