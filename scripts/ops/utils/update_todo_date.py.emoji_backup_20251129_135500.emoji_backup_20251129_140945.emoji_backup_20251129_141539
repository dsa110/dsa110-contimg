#!/opt/miniforge/envs/casa6/bin/python
"""
Automatically update the 'Last Updated' date in TODO.md.

This script finds the date line in TODO.md and updates it to today's date.
Can be run manually, via git hooks, or as part of CI/CD.
"""

import re
import sys
from datetime import date
from pathlib import Path

# Get project root (assuming script is in scripts/)
PROJECT_ROOT = Path(__file__).parent.parent
TODO_FILE = PROJECT_ROOT / "docs" / "dev" / "notes" / "TODO.md"

# Date format: YYYY-MM-DD
DATE_FORMAT = "%Y-%m-%d"


def update_todo_date():
    """Update the 'Last Updated' date in TODO.md to today's date."""
    if not TODO_FILE.exists():
        print(f"Error: {TODO_FILE} not found", file=sys.stderr)
        return 1

    # Read current content
    content = TODO_FILE.read_text(encoding="utf-8")

    # Find and replace the date line
    # Pattern: **Last Updated:** YYYY-MM-DD
    today = date.today().strftime(DATE_FORMAT)
    pattern = r"(\*\*Last Updated:\*\* )\d{4}-\d{2}-\d{2}"
    replacement = rf"\1{today}"

    new_content = re.sub(pattern, replacement, content)

    # Only write if something changed
    if new_content != content:
        TODO_FILE.write_text(new_content, encoding="utf-8")
        print(f":check_mark: Updated TODO.md date to {today}")
        return 0
    else:
        # Date might already be correct, or pattern didn't match
        print(f":info: No date update needed (already {today} or pattern not found)")
        return 0


if __name__ == "__main__":
    sys.exit(update_todo_date())

