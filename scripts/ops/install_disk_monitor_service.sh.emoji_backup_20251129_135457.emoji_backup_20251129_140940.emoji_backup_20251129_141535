#!/bin/bash
# Install DSA-110 Disk Monitoring Service

set -e

echo "Installing DSA-110 Disk Monitoring Service..."

# Check if running as root or with sudo
if [ "$EUID" -ne 0 ]; then
    echo "This script must be run as root or with sudo"
    exit 1
fi

# Copy service file to systemd directory
echo "  Copying service file..."
cp /data/dsa110-contimg/ops/systemd/dsa110-disk-monitor.service /etc/systemd/system/

# Reload systemd daemon
echo "  Reloading systemd daemon..."
systemctl daemon-reload

# Enable service (start on boot)
echo "  Enabling service..."
systemctl enable dsa110-disk-monitor.service

# Start service
echo "  Starting service..."
systemctl start dsa110-disk-monitor.service

# Check status
echo "  Checking status..."
systemctl status dsa110-disk-monitor.service --no-pager || true

echo ""
echo ":check_mark: Disk monitoring service installed successfully!"
echo ""
echo "Useful commands:"
echo "  sudo systemctl status dsa110-disk-monitor    # Check status"
echo "  sudo systemctl stop dsa110-disk-monitor      # Stop service"
echo "  sudo systemctl start dsa110-disk-monitor     # Start service"
echo "  sudo systemctl restart dsa110-disk-monitor   # Restart service"
echo "  sudo journalctl -u dsa110-disk-monitor -f    # View logs"
