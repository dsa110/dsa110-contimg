
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="http://code.deepsynoptic.org/dsa110-contimg/dev/notes/MEMORY/" rel="canonical"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.31" name="generator"/>
<title>DSA-110 Continuum Imaging Pipeline - Codebase Understanding - DSA-110 Continuum Imaging Pipeline</title>
<link href="../../../assets/stylesheets/main.3cba04c6.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../assets/_mkdocstrings.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#dsa-110-continuum-imaging-pipeline-codebase-understanding">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="DSA-110 Continuum Imaging Pipeline" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="DSA-110 Continuum Imaging Pipeline">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            DSA-110 Continuum Imaging Pipeline
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              DSA-110 Continuum Imaging Pipeline - Codebase Understanding
            
          </span>
</div>
</div>
</div>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/dsa110/dsa110-contimg" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="DSA-110 Continuum Imaging Pipeline" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="DSA-110 Continuum Imaging Pipeline">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    DSA-110 Continuum Imaging Pipeline
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/dsa110/dsa110-contimg" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    Home
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../DOCUMENTATION_QUICK_REFERENCE/">
<span class="md-ellipsis">
    Documentation Guide
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../concepts/">
<span class="md-ellipsis">
    Concepts
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/architecture/">
<span class="md-ellipsis">
    Architecture
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/DIRECTORY_ARCHITECTURE/">
<span class="md-ellipsis">
    Directory Architecture
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/modules/">
<span class="md-ellipsis">
    Modules
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/control-panel/">
<span class="md-ellipsis">
    Control Panel
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/aoflagger/">
<span class="md-ellipsis">
    AOFlagger
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/frontend_design/">
<span class="md-ellipsis">
    Frontend Design
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
<span class="md-ellipsis">
    Dashboard
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_8">
<span class="md-nav__icon md-icon"></span>
            Dashboard
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/dashboard_mockups/">
<span class="md-ellipsis">
    Mockups
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../SKYVIEW_IMPLEMENTATION_PLAN/">
<span class="md-ellipsis">
    Sky View
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/GLOSSARY/">
<span class="md-ellipsis">
    Glossary
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
<span class="md-ellipsis">
    Pipeline
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_10_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_10">
<span class="md-nav__icon md-icon"></span>
            Pipeline
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/pipeline_overview/">
<span class="md-ellipsis">
    Overview
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/pipeline_stage_architecture/">
<span class="md-ellipsis">
    Stage Architecture
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/pipeline_workflow_visualization/">
<span class="md-ellipsis">
    Workflow Visualization
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/pipeline_production_features/">
<span class="md-ellipsis">
    Production Features
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/pipeline_patterns/">
<span class="md-ellipsis">
    Patterns
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_11" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_11" id="__nav_3_11_label" tabindex="0">
<span class="md-ellipsis">
    Science
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_11_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_11">
<span class="md-nav__icon md-icon"></span>
            Science
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/science/photometry_normalization/">
<span class="md-ellipsis">
    Photometry Normalization
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../concepts/mcp_browser_server_setup/">
<span class="md-ellipsis">
    Browser MCP Server
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    Tutorials
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
<span class="md-ellipsis">
    Conversion
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
            Conversion
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tutorials/HDF5_TO_MS_TUTORIAL/">
<span class="md-ellipsis">
    HDF5 to MS
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tutorials/simulation-tutorial/">
<span class="md-ellipsis">
    Simulation
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tutorials/calibrate-apply/">
<span class="md-ellipsis">
    Calibrate and Apply
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tutorials/convert-standalone/">
<span class="md-ellipsis">
    Convert Standalone
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tutorials/streaming/">
<span class="md-ellipsis">
    Streaming
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
<span class="md-ellipsis">
    Notebooks
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tutorials/notebooks/bandpass_calibration_test.ipynb">
<span class="md-ellipsis">
    Bandpass Calibration Test
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tutorials/notebooks/calibrator_helper.py">
<span class="md-ellipsis">
    Calibrator Helper
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tutorials/notebooks/CalibratorSearch.ipynb">
<span class="md-ellipsis">
    Calibrator Search
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tutorials/notebooks/ms_staging_workflow.ipynb">
<span class="md-ellipsis">
    MS Staging Workflow
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
<span class="md-ellipsis">
    How-To Guides
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            How-To Guides
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/github_pages_walkthrough/">
<span class="md-ellipsis">
    GitHub Pages Setup
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-ellipsis">
    Quickstarts
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            Quickstarts
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/quickstart/">
<span class="md-ellipsis">
    General
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/control-panel-quickstart/">
<span class="md-ellipsis">
    Control Panel
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/LINEAR_SETUP_QUICKSTART/">
<span class="md-ellipsis">
    Linear Setup
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
<span class="md-ellipsis">
    Testing
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
            Testing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/FAST_TESTING/">
<span class="md-ellipsis">
    Fast Testing
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/PIPELINE_TESTING_GUIDE/">
<span class="md-ellipsis">
    Pipeline Guide
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/TEST_FLAG_SUBCOMMAND/">
<span class="md-ellipsis">
    Flag Subcommand
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/build-vp-from-h5/">
<span class="md-ellipsis">
    Build VP from h5
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
<span class="md-ellipsis">
    Calibration
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_5">
<span class="md-nav__icon md-icon"></span>
            Calibration
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/CALIBRATION_DETAILED_PROCEDURE/">
<span class="md-ellipsis">
    Detailed Procedure
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/FIND_CALIBRATOR_TRANSIT_DATA/">
<span class="md-ellipsis">
    Find Calibrator Transit
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/IMAGE_0834_TRANSIT_5MIN/">
<span class="md-ellipsis">
    Image 0834 Transit 5min
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
<span class="md-ellipsis">
    Mosaic
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_7">
<span class="md-nav__icon md-icon"></span>
            Mosaic
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/mosaic_quickstart/">
<span class="md-ellipsis">
    Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/mosaic/">
<span class="md-ellipsis">
    Complete Guide
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
<span class="md-ellipsis">
    Quality Assurance
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_8">
<span class="md-nav__icon md-icon"></span>
            Quality Assurance
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/QUALITY_ASSURANCE_SETUP/">
<span class="md-ellipsis">
    Setup
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/quicklook/">
<span class="md-ellipsis">
    Quick Look
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/reprocess/">
<span class="md-ellipsis">
    Reprocess
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/USING_ORCHESTRATOR_CLI/">
<span class="md-ellipsis">
    Using Orchestrator CLI
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_11" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_11" id="__nav_5_11_label" tabindex="0">
<span class="md-ellipsis">
    Dashboard
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_11_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_11">
<span class="md-nav__icon md-icon"></span>
            Dashboard
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/dashboard-development/">
<span class="md-ellipsis">
    Development
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/dashboard-quickstart/">
<span class="md-ellipsis">
    Quickstart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/dashboard_testing/">
<span class="md-ellipsis">
    Testing
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/dashboard_development_workflow/">
<span class="md-ellipsis">
    Development Workflow
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/LINEAR_INTEGRATION/">
<span class="md-ellipsis">
    Linear Integration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/frontend-initial-setup/">
<span class="md-ellipsis">
    Frontend Initial Setup
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/PARAMETER_OPTIMIZATION_GUIDE/">
<span class="md-ellipsis">
    AOFlagger Parameter Optimization
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/downsampling_guide/">
<span class="md-ellipsis">
    Downsampling Guide
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_16" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_16" id="__nav_5_16_label" tabindex="0">
<span class="md-ellipsis">
    Conversion
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_16_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_16">
<span class="md-nav__icon md-icon"></span>
            Conversion
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/uvh5_to_ms_conversion/">
<span class="md-ellipsis">
    UVH5 to MS
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/streaming_converter_guide/">
<span class="md-ellipsis">
    Streaming Converter
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../how-to/troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
<span class="md-ellipsis">
    Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
<span class="md-ellipsis">
    API
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_1">
<span class="md-nav__icon md-icon"></span>
            API
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/api-endpoints/">
<span class="md-ellipsis">
    Endpoints
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_1_2" id="__nav_6_1_2_label" tabindex="0">
<span class="md-ellipsis">
    Dashboard
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_1_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_6_1_2">
<span class="md-nav__icon md-icon"></span>
            Dashboard
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/dashboard_backend_api/">
<span class="md-ellipsis">
    API Reference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/dashboard_pages_and_features/">
<span class="md-ellipsis">
    Pages &amp; Features
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/backend_integration_snippets/">
<span class="md-ellipsis">
    Integration Snippets
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/calibration-overview/">
<span class="md-ellipsis">
    Calibration Overview
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/cli/">
<span class="md-ellipsis">
    CLI
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/control-panel-cheatsheet/">
<span class="md-ellipsis">
    Control Panel Cheatsheet
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/database_schema/">
<span class="md-ellipsis">
    Database Schema
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/env/">
<span class="md-ellipsis">
    Environment Variables
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/CRITICAL_PYTHON_ENVIRONMENT/">
<span class="md-ellipsis">
    Critical Python Environment
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_8" id="__nav_6_8_label" tabindex="0">
<span class="md-ellipsis">
    Optimizations
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_8">
<span class="md-nav__icon md-icon"></span>
            Optimizations
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/optimizations/OPTIMIZATION_API/">
<span class="md-ellipsis">
    API
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/optimizations/PROFILING_GUIDE/">
<span class="md-ellipsis">
    Profiling Guide
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
<span class="md-ellipsis">
    Operations
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Operations
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
<span class="md-ellipsis">
    Deployment
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_1">
<span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../operations/deploy-docker/">
<span class="md-ellipsis">
    Docker
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../operations/deploy-systemd/">
<span class="md-ellipsis">
    systemd
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../operations/port-management/">
<span class="md-ellipsis">
    Port Management
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../operations/refant_quick_reference/">
<span class="md-ellipsis">
    Refant Quick Reference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../operations/service_restart_fix/">
<span class="md-ellipsis">
    Service Restart Fix
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../operations/systemd-migration/">
<span class="md-ellipsis">
    Systemd Migration
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../contributing/">
<span class="md-ellipsis">
    Contributing
  </span>
</a>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
<span class="md-ellipsis">
    Archive
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_8_2">
<span class="md-nav__icon md-icon"></span>
            Archive
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../contributing/archive/CONTRIBUTING_TODO/">
<span class="md-ellipsis">
    Contributing to TODO
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../contributing/archive/rules/">
<span class="md-ellipsis">
    Rules
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#executive-summary">
<span class="md-ellipsis">
      Executive Summary
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pipeline-architecture">
<span class="md-ellipsis">
      Pipeline Architecture
    </span>
</a>
<nav aria-label="Pipeline Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-processing-flow">
<span class="md-ellipsis">
      Core Processing Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-components">
<span class="md-ellipsis">
      Key Components
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-technical-decisions">
<span class="md-ellipsis">
      Key Technical Decisions
    </span>
</a>
<nav aria-label="Key Technical Decisions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#python-environment-casa6-is-mandatory">
<span class="md-ellipsis">
      Python Environment: casa6 is MANDATORY
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conversion-strategy">
<span class="md-ellipsis">
      Conversion Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#k-calibration-default-behavior">
<span class="md-ellipsis">
      K-Calibration Default Behavior
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-coherence-fix">
<span class="md-ellipsis">
      Phase Coherence Fix
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#database-preferences">
<span class="md-ellipsis">
      Database Preferences
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#transit-time-calculation">
<span class="md-ellipsis">
      Transit Time Calculation
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ese-detection-methodology">
<span class="md-ellipsis">
      ESE Detection Methodology
    </span>
</a>
<nav aria-label="ESE Detection Methodology" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#physical-phenomenon">
<span class="md-ellipsis">
      Physical Phenomenon
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#observational-signatures">
<span class="md-ellipsis">
      Observational Signatures
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#detection-algorithm">
<span class="md-ellipsis">
      Detection Algorithm
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#detection-metrics">
<span class="md-ellipsis">
      Detection Metrics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#normalization-algorithm">
<span class="md-ellipsis">
      Normalization Algorithm
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deployment">
<span class="md-ellipsis">
      Deployment
    </span>
</a>
<nav aria-label="Deployment" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#systemd-recommended-for-streaming-worker">
<span class="md-ellipsis">
      Systemd (Recommended for Streaming Worker)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#docker-compose">
<span class="md-ellipsis">
      Docker Compose
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#frontend">
<span class="md-ellipsis">
      Frontend
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#codebase-structure">
<span class="md-ellipsis">
      Codebase Structure
    </span>
</a>
<nav aria-label="Codebase Structure" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#main-directories">
<span class="md-ellipsis">
      Main Directories
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-entry-points">
<span class="md-ellipsis">
      Key Entry Points
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#important-notes-for-future-work">
<span class="md-ellipsis">
      Important Notes for Future Work
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-design-principles">
<span class="md-ellipsis">
      Key Design Principles
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#critical-lessons-learned">
<span class="md-ellipsis">
      Critical Lessons Learned
    </span>
</a>
<nav aria-label="Critical Lessons Learned" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#model_data-column-structure-vs-sky-model-content">
<span class="md-ellipsis">
      MODEL_DATA: Column Structure vs. Sky Model Content
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#casa-calibration-tables-are-directories">
<span class="md-ellipsis">
      CASA Calibration Tables Are Directories
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bandpass-solve-field-selection-and-uv-range-tuning-2025-11-04">
<span class="md-ellipsis">
      Bandpass Solve: Field Selection and UV Range Tuning (2025-11-04)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#test-organization">
<span class="md-ellipsis">
      Test Organization
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#agent-rules-effectiveness-2025-11-12">
<span class="md-ellipsis">
      Agent Rules Effectiveness (2025-11-12)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#documentation-organization-2025-11-12">
<span class="md-ellipsis">
      Documentation Organization (2025-11-12)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-documentation">
<span class="md-ellipsis">
      Related Documentation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#redundancies-and-confusion-risks-2025-11-04">
<span class="md-ellipsis">
      Redundancies and Confusion Risks (2025-11-04)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ops-directory-redundancies-2025-11-12">
<span class="md-ellipsis">
      Ops Directory Redundancies (2025-11-12)
    </span>
</a>
<nav aria-label="Ops Directory Redundancies (2025-11-12)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#legacy-systemd-service-file">
<span class="md-ellipsis">
      Legacy Systemd Service File
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#duplicate-helper-functions-in-opspipeline">
<span class="md-ellipsis">
      Duplicate Helper Functions in ops/pipeline/
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#overlapping-cleanup-routines">
<span class="md-ellipsis">
      Overlapping Cleanup Routines
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#similar-calibrator-processing-scripts">
<span class="md-ellipsis">
      Similar Calibrator Processing Scripts
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#new-lessons-2025-11-05">
<span class="md-ellipsis">
      New Lessons (2025-11-05)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streaming-mode-procedure-2025-11-06">
<span class="md-ellipsis">
      Streaming Mode Procedure (2025-11-06)
    </span>
</a>
<nav aria-label="Streaming Mode Procedure (2025-11-06)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow">
<span class="md-ellipsis">
      Workflow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#readiness">
<span class="md-ellipsis">
      Readiness
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#casa-mpi-evaluation-2025-11-12">
<span class="md-ellipsis">
      CASA-mpi Evaluation (2025-11-12)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deep-dive-issues-analysis-2025-11-12">
<span class="md-ellipsis">
      Deep Dive Issues Analysis (2025-11-12)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#post-fix-reassessment-2025-11-12">
<span class="md-ellipsis">
      Post-Fix Reassessment (2025-11-12)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#code-quality-improvements-2025-11-12">
<span class="md-ellipsis">
      Code Quality Improvements (2025-11-12)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#mosaic-construction-workflow">
<span class="md-ellipsis">
      Mosaic Construction Workflow
    </span>
</a>
<nav aria-label="Mosaic Construction Workflow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#building-60-minute-mosaics-around-vla-calibrators">
<span class="md-ellipsis">
      Building 60-Minute Mosaics Around VLA Calibrators
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deep-study-summary-2025-11-12">
<span class="md-ellipsis">
      Deep Study Summary (2025-11-12)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#measurement-set-permissions">
<span class="md-ellipsis">
      Measurement Set Permissions
    </span>
</a>
<nav aria-label="Measurement Set Permissions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#critical-ms-files-must-be-writable">
<span class="md-ellipsis">
      Critical: MS Files Must Be Writable
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-points">
<span class="md-ellipsis">
      Integration Points
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dependencies">
<span class="md-ellipsis">
      Dependencies
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#timeline">
<span class="md-ellipsis">
      Timeline
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#risk-assessment">
<span class="md-ellipsis">
      Risk Assessment
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-documentation_1">
<span class="md-ellipsis">
      Related Documentation
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streaming-test-run-lessons-learned-2025-11-10">
<span class="md-ellipsis">
      Streaming Test Run Lessons Learned (2025-11-10)
    </span>
</a>
<nav aria-label="Streaming Test Run Lessons Learned (2025-11-10)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#key-mistakes-and-fixes">
<span class="md-ellipsis">
      Key Mistakes and Fixes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#critical-principles-for-autonomous-runs">
<span class="md-ellipsis">
      Critical Principles for Autonomous Runs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pre-flight-checklist-for-autonomous-runs">
<span class="md-ellipsis">
      Pre-Flight Checklist for Autonomous Runs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#additional-safeguards-implemented">
<span class="md-ellipsis">
      Additional Safeguards Implemented
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-documentation_2">
<span class="md-ellipsis">
      Related Documentation
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="dsa-110-continuum-imaging-pipeline-codebase-understanding">DSA-110 Continuum Imaging Pipeline - Codebase Understanding<a class="headerlink" href="#dsa-110-continuum-imaging-pipeline-codebase-understanding" title="Permanent link">¶</a></h1>
<p><strong>Last Updated:</strong> 2025-11-09<br/>
<strong>Purpose:</strong> Record lessons and principles discovered during codebase exploration for future reference</p>
<hr/>
<h2 id="executive-summary">Executive Summary<a class="headerlink" href="#executive-summary" title="Permanent link">¶</a></h2>
<p>The DSA-110 continuum imaging pipeline is a <strong>production-ready radio astronomy data processing system</strong> designed to:
1. Convert raw UVH5 subband visibility data into calibrated, deconvolved continuum images
2. Search for <strong>Extreme Scattering Events (ESEs)</strong> - plasma lensing events in the interstellar medium that cause 10-50% flux variations over weeks to months</p>
<p>The pipeline achieves <strong>1-2% relative flux precision</strong> (vs ~5-10% absolute) through differential photometry normalization, enabling detection of ESE flux variations at 5-10σ significance.</p>
<hr/>
<h2 id="pipeline-architecture">Pipeline Architecture<a class="headerlink" href="#pipeline-architecture" title="Permanent link">¶</a></h2>
<h3 id="core-processing-flow">Core Processing Flow<a class="headerlink" href="#core-processing-flow" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code>UVH5 Files → Conversion → Calibration → Imaging → Photometry → ESE Detection
  (16 sb)      (MS)      ({K}/BP/G)      (tclean)    (normalize)   (variability)

{} = optional, not default
</code></pre></div>
<h3 id="key-components">Key Components<a class="headerlink" href="#key-components" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Streaming Converter</strong> (<code>conversion/streaming/streaming_converter.py</code>)</li>
<li>Watches for incoming <code>*_sb??.hdf5</code> files</li>
<li>Groups by timestamp (5-minute windows, 16 subbands)</li>
<li>State machine: <code>collecting</code> → <code>pending</code> → <code>in_progress</code> → <code>completed</code></li>
<li>
<p>Persists queue in SQLite (<code>state/ingest.sqlite3</code>)</p>
</li>
<li>
<p><strong>Conversion Layer</strong> (<code>conversion/strategies/</code>)</p>
</li>
<li><strong>Orchestrator</strong> (<code>hdf5_orchestrator.py</code>): Primary entry point</li>
<li><strong>Writers</strong>:<ul>
<li><code>direct_subband.py</code>: Production path - parallel per-subband writes, then CASA concat</li>
<li><code>pyuvdata_monolithic.py</code>: Testing only (≤2 subbands)</li>
</ul>
</li>
<li>Operations:<ul>
<li>Sets telescope identity (<code>DSA_110</code>)</li>
<li>Phases to meridian at midpoint</li>
<li>Computes UVW coordinates</li>
<li>Initializes imaging columns (<code>MODEL_DATA</code>, <code>CORRECTED_DATA</code>, <code>WEIGHT_SPECTRUM</code>)</li>
</ul>
</li>
<li>
<p>Performance: tmpfs staging (<code>/dev/shm</code>) for 3-5x speedup</p>
</li>
<li>
<p><strong>Calibration Layer</strong> (<code>calibration/</code>)</p>
</li>
<li><strong>K-calibration</strong> (delay): Frequency-independent delays per antenna<ul>
<li><strong>Default: SKIPPED</strong> for DSA-110 (short 2.6 km baselines, delays &lt;0.5 ns absorbed into gains)</li>
<li>Use <code>--do-k</code> to explicitly enable if needed</li>
</ul>
</li>
<li><strong>BP-calibration</strong> (bandpass): Frequency-dependent gains; use “G” (polarization/time-dependent) mode.</li>
<li><strong>G-calibration</strong> (gain): Time-variable atmospheric effects; use “p” (phase-only) mode.</li>
<li>Fast mode: time/channel binning, phase-only gains, uvrange cuts</li>
<li>Auto calibrator field selection from VLA catalog</li>
<li>
<p>Calibration table registry (<code>state/cal_registry.sqlite3</code>) tracks validity windows</p>
</li>
<li>
<p><strong>Imaging Layer</strong> (<code>imaging/</code>)</p>
</li>
<li>CASA <code>tclean</code> with primary beam correction</li>
<li>NVSS sky model seeding (≥10 mJy sources)</li>
<li>Quick-look mode: smaller imsize, fewer iterations</li>
<li>
<p>Optional FITS export skipping for speed</p>
</li>
<li>
<p><strong>Photometry &amp; Normalization</strong> (<code>photometry/</code>)</p>
</li>
<li><strong>Forced photometry</strong> (<code>forced.py</code>): Measure peak flux at catalog positions</li>
<li>
<p><strong>Differential normalization</strong> (<code>normalize.py</code>): Achieves 1-2% relative precision</p>
<ul>
<li>Uses ensemble of stable reference sources (NVSS, SNR≥50)</li>
<li>Computes correction factor from reference flux ratios</li>
<li>Normalizes target sources by correction factor</li>
<li>Robust outlier rejection (3σ clipping)</li>
</ul>
</li>
<li>
<p><strong>ESE Detection</strong> (<code>database/migrations.py</code>, <code>api/routes.py</code>)</p>
</li>
<li>Variability statistics: χ²_reduced, fractional variability, significance</li>
<li>ESE-specific morphology: asymmetry, timescale (14-180 days), amplitude (10-50%)</li>
<li>Database tables:<ul>
<li><code>variability_stats</code>: Pre-computed statistics per source</li>
<li><code>ese_candidates</code>: Flagged candidates (auto or user-flagged)</li>
<li><code>photometry_timeseries</code>: Normalized flux measurements</li>
</ul>
</li>
<li>
<p>API endpoint: <code>GET /api/ese/candidates</code> (currently mock data)</p>
</li>
<li>
<p><strong>API &amp; Monitoring</strong> (<code>api/</code>)</p>
</li>
<li>FastAPI REST endpoints</li>
<li>Background job execution with SSE log streaming</li>
<li>Control panel for manual job execution</li>
<li>
<p>Status, products, QA views</p>
</li>
<li>
<p><strong>Database Layer</strong> (<code>database/</code>)</p>
</li>
<li><strong>Products DB</strong> (<code>state/products.sqlite3</code>):<ul>
<li><code>ms_index</code>: MS metadata (path, timestamps, status, calibration applied)</li>
<li><code>images</code>: Image metadata (path, beam, noise, PB correction)</li>
<li><code>photometry_timeseries</code>: Flux measurements per source per epoch</li>
<li><code>variability_stats</code>: Pre-computed variability metrics</li>
<li><code>ese_candidates</code>: Flagged ESE candidates</li>
</ul>
</li>
<li><strong>Queue DB</strong> (<code>state/ingest.sqlite3</code>): Group state, file arrivals, performance metrics</li>
<li>
<p><strong>Cal Registry DB</strong> (<code>state/cal_registry.sqlite3</code>): Calibration table registry</p>
</li>
<li>
<p><strong>Quality Assurance</strong> (<code>qa/</code>)</p>
</li>
<li>MS validation after conversion</li>
<li>Calibration quality assessment</li>
<li>Image quality metrics</li>
<li>Diagnostic plots and thumbnails</li>
</ol>
<hr/>
<h2 id="key-technical-decisions">Key Technical Decisions<a class="headerlink" href="#key-technical-decisions" title="Permanent link">¶</a></h2>
<h3 id="python-environment-casa6-is-mandatory">Python Environment: casa6 is MANDATORY<a class="headerlink" href="#python-environment-casa6-is-mandatory" title="Permanent link">¶</a></h3>
<p><strong>CRITICAL: ALL Python execution MUST use casa6 environment at <code>/opt/miniforge/envs/casa6/bin/python</code></strong></p>
<ul>
<li><strong>Path</strong>: <code>/opt/miniforge/envs/casa6/bin/python</code> (Python 3.11.13)</li>
<li><strong>Why</strong>: System Python (3.6.9) lacks CASA dependencies, required Python features, and scientific packages</li>
<li><strong>Makefile</strong>: Uses <code>CASA6_PYTHON</code> variable with automatic validation</li>
<li><strong>Shell Scripts</strong>: Must set <code>PYTHON_BIN="/opt/miniforge/envs/casa6/bin/python"</code> and check existence</li>
<li><strong>Never use</strong>: <code>python3</code>, <code>python</code>, or any system Python - pipeline will fail</li>
<li><strong>Documentation</strong>: See <code>docs/CRITICAL_PYTHON_ENVIRONMENT.md</code> for complete guidelines</li>
<li><strong>For AI Agents</strong>: Always reference casa6 path explicitly - never assume system Python works</li>
</ul>
<h3 id="conversion-strategy">Conversion Strategy<a class="headerlink" href="#conversion-strategy" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Production</strong>: Always uses <code>parallel-subband</code> writer for 16 subbands</li>
<li><strong>Testing</strong>: <code>pyuvdata</code> writer available for ≤2 subbands only</li>
<li><strong>Auto selection</strong>: <code>--writer auto</code> selects appropriate writer</li>
<li><strong>Staging</strong>: Prefer tmpfs (<code>/dev/shm</code>) when available, fallback to SSD</li>
</ul>
<h3 id="k-calibration-default-behavior">K-Calibration Default Behavior<a class="headerlink" href="#k-calibration-default-behavior" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Skipped by default</strong> for DSA-110 (following VLA/ALMA practice)</li>
<li>Short baselines (2.6 km max) mean residual delays &lt;0.5 ns (below decorrelation threshold)</li>
<li>Delays absorbed into complex gain calibration</li>
<li>Use <code>--do-k</code> flag to explicitly enable if needed</li>
</ul>
<h3 id="phase-coherence-fix">Phase Coherence Fix<a class="headerlink" href="#phase-coherence-fix" title="Permanent link">¶</a></h3>
<ul>
<li>Direct-subband writer computes <strong>single shared phase center</strong> for entire group</li>
<li>Prevents phase discontinuities when concatenated</li>
<li>Averages all subband midpoint times to compute group midpoint</li>
<li>All subbands reference same ICRS phase center (<code>meridian_icrs</code>)</li>
</ul>
<h3 id="database-preferences">Database Preferences<a class="headerlink" href="#database-preferences" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Always prefer SQLite</strong> for any relevant pipeline stage/function</li>
<li>SQLite provides faster, more reliable access than CSV/JSON</li>
<li>Standard locations:</li>
<li><code>state/catalogs/vla_calibrators.sqlite3</code></li>
<li><code>state/catalogs/master_sources.sqlite3</code></li>
<li><code>state/products.sqlite3</code></li>
<li><code>state/cal_registry.sqlite3</code></li>
<li>Functions like <code>load_vla_catalog()</code> automatically prefer SQLite when available</li>
</ul>
<h3 id="transit-time-calculation">Transit Time Calculation<a class="headerlink" href="#transit-time-calculation" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Proper method</strong> for end-to-end testing:</li>
<li>Load calibrator coordinates via <code>load_vla_catalog()</code> (SQLite preferred)</li>
<li>Calculate transit times using <code>previous_transits()</code> from <code>dsa110_contimg.calibration.schedule</code></li>
<li>Calculate search window (±30-60 minutes around transit)</li>
<li><strong>CRITICAL</strong>: Verify data exists using <code>find_subband_groups()</code> from orchestrator</li>
<li>Use <code>hdf5_orchestrator</code> CLI with <code>--start-time</code> and <code>--end-time</code> flags</li>
<li><strong>Never use simplified time-based searches</strong> - this bypasses actual pipeline components</li>
</ul>
<hr/>
<h2 id="ese-detection-methodology">ESE Detection Methodology<a class="headerlink" href="#ese-detection-methodology" title="Permanent link">¶</a></h2>
<h3 id="physical-phenomenon">Physical Phenomenon<a class="headerlink" href="#physical-phenomenon" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Cause</strong>: Plasma lensing by ionized structures in the interstellar medium</li>
<li><strong>Mechanism</strong>: Time-varying magnification/demagnification as Earth moves relative to ISM lens</li>
<li><strong>Frequency dependence</strong>: Nearly achromatic (ν^0 to ν^-0.2)</li>
</ul>
<h3 id="observational-signatures">Observational Signatures<a class="headerlink" href="#observational-signatures" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Timescales</strong>: Weeks to months (typical: 30-90 days)</li>
<li><strong>Morphology</strong>: </li>
<li>Phase 1: Gradual flux decrease (lens approaching)</li>
<li>Phase 2: Sharp caustic-crossing peaks (lens in beam)</li>
<li>Phase 3: Gradual recovery (lens departing)</li>
<li><strong>Amplitude</strong>: 10-50% typical, can reach factors of 2-3</li>
<li><strong>Rare</strong>: ~0.5-1 event per source per century</li>
</ul>
<h3 id="detection-algorithm">Detection Algorithm<a class="headerlink" href="#detection-algorithm" title="Permanent link">¶</a></h3>
<p><strong>Per-Image Processing:</strong>
1. Load FITS image (<code>.pbcor.fits</code>)
2. Query reference sources from <code>master_sources.sqlite3</code> within FoV
3. Perform forced photometry on N_ref references
4. Check if baselines exist (first 10 epochs):
   - If no: store measurements, flag as baseline establishment
   - If yes: compute correction factor from reference ensemble
5. Perform forced photometry on target sources (all NVSS in FoV)
6. Apply normalization to targets
7. Store in <code>photometry_timeseries</code> table</p>
<p><strong>Variability Analysis:</strong>
- For each source with N_epochs &gt; 20:
  - Compute χ²_reduced, fractional variability (V), significance
  - If variable (χ²_ν &gt; 3 or V &gt; 0.05):
    - Fit morphology (asymmetry, timescale, amplitude)
    - Compute ESE_score (weighted combination of metrics)
    - Flag if ESE_score &gt; 0.6
  - Update <code>variability_stats</code> table</p>
<h3 id="detection-metrics">Detection Metrics<a class="headerlink" href="#detection-metrics" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Reduced χ²</strong>: χ²_ν &gt; 5 flags as variable</li>
<li><strong>Fractional Variability</strong>: V &gt; 0.10 flags as significant</li>
<li><strong>ESE-Specific</strong>:</li>
<li>Asymmetry index (sharp rise/slow fall or vice versa)</li>
<li>Characteristic timescale: 14 days &lt; τ_char &lt; 180 days</li>
<li>Peak-to-trough amplitude: 0.2 &lt; amplitude &lt; 2.0</li>
</ul>
<h3 id="normalization-algorithm">Normalization Algorithm<a class="headerlink" href="#normalization-algorithm" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Baseline establishment</strong>: Median of first 10 epochs for each reference source</li>
<li><strong>Correction factor</strong>: Median of reference flux ratios (ratio = current/baseline)</li>
<li><strong>Outlier rejection</strong>: 3σ clipping on reference ensemble</li>
<li><strong>Error propagation</strong>: Accounts for measurement error and correction uncertainty</li>
<li><strong>Result</strong>: 1-2% relative precision vs 5-10% absolute precision</li>
</ul>
<hr/>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">¶</a></h2>
<h3 id="systemd-recommended-for-streaming-worker">Systemd (Recommended for Streaming Worker)<a class="headerlink" href="#systemd-recommended-for-streaming-worker" title="Permanent link">¶</a></h3>
<ul>
<li>Units: <code>ops/systemd/contimg-stream.service</code>, <code>contimg-api.service</code></li>
<li>Environment: <code>ops/systemd/contimg.env</code></li>
<li>Logs: <code>/data/dsa110-contimg/state/logs</code></li>
</ul>
<h3 id="docker-compose">Docker Compose<a class="headerlink" href="#docker-compose" title="Permanent link">¶</a></h3>
<ul>
<li>Services: <code>stream</code>, <code>api</code>, <code>scheduler</code> (optional)</li>
<li>Configuration: <code>ops/docker/.env</code></li>
<li>Image: Creates <code>contimg</code> conda env (casa6, casacore, pyuvdata, FastAPI)</li>
</ul>
<h3 id="frontend">Frontend<a class="headerlink" href="#frontend" title="Permanent link">¶</a></h3>
<ul>
<li>React/TypeScript dashboard</li>
<li>API URL configurable via <code>VITE_API_URL</code> env var</li>
<li>Control panel for manual job execution with live log streaming</li>
</ul>
<hr/>
<h2 id="codebase-structure">Codebase Structure<a class="headerlink" href="#codebase-structure" title="Permanent link">¶</a></h2>
<h3 id="main-directories">Main Directories<a class="headerlink" href="#main-directories" title="Permanent link">¶</a></h3>
<ul>
<li><code>src/dsa110_contimg/</code>: Core Python package</li>
<li><code>conversion/</code>: UVH5 → MS conversion</li>
<li><code>calibration/</code>: CASA-based calibration (K/BP/G)</li>
<li><code>imaging/</code>: tclean CLI and worker</li>
<li><code>photometry/</code>: Forced photometry and normalization</li>
<li><code>database/</code>: SQLite helpers and migrations</li>
<li><code>api/</code>: FastAPI application</li>
<li><code>qa/</code>: Quality assurance plots and helpers</li>
<li><code>mosaic/</code>: Mosaic planner/builder</li>
<li><code>scripts/</code>: Operational scripts</li>
<li><code>ops/</code>: Deployment configs (systemd, docker)</li>
<li><code>docs/</code>: Comprehensive documentation</li>
<li><code>state/</code>: Default location for databases and artifacts</li>
<li><code>config/</code>: Pipeline configuration templates</li>
</ul>
<h3 id="key-entry-points">Key Entry Points<a class="headerlink" href="#key-entry-points" title="Permanent link">¶</a></h3>
<ul>
<li>Streaming: <code>python -m dsa110_contimg.conversion.streaming.streaming_converter</code></li>
<li>Orchestrator: <code>python -m dsa110_contimg.conversion.strategies.hdf5_orchestrator</code></li>
<li>Calibration: <code>python -m dsa110_contimg.calibration.cli</code></li>
<li>Imaging: <code>python -m dsa110_contimg.imaging.cli</code></li>
<li>API: <code>uvicorn dsa110_contimg.api.routes:app</code></li>
</ul>
<hr/>
<h2 id="important-notes-for-future-work">Important Notes for Future Work<a class="headerlink" href="#important-notes-for-future-work" title="Permanent link">¶</a></h2>
<ol>
<li>
<p>When extracting or organizing cross-cutting project knowledge, follow the internal schema guidance.</p>
</li>
<li>
<p><strong>Database migrations</strong>: Run <code>python -m dsa110_contimg.database.migrations migrate_all</code> to ensure schema is up-to-date</p>
</li>
<li>
<p><strong>ESE detection currently uses mock data</strong>: Real implementation needs to:</p>
</li>
<li>Connect <code>variability_stats</code> computation to actual photometry pipeline</li>
<li>Implement ESE_score calculation</li>
<li>
<p>Hook up automatic flagging based on thresholds</p>
</li>
<li>
<p><strong>Photometry normalization</strong>: Fully implemented but needs integration with imaging pipeline to run automatically after each image is created</p>
</li>
<li>
<p><strong>Frontend ESE panel</strong>: Currently shows mock candidates; needs backend connection to real <code>ese_candidates</code> table</p>
</li>
<li>
<p><strong>Reference source selection</strong>: Currently manual/CLI-based; could be automated as part of imaging pipeline</p>
</li>
</ol>
<hr/>
<h2 id="key-design-principles">Key Design Principles<a class="headerlink" href="#key-design-principles" title="Permanent link">¶</a></h2>
<ol>
<li><strong>Modular architecture</strong>: Clear separation between conversion, calibration, imaging, QA</li>
<li><strong>Strategy pattern</strong>: Writer selection based on use case (production vs testing)</li>
<li><strong>SQLite-first</strong>: All persistent state in SQLite databases for fast, reliable access</li>
<li><strong>Performance optimization</strong>: tmpfs staging, fast calibration modes, quick imaging options</li>
<li><strong>Robustness</strong>: Outlier rejection, error propagation, validation at each stage</li>
<li><strong>Observability</strong>: Comprehensive logging, QA plots, API monitoring endpoints</li>
</ol>
<hr/>
<h2 id="critical-lessons-learned">Critical Lessons Learned<a class="headerlink" href="#critical-lessons-learned" title="Permanent link">¶</a></h2>
<h3 id="model_data-column-structure-vs-sky-model-content">MODEL_DATA: Column Structure vs. Sky Model Content<a class="headerlink" href="#model_data-column-structure-vs-sky-model-content" title="Permanent link">¶</a></h3>
<p><strong>Critical Distinction (2025-11-03):</strong></p>
<p>The <code>configure_ms_for_imaging()</code> function (and its helper <code>_ensure_imaging_columns_populated()</code>) only creates the <strong>column structure</strong> for <code>MODEL_DATA</code> - it initializes the column with zeros to match the shape of the <code>DATA</code> column. This is <strong>not</strong> the same as populating it with an actual sky model.</p>
<p><strong>What <code>configure_ms_for_imaging()</code> does:</strong>
- Creates <code>MODEL_DATA</code>, <code>CORRECTED_DATA</code>, <code>WEIGHT_SPECTRUM</code> columns if missing
- Fills them with zeros to match <code>DATA</code> shape/dtype
- Ensures structural integrity for imaging operations</p>
<p><strong>What calibration requires:</strong>
- <code>MODEL_DATA</code> must contain <strong>actual visibility predictions</strong> from a sky model
- This requires a separate step using:
  - <code>setjy</code> for standard calibrators (e.g., 0834+555)
  - <code>ft()</code> with component lists (NVSS catalog sources)
  - <code>write_point_model_with_ft()</code> for point source models
  - <code>write_setjy_model()</code> for standard calibrator models</p>
<p><strong>Pipeline Order:</strong>
1. <strong>Conversion</strong>: Creates MS with <code>MODEL_DATA</code> column structure (zeros)
2. <strong>MODEL_DATA Population</strong>: Populate with sky model (NVSS catalog, setjy, etc.) ← <strong>Required before calibration</strong>
3. <strong>Calibration</strong>: Uses populated <code>MODEL_DATA</code> to solve for gains/delays/bandpass
4. <strong>Apply Calibration</strong>: Writes to <code>CORRECTED_DATA</code>
5. <strong>Imaging</strong>: Uses <code>CORRECTED_DATA</code> (or <code>DATA</code> if uncalibrated) for deconvolution</p>
<p><strong>Why this matters:</strong>
- <code>solve_bandpass()</code>, <code>solve_gains()</code>, and <code>solve_delay()</code> all check that <code>MODEL_DATA</code> is populated (not all zeros) as a precondition
- Without a sky model in <code>MODEL_DATA</code>, calibration cannot determine what signal to calibrate against
- The imaging stage can populate <code>MODEL_DATA</code> with NVSS sources, but this happens <strong>after</strong> calibration in the standard pipeline flow</p>
<h3 id="casa-calibration-tables-are-directories">CASA Calibration Tables Are Directories<a class="headerlink" href="#casa-calibration-tables-are-directories" title="Permanent link">¶</a></h3>
<p><strong>Critical Fix (2025-11-03):</strong></p>
<p>CASA calibration tables (<code>.bpcal</code>, <code>.gpcal</code>, <code>.kcal</code>, etc.) are <strong>directories</strong>, not files, just like Measurement Sets. This is a fundamental CASA table storage format.</p>
<p><strong>Validation Bug Fixed:</strong>
- <strong>Before</strong>: <code>validate_caltable_exists()</code> checked <code>os.path.isfile()</code> - failed for caltables
- <strong>After</strong>: Changed to <code>os.path.isdir()</code> - correctly validates CASA table directories</p>
<p><strong>Impact:</strong>
- All calibration table validation functions must check for directories, not files
- This affects <code>validate_caltable_exists()</code>, <code>validate_caltables_for_use()</code>, and any code that validates caltable paths
- The fix ensures calibration tables are recognized correctly throughout the pipeline</p>
<p><strong>Files affected:</strong>
- <code>src/dsa110_contimg/calibration/validate.py</code>: <code>validate_caltable_exists()</code> function</p>
<h3 id="bandpass-solve-field-selection-and-uv-range-tuning-2025-11-04">Bandpass Solve: Field Selection and UV Range Tuning (2025-11-04)<a class="headerlink" href="#bandpass-solve-field-selection-and-uv-range-tuning-2025-11-04" title="Permanent link">¶</a></h3>
<ul>
<li>Problem observed: During bandpass(), &gt;50% of solutions flagged (low SNR). Root causes in code/config:</li>
<li><code>solve_bandpass()</code> and <code>solve_gains()</code> reduce <code>field</code> to a single "peak" field by taking the last index of a range (e.g., <code>0~15 -&gt; 15</code>), which defeats <code>combine_fields</code> and reduces SNR.</li>
<li>Default <code>uvrange='&gt;1klambda'</code> is too aggressive for DSA-110; it removes many short baselines, further lowering SNR.</li>
<li><code>job_runner</code> does not pass <code>--model-source</code> or <code>--bp-combine-field</code>, risking missing MODEL_DATA and reduced SNR even when UI supports these options.</li>
<li><strong>Pre-bandpass phase solve also had field selection bug</strong> - using peak_field even when <code>combine_fields=True</code>, reducing SNR for phase correction.</li>
<li>
<p><strong>Pre-bandpass phase defaults were suboptimal</strong> - <code>solint='inf'</code> causes decorrelation, and <code>minsnr=5.0</code> is too strict.</p>
</li>
<li>
<p>Lessons/Guidelines:</p>
</li>
<li>When <code>combine_fields</code> is requested, pass the full field selection string to CASA (e.g., <code>field='0~15'</code>) instead of a single field. Only reduce to a single peak field when not combining. <strong>This applies to both bandpass AND pre-bandpass phase solves.</strong></li>
<li>Prefer <code>uvrange=""</code> (no cut) or a relaxed cut (e.g., <code>&gt;0.3klambda</code>) for DSA-110 bandpass solves unless the calibrator is strongly resolved on short baselines.</li>
<li>Expose and plumb a <code>--bp-minsnr</code> parameter (default 3–5) to trade off solution retention vs robustness; use 3.0 for marginal SNR cases.</li>
<li>Ensure MODEL_DATA is populated (e.g., <code>--model-source=catalog</code>) and consider rephasing to the calibrator before <code>ft()</code> to maximize SNR.</li>
<li>Integrate <code>--refant-ranking</code> input to avoid poor/flagged reference antennas.</li>
<li>
<p><strong>Pre-bandpass phase solve defaults</strong>: Use <code>solint='30s'</code> (not <code>'inf'</code>) to handle time-variable phase drifts, and <code>minsnr=3.0</code> (not 5.0) to match bandpass threshold since phase-only solve is more robust.</p>
</li>
<li>
<p>Actionable code pointers:</p>
</li>
<li><code>src/dsa110_contimg/calibration/calibration.py</code>: update <code>solve_bandpass()</code> and <code>solve_gains()</code> to honor <code>combine_fields</code> by using the full <code>cal_field</code> string for CASA <code>field</code> selection when combining. <strong>FIXED: Also updated <code>solve_prebandpass_phase()</code> to use full field range when <code>combine_fields=True</code>.</strong></li>
<li><code>src/dsa110_contimg/calibration/cli.py</code>: when auto-selecting fields, pass the computed peak field for single-field solves; pass full selection when combining; add <code>--bp-minsnr</code> and plumb through. <strong>FIXED: Updated default <code>--prebp-solint</code> to <code>'30s'</code> and <code>--prebp-minsnr</code> to <code>3.0</code>.</strong></li>
<li><code>src/dsa110_contimg/api/job_runner.py</code>: pass <code>--model-source=catalog</code>, <code>--bp-combine-field</code>, and optional <code>--uvrange</code>/<code>--bp-minsnr</code> from UI params.</li>
</ul>
<hr/>
<h2 id="test-organization">Test Organization<a class="headerlink" href="#test-organization" title="Permanent link">¶</a></h2>
<p><strong>Location</strong>: <code>tests/</code> directory (consolidated from <code>tests/</code> and <code>scripts/tests/</code> in 2025-01-15)</p>
<p><strong>Structure</strong>:
- <code>tests/unit/</code> - Pytest unit tests (API routes, module validation)
- <code>tests/integration/</code> - Integration tests (end-to-end pipeline test)
- <code>tests/scripts/</code> - Standalone test/diagnostic scripts (run directly, not via pytest)
- <code>tests/utils/</code> - Test utilities and helper scripts</p>
<p><strong>Key Principles</strong>:
- <strong>Pytest tests</strong> (<code>tests/unit/</code>, <code>tests/integration/</code>) use pytest fixtures and are discovered automatically
- <strong>Standalone scripts</strong> (<code>tests/scripts/</code>) are run directly: <code>python tests/scripts/test_*.py</code>
- <strong>Path references</strong>: All scripts use <code>parent.parent.parent</code> or equivalent to find repo root
- <strong>Configuration</strong>: <code>pytest.ini</code> configured to discover tests in <code>tests/unit</code> and <code>tests/integration</code></p>
<p><strong>Running Tests</strong>:
- Pytest: <code>pytest</code> or <code>pytest tests/unit/</code>
- End-to-end: <code>bash tests/integration/test_pipeline_end_to_end.sh</code>
- Standalone: <code>python tests/scripts/test_suite_comprehensive.py</code></p>
<hr/>
<h2 id="agent-rules-effectiveness-2025-11-12">Agent Rules Effectiveness (2025-11-12)<a class="headerlink" href="#agent-rules-effectiveness-2025-11-12" title="Permanent link">¶</a></h2>
<p><strong>Lesson:</strong> Concise, action-oriented rules in <code>.cursorrules</code> are highly effective at guiding agent behavior.</p>
<p><strong>Problem:</strong> Agents were repeatedly using system Python (<code>python3</code>) instead of casa6, despite existing rules.</p>
<p><strong>Solution:</strong> Updated <code>.cursorrules</code> with:
- Ultra-concise format (3-4 lines max for critical info)
- Action-oriented language ("BEFORE ANY PYTHON EXECUTION")
- Explicit prohibition ("NEVER use python/python3")
- Prominent placement (warning emoji, at top)</p>
<p><strong>Result:</strong> ✅ Test validated - new agent automatically used casa6 without explicit instruction.</p>
<p><strong>Key Principles:</strong>
- Keep critical rules SHORT (agents skip verbose text)
- Use action verbs ("BEFORE", "NEVER", "ALWAYS")
- Place most critical info FIRST
- Link to details rather than embedding them</p>
<p><strong>Reference:</strong> <code>docs/TEST_AGENT_PYTHON_ENV.md</code> for test script and validation results.</p>
<hr/>
<h2 id="documentation-organization-2025-11-12">Documentation Organization (2025-11-12)<a class="headerlink" href="#documentation-organization-2025-11-12" title="Permanent link">¶</a></h2>
<p><strong>CRITICAL RULE:</strong> All markdown documentation files MUST be placed in the <code>docs/</code> directory structure, NOT in the root directory.</p>
<p><strong>Root directory should only contain:</strong>
- <code>README.md</code> - Main project README
- <code>MEMORY.md</code> - Agent memory file (this file)
- <code>TODO.md</code> - Active TODO list</p>
<p><strong>All other documentation goes in <code>docs/</code>:</strong>
- User-facing docs: <code>docs/how-to/</code>, <code>docs/concepts/</code>, <code>docs/reference/</code>, <code>docs/tutorials/</code>
- Development notes: <code>internal/docs/dev/status/</code>, <code>internal/docs/dev/analysis/</code>, <code>internal/docs/dev/notes/</code>
- Historical: <code>docs/archive/</code></p>
<p><strong>Before creating any markdown file:</strong>
1. Check <a href="../../../DOCUMENTATION_QUICK_REFERENCE/"><code>../../DOCUMENTATION_QUICK_REFERENCE.md</code></a> for where to put it
2. Use lowercase_with_underscores naming (not UPPERCASE)
3. Never create files in root directory</p>
<p><strong>See also:</strong>
- <a href="../../../DOCUMENTATION_CONSOLIDATION_STRATEGY/">Documentation Consolidation Strategy</a>
- <a href="../../../DOCUMENTATION_QUICK_REFERENCE/">Documentation Quick Reference</a>
- Cursor Rule: Documentation Location: <code>../../../.cursor/rules/documentation-location.mdc</code> (external file)</p>
<hr/>
<h2 id="related-documentation">Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">¶</a></h2>
<ul>
<li><strong>Quick Start</strong>: <code>docs/quickstart.md</code></li>
<li><strong>Pipeline Flow</strong>: <code>docs/pipeline.md</code></li>
<li><strong>Deep Understanding</strong>: <code>docs/analysis/PIPELINE_DEEP_UNDERSTANDING.md</code> - Comprehensive architecture and data flow documentation</li>
<li><strong>Development History</strong>: <code>docs/analysis/CURSOR_CHAT_DEVELOPMENT_HISTORY.md</code> - Key development decisions, bug fixes, and implementation details from AI-assisted development sessions</li>
<li><strong>ESE Literature Summary</strong>: <code>docs/reports/ESE_LITERATURE_SUMMARY.md</code></li>
<li><strong>Photometry Normalization</strong>: <code>docs/science/photometry_normalization.md</code></li>
<li>See internal documentation for schema and guardrails.</li>
<li><strong>Control Panel</strong>: <code>docs/guides/control-panel/</code></li>
<li><strong>Complete Project Review</strong>: <code>docs/reports/COMPLETE_PROJECT_REVIEW.md</code></li>
<li><strong>Test Suite</strong>: <code>tests/README.md</code></li>
<li><strong>Robustness Analysis</strong>: <code>docs/reports/PIPELINE_ROBUSTNESS_ANALYSIS.md</code> - Comprehensive analysis of pipeline robustness with actionable recommendations for error handling, resource management, state consistency, and observability</li>
</ul>
<hr/>
<h2 id="redundancies-and-confusion-risks-2025-11-04">Redundancies and Confusion Risks (2025-11-04)<a class="headerlink" href="#redundancies-and-confusion-risks-2025-11-04" title="Permanent link">¶</a></h2>
<ul>
<li>Unifying CASA logging helpers: <code>dsa110_contimg.utils.cli_helpers.casa_log_environment</code> duplicates <code>dsa110_contimg.utils.tempdirs.casa_log_environment</code>. Prefer a single source of truth (recommend <code>utils.tempdirs</code>) and update imports; optionally re-export from <code>cli_helpers</code> to avoid breaking changes. Also align <code>setup_casa_environment()</code>/<code>setup_casa_logging()</code> semantics under one API.</li>
<li>Headless CASA setup is applied ad hoc across modules (<code>calibration/cli.py</code>, <code>calibration/flagging.py</code>, <code>qa/casa_ms_qa.py</code>, <code>qa/plotting.py</code>, <code>qa/sanity_plotms.py</code>, some tests). Centralize headless config (e.g., <code>utils.casa_env.ensure_headless()</code>), and call it consistently early in CLIs and any CASA-using code.</li>
<li>CLI consistency gaps: Some CLIs use shared helpers (<code>conversion/cli.py</code>, <code>calibration/cli.py</code>, <code>imaging/cli.py</code>, <code>pointing/cli.py</code>), while others don’t (<code>mosaic/cli.py</code>, <code>beam/cli.py</code>). Adopt <code>add_common_logging_args()</code> and <code>configure_logging_from_args()</code> everywhere; consider adding <code>add_progress_flag()</code> + <code>utils.progress.should_disable_progress()</code> usage or removing the unused helper.</li>
<li>Repeated CASA log env setup in <code>api/job_runner.py</code> (multiple places set <code>CASALOGFILE</code> and chdir). Factor into a helper (e.g., <code>_with_casa_log_env(env)</code> or reuse <code>utils.tempdirs.setup_casa_logging()</code> + <code>casa_log_environment()</code> for subprocess cwd).</li>
<li>Duplicate antenna coordinate CSVs: both <code>src/dsa110_contimg/utils/antpos_local/data/DSA110_Station_Coordinates.csv</code> and <code>src/dsa110_contimg/utils/data/DSA110_Station_Coordinates.csv</code> exist. Consolidate to one authoritative path and update code/docs accordingly.</li>
<li>Outdated notebook reference: <code>docs/notebooks/ms_staging_workflow.ipynb</code> still references <code>dsa110_contimg.conversion.uvh5_to_ms_converter_v2</code> (removed). Update to <code>conversion.strategies.hdf5_orchestrator</code> or <code>conversion.cli</code> to match current docs.</li>
<li><code>__main__</code> exit patterns are inconsistent (<code>main()</code> vs <code>raise SystemExit(main())</code>). Standardize to ensure exit codes propagate correctly, especially for scripts used in automation.</li>
<li>Avoid changing CWD at import time: several CLIs call <code>setup_casa_environment()</code> at module import, which changes the working directory globally on import. Move to <code>main()</code> or use <code>casa_log_environment()</code> around CASA task calls.</li>
<li>Env var namespaces: mixture of <code>CONTIMG_*</code> and <code>PIPELINE_*</code>. Backward-compat is fine (e.g., <code>derive_casa_log_dir()</code> honors both), but document precedence and prefer <code>CONTIMG_*</code> in new code.</li>
</ul>
<p>These should reduce drift, improve predictability, and make the CLIs/API easier to maintain.</p>
<hr/>
<h2 id="ops-directory-redundancies-2025-11-12">Ops Directory Redundancies (2025-11-12)<a class="headerlink" href="#ops-directory-redundancies-2025-11-12" title="Permanent link">¶</a></h2>
<h3 id="legacy-systemd-service-file">Legacy Systemd Service File<a class="headerlink" href="#legacy-systemd-service-file" title="Permanent link">¶</a></h3>
<p><strong>Problem:</strong> Duplicate streaming converter service files:
- <code>ops/pipeline/dsa110-streaming-converter.service</code> (legacy, hardcoded paths)
- <code>ops/systemd/contimg-stream.service</code> (current, uses environment file)</p>
<p><strong>Key Lessons:</strong>
- <strong>Use <code>ops/systemd/contimg-stream.service</code></strong> as the canonical service file
- <strong>Legacy file</strong> uses hardcoded paths and old module structure
- <strong>Current file</strong> uses environment variables and modern configuration
- <strong>Action:</strong> Archive or remove legacy file, document canonical service in INSTALL.md</p>
<h3 id="duplicate-helper-functions-in-opspipeline">Duplicate Helper Functions in ops/pipeline/<a class="headerlink" href="#duplicate-helper-functions-in-opspipeline" title="Permanent link">¶</a></h3>
<p><strong>Problem:</strong> Multiple scripts duplicate identical helper functions:</p>
<p><strong>Catalog Loading Functions:</strong>
- <code>_load_ra_dec()</code> appears in 3+ files with slight variations
- <code>_load_flux_jy()</code> appears in 2+ files with slight variations
- Some files have DB-aware versions, others don't</p>
<p><strong>MS Writing Functions:</strong>
- <code>_write_ms_group_via_uvh5_to_ms()</code> appears in 4 files with ~300 lines of duplicated code
- All use <code>uvh5_to_ms</code> directly instead of orchestrator (production path)</p>
<p><strong>Group ID Parsing:</strong>
- <code>_group_id_from_path()</code> appears in 4 files with identical logic</p>
<p><strong>Key Lessons:</strong>
- <strong>Create shared helpers</strong>: <code>ops/pipeline/calibrator_helpers.py</code> for catalog loading
- <strong>Prefer orchestrator</strong>: Use <code>hdf5_orchestrator</code> CLI instead of direct <code>uvh5_to_ms</code> calls
- <strong>Consolidate logic</strong>: Reduces ~500 lines of duplicated code across scripts</p>
<h3 id="overlapping-cleanup-routines">Overlapping Cleanup Routines<a class="headerlink" href="#overlapping-cleanup-routines" title="Permanent link">¶</a></h3>
<p><strong>Problem:</strong> Multiple cleanup scripts with overlapping functionality:
- <code>ops/pipeline/housekeeping.py</code> - Queue recovery, temp dir cleanup
- <code>ops/pipeline/cleanup_old_data.py</code> - MS file deletion, log compression
- <code>ops/pipeline/scheduler.py</code> - Calls housekeeping, also does mosaicking</p>
<p><strong>Key Lessons:</strong>
- <strong>Integrate cleanup_old_data.py into housekeeping.py</strong> for unified cleanup
- <strong>Update scheduler.py</strong> to call all cleanup functions
- <strong>Single entry point</strong> for all cleanup tasks improves maintainability</p>
<h3 id="similar-calibrator-processing-scripts">Similar Calibrator Processing Scripts<a class="headerlink" href="#similar-calibrator-processing-scripts" title="Permanent link">¶</a></h3>
<p><strong>Problem:</strong> Two scripts with ~400 lines of duplicated calibration logic:
- <code>ops/pipeline/build_central_calibrator_group.py</code> - Single central group
- <code>ops/pipeline/build_calibrator_transit_offsets.py</code> - Multiple groups in window</p>
<p><strong>Key Lessons:</strong>
- <strong>Extract shared calibration pipeline</strong> to <code>ops/pipeline/calibrator_pipeline.py</code>
- <strong>Keep scripts as thin wrappers</strong> that find groups and call shared pipeline
- <strong>Reduces duplication</strong> by ~400 lines, improves maintainability</p>
<p>See <code>docs/OPS_REDUNDANCY_ANALYSIS.md</code> for comprehensive analysis and recommendations.</p>
<hr/>
<h2 id="new-lessons-2025-11-05">New Lessons (2025-11-05)<a class="headerlink" href="#new-lessons-2025-11-05" title="Permanent link">¶</a></h2>
<ul>
<li>Phase angle handling: When converting phases from radians to degrees for QA metrics or plotting, wrap to [-180, 180) to avoid artificial scatter and discontinuities at ±180°. A new helper <code>dsa110_contimg.utils.angles.wrap_phase_deg()</code> provides consistent wrapping; use this instead of raw <code>np.degrees()</code> outputs for phase statistics and plots.</li>
<li>Implementation notes:</li>
<li>QA: <code>qa/calibration_quality.py</code> now wraps phases before computing median/std/RMS.</li>
<li>API plots: <code>api/routes.py</code> wraps phases in <code>phase_vs_time</code> and <code>phase_vs_freq</code> plots.</li>
<li>
<p>Keep RA/Dec handling unchanged (astropy Angle or simple degrees is fine); wrapping is primarily for phases.</p>
</li>
<li>
<p><strong>CRITICAL: CASA ft() Phase Center Bug (2025-11-05):</strong></p>
</li>
<li><strong>Root Cause:</strong> CASA's <code>ft()</code> task (used by <code>setjy</code> internally) does NOT use <code>PHASE_DIR</code> or <code>REFERENCE_DIR</code> from the FIELD table. Instead, it determines phase center from the DATA column's original phasing (UVW coordinates). This causes MODEL_DATA to be misaligned with DATA when the MS has been rephased, leading to 100°+ phase scatter and calibration failures.</li>
<li><strong>Solution:</strong> When rephasing is performed, automatically use manual MODEL_DATA calculation instead of <code>ft()</code>/<code>setjy</code>. Manual calculation reads <code>PHASE_DIR</code> per field and ensures correct phase structure.</li>
<li><strong>Implementation:</strong><ul>
<li><code>--model-source catalog</code>: Already uses manual calculation when rephasing is done ✓</li>
<li><code>--model-source setjy</code>: Now detects if MS was rephased and uses manual calculation if calibrator coordinates are available (<code>--cal-ra-deg</code>, <code>--cal-dec-deg</code>, <code>--cal-flux-jy</code>)</li>
<li><code>--model-source component/image</code>: Still uses <code>ft()</code> (no easy conversion); warnings added</li>
</ul>
</li>
<li><strong>Best Practice:</strong> When rephasing MS, use <code>--model-source catalog</code> with calibrator coordinates, or provide coordinates when using <code>--model-source setjy</code>. Avoid component/image models when rephasing.</li>
<li><strong>Verification:</strong> Test script <code>scripts/test_ft_phase_dir_corrected.py</code> confirms ft() doesn't use PHASE_DIR (104.5° scatter even when component is at PHASE_DIR position).</li>
<li>
<p><strong>References:</strong> <code>docs/reports/FT_PHASE_CENTER_FIX.md</code>, <code>docs/reports/FT_PHASE_CENTER_TEST_RESULTS.md</code></p>
</li>
<li>
<p><strong>AOFlagger Docker Installation (2025-11-12):</strong></p>
</li>
<li>AOFlagger installed via Docker to resolve Ubuntu 18.x compatibility issues (CMake version conflicts with pybind11)</li>
<li>Dockerfile pattern mirrors WSClean installation (<code>~/proj/wsclean/Dockerfile.everybeam-0.7.4</code>)</li>
<li><strong>Location:</strong> <code>~/proj/aoflagger/Dockerfile</code> and <code>~/proj/aoflagger/build-docker.sh</code></li>
<li><strong>Base image:</strong> Ubuntu 24.04 (modern CMake, GCC 13) to avoid host system CMake version issues</li>
<li><strong>Dependencies:</strong> casacore (built from source), HDF5, CFITSIO, FFTW3, GSL, Boost, Lua 5.3, Python/pybind11, PNG</li>
<li><strong>GUI disabled:</strong> Built with <code>-DENABLE_GUI=OFF</code> to avoid GTKMM dependency</li>
<li><strong>Image tag:</strong> <code>aoflagger:latest</code> (version 3.4, 2023-10-06)</li>
<li><strong>Usage:</strong> <code>docker run --rm -v /scratch:/scratch -v /data:/data aoflagger:latest aoflagger &lt;args&gt;</code></li>
<li><strong>Integration:</strong> Can be used as alternative to CASA <code>flagdata</code> for RFI flagging (see <code>docs/reports/ALTERNATIVE_RFI_FLAGGING_METHODS.md</code>)</li>
<li><strong>Note:</strong> Similar to WSClean, this must run in Docker container on Ubuntu 18.x hosts due to glibc version requirements</li>
</ul>
<h2 id="streaming-mode-procedure-2025-11-06">Streaming Mode Procedure (2025-11-06)<a class="headerlink" href="#streaming-mode-procedure-2025-11-06" title="Permanent link">¶</a></h2>
<ul>
<li><strong>Description</strong>: Real-time processing of incoming UVH5 subband files: watches input directory, groups by timestamp and subband, converts to MS using hdf5_orchestrator.</li>
<li><strong>Scope</strong>: conversion</li>
<li><strong>Parameters</strong>: input_dir, ms_dir, group_timeout, max_retries</li>
<li><strong>Preferences</strong>:</li>
<li>Name: streaming/tmpfs_staging</li>
<li>Key: stage_to_tmpfs</li>
<li>Value: true</li>
<li>Category: performance</li>
<li>Applies to: procedure</li>
<li><strong>Relationships</strong>:</li>
<li>Procedure:streaming/conversion --HAS_PREFERENCE--&gt; Preference:streaming/tmpfs_staging</li>
<li>Procedure:streaming/conversion --REQUIRES_HONING--&gt; automation, error_recovery, scalability</li>
</ul>
<h3 id="workflow">Workflow<a class="headerlink" href="#workflow" title="Permanent link">¶</a></h3>
<ol>
<li>Deploy via systemd or Docker to watch input directory.</li>
<li>Group arriving *_sb??.hdf5 files by 5-min timestamp windows (16 subbands).</li>
<li>Convert complete groups to MS using direct_subband writer (parallel + CASA concat).</li>
<li>Optionally trigger downstream calibration/imaging via API/scripts.</li>
</ol>
<h3 id="readiness">Readiness<a class="headerlink" href="#readiness" title="Permanent link">¶</a></h3>
<ul>
<li>Core machinery (watcher, queuing, conversion) is functional and tested.</li>
<li>Needs honing: automate downstream triggering, improve error recovery, scale testing for high-volume streams.</li>
<li>Open TODO: Automate full streaming with ESE flagging; optimize for low-latency previews.</li>
</ul>
<h2 id="casa-mpi-evaluation-2025-11-12">CASA-mpi Evaluation (2025-11-12)<a class="headerlink" href="#casa-mpi-evaluation-2025-11-12" title="Permanent link">¶</a></h2>
<p><strong>Context</strong>: Evaluated CASA-mpi for MPI parallelization on remote HPC server.</p>
<p><strong>Key Findings</strong>:
- <strong>Recommendation: NOT RECOMMENDED</strong> for current pipeline
- <strong>Primary reason</strong>: Pipeline uses WSClean (2-5x faster than tclean), not CASA tclean
- <strong>Infrastructure blocker</strong>: HPC has OpenMPI 2.1.1, but CASA-mpi requires OpenMPI &gt;= 5.0
- <strong>Limited benefit</strong>: Current parallelization (ProcessPoolExecutor) already handles independent MS operations efficiently
- <strong>Complexity cost</strong>: Would require MPI upgrade + code changes for marginal gains</p>
<p><strong>When to reconsider</strong>:
- If switching to tclean as primary backend (unlikely given WSClean performance)
- If processing large spectral cubes (not current use case)
- If HPC infrastructure upgraded and multi-node MPI needed</p>
<p><strong>Current parallelization strategy</strong> (sufficient):
- Conversion: Parallel per-subband writes (16 workers)
- Independent MS: ProcessPoolExecutor (2-4x speedup)
- Imaging: WSClean with OpenMP threads (no MPI needed)</p>
<p><strong>Documentation</strong>: See <code>docs/reports/CASA_MPI_EVALUATION.md</code> for complete analysis.</p>
<h2 id="deep-dive-issues-analysis-2025-11-12">Deep Dive Issues Analysis (2025-11-12)<a class="headerlink" href="#deep-dive-issues-analysis-2025-11-12" title="Permanent link">¶</a></h2>
<p><strong>Comprehensive codebase analysis</strong> identified critical security vulnerabilities, resource management issues, and areas for improvement.</p>
<p><strong>Critical Findings:</strong></p>
<ol>
<li><strong>SQL Injection Vulnerabilities</strong> (CRITICAL):</li>
<li>Dynamic SQL construction using f-strings in multiple files</li>
<li>Table/column names interpolated directly from user input</li>
<li>Affected files: <code>api/routes.py</code>, <code>database/data_registry.py</code>, <code>database/jobs.py</code>, <code>mosaic/validation.py</code>, <code>catalog/build_master.py</code></li>
<li>
<p><strong>Fix</strong>: Use parameterized queries, whitelist table/column names, never interpolate table names directly</p>
</li>
<li>
<p><strong>Thread Safety Issues</strong> (CRITICAL):</p>
</li>
<li>SQLite connections with <code>check_same_thread=False</code> but shared across threads</li>
<li>Lock protects individual operations but not multi-step transactions</li>
<li>Risk of database corruption with concurrent writes</li>
<li>
<p><strong>Fix</strong>: Use per-operation connections or WAL mode, implement proper transaction boundaries</p>
</li>
<li>
<p><strong>Resource Leak Risks</strong> (HIGH):</p>
</li>
<li>Database connections not always closed in error paths</li>
<li>Temporary files may not be cleaned up if exceptions occur</li>
<li>CASA file handles can leak if cleanup not called</li>
<li>
<p><strong>Fix</strong>: Use context managers consistently, ensure cleanup in all error paths</p>
</li>
<li>
<p><strong>Path Traversal Vulnerability</strong> (HIGH):</p>
</li>
<li>API endpoint <code>/qa/file/{group}/{name}</code> has fallback path check vulnerable to symlink attacks</li>
<li>No validation that path components don't contain separators</li>
<li>
<p><strong>Fix</strong>: Validate input format, use safe path operations, handle symlinks correctly</p>
</li>
<li>
<p><strong>Error Handling Inconsistencies</strong> (HIGH):</p>
</li>
<li>265+ broad <code>except Exception:</code> clauses</li>
<li>Missing cleanup in error paths</li>
<li>Error context may be lost</li>
<li><strong>Fix</strong>: Catch specific exceptions, use exception chaining, ensure cleanup</li>
</ol>
<p><strong>Medium Priority Issues (FIXED):</strong>
- Configuration validation gaps (env vars used without validation) - <strong>FIXED</strong>: Added safe_int/safe_float helpers with type and range validation
- File locking issues (stale locks, no cleanup) - <strong>FIXED</strong>: Added cleanup_stale_locks() function with PID validation and timeout
- Race conditions in concurrent database operations - <strong>FIXED</strong>: Already addressed in CRITICAL fixes (WAL mode, explicit transactions)
- Performance bottlenecks (queries fetching all rows, missing indexes) - <strong>VERIFIED</strong>: All queries use WHERE clauses properly, no issues found</p>
<p><strong>Documentation</strong>: See <code>docs/reports/MEDIUM_PRIORITY_FIXES_SUMMARY.md</code> for complete details.</p>
<p><strong>Reassessment</strong>: See <code>docs/reports/REASSESSED_ISSUES_PRIORITY.md</code> for updated priority classification after fixes.</p>
<p><strong>Full Report</strong>: <code>docs/reports/DEEP_DIVE_ISSUES_REPORT.md</code></p>
<h2 id="post-fix-reassessment-2025-11-12">Post-Fix Reassessment (2025-11-12)<a class="headerlink" href="#post-fix-reassessment-2025-11-12" title="Permanent link">¶</a></h2>
<p><strong>Priority Reclassification</strong> completed after applying fixes:</p>
<p><strong>CRITICAL Issues:</strong> ✅ All fixed (2/2)
- SQL injection vulnerabilities - FIXED
- Thread safety issues - FIXED</p>
<p><strong>HIGH Priority Issues Remaining:</strong> 1/4
- ✅ Path traversal vulnerability - FIXED
- ✅ Resource cleanup (partial) - IMPROVED
- ⚠️ Error handling inconsistencies - REMAINING (731 broad exception catches across 114 files)
- ⚠️ CASA file handle leaks - DOWNGRADED to MEDIUM (mitigation exists)</p>
<p><strong>MEDIUM Priority Issues:</strong> 3/5 remaining
- ✅ Configuration validation - FIXED
- ✅ File locking issues - FIXED
- ✅ Database query patterns - VERIFIED (no issues)
- ⚠️ Path validation at config load - PARTIAL (function exists, not auto-called)
- ⚠️ Missing default values documentation - REMAINING</p>
<p><strong>Key Insights:</strong>
- Most critical security issues resolved
- Error handling remains the largest operational concern (HIGH priority)
- CASA file handle management downgraded to MEDIUM (mitigation exists, low probability)
- Mosaic validation dynamic IN clause verified safe (uses parameterized queries)</p>
<p><strong>Next Steps:</strong>
1. ✅ Address error handling inconsistencies systematically (HIGH priority) - DONE
2. ✅ Add CASA context manager wrapper (MEDIUM priority) - DONE
3. ✅ Add automatic path validation to config loading (MEDIUM priority) - DONE
4. ✅ Create comprehensive configuration documentation (MEDIUM priority) - DONE</p>
<h2 id="code-quality-improvements-2025-11-12">Code Quality Improvements (2025-11-12)<a class="headerlink" href="#code-quality-improvements-2025-11-12" title="Permanent link">¶</a></h2>
<p><strong>High-priority work completed</strong> for systematic code quality improvements across the codebase.</p>
<p><strong>Completed:</strong>
1. <strong>Logging Consistency</strong> - Fixed critical paths
   - <code>direct_subband.py</code>: Replaced 10+ <code>print()</code> statements with logger calls
   - <code>catalog/build_master.py</code>: Added logging alongside user-facing print statements
   - Established patterns for remaining 28 files</p>
<ol>
<li><strong>Error Message Consistency</strong> - Standardized exception handling</li>
<li><code>orchestrator.py</code>: More specific exception catching, better error context</li>
<li><code>api/job_adapters.py</code>: All job functions now use unified exception hierarchy<ul>
<li><code>run_convert_job()</code>: Uses <code>ValidationError</code> and <code>ConversionError</code></li>
<li><code>run_calibrate_job()</code>: Uses <code>ValidationError</code> with specific exception catching</li>
<li><code>run_apply_job()</code>: Uses <code>ValidationError</code> with specific exception catching</li>
<li><code>run_image_job()</code>: Uses <code>ValidationError</code> and <code>ImagingError</code></li>
</ul>
</li>
<li>
<p>All exceptions now include context and actionable suggestions</p>
</li>
<li>
<p><strong>Type Safety</strong> - Cleanup and verification</p>
</li>
<li>Removed unused imports from <code>job_adapters.py</code></li>
<li>Verified database functions have proper type hints</li>
<li>Created guide for addressing remaining <code># type: ignore</code> comments</li>
</ol>
<p><strong>Documentation:</strong>
- <code>docs/reports/CODE_QUALITY_IMPROVEMENTS_GUIDE.md</code> - Comprehensive guide with patterns and priorities
- <code>docs/reports/CODE_QUALITY_COMPLETION_SUMMARY.md</code> - Summary and remaining work tracking
- <code>docs/reports/CODE_QUALITY_WORK_COMPLETED.md</code> - Detailed completion report</p>
<p><strong>Additional Work Completed:</strong>
- <code>calibration/cli_calibrate.py</code>: Added logging alongside user-facing print statements
- <code>conversion/cli.py</code>: Added logging module and logger calls
- <code>imaging/cli.py</code>: Added logger calls for warnings
- <code>calibration/calibration.py</code>: Replaced print() with logger.info()
- <code>conversion/strategies/hdf5_orchestrator.py</code>: Replaced print() with logger.debug()</p>
<p>Immediate next steps:
Complete qa/calibration_quality.py logging (highest impact)
Standardize exceptions in core conversion modules
Add type hints to helper functions<strong>Low Priority Work Completed:</strong>
- <code>qa/calibration_quality.py</code>: Replaced print() with logger calls in key functions
- <code>mosaic/cli.py</code>: Added logger calls alongside user-facing print statements</p>
<p><strong>Remaining Work (Low Priority):</strong>
- <strong>Logging:</strong> 579 print() statements across 44 files (~7% complete)
  - <code>qa/calibration_quality.py</code>: ~95 print() statements remaining (highest priority)
  - CLI tools: ~15 files with user-facing print() statements (medium priority)
  - Utility/test files: ~20 files (low priority)
- <strong>Error messages:</strong> 258 generic exceptions across 47 files (~4% complete)
  - Core conversion/calibration: ~10 files (high priority)
  - Supporting modules: ~15 files (medium priority)
  - Utility modules: ~20 files (low priority)
- <strong>Type safety:</strong> 101 <code># type: ignore</code> comments across 35 files (~5% complete)
  - ~60 acceptable (CASA libraries without stubs)
  - ~40 can be improved (helper functions, CLI parsing)</p>
<p><strong>Progress Report:</strong> See <code>docs/reports/CODE_QUALITY_PROGRESS_REPORT.md</code> for detailed status</p>
<p><strong>Impact:</strong>
- Critical paths now use proper logging infrastructure
- Better error messages with actionable suggestions
- Consistent exception handling patterns established
- Foundation ready for incremental improvements</p>
<p><strong>Action Items:</strong>
1. Fix SQL injection vulnerabilities immediately (CRITICAL)
2. Fix thread safety issues before production deployment (CRITICAL)
3. Add resource cleanup guarantees (HIGH)
4. Improve path traversal protection (HIGH)
5. Standardize error handling (HIGH)</p>
<hr/>
<h2 id="mosaic-construction-workflow">Mosaic Construction Workflow<a class="headerlink" href="#mosaic-construction-workflow" title="Permanent link">¶</a></h2>
<h3 id="building-60-minute-mosaics-around-vla-calibrators">Building 60-Minute Mosaics Around VLA Calibrators<a class="headerlink" href="#building-60-minute-mosaics-around-vla-calibrators" title="Permanent link">¶</a></h3>
<p><strong>Key Concept:</strong> A mosaic combines multiple 5-minute tiles (images) into a single larger image covering a wider field of view. For a 60-minute mosaic around VLA calibrator 0834+555:</p>
<ol>
<li><strong>Transit Time Calculation</strong></li>
<li>Use <code>dsa110_contimg.calibration.schedule.previous_transits()</code> to find transit times</li>
<li>Transit occurs when source RA equals Local Sidereal Time (LST)</li>
<li>Example: <code>previous_transits(ra_deg, start_time=Time("2025-11-02 23:59:59"), n=10)</code></li>
<li>
<p>Returns list of transit Time objects</p>
</li>
<li>
<p><strong>Time Window Selection</strong></p>
</li>
<li>60-minute window = ±30 minutes around transit</li>
<li>Convert to Unix timestamps for mosaic CLI: <code>int(time.unix)</code></li>
<li>
<p>Window should span 12 complete 5-minute groups</p>
</li>
<li>
<p><strong>Data Processing Pipeline</strong> (if tiles don't exist)</p>
</li>
<li><strong>Conversion</strong>: HDF5 groups → MS files (<code>hdf5_orchestrator.py</code>)</li>
<li><strong>Calibration</strong>: BP + G calibration (<code>calibration.cli calibrate</code>)</li>
<li><strong>Imaging</strong>: MS → PB-corrected images (<code>imaging.cli image --pbcor</code>)</li>
<li>
<p><strong>Registration</strong>: Images registered in products DB</p>
</li>
<li>
<p><strong>Mosaic Planning</strong></p>
</li>
<li>Query products DB for PB-corrected tiles in time window</li>
<li>Use <code>mosaic.cli plan</code> with <code>--since</code> and <code>--until</code> epoch timestamps</li>
<li>Method options: <code>pbweighted</code> (recommended), <code>weighted</code>, <code>mean</code></li>
<li>
<p>Plan stored in <code>mosaics</code> table in products DB</p>
</li>
<li>
<p><strong>Mosaic Building</strong></p>
</li>
<li>Use <code>mosaic.cli build</code> with planned mosaic name</li>
<li>Validates tiles (grid consistency, astrometry, calibration, PB)</li>
<li>Computes pixel-by-pixel weights: <code>weight = pb^2 / noise_variance</code></li>
<li>Combines tiles: <code>mosaic = sum(weight * tile) / sum(weight)</code></li>
<li>Exports FITS file for analysis</li>
</ol>
<p><strong>Key Files:</strong>
- <code>scripts/build_0834_transit_mosaic.py</code>: Simple script for 0834+555 mosaics
- <code>scripts/build_60min_mosaic.py</code>: Comprehensive end-to-end workflow
- <code>src/dsa110_contimg/mosaic/cli.py</code>: Mosaic planning and building CLI
- <code>src/dsa110_contimg/mosaic/cli.py:_build_weighted_mosaic()</code>: PB-weighted combination logic</p>
<p><strong>Important Notes:</strong>
- All tiles must be PB-corrected (<code>pbcor=1</code> in products DB)
- Tiles must have consistent grids (same pixel scale, alignment)
- PB images must exist for PB-weighted method
- Validation checks ensure science quality before building
- Use <code>--dry-run</code> to validate without building</p>
<p><strong>Quick Reference:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Find transit and plan mosaic</span>
python<span class="w"> </span>scripts/build_0834_transit_mosaic.py

<span class="c1"># Or step-by-step:</span>
python<span class="w"> </span>-m<span class="w"> </span>dsa110_contimg.mosaic.cli<span class="w"> </span>plan<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--products-db<span class="w"> </span>state/products.sqlite3<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>0834_transit_2025-11-02<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--since<span class="w"> </span>&lt;start_epoch&gt;<span class="w"> </span>--until<span class="w"> </span>&lt;end_epoch&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--method<span class="w"> </span>pbweighted

python<span class="w"> </span>-m<span class="w"> </span>dsa110_contimg.mosaic.cli<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--products-db<span class="w"> </span>state/products.sqlite3<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>0834_transit_2025-11-02<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--output<span class="w"> </span>/stage/dsa110-contimg/mosaics/0834_transit_2025-11-02.image
</code></pre></div></p>
<h2 id="deep-study-summary-2025-11-12">Deep Study Summary (2025-11-12)<a class="headerlink" href="#deep-study-summary-2025-11-12" title="Permanent link">¶</a></h2>
<p><strong>Comprehensive Codebase Analysis:</strong></p>
<p>A deep study of the entire dsa110-contimg codebase was conducted, covering architecture, implementation patterns, database schema, deployment options, and key technical decisions.</p>
<p><strong>Key Findings:</strong></p>
<ol>
<li><strong>Architecture Overview:</strong></li>
<li>Production-ready radio astronomy pipeline with 8 core components</li>
<li>Streaming converter → Conversion → Calibration → Imaging → Photometry → ESE Detection</li>
<li>~50,000+ lines of Python code, well-organized modular structure</li>
<li>Comprehensive FastAPI monitoring API (4000+ lines in routes.py)</li>
<li>169+ Python modules, 883+ classes and functions, 1,265+ import statements</li>
<li>
<p>Modern React/TypeScript frontend with WebSocket support for real-time updates</p>
</li>
<li>
<p><strong>Database Schema:</strong></p>
</li>
<li>Products DB: <code>ms_index</code> (renamed to <code>ms_all</code>), <code>images</code> (renamed to <code>images_all</code>), <code>photometry_timeseries</code>, <code>variability_stats</code>, <code>ese_candidates</code>, <code>mosaics</code>, <code>regions</code>, <code>alert_history</code></li>
<li>Queue DB: <code>ingest_queue</code>, <code>subband_files</code>, <code>performance_metrics</code></li>
<li>Cal Registry DB: <code>caltables</code> with validity windows and apply order</li>
<li>Catalog DBs: <code>vla_calibrators.sqlite3</code>, <code>master_sources.sqlite3</code></li>
<li>
<p>Storage location registry: <code>storage_locations</code> table tracks base directories</p>
</li>
<li>
<p><strong>Technical Patterns:</strong></p>
</li>
<li>Strategy pattern for writer selection (production vs testing)</li>
<li>Pipeline orchestration framework with dependency resolution (<code>pipeline/orchestrator.py</code>)</li>
<li>SQLite-first approach for all persistent state</li>
<li>tmpfs staging for 3-5x conversion speedup (<code>/dev/shm</code>)</li>
<li>Factory pattern for writer creation (<code>get_writer()</code>)</li>
<li>Repository pattern for database access (<code>database/products.py</code>, <code>database/registry.py</code>)</li>
<li>Observer pattern for pipeline observability (<code>pipeline/observability.py</code>)</li>
<li>
<p>Stage-based execution with retry policies and error recovery</p>
</li>
<li>
<p><strong>Critical Technical Decisions:</strong></p>
</li>
<li>casa6 Python environment is MANDATORY (never use system Python)</li>
<li>K-calibration skipped by default for DSA-110 (short baselines &lt;2.6 km)</li>
<li>WSClean default backend (2-5x faster than tclean)</li>
<li>Differential photometry normalization achieves 1-2% relative precision</li>
<li>Single shared phase center for entire group (prevents discontinuities)</li>
<li>CASA ft() phase center bug fixed (manual MODEL_DATA calculation when rephased)</li>
<li>
<p>MS files written directly to organized locations (<code>ms/science/YYYY-MM-DD/</code>, <code>ms/calibrators/YYYY-MM-DD/</code>)</p>
</li>
<li>
<p><strong>Code Quality Status:</strong></p>
</li>
<li>Critical security issues fixed (SQL injection, thread safety)</li>
<li>Logging consistency: ~7% complete (579 print() statements remaining across 44 files)</li>
<li>Error handling: ~4% complete (258 generic exceptions remaining across 47 files)</li>
<li>Type safety: ~5% complete (101 <code># type: ignore</code> comments across 35 files)</li>
<li>
<p>Remaining: 731 broad exception catches across 114 files (HIGH priority)</p>
</li>
<li>
<p><strong>Deployment Options:</strong></p>
</li>
<li>Systemd (recommended for streaming worker)</li>
<li>Docker Compose (good for API and reproducible deployments)</li>
<li>Frontend: React/TypeScript dashboard with WebSocket support</li>
<li>
<p>Scheduler service for automated housekeeping and nightly mosaics</p>
</li>
<li>
<p><strong>Frontend Architecture:</strong></p>
</li>
<li>React 18+ with TypeScript</li>
<li>Vite build system</li>
<li>WebSocket for real-time pipeline status updates</li>
<li>JS9 integration for image visualization</li>
<li>Component structure: Pages → Components → API layer</li>
<li>
<p>Key pages: Dashboard, Control Panel, Sky Viewer, Source Monitoring, Mosaic Gallery</p>
</li>
<li>
<p><strong>Pipeline Orchestration Framework:</strong></p>
</li>
<li>Declarative stage definitions with dependencies</li>
<li>Topological sorting for execution order</li>
<li>Retry policies with exponential backoff</li>
<li>Context passing between stages</li>
<li>Observability hooks for metrics and logging</li>
<li>Standard workflows: <code>standard_imaging_workflow()</code>, <code>quicklook_workflow()</code></li>
</ol>
<p><strong>Documentation:</strong>
- Complete deep study summary: <code>docs/analysis/DEEP_STUDY_COMPREHENSIVE.md</code> (new comprehensive version)
- Previous summary: <code>docs/analysis/DEEP_STUDY_SUMMARY.md</code>
- Comprehensive architecture details: <code>docs/analysis/PIPELINE_DEEP_UNDERSTANDING.md</code>
- Pipeline flow visualization: <code>docs/concepts/pipeline_overview.md</code>
- Directory architecture: <code>docs/concepts/DIRECTORY_ARCHITECTURE.md</code></p>
<p><strong>Key Strengths:</strong>
- Clear architecture with well-defined data flow
- Production-ready deployment options
- Comprehensive monitoring and QA
- Scientific accuracy (1-2% relative flux precision)
- Modern pipeline orchestration framework
- Extensive documentation structure
- Organized file structure (date-based MS organization)
- Real-time frontend with WebSocket support</p>
<p><strong>Areas for Improvement:</strong>
- Complete code quality improvements (logging, error handling, type safety)
- Integrate ESE detection fully into pipeline (currently mock data in API)
- Consolidate redundant code in ops/pipeline/
- Complete pipeline robustness improvements (6-week plan)
- Expand test coverage (unit, integration, end-to-end)
- Complete CARTA Phase 3 (progressive loading, WebGL rendering)</p>
<hr/>
<h2 id="measurement-set-permissions">Measurement Set Permissions<a class="headerlink" href="#measurement-set-permissions" title="Permanent link">¶</a></h2>
<h3 id="critical-ms-files-must-be-writable">Critical: MS Files Must Be Writable<a class="headerlink" href="#critical-ms-files-must-be-writable" title="Permanent link">¶</a></h3>
<p><strong>Issue Discovered:</strong> 2025-11-09</p>
<p>Measurement Sets (MS) must <strong>never</strong> be read-only. CASA tasks require write access to:
- Modify <code>MODEL_DATA</code> column (for skymodel seeding)
- Update <code>CORRECTED_DATA</code> column (during calibration)
- Write flagging information
- Update weight columns</p>
<p><strong>Symptoms:</strong>
- CASA <code>ft()</code> task fails with: "Please make sure MS is writable when using Imager::ft"
- NVSS skymodel seeding skipped
- Non-fatal for read-only imaging, but prevents calibration and model updates</p>
<p><strong>Root Cause:</strong>
- <code>table.dat</code> files owned by <code>root:root</code> instead of <code>ubuntu:ubuntu</code>
- Likely caused by running CASA commands or scripts with <code>sudo</code>
- All affected files modified on same date/time (batch operation)</p>
<p><strong>Fix:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Find and fix all root-owned files in MS directories</span>
find<span class="w"> </span>/stage/dsa110-contimg/ms<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>!<span class="w"> </span>-user<span class="w"> </span>ubuntu<span class="w"> </span>-exec<span class="w"> </span>sudo<span class="w"> </span>chown<span class="w"> </span>ubuntu:ubuntu<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</code></pre></div></p>
<p><strong>Prevention:</strong>
- Never run CASA commands or pipeline scripts with <code>sudo</code>
- Ensure all systemd services run as <code>ubuntu</code> user (already configured)
- Verify MS permissions after any batch operations
- Check ownership before running calibration or imaging tasks</p>
<p><strong>Verification:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># Check for root-owned files</span>
find<span class="w"> </span>/stage/dsa110-contimg/ms<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>!<span class="w"> </span>-user<span class="w"> </span>ubuntu<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<span class="c1"># Should return 0</span>

<span class="c1"># Verify specific MS</span>
ls<span class="w"> </span>-lh<span class="w"> </span>/path/to/ms/table.dat

---

<span class="c1">## CASA Table Locking and Concurrent Access</span>

<span class="c1">### Critical: MS Cannot Be Accessed Concurrently for Write Operations</span>

**Date:**<span class="w"> </span><span class="m">2025</span>-11-09<span class="w">  </span>
**Issue:**<span class="w"> </span>CASA<span class="err">'</span>s<span class="w"> </span>table<span class="w"> </span>locking<span class="w"> </span>mechanism<span class="w"> </span>prevents<span class="w"> </span>concurrent<span class="w"> </span>write<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>Measurement<span class="w"> </span>Set.

<span class="c1">### Problem</span>

When<span class="w"> </span>multiple<span class="w"> </span>processes<span class="w"> </span>try<span class="w"> </span>to<span class="w"> </span>access<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>MS<span class="w"> </span>simultaneously<span class="w"> </span><span class="o">(</span>e.g.,<span class="w"> </span>parallel<span class="w"> </span>adaptive<span class="w"> </span>binning<span class="w"> </span>on<span class="w"> </span>multiple<span class="w"> </span>sources<span class="o">)</span>,<span class="w"> </span>CASA<span class="w"> </span>throws<span class="w"> </span>**resource<span class="w"> </span>deadlock<span class="w"> </span>errors**:
</code></pre></div>
Error (Resource deadlock avoided) when acquiring lock on 
/path/to/ms/table.lock
<div class="highlight"><pre><span></span><code>### Root Cause

- CASA `tclean` requires **write access** to the MS (to write MODEL_DATA column)
- CASA's table locking mechanism (`table.lock` file) doesn't support concurrent write access
- Multiple processes accessing the same MS simultaneously conflict on the lock
- Even read operations can conflict if another process has a write lock

### Impact

- Parallel processing of multiple sources on the same MS causes lock conflicts
- Many SPW imaging attempts fail initially, requiring retries
- Warning messages: "Failed to clear MODEL_DATA before ft()"
- Inefficient processing due to lock contention

### Solutions

1. **Serialize MS Access (Recommended)**
   - Process multiple sources sequentially
   - Or implement a file lock mechanism to serialize access:
   ```python
   import fcntl
   lock_file = f"{ms_path}.lock"
   with open(lock_file, 'w') as lock:
       fcntl.flock(lock.fileno(), fcntl.LOCK_EX)
       # Process MS
   ```

2. **Copy MS for Each Process**
   - Create a copy of the MS for each parallel process
   - Expensive but avoids conflicts
   - Only practical for small MS files

3. **Use WSClean Backend**
   - WSClean reads the MS but doesn't write MODEL_DATA
   - May avoid some locking issues
   - However, WSClean doesn't support SPW selection directly

4. **Accept Sequential Processing**
   - For multiple sources on the same MS, process sequentially
   - Simpler but slower

### Best Practices

- **For production:** Implement MS access serialization when processing multiple sources on the same MS
- **For testing:** Process sources sequentially or use separate MS files for parallel testing
- **Consider:** Adding a `--serialize-ms-access` flag to imaging/photometry CLIs

### Related Files

- `src/dsa110_contimg/imaging/spw_imaging.py`: SPW imaging (uses `image_ms` which calls `tclean`)
- `src/dsa110_contimg/photometry/adaptive_photometry.py`: Adaptive binning photometry
- `docs/testing/PHASE1_MULTIPLE_SOURCES_TEST_RESULTS.md`: Test results documenting this issue

---

## VAST Tools Comparison and Adoption Recommendations

**Date:** 2025-11-12  
**Reference:** `/data/dsa110-contimg/archive/references/vast-tools`

### Key Findings

DSA-110 has strong foundations (photometry, normalization, database) but lacks the rich source analysis interface and visualization tools that VAST Tools provides. Adopting VAST patterns would significantly improve ESE candidate analysis workflows.

### Current State vs. VAST Tools

**DSA-110 Strengths:**
- ✅ Forced photometry (`photometry/forced.py`)
- ✅ Differential normalization (`photometry/normalize.py`) - achieves 1-2% precision
- ✅ Database storage (`photometry_timeseries`, `variability_stats` tables)
- ✅ Basic variability metrics (V metric, χ²)

**DSA-110 Gaps:**
- ❌ No Source class pattern (only database queries)
- ❌ No light curve plotting (essential for ESE visualization)
- ❌ Missing variability metrics (η metric, Vs metric, m metric)
- ❌ No postage stamp visualization
- ⚠️ Limited external catalog integration (NVSS/VLASS only, missing SIMBAD/NED/Gaia)

### Recommended Adoptions (Priority Order)

#### 1. Source Class Pattern (High Priority)
**Why:** Clean interface for ESE candidate analysis, encapsulates measurements/plotting/analysis  
**Implementation:** Create `src/dsa110_contimg/photometry/source.py`  
**Timeline:** 2-3 weeks  
**Adopt from:** `vasttools/source.py::Source`

**Key Features:**
- Load measurements from `photometry_timeseries` table
- Properties: `coord`, `n_epochs`, `detections`
- Methods: `plot_lightcurve()`, `calc_variability_metrics()`, `show_all_cutouts()`

#### 2. Light Curve Plotting (High Priority)
**Why:** Essential for ESE candidate visualization and verification  
**Implementation:** Add to Source class or create `qa/lightcurves.py`  
**Timeline:** 1 week  
**Adopt from:** `vasttools/source.py::Source.plot_lightcurve()`

**ESE-Specific Features:**
- Highlight baseline period (first 10 epochs)
- Highlight ESE candidate period (14-180 days)
- Normalized flux plotting
- Error bars and detection/limit distinction

#### 3. Variability Metrics (Medium Priority)
**Why:** Complementary to χ² for variability detection  
**Implementation:** Create `photometry/variability.py`  
**Timeline:** 1 week  
**Adopt from:** `vasttools/utils.py`

**Metrics to Add:**
- **η metric**: Weighted variance (`pipeline_get_eta_metric()`)
- **Vs metric**: Two-epoch t-statistic (`calculate_vs_metric()`)
- **m metric**: Modulation index (`calculate_m_metric()`)

**Database Update:** Add `eta_metric` column to `variability_stats` table

#### 4. Postage Stamp Visualization (Medium Priority)
**Why:** Visual verification of ESE candidates, quality assessment  
**Implementation:** Create `qa/postage_stamps.py`  
**Timeline:** 2 weeks  
**Adopt from:** `vasttools/source.py::Source.show_all_png_cutouts()`

**Features:**
- Image cutout creation around source position
- All-epoch grid visualization
- Z-scale normalization
- Customizable size and layout

#### 5. External Catalog Integration (Low-Medium Priority)
**Why:** Better source identification and crossmatching  
**Implementation:** Create `catalog/external.py`  
**Timeline:** 1-2 weeks  
**Adopt from:** `vasttools/utils.py::simbad_search()`, `vasttools/source.py`

**Catalogs to Add:**
- SIMBAD (object identification)
- NED (extragalactic database)
- Gaia (astrometry)

### Implementation Pattern

**Source Class Structure:**
```python
class Source:
    def __init__(self, source_id, ra_deg, dec_deg, products_db):
        self.source_id = source_id
        self.measurements = self._load_measurements()

    @property
    def coord(self) -&gt; SkyCoord:
        return SkyCoord(self.ra_deg, self.dec_deg, unit=(u.deg, u.deg))

    def plot_lightcurve(self, highlight_baseline=True, ...) -&gt; Figure:
        # Adopt from VAST with ESE-specific features

    def calc_variability_metrics(self) -&gt; dict:
        # Include η, Vs, m metrics
</code></pre></div></p>
<h3 id="integration-points">Integration Points<a class="headerlink" href="#integration-points" title="Permanent link">¶</a></h3>
<p><strong>API Endpoints:</strong>
- <code>GET /api/sources/{source_id}/lightcurve</code> → Source.plot_lightcurve()
- <code>GET /api/sources/{source_id}/variability</code> → Source.calc_variability_metrics()
- <code>GET /api/sources/{source_id}/postage_stamps</code> → Source.show_all_cutouts()</p>
<p><strong>ESE Detection Workflow:</strong>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">analyze_ese_candidate</span><span class="p">(</span><span class="n">source_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="n">source_id</span><span class="p">,</span> <span class="n">products_db</span><span class="o">=</span><span class="n">products_db</span><span class="p">)</span>
    <span class="n">lightcurve</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">plot_lightcurve</span><span class="p">(</span><span class="n">highlight_ese_period</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">calc_variability_metrics</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">'metrics'</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span> <span class="s1">'lightcurve'</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">}</span>
</code></pre></div></p>
<h3 id="dependencies">Dependencies<a class="headerlink" href="#dependencies" title="Permanent link">¶</a></h3>
<p><strong>Required:</strong>
- <code>astroquery</code> (for external catalog queries)</p>
<p><strong>Optional:</strong>
- <code>bokeh</code> (for interactive plots, can add later)</p>
<h3 id="timeline">Timeline<a class="headerlink" href="#timeline" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Phase 1 (High Priority):</strong> 2-3 weeks (Source class + light curves + basic metrics)</li>
<li><strong>Phase 2 (Medium Priority):</strong> 2 weeks (Postage stamps + enhanced metrics)</li>
<li><strong>Phase 3 (Low-Medium Priority):</strong> 1-2 weeks (External catalogs)</li>
<li><strong>Total:</strong> 5-7 weeks</li>
</ul>
<h3 id="risk-assessment">Risk Assessment<a class="headerlink" href="#risk-assessment" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Low Risk:</strong> Adopting well-tested patterns from VAST Tools</li>
<li><strong>Non-Breaking:</strong> Can be added incrementally without breaking existing code</li>
<li><strong>High Value:</strong> Significantly improves ESE analysis workflow</li>
</ul>
<h3 id="related-documentation_1">Related Documentation<a class="headerlink" href="#related-documentation_1" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Detailed Comparison:</strong> <code>docs/analysis/VAST_TOOLS_DSA110_DETAILED_COMPARISON.md</code></li>
<li><strong>Adoption Summary:</strong> <code>docs/analysis/VAST_TOOLS_ADOPTION_SUMMARY.md</code></li>
<li><strong>VAST Tools Review:</strong> <code>archive/references/vast-tools/VAST_TOOLS_CODEBASE_REVIEW.md</code></li>
<li><strong>VAST Tools Code:</strong> <code>archive/references/vast-tools/vasttools/</code></li>
</ul>
<h2 id="streaming-test-run-lessons-learned-2025-11-10">Streaming Test Run Lessons Learned (2025-11-10)<a class="headerlink" href="#streaming-test-run-lessons-learned-2025-11-10" title="Permanent link">¶</a></h2>
<p><strong>Context:</strong> First trial autonomous streaming run from conversion to mosaic creation failed due to multiple issues, but revealed critical lessons about validation, workflow integration, and expected behaviors.</p>
<h3 id="key-mistakes-and-fixes">Key Mistakes and Fixes<a class="headerlink" href="#key-mistakes-and-fixes" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Phase Center Validation: Expected Behavior Treated as Error</strong></li>
<li><strong>Mistake:</strong> Phase center validation failed with 2583.71 arcsec separation (vs 2.00 arcsec tolerance), halting test run</li>
<li><strong>Root Cause:</strong> DSA-110 uses meridian-tracking phasing (RA = LST), causing phase centers to be incoherent across fields (EXPECTED)</li>
<li><strong>Fix:</strong> Created <code>conversion/README.md</code> documenting expected behavior, updated validation to detect time-dependent phasing, added tolerance for large separations (&gt;60 arcsec)</li>
<li>
<p><strong>Lesson:</strong> Document expected behaviors prominently - don't bury in function docstrings. Validation should distinguish expected vs. error conditions.</p>
</li>
<li>
<p><strong>File Existence Validation Gaps</strong></p>
</li>
<li><strong>Mistake:</strong> MS files not verified to exist before processing in multiple locations (<code>run_first_mosaic.py</code>, <code>streaming_mosaic.py</code>)</li>
<li><strong>Root Cause:</strong> Assumed database paths always correct, no validation against filesystem</li>
<li><strong>Fix:</strong> Added file existence checks before all MS operations, validated database paths against filesystem</li>
<li>
<p><strong>Lesson:</strong> Always verify file existence before operations - don't trust database paths blindly. Validate database paths against filesystem, especially after organization.</p>
</li>
<li>
<p><strong>Race Condition: Processing Before Conversion Completes</strong></p>
</li>
<li><strong>Mistake:</strong> <code>process_one_group()</code> returned immediately after calling conversion, tried to process MS before it existed</li>
<li><strong>Root Cause:</strong> Conversion runs asynchronously, no wait mechanism for completion</li>
<li><strong>Fix:</strong> Added explicit wait for conversion completion, file existence verification, retry logic</li>
<li>
<p><strong>Lesson:</strong> Synchronize async operations - don't assume completion, verify before proceeding.</p>
</li>
<li>
<p><strong>Incorrect Time Fallback Logic</strong></p>
</li>
<li><strong>Mistake:</strong> Used <code>time.time() / 86400.0</code> (current time) as fallback instead of observation time from filename</li>
<li><strong>Root Cause:</strong> Fallback logic didn't extract observation time from filename when MS metadata unavailable</li>
<li><strong>Fix:</strong> Fixed time extraction fallback to use observation time from filename, added multiple fallback mechanisms</li>
<li>
<p><strong>Lesson:</strong> Use observation time for calibration validity windows - not current time. Multiple fallback mechanisms: filename → metadata → current time (last resort).</p>
</li>
<li>
<p><strong>Missing Mosaic Registration and Finalization</strong></p>
</li>
<li><strong>Mistake:</strong> Mosaics created but never registered in <code>data_registry</code>, never finalized, stayed in staging forever</li>
<li><strong>Root Cause:</strong> Missing calls to <code>register_mosaic_in_data_registry()</code> and <code>finalize_mosaic()</code>, QA/validation status never set</li>
<li><strong>Fix:</strong> Added registration and finalization steps, set QA/validation status, added error handling and retry logic</li>
<li><strong>Lesson:</strong> Complete the entire workflow - don't stop at creation, register and finalize. Set all required status fields for auto-publish.</li>
</ol>
<h3 id="critical-principles-for-autonomous-runs">Critical Principles for Autonomous Runs<a class="headerlink" href="#critical-principles-for-autonomous-runs" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Document Expected Behaviors Prominently</strong></li>
<li>Create module-level READMEs for expected behaviors (e.g., <code>conversion/README.md</code>)</li>
<li>Don't bury important information in function docstrings</li>
<li>
<p>Reference documentation in error messages</p>
</li>
<li>
<p><strong>Distinguish Expected vs. Error Conditions</strong></p>
</li>
<li>Validation should detect expected behaviors before failing</li>
<li>Add tolerance for expected variations (phase center separations, time-dependent phasing)</li>
<li>
<p>Guide users in error messages - reference documentation, explain why behavior is expected</p>
</li>
<li>
<p><strong>Always Verify File Existence</strong></p>
</li>
<li>Check file existence before all MS operations</li>
<li>Validate database paths against filesystem</li>
<li>
<p>Handle missing files gracefully with clear error messages</p>
</li>
<li>
<p><strong>Handle Race Conditions Explicitly</strong></p>
</li>
<li>Wait for conversion completion before processing</li>
<li>Verify file existence, not just process exit code</li>
<li>
<p>Add retry logic with timeout for transient failures</p>
</li>
<li>
<p><strong>Complete the Entire Workflow</strong></p>
</li>
<li>Don't stop at creation - register and finalize</li>
<li>Set all required status fields (QA/validation status, processing stage)</li>
<li>
<p>Trigger auto-publish by ensuring criteria are met</p>
</li>
<li>
<p><strong>Use Observation Time, Not Current Time</strong></p>
</li>
<li>Extract observation time from filename when MS metadata unavailable</li>
<li>Use observation time for calibration validity windows</li>
<li>Multiple fallback mechanisms: filename → metadata → current time (last resort)</li>
</ol>
<h3 id="pre-flight-checklist-for-autonomous-runs">Pre-Flight Checklist for Autonomous Runs<a class="headerlink" href="#pre-flight-checklist-for-autonomous-runs" title="Permanent link">¶</a></h3>
<p>Before running autonomous test:
- [ ] Verify all expected behaviors are documented (phase centers, validation tolerances)
- [ ] Check file existence validation is in place for all MS operations
- [ ] Verify race condition handling (wait for conversion completion)
- [ ] Validate database paths match filesystem
- [ ] Test time extraction fallback logic
- [ ] Verify mosaic registration and finalization workflow</p>
<h3 id="additional-safeguards-implemented">Additional Safeguards Implemented<a class="headerlink" href="#additional-safeguards-implemented" title="Permanent link">¶</a></h3>
<p>After initial review, implemented 5 critical safeguards:</p>
<ol>
<li><strong>Group ID Collision Prevention</strong> - SHA256 hash + microsecond timestamp prevents collisions</li>
<li><strong>Total Time Span Validation</strong> - Ensures mosaics from contiguous observations (&lt; 60 min span)</li>
<li><strong>MS Files Stage Validation</strong> - Only groups from fully processed (imaged) MS files</li>
<li><strong>Calibration Table Existence Validation</strong> - Verifies tables exist before applying</li>
<li><strong>Image File Existence Validation</strong> - Verifies all images exist before mosaic creation</li>
</ol>
<h3 id="related-documentation_2">Related Documentation<a class="headerlink" href="#related-documentation_2" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Full Review:</strong> <code>docs/reports/streaming_test_run_review_2025-11-10.md</code> - Comprehensive analysis of mistakes and fixes</li>
<li><strong>Safeguards Implemented:</strong> <code>docs/reports/safeguards_implemented_2025-11-10.md</code> - Details of safeguards added</li>
<li><strong>Additional Safeguards Needed:</strong> <code>docs/reports/additional_safeguards_needed_2025-11-10.md</code> - Lower priority issues</li>
<li><strong>Conversion README:</strong> <code>src/dsa110_contimg/conversion/README.md</code> - Expected behaviors and troubleshooting</li>
</ul>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.sections", "navigation.indexes", "content.code.copy", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
<script src="../../../javascripts/mathjax.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="../../../javascripts/mermaid-zoom.js"></script>
</body>
</html>