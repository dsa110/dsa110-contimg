{"version":3,"file":"MSDetailPage-DKqj8e2V.js","sources":["../../src/pages/MSDetailPage.tsx"],"sourcesContent":["import React from \"react\";\nimport { useParams, Link } from \"react-router-dom\";\nimport ProvenanceStrip from \"../components/provenance/ProvenanceStrip\";\nimport ErrorDisplay from \"../components/errors/ErrorDisplay\";\nimport { Card, CoordinateDisplay, QAMetrics } from \"../components/common\";\nimport { mapProvenanceFromMSDetail } from \"../utils/provenanceMappers\";\nimport { relativeTime } from \"../utils/relativeTime\";\nimport type { ErrorResponse } from \"../types/errors\";\nimport { useMS } from \"../hooks/useQueries\";\n\n/**\n * Detail page for a Measurement Set.\n * Displays MS metadata, calibrator matches, provenance, and related images.\n *\n * Route: /ms/*\n * The \"*\" captures the full MS path which may contain slashes.\n */\nconst MSDetailPage: React.FC = () => {\n  // React Router v6 captures the rest of the path with \"*\"\n  const { \"*\": msPath } = useParams<{ \"*\": string }>();\n  const { data: ms, isLoading, error, refetch } = useMS(msPath);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-pulse text-gray-500\">Loading Measurement Set details...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <ErrorDisplay error={error as unknown as ErrorResponse} onRetry={() => refetch()} />\n      </div>\n    );\n  }\n\n  if (!ms || !msPath) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <Card>\n          <p className=\"text-gray-500 mb-4\">Measurement Set not found.</p>\n          <Link to=\"/images\" className=\"link\">\n            Back to Images\n          </Link>\n        </Card>\n      </div>\n    );\n  }\n\n  // Map MS data to provenance format\n  const provenance = mapProvenanceFromMSDetail({\n    path: ms.path,\n    pointing_ra_deg: ms.pointing_ra_deg,\n    pointing_dec_deg: ms.pointing_dec_deg,\n    created_at: ms.created_at,\n    qa_grade: ms.qa_grade,\n    calibrator_matches: ms.calibrator_matches,\n  });\n\n  const filename = ms.path.split(\"/\").pop() || msPath;\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <Link to=\"/images\" className=\"text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block\">\n          Back to Images\n        </Link>\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">{filename}</h1>\n        <ProvenanceStrip {...provenance} />\n      </div>\n\n      {/* Main content grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Left column - Actions and quick info */}\n        <div className=\"lg:col-span-1 space-y-6\">\n          {/* Status */}\n          {ms.qa_grade && (\n            <Card title=\"Quality\">\n              <QAMetrics\n                grade={ms.qa_grade as \"good\" | \"warn\" | \"fail\" | undefined}\n                summary={ms.qa_summary}\n                compact\n              />\n            </Card>\n          )}\n\n          {/* Actions */}\n          <Card title=\"Actions\">\n            <div className=\"flex flex-col gap-2\">\n              <button\n                type=\"button\"\n                className=\"btn btn-primary\"\n                onClick={() =>\n                  window.open(\n                    `${import.meta.env.VITE_API_URL || \"/api\"}/ms/${encodeURIComponent(\n                      msPath ?? \"\"\n                    )}/download`,\n                    \"_blank\"\n                  )\n                }\n              >\n                Download MS\n              </button>\n              <button\n                type=\"button\"\n                className=\"btn btn-secondary\"\n                onClick={() =>\n                  window.open(`/viewer/carta?ms=${encodeURIComponent(msPath ?? \"\")}`, \"_blank\")\n                }\n              >\n                Open in CARTA\n              </button>\n              {ms.qa_grade && (\n                <Link\n                  to={`/qa/ms/${encodeURIComponent(msPath ?? \"\")}`}\n                  className=\"btn btn-secondary text-center\"\n                >\n                  View QA Report\n                </Link>\n              )}\n            </div>\n          </Card>\n\n          {/* Quick stats */}\n          <Card title=\"Quick Info\">\n            <dl className=\"space-y-3\">\n              {ms.created_at && (\n                <div>\n                  <dt className=\"text-xs text-gray-500 uppercase tracking-wide\">Created</dt>\n                  <dd className=\"text-sm text-gray-900\">\n                    {relativeTime(ms.created_at)}\n                    <span className=\"text-gray-500 block text-xs\">\n                      {new Date(ms.created_at).toLocaleString()}\n                    </span>\n                  </dd>\n                </div>\n              )}\n              {ms.run_id && (\n                <div>\n                  <dt className=\"text-xs text-gray-500 uppercase tracking-wide\">Pipeline Run</dt>\n                  <dd className=\"text-sm\">\n                    <Link\n                      to={`/jobs/${ms.run_id}`}\n                      className=\"text-blue-600 hover:text-blue-800 hover:underline\"\n                    >\n                      {ms.run_id}\n                    </Link>\n                  </dd>\n                </div>\n              )}\n            </dl>\n          </Card>\n        </div>\n\n        {/* Right column - Details */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* Pointing coordinates */}\n          {ms.pointing_ra_deg !== undefined &&\n            ms.pointing_ra_deg !== null &&\n            ms.pointing_dec_deg !== undefined &&\n            ms.pointing_dec_deg !== null && (\n              <Card title=\"Pointing\">\n                <CoordinateDisplay\n                  raDeg={ms.pointing_ra_deg}\n                  decDeg={ms.pointing_dec_deg}\n                  showDecimal\n                />\n              </Card>\n            )}\n\n          {/* Calibrator matches */}\n          {ms.calibrator_matches && ms.calibrator_matches.length > 0 && (\n            <Card\n              title=\"Calibration Applied\"\n              subtitle={`${ms.calibrator_matches.length} calibration table${\n                ms.calibrator_matches.length !== 1 ? \"s\" : \"\"\n              }`}\n            >\n              <div className=\"space-y-3\">\n                {ms.calibrator_matches.map((cal, index) => (\n                  <div key={index} className=\"p-3 rounded-lg border border-gray-200 bg-gray-50\">\n                    <div className=\"flex items-start justify-between\">\n                      <div>\n                        <span\n                          className={`badge ${\n                            cal.type === \"bandpass\"\n                              ? \"badge-info\"\n                              : cal.type === \"gain\"\n                              ? \"badge-success\"\n                              : \"badge-gray\"\n                          }`}\n                        >\n                          {cal.type}\n                        </span>\n                      </div>\n                    </div>\n                    <div className=\"mt-2 font-mono text-xs text-gray-600 break-all\">\n                      {cal.cal_table}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </Card>\n          )}\n\n          {/* No calibration applied */}\n          {(!ms.calibrator_matches || ms.calibrator_matches.length === 0) && (\n            <Card title=\"Calibration\">\n              <div className=\"text-center py-6 text-gray-500\">\n                <svg\n                  className=\"w-10 h-10 mx-auto mb-2 text-gray-300\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n                  />\n                </svg>\n                <p>No calibration tables applied yet.</p>\n              </div>\n            </Card>\n          )}\n\n          {/* Metadata */}\n          <Card title=\"Metadata\">\n            <dl className=\"grid grid-cols-1 gap-4\">\n              <div>\n                <dt className=\"text-xs text-gray-500 uppercase tracking-wide\">Full Path</dt>\n                <dd className=\"font-mono text-sm text-gray-900 break-all\">{ms.path}</dd>\n              </div>\n            </dl>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default MSDetailPage;\n"],"names":["MSDetailPage","msPath","useParams","ms","isLoading","error","refetch","useMS","jsx","ErrorDisplay","Card","Link","provenance","mapProvenanceFromMSDetail","filename","jsxs","ProvenanceStrip","QAMetrics","relativeTime","CoordinateDisplay","cal","index"],"mappings":"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"}