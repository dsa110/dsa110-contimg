{"version":3,"file":"AladinLiteViewer-4ddxAsek.js","sources":["../../src/components/widgets/AladinLiteViewer.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from \"react\";\n\n// Use the official Aladin Lite CDN URL for reliable loading\n// Version 3.5.0 is the latest stable release from CDS\nconst ALADIN_LITE_CDN_URL = \"https://aladin.cds.unistra.fr/AladinLite/api/v3/latest/aladin.js\";\n\nexport interface AladinLiteViewerProps {\n  /** Right Ascension in degrees */\n  raDeg: number;\n  /** Declination in degrees */\n  decDeg: number;\n  /** Field of view in degrees (default: 0.25) */\n  fov?: number;\n  /** Height of the viewer in pixels or CSS string */\n  height?: number | string;\n  /** Optional survey to display (default: P/DSS2/color) */\n  survey?: string;\n  /** Optional source name for marker */\n  sourceName?: string;\n  /** Custom class name */\n  className?: string;\n  /** Enable fullscreen toggle */\n  showFullscreen?: boolean;\n}\n\ninterface AladinOptions {\n  target: string;\n  fov: number;\n  survey?: string;\n  showReticle?: boolean;\n  showZoomControl?: boolean;\n  showFullscreenControl?: boolean;\n  showLayersControl?: boolean;\n  showGotoControl?: boolean;\n  showShareControl?: boolean;\n  showCatalog?: boolean;\n  showFrame?: boolean;\n}\n\ninterface AladinInstance {\n  gotoRaDec: (ra: number, dec: number) => void;\n  setFoV: (fov: number) => void;\n  setImageSurvey: (survey: string) => void;\n  addCatalog: (catalog: unknown) => void;\n  increaseZoom: () => void;\n  decreaseZoom: () => void;\n  toggleFullscreen: () => void;\n}\n\ndeclare global {\n  interface Window {\n    A?: {\n      aladin: (element: HTMLElement, options: AladinOptions) => AladinInstance;\n    };\n  }\n}\n\n/**\n * Interactive sky viewer using Aladin Lite v3.\n * Displays an interactive sky map centered on the specified coordinates.\n */\nconst AladinLiteViewer: React.FC<AladinLiteViewerProps> = ({\n  raDeg,\n  decDeg,\n  fov = 0.25,\n  height = 400,\n  survey = \"P/DSS2/color\",\n  sourceName,\n  className = \"\",\n  showFullscreen = true,\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const aladinRef = useRef<AladinInstance | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [currentFov, setCurrentFov] = useState(fov);\n  const [shouldLoad, setShouldLoad] = useState(false);\n  const destroyInstance = useCallback(() => {\n    if (aladinRef.current && typeof (aladinRef.current as any).destroy === \"function\") {\n      (aladinRef.current as any).destroy();\n    }\n    aladinRef.current = null;\n  }, []);\n\n  // Initialize Aladin viewer\n  useEffect(() => {\n    let cancelled = false;\n    const init = async () => {\n      if (!shouldLoad || error || !containerRef.current) return;\n\n      const target = `${raDeg.toFixed(6)} ${decDeg >= 0 ? \"+\" : \"\"}${decDeg.toFixed(6)}`;\n\n      try {\n        setIsLoading(true);\n        destroyInstance();\n\n        // Load Aladin from CDN if not already present\n        if (!window.A) {\n          await new Promise<void>((resolve, reject) => {\n            let script = document.querySelector<HTMLScriptElement>(\n              'script[data-aladin-lite=\"true\"]'\n            );\n            if (script) {\n              script.onload = () => resolve();\n              script.onerror = () => reject(new Error(\"Failed to load Aladin Lite\"));\n              return;\n            }\n\n            script = document.createElement(\"script\");\n            script.src = ALADIN_LITE_CDN_URL;\n            script.async = true;\n            script.dataset.aladinLite = \"true\";\n            script.onload = () => resolve();\n            script.onerror = () => reject(new Error(\"Failed to load Aladin Lite\"));\n            document.head.appendChild(script);\n          });\n        }\n\n        if (cancelled) return;\n        if (!window.A?.aladin) {\n          throw new Error(\"Aladin Lite library unavailable\");\n        }\n\n        aladinRef.current = window.A.aladin(containerRef.current, {\n          target,\n          fov: currentFov,\n          survey,\n          showReticle: true,\n          showZoomControl: true,\n          showFullscreenControl: showFullscreen,\n          showLayersControl: true,\n          showGotoControl: false,\n          showShareControl: false,\n          showCatalog: true,\n          showFrame: true,\n        });\n        setIsLoading(false);\n      } catch (err) {\n        if (!cancelled) {\n          setError(err instanceof Error ? err.message : \"Failed to load sky viewer\");\n          setIsLoading(false);\n        }\n      }\n    };\n\n    init();\n\n    return () => {\n      cancelled = true;\n      destroyInstance();\n    };\n  }, [destroyInstance, error, raDeg, decDeg, survey, showFullscreen, shouldLoad]);\n\n  // Update position when coordinates change\n  useEffect(() => {\n    if (aladinRef.current) {\n      aladinRef.current.gotoRaDec(raDeg, decDeg);\n    }\n  }, [raDeg, decDeg]);\n\n  const handleZoomIn = useCallback(() => {\n    if (aladinRef.current) {\n      aladinRef.current.increaseZoom();\n      setCurrentFov((prev) => {\n        const next = Math.max(0.001, prev / 2);\n        if (typeof (aladinRef.current as any).setFoV === \"function\") {\n          (aladinRef.current as any).setFoV(next);\n        }\n        return next;\n      });\n    }\n  }, []);\n\n  const handleZoomOut = useCallback(() => {\n    if (aladinRef.current) {\n      aladinRef.current.decreaseZoom();\n      setCurrentFov((prev) => {\n        const next = Math.min(180, prev * 2);\n        if (typeof (aladinRef.current as any).setFoV === \"function\") {\n          (aladinRef.current as any).setFoV(next);\n        }\n        return next;\n      });\n    }\n  }, []);\n\n  const handleFullscreen = useCallback(() => {\n    if (aladinRef.current) {\n      aladinRef.current.toggleFullscreen();\n    }\n  }, []);\n\n  const heightStyle = typeof height === \"number\" ? `${height}px` : height;\n\n  if (!shouldLoad) {\n    return (\n      <div className={`bg-gray-100 rounded-lg p-4 ${className}`} style={{ height: heightStyle }}>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <p className=\"font-semibold text-gray-800\">Sky Viewer</p>\n            <p className=\"text-sm text-gray-600\">\n              Load the interactive Aladin viewer on demand to reduce initial page weight.\n            </p>\n          </div>\n          <button\n            type=\"button\"\n            className=\"btn btn-primary btn-sm\"\n            onClick={() => setShouldLoad(true)}\n            aria-label=\"Load sky viewer\"\n          >\n            Load viewer\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div\n        className={`bg-gray-100 rounded-lg flex items-center justify-center ${className}`}\n        style={{ height: heightStyle }}\n      >\n        <div className=\"text-center text-gray-500 p-4\">\n          <svg\n            className=\"w-12 h-12 mx-auto mb-2 text-gray-400\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n            />\n          </svg>\n          <p className=\"text-sm\">{error}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`relative ${className}`}>\n      {isLoading && (\n        <div\n          className=\"absolute inset-0 bg-gray-100 rounded-lg flex items-center justify-center z-10\"\n          style={{ height: heightStyle }}\n        >\n          <div className=\"flex flex-col items-center text-gray-500\">\n            <div className=\"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-2\" />\n            <span className=\"text-sm\">Loading sky viewer...</span>\n          </div>\n        </div>\n      )}\n      <div\n        ref={containerRef}\n        className=\"rounded-lg overflow-hidden\"\n        style={{ height: heightStyle, width: \"100%\" }}\n      />\n      {/* Custom controls overlay */}\n      <div className=\"absolute bottom-2 left-2 flex gap-1\">\n        <button\n          type=\"button\"\n          onClick={handleZoomIn}\n          className=\"bg-white/90 hover:bg-white p-1.5 rounded shadow text-gray-700 hover:text-gray-900 transition-colors\"\n          title=\"Zoom in\"\n        >\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v12m6-6H6\" />\n          </svg>\n        </button>\n        <button\n          type=\"button\"\n          onClick={handleZoomOut}\n          className=\"bg-white/90 hover:bg-white p-1.5 rounded shadow text-gray-700 hover:text-gray-900 transition-colors\"\n          title=\"Zoom out\"\n        >\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18 12H6\" />\n          </svg>\n        </button>\n        {showFullscreen && (\n          <button\n            type=\"button\"\n            onClick={handleFullscreen}\n            className=\"bg-white/90 hover:bg-white p-1.5 rounded shadow text-gray-700 hover:text-gray-900 transition-colors\"\n            title=\"Toggle fullscreen\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\"\n              />\n            </svg>\n          </button>\n        )}\n      </div>\n      {/* Coordinate display */}\n      <div className=\"absolute top-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded font-mono\">\n        {raDeg.toFixed(4)}° {decDeg >= 0 ? \"+\" : \"\"}\n        {decDeg.toFixed(4)}°\n      </div>\n    </div>\n  );\n};\n\nexport default AladinLiteViewer;\n"],"names":["ALADIN_LITE_CDN_URL","AladinLiteViewer","raDeg","decDeg","fov","height","survey","sourceName","className","showFullscreen","containerRef","useRef","aladinRef","isLoading","setIsLoading","useState","error","setError","currentFov","setCurrentFov","shouldLoad","setShouldLoad","destroyInstance","useCallback","useEffect","cancelled","target","resolve","reject","script","err","handleZoomIn","prev","next","handleZoomOut","handleFullscreen","heightStyle","jsx","jsxs"],"mappings":"0CAIA,MAAMA,EAAsB,mEAyDtBC,EAAoD,CAAC,CACzD,MAAAC,EACA,OAAAC,EACA,IAAAC,EAAM,IACN,OAAAC,EAAS,IACT,OAAAC,EAAS,eACT,WAAAC,EACA,UAAAC,EAAY,GACZ,eAAAC,EAAiB,EACnB,IAAM,CACJ,MAAMC,EAAeC,EAAAA,OAAuB,IAAI,EAC1CC,EAAYD,EAAAA,OAA8B,IAAI,EAC9C,CAACE,EAAWC,CAAY,EAAIC,EAAAA,SAAS,EAAI,EACzC,CAACC,EAAOC,CAAQ,EAAIF,EAAAA,SAAwB,IAAI,EAChD,CAACG,EAAYC,CAAa,EAAIJ,EAAAA,SAASX,CAAG,EAC1C,CAACgB,EAAYC,CAAa,EAAIN,EAAAA,SAAS,EAAK,EAC5CO,EAAkBC,EAAAA,YAAY,IAAM,CACpCX,EAAU,SAAW,OAAQA,EAAU,QAAgB,SAAY,YACpEA,EAAU,QAAgB,QAAA,EAE7BA,EAAU,QAAU,IACtB,EAAG,CAAA,CAAE,EAGLY,EAAAA,UAAU,IAAM,CACd,IAAIC,EAAY,GA2DhB,OA1Da,SAAY,CACvB,GAAI,CAACL,GAAcJ,GAAS,CAACN,EAAa,QAAS,OAEnD,MAAMgB,EAAS,GAAGxB,EAAM,QAAQ,CAAC,CAAC,IAAIC,GAAU,EAAI,IAAM,EAAE,GAAGA,EAAO,QAAQ,CAAC,CAAC,GAEhF,GAAI,CA0BF,GAzBAW,EAAa,EAAI,EACjBQ,EAAA,EAGK,OAAO,GACV,MAAM,IAAI,QAAc,CAACK,EAASC,IAAW,CAC3C,IAAIC,EAAS,SAAS,cACpB,iCAAA,EAEF,GAAIA,EAAQ,CACVA,EAAO,OAAS,IAAMF,EAAA,EACtBE,EAAO,QAAU,IAAMD,EAAO,IAAI,MAAM,4BAA4B,CAAC,EACrE,MACF,CAEAC,EAAS,SAAS,cAAc,QAAQ,EACxCA,EAAO,IAAM7B,EACb6B,EAAO,MAAQ,GACfA,EAAO,QAAQ,WAAa,OAC5BA,EAAO,OAAS,IAAMF,EAAA,EACtBE,EAAO,QAAU,IAAMD,EAAO,IAAI,MAAM,4BAA4B,CAAC,EACrE,SAAS,KAAK,YAAYC,CAAM,CAClC,CAAC,EAGCJ,EAAW,OACf,GAAI,CAAC,OAAO,GAAG,OACb,MAAM,IAAI,MAAM,iCAAiC,EAGnDb,EAAU,QAAU,OAAO,EAAE,OAAOF,EAAa,QAAS,CACxD,OAAAgB,EACA,IAAKR,EACL,OAAAZ,EACA,YAAa,GACb,gBAAiB,GACjB,sBAAuBG,EACvB,kBAAmB,GACnB,gBAAiB,GACjB,iBAAkB,GAClB,YAAa,GACb,UAAW,EAAA,CACZ,EACDK,EAAa,EAAK,CACpB,OAASgB,EAAK,CACPL,IACHR,EAASa,aAAe,MAAQA,EAAI,QAAU,2BAA2B,EACzEhB,EAAa,EAAK,EAEtB,CACF,GAEA,EAEO,IAAM,CACXW,EAAY,GACZH,EAAA,CACF,CACF,EAAG,CAACA,EAAiBN,EAAOd,EAAOC,EAAQG,EAAQG,EAAgBW,CAAU,CAAC,EAG9EI,EAAAA,UAAU,IAAM,CACVZ,EAAU,SACZA,EAAU,QAAQ,UAAUV,EAAOC,CAAM,CAE7C,EAAG,CAACD,EAAOC,CAAM,CAAC,EAElB,MAAM4B,EAAeR,EAAAA,YAAY,IAAM,CACjCX,EAAU,UACZA,EAAU,QAAQ,aAAA,EAClBO,EAAea,GAAS,CACtB,MAAMC,EAAO,KAAK,IAAI,KAAOD,EAAO,CAAC,EACrC,OAAI,OAAQpB,EAAU,QAAgB,QAAW,YAC9CA,EAAU,QAAgB,OAAOqB,CAAI,EAEjCA,CACT,CAAC,EAEL,EAAG,CAAA,CAAE,EAECC,EAAgBX,EAAAA,YAAY,IAAM,CAClCX,EAAU,UACZA,EAAU,QAAQ,aAAA,EAClBO,EAAea,GAAS,CACtB,MAAMC,EAAO,KAAK,IAAI,IAAKD,EAAO,CAAC,EACnC,OAAI,OAAQpB,EAAU,QAAgB,QAAW,YAC9CA,EAAU,QAAgB,OAAOqB,CAAI,EAEjCA,CACT,CAAC,EAEL,EAAG,CAAA,CAAE,EAECE,EAAmBZ,EAAAA,YAAY,IAAM,CACrCX,EAAU,SACZA,EAAU,QAAQ,iBAAA,CAEtB,EAAG,CAAA,CAAE,EAECwB,EAAc,OAAO/B,GAAW,SAAW,GAAGA,CAAM,KAAOA,EAEjE,OAAKe,EAuBDJ,EAEAqB,EAAAA,IAAC,MAAA,CACC,UAAW,2DAA2D7B,CAAS,GAC/E,MAAO,CAAE,OAAQ4B,CAAA,EAEjB,SAAAE,EAAAA,KAAC,MAAA,CAAI,UAAU,gCACb,SAAA,CAAAD,EAAAA,IAAC,MAAA,CACC,UAAU,uCACV,KAAK,OACL,OAAO,eACP,QAAQ,YAER,SAAAA,EAAAA,IAAC,OAAA,CACC,cAAc,QACd,eAAe,QACf,YAAa,EACb,EAAE,sIAAA,CAAA,CACJ,CAAA,EAEFA,EAAAA,IAAC,IAAA,CAAE,UAAU,UAAW,SAAArB,CAAA,CAAM,CAAA,CAAA,CAChC,CAAA,CAAA,EAMJsB,EAAAA,KAAC,MAAA,CAAI,UAAW,YAAY9B,CAAS,GAClC,SAAA,CAAAK,GACCwB,EAAAA,IAAC,MAAA,CACC,UAAU,gFACV,MAAO,CAAE,OAAQD,CAAA,EAEjB,SAAAE,EAAAA,KAAC,MAAA,CAAI,UAAU,2CACb,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,sFAAA,CAAuF,EACtGA,EAAAA,IAAC,OAAA,CAAK,UAAU,UAAU,SAAA,uBAAA,CAAqB,CAAA,CAAA,CACjD,CAAA,CAAA,EAGJA,EAAAA,IAAC,MAAA,CACC,IAAK3B,EACL,UAAU,6BACV,MAAO,CAAE,OAAQ0B,EAAa,MAAO,MAAA,CAAO,CAAA,EAG9CE,EAAAA,KAAC,MAAA,CAAI,UAAU,sCACb,SAAA,CAAAD,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAASN,EACT,UAAU,sGACV,MAAM,UAEN,SAAAM,EAAAA,IAAC,OAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,YACjE,eAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,iBAAiB,CAAA,CACxF,CAAA,CAAA,EAEFA,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAASH,EACT,UAAU,sGACV,MAAM,WAEN,SAAAG,EAAAA,IAAC,OAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,YACjE,eAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,WAAW,CAAA,CAClF,CAAA,CAAA,EAED5B,GACC4B,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAASF,EACT,UAAU,sGACV,MAAM,oBAEN,SAAAE,EAAAA,IAAC,OAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,YACjE,SAAAA,EAAAA,IAAC,OAAA,CACC,cAAc,QACd,eAAe,QACf,YAAa,EACb,EAAE,2FAAA,CAAA,CACJ,CACF,CAAA,CAAA,CACF,EAEJ,EAEAC,EAAAA,KAAC,MAAA,CAAI,UAAU,oFACZ,SAAA,CAAApC,EAAM,QAAQ,CAAC,EAAE,KAAGC,GAAU,EAAI,IAAM,GACxCA,EAAO,QAAQ,CAAC,EAAE,GAAA,CAAA,CACrB,CAAA,EACF,EA9GEkC,EAAAA,IAAC,MAAA,CAAI,UAAW,8BAA8B7B,CAAS,GAAI,MAAO,CAAE,OAAQ4B,CAAA,EAC1E,SAAAE,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,OAAC,MAAA,CACC,SAAA,CAAAD,EAAAA,IAAC,IAAA,CAAE,UAAU,8BAA8B,SAAA,aAAU,EACrDA,EAAAA,IAAC,IAAA,CAAE,UAAU,wBAAwB,SAAA,6EAAA,CAErC,CAAA,EACF,EACAA,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,UAAU,yBACV,QAAS,IAAMhB,EAAc,EAAI,EACjC,aAAW,kBACZ,SAAA,aAAA,CAAA,CAED,CAAA,CACF,CAAA,CACF,CA+FN"}