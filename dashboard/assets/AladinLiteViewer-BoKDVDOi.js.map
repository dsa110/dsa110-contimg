{"version":3,"mappings":"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","names":["AladinLiteViewer","raDeg","decDeg","fov","height","survey","sourceName","className","showFullscreen","containerRef","useRef","aladinRef","isLoading","setIsLoading","useState","error","setError","currentFov","setCurrentFov","aladinLibRef","destroyInstance","useCallback","useEffect","cancelled","target","mod","aladinLib","err","handleZoomIn","prev","next","handleZoomOut","handleFullscreen","heightStyle","jsx","jsxs"],"ignoreList":[],"sources":["../../src/components/widgets/AladinLiteViewer.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from \"react\";\n\nexport interface AladinLiteViewerProps {\n  /** Right Ascension in degrees */\n  raDeg: number;\n  /** Declination in degrees */\n  decDeg: number;\n  /** Field of view in degrees (default: 0.25) */\n  fov?: number;\n  /** Height of the viewer in pixels or CSS string */\n  height?: number | string;\n  /** Optional survey to display (default: P/DSS2/color) */\n  survey?: string;\n  /** Optional source name for marker */\n  sourceName?: string;\n  /** Custom class name */\n  className?: string;\n  /** Enable fullscreen toggle */\n  showFullscreen?: boolean;\n}\n\ninterface AladinOptions {\n  target: string;\n  fov: number;\n  survey?: string;\n  showReticle?: boolean;\n  showZoomControl?: boolean;\n  showFullscreenControl?: boolean;\n  showLayersControl?: boolean;\n  showGotoControl?: boolean;\n  showShareControl?: boolean;\n  showCatalog?: boolean;\n  showFrame?: boolean;\n}\n\ninterface AladinInstance {\n  gotoRaDec: (ra: number, dec: number) => void;\n  setFoV: (fov: number) => void;\n  setImageSurvey: (survey: string) => void;\n  addCatalog: (catalog: unknown) => void;\n  increaseZoom: () => void;\n  decreaseZoom: () => void;\n  toggleFullscreen: () => void;\n}\n\n/**\n * Interactive sky viewer using Aladin Lite v3.\n * Displays an interactive sky map centered on the specified coordinates.\n */\nconst AladinLiteViewer: React.FC<AladinLiteViewerProps> = ({\n  raDeg,\n  decDeg,\n  fov = 0.25,\n  height = 400,\n  survey = \"P/DSS2/color\",\n  sourceName,\n  className = \"\",\n  showFullscreen = true,\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const aladinRef = useRef<AladinInstance | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [currentFov, setCurrentFov] = useState(fov);\n  const aladinLibRef = useRef<{ aladin: (el: HTMLElement, opts: AladinOptions) => AladinInstance }>();\n  const destroyInstance = useCallback(() => {\n    if (aladinRef.current && typeof (aladinRef.current as any).destroy === \"function\") {\n      (aladinRef.current as any).destroy();\n    }\n    aladinRef.current = null;\n  }, []);\n\n  // Initialize Aladin viewer\n  useEffect(() => {\n    let cancelled = false;\n    const init = async () => {\n      if (error || !containerRef.current) return;\n\n      const target = `${raDeg.toFixed(6)} ${decDeg >= 0 ? \"+\" : \"\"}${decDeg.toFixed(6)}`;\n\n      try {\n        setIsLoading(true);\n        destroyInstance();\n\n        // Lazy-load aladin-lite to keep the main bundle small\n        const mod = await import(\"aladin-lite\");\n        const aladinLib = (mod as any).default?.aladin ? (mod as any).default : (mod as any);\n        if (!aladinLib?.aladin) {\n          throw new Error(\"Aladin Lite library unavailable\");\n        }\n        if (cancelled) return;\n        aladinLibRef.current = aladinLib;\n\n        aladinRef.current = aladinLib.aladin(containerRef.current, {\n          target,\n          fov: currentFov,\n          survey,\n          showReticle: true,\n          showZoomControl: true,\n          showFullscreenControl: showFullscreen,\n          showLayersControl: true,\n          showGotoControl: false,\n          showShareControl: false,\n          showCatalog: true,\n          showFrame: true,\n        });\n        setIsLoading(false);\n      } catch (err) {\n        if (!cancelled) {\n          setError(err instanceof Error ? err.message : \"Failed to load sky viewer\");\n          setIsLoading(false);\n        }\n      }\n    };\n\n    init();\n\n    return () => {\n      cancelled = true;\n      destroyInstance();\n    };\n  }, [destroyInstance, error, raDeg, decDeg, survey, showFullscreen]);\n\n  // Update position when coordinates change\n  useEffect(() => {\n    if (aladinRef.current) {\n      aladinRef.current.gotoRaDec(raDeg, decDeg);\n    }\n  }, [raDeg, decDeg]);\n\n  const handleZoomIn = useCallback(() => {\n    if (aladinRef.current) {\n      aladinRef.current.increaseZoom();\n      setCurrentFov((prev) => {\n        const next = Math.max(0.001, prev / 2);\n        if (typeof (aladinRef.current as any).setFoV === \"function\") {\n          (aladinRef.current as any).setFoV(next);\n        }\n        return next;\n      });\n    }\n  }, []);\n\n  const handleZoomOut = useCallback(() => {\n    if (aladinRef.current) {\n      aladinRef.current.decreaseZoom();\n      setCurrentFov((prev) => {\n        const next = Math.min(180, prev * 2);\n        if (typeof (aladinRef.current as any).setFoV === \"function\") {\n          (aladinRef.current as any).setFoV(next);\n        }\n        return next;\n      });\n    }\n  }, []);\n\n  const handleFullscreen = useCallback(() => {\n    if (aladinRef.current) {\n      aladinRef.current.toggleFullscreen();\n    }\n  }, []);\n\n  const heightStyle = typeof height === \"number\" ? `${height}px` : height;\n\n  if (error) {\n    return (\n      <div\n        className={`bg-gray-100 rounded-lg flex items-center justify-center ${className}`}\n        style={{ height: heightStyle }}\n      >\n        <div className=\"text-center text-gray-500 p-4\">\n          <svg\n            className=\"w-12 h-12 mx-auto mb-2 text-gray-400\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n            />\n          </svg>\n          <p className=\"text-sm\">{error}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`relative ${className}`}>\n      {isLoading && (\n        <div\n          className=\"absolute inset-0 bg-gray-100 rounded-lg flex items-center justify-center z-10\"\n          style={{ height: heightStyle }}\n        >\n          <div className=\"flex flex-col items-center text-gray-500\">\n            <div className=\"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-2\" />\n            <span className=\"text-sm\">Loading sky viewer...</span>\n          </div>\n        </div>\n      )}\n      <div\n        ref={containerRef}\n        className=\"rounded-lg overflow-hidden\"\n        style={{ height: heightStyle, width: \"100%\" }}\n      />\n      {/* Custom controls overlay */}\n      <div className=\"absolute bottom-2 left-2 flex gap-1\">\n        <button\n          type=\"button\"\n          onClick={handleZoomIn}\n          className=\"bg-white/90 hover:bg-white p-1.5 rounded shadow text-gray-700 hover:text-gray-900 transition-colors\"\n          title=\"Zoom in\"\n        >\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v12m6-6H6\" />\n          </svg>\n        </button>\n        <button\n          type=\"button\"\n          onClick={handleZoomOut}\n          className=\"bg-white/90 hover:bg-white p-1.5 rounded shadow text-gray-700 hover:text-gray-900 transition-colors\"\n          title=\"Zoom out\"\n        >\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18 12H6\" />\n          </svg>\n        </button>\n        {showFullscreen && (\n          <button\n            type=\"button\"\n            onClick={handleFullscreen}\n            className=\"bg-white/90 hover:bg-white p-1.5 rounded shadow text-gray-700 hover:text-gray-900 transition-colors\"\n            title=\"Toggle fullscreen\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\"\n              />\n            </svg>\n          </button>\n        )}\n      </div>\n      {/* Coordinate display */}\n      <div className=\"absolute top-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded font-mono\">\n        {raDeg.toFixed(4)}° {decDeg >= 0 ? \"+\" : \"\"}\n        {decDeg.toFixed(4)}°\n      </div>\n    </div>\n  );\n};\n\nexport default AladinLiteViewer;\n"],"file":"AladinLiteViewer-BoKDVDOi.js"}