import{r as a,j as e}from"./index-QjjBz54k.js";const H=["grey","heat","cool","rainbow","viridis","plasma","magma","inferno","cubehelix","red","green","blue"],_=["linear","log","sqrt","squared","asinh","sinh","histeq","power"],K=({colorMap:d,scale:s,contrast:f,bias:j,showRegions:y,showCrosshair:h,onChange:i,onZoomIn:g,onZoomOut:u,onZoomFit:l,onExport:w})=>{const[S,p]=a.useState(!0);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>p(!S),className:"w-full flex items-center justify-between px-3 py-2 bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-700",children:"Display Settings"}),e.jsx("svg",{className:`w-4 h-4 text-gray-500 transition-transform ${S?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),S&&e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:g,className:"flex-1 px-2 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded transition-colors",title:"Zoom in",children:e.jsx("svg",{className:"w-4 h-4 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})})}),e.jsx("button",{onClick:u,className:"flex-1 px-2 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded transition-colors",title:"Zoom out",children:e.jsx("svg",{className:"w-4 h-4 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM7 10h6"})})}),e.jsx("button",{onClick:l,className:"flex-1 px-2 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded transition-colors",title:"Fit to window",children:e.jsx("svg",{className:"w-4 h-4 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Color Map"}),e.jsx("select",{value:d,onChange:t=>i({colorMap:t.target.value}),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm",children:H.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Scale"}),e.jsx("select",{value:s,onChange:t=>i({scale:t.target.value}),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm",children:_.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"Contrast"}),e.jsxs("span",{className:"text-gray-400",children:[(f*100).toFixed(0),"%"]})]}),e.jsx("input",{type:"range",min:0,max:1,step:.01,value:f,onChange:t=>i({contrast:parseFloat(t.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"Bias"}),e.jsxs("span",{className:"text-gray-400",children:[(j*100).toFixed(0),"%"]})]}),e.jsx("input",{type:"range",min:0,max:1,step:.01,value:j,onChange:t=>i({bias:parseFloat(t.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-100",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:t=>i({showRegions:t.target.checked}),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Show regions"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:t=>i({showCrosshair:t.target.checked}),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Show crosshair"})]})]}),w&&e.jsxs("div",{className:"flex gap-2 pt-2 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>w("png"),className:"flex-1 px-2 py-1.5 text-sm bg-primary text-white rounded hover:bg-primary-dark transition-colors",children:"Export PNG"}),e.jsx("button",{onClick:()=>w("fits"),className:"flex-1 px-2 py-1.5 text-sm border border-primary text-primary rounded hover:bg-primary/10 transition-colors",children:"Export FITS"})]})]})]})},X=({fitsUrl:d,displayId:s="JS9",width:f=512,height:j=512,showControls:y=!0,initialCenter:h,initialFov:i,onCoordinateClick:g,onLoad:u,onError:l,className:w=""})=>{var R;const S=a.useRef(null),[p,t]=a.useState(!0),[v,b]=a.useState(null),[x,P]=a.useState(!1),[N,W]=a.useState(null),k=a.useRef(null),[c,$]=a.useState({colorMap:"grey",scale:"log",contrast:.5,bias:.5,showRegions:!0,showCrosshair:!1});k.current===null&&(k.current={...c}),a.useEffect(()=>{const r=()=>window.JS9&&window.JS9.Load?(P(!0),!0):!1;if(r())return;const o=setInterval(()=>{r()&&clearInterval(o)},100),m=setTimeout(()=>{clearInterval(o),x||(b("JS9 library failed to load. Make sure JS9 CDN is included."),t(!1))},1e4);return()=>{clearInterval(o),clearTimeout(m)}},[x]),a.useEffect(()=>{if(!(!x||!d)){t(!0),b(null);try{window.JS9.Load(d,{display:s,onload:r=>{t(!1),h&&window.JS9.SetPan(h.ra,h.dec,{display:s}),i&&window.JS9.SetZoom("tofit",{display:s});const o=k.current;o&&(window.JS9.SetColormap(o.colorMap,{display:s}),window.JS9.SetScale(o.scale,{display:s})),u==null||u()},onerror:r=>{b(r||"Failed to load FITS file"),t(!1),l==null||l(r)}}),g&&window.JS9.SetCallback("onclick",(r,o,m)=>{const n=window.JS9.PixToWCS(m.x,m.y,{display:s});n&&g(n.ra,n.dec)},{display:s}),window.JS9.SetCallback("onmousemove",(r,o,m)=>{try{const n=window.JS9.PixToWCS(m.x,m.y,{display:s});if(n&&n.ra!==void 0&&n.dec!==void 0){const C=n.ra/15,J=Math.floor(C),L=Math.floor((C-J)*60),V=((C-J)*60-L)*60,q=`${J.toString().padStart(2,"0")}:${L.toString().padStart(2,"0")}:${V.toFixed(2).padStart(5,"0")}`,z=n.dec>=0?"+":"-",M=Math.abs(n.dec),F=Math.floor(M),Z=Math.floor((M-F)*60),E=((M-F)*60-Z)*60,G=`${z}${F.toString().padStart(2,"0")}:${Z.toString().padStart(2,"0")}:${E.toFixed(1).padStart(4,"0")}`;W({ra:q,dec:G})}}catch{}},{display:s})}catch(r){b(String(r)),t(!1),l==null||l(String(r))}return()=>{var r;(r=window.JS9)!=null&&r.CloseImage&&window.JS9.CloseImage({display:s})}}},[x,d,s,h,i,u,l,g]),a.useEffect(()=>{if(!(!x||p))try{window.JS9.SetColormap(c.colorMap,{display:s}),window.JS9.SetScale(c.scale,{display:s}),window.JS9.SetParam("contrast",c.contrast,{display:s}),window.JS9.SetParam("bias",c.bias,{display:s});try{const r=window.JS9.GetRegions("all",{display:s});r&&r.length>0&&r.forEach(o=>{window.JS9.ChangeRegions(o.id,{visibility:c.showRegions},{display:s})})}catch(r){console.debug("Region visibility toggle:",r)}window.JS9.SetParam("crosshair",c.showCrosshair,{display:s})}catch(r){console.warn("Failed to apply JS9 settings:",r)}},[c,x,p,s]);const T=a.useCallback(()=>{window.JS9&&window.JS9.SetZoom("in",{display:s})},[s]),A=a.useCallback(()=>{window.JS9&&window.JS9.SetZoom("out",{display:s})},[s]),B=a.useCallback(()=>{window.JS9&&window.JS9.SetZoom("tofit",{display:s})},[s]),D=a.useCallback(r=>{window.JS9&&(r==="png"?window.JS9.SavePNG({display:s}):window.JS9.SaveFITS({display:s}))},[s]),O=r=>{$(o=>({...o,...r}))};return e.jsxs("div",{className:`flex gap-4 ${w}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{ref:S,className:"relative bg-black rounded-lg overflow-hidden",style:{width:f,height:j},children:[e.jsx("div",{className:"JS9",id:s,style:{width:"100%",height:"100%"}}),p&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("span",{className:"text-white text-sm",children:"Loading FITS..."})]})}),v&&e.jsx("div",{className:"absolute inset-0 bg-red-900/80 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-8 h-8 text-red-300 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-red-100 text-sm",children:v})]})}),!x&&!p&&!v&&e.jsx("div",{className:"absolute inset-0 bg-gray-800 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-300 text-sm",children:"JS9 library not loaded. Add the following to your index.html:"}),e.jsx("code",{className:"text-xs text-gray-400 mt-2 block",children:'<script src="https://js9.si.edu/js9/js9.min.js"><\/script>'})]})})]}),e.jsxs("div",{className:"mt-2 flex justify-between items-center text-xs text-gray-500 bg-gray-100 rounded px-2 py-1",children:[e.jsx("span",{className:"font-mono",children:N?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-700",children:"RA:"})," ",N.ra," ",e.jsx("span",{className:"text-gray-700 ml-2",children:"Dec:"})," ",N.dec]}):e.jsx("span",{className:"text-gray-400",children:"Move cursor over image for coordinates"})}),e.jsx("span",{className:"text-gray-400 truncate max-w-[150px]",title:d,children:((R=d.split("/").pop())==null?void 0:R.substring(0,25))||"No file"})]})]}),y&&e.jsx("div",{className:"w-48 flex-shrink-0",children:e.jsx(K,{...c,onChange:O,onZoomIn:T,onZoomOut:A,onZoomFit:B,onExport:D})})]})};export{X as F};
//# sourceMappingURL=FitsViewer-DACfSk0t.js.map
