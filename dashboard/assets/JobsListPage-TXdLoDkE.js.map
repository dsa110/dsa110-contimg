{"version":3,"file":"JobsListPage-TXdLoDkE.js","sources":["../../src/pages/JobsListPage.tsx"],"sourcesContent":["import React, { useCallback, useMemo } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { useJobs } from \"../hooks/useQueries\";\nimport { relativeTime } from \"../utils/relativeTime\";\nimport { LoadingSpinner, SortableTableHeader, useTableSort } from \"../components/common\";\nimport { useSelectionStore } from \"../stores/appStore\";\n\ninterface JobItem {\n  run_id: string;\n  status: string;\n  started_at?: string;\n}\n\n/**\n * List page showing all pipeline jobs with sortable columns.\n */\nconst JobsListPage: React.FC = () => {\n  const { data: jobs, isLoading, error } = useJobs();\n\n  // Multi-select state\n  const selectedJobs = useSelectionStore((s) => s.selectedJobs);\n  const toggleJobSelection = useSelectionStore((s) => s.toggleJobSelection);\n  const selectAllJobs = useSelectionStore((s) => s.selectAllJobs);\n  const clearJobSelection = useSelectionStore((s) => s.clearJobSelection);\n\n  const selectedIds = useMemo(() => Array.from(selectedJobs), [selectedJobs]);\n\n  const handleBulkAction = useCallback(\n    async (action: \"rerun\" | \"cancel\" | \"export\") => {\n      if (selectedIds.length === 0) return;\n      const baseUrl = import.meta.env.VITE_API_URL || \"/api\";\n      if (action === \"export\") {\n        window.open(`${baseUrl}/jobs/export?ids=${selectedIds.join(\",\")}`, \"_blank\");\n      } else {\n        await fetch(`${baseUrl}/jobs/bulk-${action}`, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ runIds: selectedIds }),\n        });\n      }\n    },\n    [selectedIds]\n  );\n\n  // Apply sorting using the hook\n  const {\n    sortColumn,\n    sortDirection,\n    handleSort,\n    sortedData: sortedJobs,\n  } = useTableSort<JobItem>(jobs as JobItem[] | undefined, \"started_at\", \"desc\");\n\n  if (isLoading) {\n    return <LoadingSpinner label=\"Loading jobs...\" />;\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\n        Failed to load jobs: {error.message}\n      </div>\n    );\n  }\n\n  const getStatusBadgeClass = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"badge-success\";\n      case \"running\":\n        return \"badge-info\";\n      case \"failed\":\n        return \"badge-error\";\n      case \"pending\":\n        return \"badge-warning\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  return (\n    <div className=\"max-w-6xl mx-auto\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center gap-4\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Pipeline Jobs</h1>\n          {selectedIds.length > 0 && (\n            <span className=\"text-sm text-gray-500\">{selectedIds.length} selected</span>\n          )}\n        </div>\n        {selectedIds.length > 0 && (\n          <div className=\"flex gap-2\">\n            <button\n              onClick={() => handleBulkAction(\"rerun\")}\n              className=\"px-3 py-1.5 rounded text-sm font-medium bg-blue-600 text-white hover:bg-blue-700\"\n            >\n              Rerun Selected\n            </button>\n            <button\n              onClick={() => handleBulkAction(\"cancel\")}\n              className=\"px-3 py-1.5 rounded text-sm font-medium bg-orange-600 text-white hover:bg-orange-700\"\n            >\n              Cancel Selected\n            </button>\n            <button\n              onClick={() => handleBulkAction(\"export\")}\n              className=\"px-3 py-1.5 rounded text-sm font-medium bg-green-600 text-white hover:bg-green-700\"\n            >\n              Export Logs\n            </button>\n          </div>\n        )}\n      </div>\n\n      {sortedJobs && sortedJobs.length > 0 ? (\n        <div className=\"card overflow-hidden\">\n          <table className=\"table\">\n            <thead>\n              <tr>\n                <th className=\"w-10 px-3 py-3\">\n                  <input\n                    type=\"checkbox\"\n                    checked={selectedIds.length === sortedJobs.length && sortedJobs.length > 0}\n                    ref={(el) => {\n                      if (el)\n                        el.indeterminate =\n                          selectedIds.length > 0 && selectedIds.length < sortedJobs.length;\n                    }}\n                    onChange={() => {\n                      if (selectedIds.length === sortedJobs.length) {\n                        clearJobSelection();\n                      } else {\n                        selectAllJobs(sortedJobs.map((j) => j.run_id));\n                      }\n                    }}\n                    className=\"h-4 w-4 text-blue-600 rounded\"\n                  />\n                </th>\n                <SortableTableHeader\n                  columnKey=\"run_id\"\n                  sortColumn={sortColumn}\n                  sortDirection={sortDirection}\n                  onSort={handleSort}\n                >\n                  Run ID\n                </SortableTableHeader>\n                <SortableTableHeader\n                  columnKey=\"status\"\n                  sortColumn={sortColumn}\n                  sortDirection={sortDirection}\n                  onSort={handleSort}\n                  className=\"text-center\"\n                >\n                  Status\n                </SortableTableHeader>\n                <SortableTableHeader\n                  columnKey=\"started_at\"\n                  sortColumn={sortColumn}\n                  sortDirection={sortDirection}\n                  onSort={handleSort}\n                  className=\"text-right\"\n                >\n                  Started\n                </SortableTableHeader>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-200\">\n              {sortedJobs.map((job) => (\n                <tr key={job.run_id} className={selectedJobs.has(job.run_id) ? \"bg-blue-50\" : \"\"}>\n                  <td className=\"px-3\">\n                    <input\n                      type=\"checkbox\"\n                      checked={selectedJobs.has(job.run_id)}\n                      onChange={() => toggleJobSelection(job.run_id)}\n                      className=\"h-4 w-4 text-blue-600 rounded\"\n                    />\n                  </td>\n                  <td>\n                    <Link\n                      to={`/jobs/${job.run_id}`}\n                      className=\"text-blue-600 hover:text-blue-800 font-medium\"\n                    >\n                      {job.run_id}\n                    </Link>\n                  </td>\n                  <td className=\"text-center\">\n                    <span className={`badge ${getStatusBadgeClass(job.status)}`}>{job.status}</span>\n                  </td>\n                  <td className=\"text-right text-gray-500\">\n                    {job.started_at ? relativeTime(job.started_at) : \"â€”\"}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      ) : (\n        <p className=\"text-gray-500\">No jobs found.</p>\n      )}\n    </div>\n  );\n};\n\nexport default JobsListPage;\n"],"names":["JobsListPage","jobs","isLoading","error","useJobs","selectedJobs","useSelectionStore","s","toggleJobSelection","selectAllJobs","clearJobSelection","selectedIds","useMemo","handleBulkAction","useCallback","action","baseUrl","sortColumn","sortDirection","handleSort","sortedJobs","useTableSort","jsx","LoadingSpinner","jsxs","getStatusBadgeClass","status","el","j","SortableTableHeader","job","Link","relativeTime"],"mappings":"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"}