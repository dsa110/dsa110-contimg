import{r as c,j as e,L as w}from"./index-CnKM1lPu.js";import{u as S}from"./useQueries-DCqY91tB.js";import{a as j,L as k}from"./appStore--CVtLTkT.js";import{u as C,S as y}from"./SortableTableHeader-DjmHQkZl.js";const D=[{value:"fits",label:"FITS"},{value:"csv",label:"CSV"},{value:"json",label:"JSON"},{value:"zip",label:"ZIP Archive"}],_=({items:l,selectedIds:s,onSelectionChange:o,onDownload:h,className:x="",disabled:m=!1})=>{const[n,g]=c.useState("fits"),[b,u]=c.useState(!1),p=c.useCallback(()=>{s.length===l.length?o([]):o(l.map(t=>t.id))},[l,s.length,o]),i=c.useCallback(t=>{s.includes(t)?o(s.filter(a=>a!==t)):o([...s,t])},[s,o]),f=c.useCallback(async()=>{if(s.length!==0){u(!0);try{await h(s,n)}finally{u(!1)}}},[s,n,h]),N=s.length===l.length&&l.length>0,r=s.length>0&&s.length<l.length;return e.jsxs("div",{className:`card ${x}`,children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Bulk Download"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.length," of ",l.length," selected"]})]}),e.jsxs("div",{className:"card-body space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N,ref:t=>{t&&(t.indeterminate=r)},onChange:p,disabled:m||l.length===0,className:"w-4 h-4 text-vast-green rounded border-gray-300 focus:ring-vast-green"}),e.jsx("span",{className:"text-sm",children:"Select All"})]}),s.length>0&&e.jsx("button",{onClick:()=>o([]),className:"text-sm text-gray-500 hover:text-red-500",children:"Clear selection"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Export Format"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:D.map(t=>e.jsx("button",{onClick:()=>g(t.value),disabled:m,className:`py-2 px-3 rounded-md text-sm font-medium transition-all ${n===t.value?"bg-vast-green text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.label},t.value))})]}),s.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 max-h-40 overflow-y-auto",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Selected items:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.slice(0,10).map(t=>{const a=l.find(d=>d.id===t);return e.jsxs("span",{className:"badge badge-secondary flex items-center gap-1",children:[(a==null?void 0:a.name)||t,e.jsx("button",{onClick:()=>i(t),className:"hover:text-red-500",children:"×"})]},t)}),s.length>10&&e.jsxs("span",{className:"badge badge-info",children:["+",s.length-10," more"]})]})]}),e.jsx("button",{onClick:f,disabled:m||s.length===0||b,className:"btn btn-primary w-full",children:b?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Preparing Download..."]}):e.jsxs(e.Fragment,{children:["Download ",s.length," item",s.length!==1?"s":""," as"," ",n.toUpperCase()]})}),e.jsxs("div",{className:"text-xs text-gray-500",children:[n==="fits"&&"Download raw FITS files individually.",n==="csv"&&"Export metadata as CSV spreadsheet.",n==="json"&&"Export metadata as JSON.",n==="zip"&&"Download all files in a single ZIP archive."]})]})]})},$=()=>{const{data:l,isLoading:s,error:o}=S(),{sortKey:h,sortDirection:x,handleSort:m,sortItems:n}=C("created_at","desc"),g=j(a=>a.selectedImages),b=j(a=>a.toggleImageSelection),u=j(a=>a.selectAllImages),p=j(a=>a.clearImageSelection),i=c.useMemo(()=>Array.from(g),[g]),f=c.useCallback(a=>{a.length===0?p():u(a)},[p,u]),N=c.useCallback(async(a,d)=>{const v=`https://ronnie-unsectarian-antone.ngrok-free.dev/api/images/bulk-download?ids=${a.join(",")}&format=${d}`;window.open(v,"_blank")},[]),r=c.useMemo(()=>l?n(l,h,x):[],[l,h,x,n]);if(s)return e.jsx(k,{label:"Loading images..."});if(o)return e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:["Failed to load images: ",o.message]});const t=c.useMemo(()=>r.map(a=>{var d;return{id:a.id,name:((d=a.path)==null?void 0:d.split("/").pop())||a.id,type:"FITS"}}),[r]);return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Images"}),i.length>0&&e.jsxs("span",{className:"text-sm text-gray-500",children:[i.length," selected"]})]}),r.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(_,{items:t,selectedIds:i,onSelectionChange:f,onDownload:N})}),r&&r.length>0?e.jsx("div",{className:"card overflow-hidden",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10 px-3 py-3",children:e.jsx("input",{type:"checkbox",checked:i.length===r.length&&r.length>0,ref:a=>{a&&(a.indeterminate=i.length>0&&i.length<r.length)},onChange:()=>{i.length===r.length?p():u(r.map(a=>a.id))},className:"h-4 w-4 text-blue-600 rounded"})}),e.jsx(y,{label:"Name",sortKey:"path",currentSortKey:h,direction:x,onSort:m}),e.jsx(y,{label:"QA Grade",sortKey:"qa_grade",currentSortKey:h,direction:x,onSort:m,className:"text-center"}),e.jsx(y,{label:"Created",sortKey:"created_at",currentSortKey:h,direction:x,onSort:m,className:"text-right"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:r.map(a=>{var d;return e.jsxs("tr",{className:g.has(a.id)?"bg-blue-50":"",children:[e.jsx("td",{className:"px-3",children:e.jsx("input",{type:"checkbox",checked:g.has(a.id),onChange:()=>b(a.id),className:"h-4 w-4 text-blue-600 rounded"})}),e.jsx("td",{children:e.jsx(w,{to:`/images/${a.id}`,className:"text-blue-600 hover:text-blue-800 font-medium",children:((d=a.path)==null?void 0:d.split("/").pop())||a.id})}),e.jsx("td",{className:"text-center",children:a.qa_grade&&e.jsx("span",{className:`badge ${a.qa_grade==="good"?"badge-success":a.qa_grade==="warn"?"badge-warning":"badge-error"}`,children:a.qa_grade})}),e.jsx("td",{className:"text-right text-gray-500",children:a.created_at?new Date(a.created_at).toLocaleDateString():"—"})]},a.id)})})]})}):e.jsx("p",{className:"text-gray-500",children:"No images found."})]})};export{$ as default};
//# sourceMappingURL=ImagesListPage-CJOxVb34.js.map
