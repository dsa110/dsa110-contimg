{"version":3,"file":"AladinLiteViewer-BhrpbVLx.js","sources":["../../src/components/widgets/AladinLiteViewer.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from \"react\";\n\nexport interface AladinLiteViewerProps {\n  /** Right Ascension in degrees */\n  raDeg: number;\n  /** Declination in degrees */\n  decDeg: number;\n  /** Field of view in degrees (default: 0.25) */\n  fov?: number;\n  /** Height of the viewer in pixels or CSS string */\n  height?: number | string;\n  /** Optional survey to display (default: P/DSS2/color) */\n  survey?: string;\n  /** Optional source name for marker */\n  sourceName?: string;\n  /** Custom class name */\n  className?: string;\n  /** Enable fullscreen toggle */\n  showFullscreen?: boolean;\n}\n\ndeclare global {\n  interface Window {\n    A?: {\n      aladin: (element: HTMLElement, options: AladinOptions) => AladinInstance;\n      catalogFromVizieR: (\n        catalog: string,\n        position: string,\n        radius: number,\n        options?: { shape?: string; color?: string }\n      ) => void;\n    };\n  }\n}\n\ninterface AladinOptions {\n  target: string;\n  fov: number;\n  survey?: string;\n  showReticle?: boolean;\n  showZoomControl?: boolean;\n  showFullscreenControl?: boolean;\n  showLayersControl?: boolean;\n  showGotoControl?: boolean;\n  showShareControl?: boolean;\n  showCatalog?: boolean;\n  showFrame?: boolean;\n}\n\ninterface AladinInstance {\n  gotoRaDec: (ra: number, dec: number) => void;\n  setFoV: (fov: number) => void;\n  setImageSurvey: (survey: string) => void;\n  addCatalog: (catalog: unknown) => void;\n  increaseZoom: () => void;\n  decreaseZoom: () => void;\n  toggleFullscreen: () => void;\n}\n\nconst ALADIN_CSS_URL = \"https://aladin.cds.unistra.fr/AladinLite/api/v3/latest/aladin.min.css\";\nconst ALADIN_JS_URL = \"https://aladin.cds.unistra.fr/AladinLite/api/v3/latest/aladin.min.js\";\nconst ALADIN_INTEGRITY = \"sha384-5Fz016Wxf7jHEXNKZn3kQ2Ac9cnag6/VZw04/m+uxBUASk3G5i63DtAo0LikMIFm\";\n\n/**\n * Interactive sky viewer using Aladin Lite v3.\n * Displays an interactive sky map centered on the specified coordinates.\n */\nconst AladinLiteViewer: React.FC<AladinLiteViewerProps> = ({\n  raDeg,\n  decDeg,\n  fov = 0.25,\n  height = 400,\n  survey = \"P/DSS2/color\",\n  sourceName,\n  className = \"\",\n  showFullscreen = true,\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const aladinRef = useRef<AladinInstance | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [currentFov, setCurrentFov] = useState(fov);\n\n  // Load Aladin Lite scripts\n  useEffect(() => {\n    const loadAladinLite = async () => {\n      // Check if already loaded\n      if (window.A) {\n        setIsLoading(false);\n        return;\n      }\n\n      try {\n        // Load CSS\n        if (!document.querySelector(`link[href=\"${ALADIN_CSS_URL}\"]`)) {\n          const link = document.createElement(\"link\");\n          link.rel = \"stylesheet\";\n          link.href = ALADIN_CSS_URL;\n          link.integrity = ALADIN_INTEGRITY;\n          link.crossOrigin = \"anonymous\";\n          document.head.appendChild(link);\n        }\n\n        // Load JS\n        if (!document.querySelector(`script[src=\"${ALADIN_JS_URL}\"]`)) {\n          await new Promise<void>((resolve, reject) => {\n            const script = document.createElement(\"script\");\n            script.src = ALADIN_JS_URL;\n            script.async = true;\n            script.integrity = ALADIN_INTEGRITY;\n            script.crossOrigin = \"anonymous\";\n            script.onload = () => resolve();\n            script.onerror = () => reject(new Error(\"Failed to load Aladin Lite\"));\n            document.head.appendChild(script);\n          });\n        }\n\n        // Wait for A to be available\n        let attempts = 0;\n        while (!window.A && attempts < 50) {\n          await new Promise((resolve) => setTimeout(resolve, 100));\n          attempts++;\n        }\n\n        if (!window.A) {\n          throw new Error(\"Aladin Lite failed to initialize\");\n        }\n\n        setIsLoading(false);\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \"Failed to load sky viewer\");\n        setIsLoading(false);\n      }\n    };\n\n    loadAladinLite();\n  }, []);\n\n  // Initialize Aladin viewer\n  useEffect(() => {\n    if (isLoading || error || !containerRef.current || !window.A) return;\n\n    const target = `${raDeg.toFixed(6)} ${decDeg >= 0 ? \"+\" : \"\"}${decDeg.toFixed(6)}`;\n\n    aladinRef.current = window.A.aladin(containerRef.current, {\n      target,\n      fov: currentFov,\n      survey,\n      showReticle: true,\n      showZoomControl: true,\n      showFullscreenControl: showFullscreen,\n      showLayersControl: true,\n      showGotoControl: false,\n      showShareControl: false,\n      showCatalog: true,\n      showFrame: true,\n    });\n\n    // Add marker at source position if name provided\n    if (sourceName) {\n      // Aladin will show the crosshair at center\n    }\n  }, [isLoading, error, raDeg, decDeg, currentFov, survey, showFullscreen, sourceName]);\n\n  // Update position when coordinates change\n  useEffect(() => {\n    if (aladinRef.current) {\n      aladinRef.current.gotoRaDec(raDeg, decDeg);\n    }\n  }, [raDeg, decDeg]);\n\n  const handleZoomIn = useCallback(() => {\n    if (aladinRef.current) {\n      aladinRef.current.increaseZoom();\n      setCurrentFov((prev) => Math.max(0.001, prev / 2));\n    }\n  }, []);\n\n  const handleZoomOut = useCallback(() => {\n    if (aladinRef.current) {\n      aladinRef.current.decreaseZoom();\n      setCurrentFov((prev) => Math.min(180, prev * 2));\n    }\n  }, []);\n\n  const handleFullscreen = useCallback(() => {\n    if (aladinRef.current) {\n      aladinRef.current.toggleFullscreen();\n    }\n  }, []);\n\n  const heightStyle = typeof height === \"number\" ? `${height}px` : height;\n\n  if (error) {\n    return (\n      <div\n        className={`bg-gray-100 rounded-lg flex items-center justify-center ${className}`}\n        style={{ height: heightStyle }}\n      >\n        <div className=\"text-center text-gray-500 p-4\">\n          <svg\n            className=\"w-12 h-12 mx-auto mb-2 text-gray-400\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n            />\n          </svg>\n          <p className=\"text-sm\">{error}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`relative ${className}`}>\n      {isLoading && (\n        <div\n          className=\"absolute inset-0 bg-gray-100 rounded-lg flex items-center justify-center z-10\"\n          style={{ height: heightStyle }}\n        >\n          <div className=\"flex flex-col items-center text-gray-500\">\n            <div className=\"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-2\" />\n            <span className=\"text-sm\">Loading sky viewer...</span>\n          </div>\n        </div>\n      )}\n      <div\n        ref={containerRef}\n        className=\"rounded-lg overflow-hidden\"\n        style={{ height: heightStyle, width: \"100%\" }}\n      />\n      {/* Custom controls overlay */}\n      <div className=\"absolute bottom-2 left-2 flex gap-1\">\n        <button\n          type=\"button\"\n          onClick={handleZoomIn}\n          className=\"bg-white/90 hover:bg-white p-1.5 rounded shadow text-gray-700 hover:text-gray-900 transition-colors\"\n          title=\"Zoom in\"\n        >\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v12m6-6H6\" />\n          </svg>\n        </button>\n        <button\n          type=\"button\"\n          onClick={handleZoomOut}\n          className=\"bg-white/90 hover:bg-white p-1.5 rounded shadow text-gray-700 hover:text-gray-900 transition-colors\"\n          title=\"Zoom out\"\n        >\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18 12H6\" />\n          </svg>\n        </button>\n        {showFullscreen && (\n          <button\n            type=\"button\"\n            onClick={handleFullscreen}\n            className=\"bg-white/90 hover:bg-white p-1.5 rounded shadow text-gray-700 hover:text-gray-900 transition-colors\"\n            title=\"Toggle fullscreen\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\"\n              />\n            </svg>\n          </button>\n        )}\n      </div>\n      {/* Coordinate display */}\n      <div className=\"absolute top-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded font-mono\">\n        {raDeg.toFixed(4)}° {decDeg >= 0 ? \"+\" : \"\"}\n        {decDeg.toFixed(4)}°\n      </div>\n    </div>\n  );\n};\n\nexport default AladinLiteViewer;\n"],"names":["ALADIN_CSS_URL","ALADIN_JS_URL","ALADIN_INTEGRITY","AladinLiteViewer","raDeg","decDeg","fov","height","survey","sourceName","className","showFullscreen","containerRef","useRef","aladinRef","isLoading","setIsLoading","useState","error","setError","currentFov","setCurrentFov","useEffect","link","resolve","reject","script","attempts","err","target","handleZoomIn","useCallback","prev","handleZoomOut","handleFullscreen","heightStyle","jsx","jsxs"],"mappings":"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"}