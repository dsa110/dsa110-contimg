{"version":3,"file":"ImagesListPage-BfEtsdTo.js","sources":["../../src/components/widgets/RangeSlider.tsx","../../src/components/fits/FitsViewerGrid.tsx","../../src/components/download/BulkDownloadPanel.tsx","../../src/components/filters/FilterPanel.tsx","../../src/pages/ImagesListPage.tsx"],"sourcesContent":["import React, { useState, useCallback, useRef, useEffect } from \"react\";\n\nexport interface RangeSliderProps {\n  /** Minimum possible value */\n  min: number;\n  /** Maximum possible value */\n  max: number;\n  /** Current minimum value */\n  minValue?: number;\n  /** Current maximum value */\n  maxValue?: number;\n  /** Step increment (default: 1) */\n  step?: number;\n  /** Label for the slider */\n  label?: string;\n  /** Unit suffix (e.g., \"mJy\", \"deg\") */\n  unit?: string;\n  /** Callback when values change */\n  onChange?: (minValue: number, maxValue: number) => void;\n  /** Callback when user finishes dragging (for debounced updates) */\n  onChangeComplete?: (minValue: number, maxValue: number) => void;\n  /** Show input fields for precise entry (default: true) */\n  showInputs?: boolean;\n  /** Show histogram overlay (optional) */\n  histogram?: number[];\n  /** Custom class name */\n  className?: string;\n  /** Number of decimal places for display */\n  decimals?: number;\n  /** Disabled state */\n  disabled?: boolean;\n  /** Format function for display values */\n  formatValue?: (value: number) => string;\n}\n\n/**\n * Dual-handle range slider for min/max value filtering.\n * Supports precise input, histograms, and customizable formatting.\n */\nconst RangeSlider: React.FC<RangeSliderProps> = ({\n  min,\n  max,\n  minValue: initialMinValue,\n  maxValue: initialMaxValue,\n  step = 1,\n  label,\n  unit = \"\",\n  onChange,\n  onChangeComplete,\n  showInputs = true,\n  histogram,\n  className = \"\",\n  decimals = 2,\n  disabled = false,\n  formatValue,\n}) => {\n  const [minValue, setMinValue] = useState(initialMinValue ?? min);\n  const [maxValue, setMaxValue] = useState(initialMaxValue ?? max);\n  const [isDragging, setIsDragging] = useState<\"min\" | \"max\" | null>(null);\n  const trackRef = useRef<HTMLDivElement>(null);\n\n  // Update internal state when props change\n  useEffect(() => {\n    if (initialMinValue !== undefined) setMinValue(initialMinValue);\n    if (initialMaxValue !== undefined) setMaxValue(initialMaxValue);\n  }, [initialMinValue, initialMaxValue]);\n\n  const formatDisplayValue = useCallback(\n    (value: number): string => {\n      if (formatValue) {\n        return formatValue(value);\n      }\n      return value.toFixed(decimals);\n    },\n    [formatValue, decimals]\n  );\n\n  const getPercentage = useCallback(\n    (value: number): number => {\n      return ((value - min) / (max - min)) * 100;\n    },\n    [min, max]\n  );\n\n  const getValueFromPercentage = useCallback(\n    (percentage: number): number => {\n      const rawValue = min + (percentage / 100) * (max - min);\n      // Snap to step\n      const steppedValue = Math.round(rawValue / step) * step;\n      return Math.max(min, Math.min(max, steppedValue));\n    },\n    [min, max, step]\n  );\n\n  const handleTrackClick = useCallback(\n    (e: React.MouseEvent<HTMLDivElement>) => {\n      if (disabled || !trackRef.current) return;\n\n      const rect = trackRef.current.getBoundingClientRect();\n      const percentage = ((e.clientX - rect.left) / rect.width) * 100;\n      const clickedValue = getValueFromPercentage(percentage);\n\n      // Determine which handle to move (closest one)\n      const distToMin = Math.abs(clickedValue - minValue);\n      const distToMax = Math.abs(clickedValue - maxValue);\n\n      if (distToMin <= distToMax) {\n        const newMin = Math.min(clickedValue, maxValue - step);\n        setMinValue(newMin);\n        onChange?.(newMin, maxValue);\n        onChangeComplete?.(newMin, maxValue);\n      } else {\n        const newMax = Math.max(clickedValue, minValue + step);\n        setMaxValue(newMax);\n        onChange?.(minValue, newMax);\n        onChangeComplete?.(minValue, newMax);\n      }\n    },\n    [disabled, getValueFromPercentage, minValue, maxValue, step, onChange, onChangeComplete]\n  );\n\n  const handleMinChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      const newMin = Math.min(parseFloat(e.target.value) || min, maxValue - step);\n      setMinValue(newMin);\n      onChange?.(newMin, maxValue);\n    },\n    [min, maxValue, step, onChange]\n  );\n\n  const handleMaxChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      const newMax = Math.max(parseFloat(e.target.value) || max, minValue + step);\n      setMaxValue(newMax);\n      onChange?.(minValue, newMax);\n    },\n    [max, minValue, step, onChange]\n  );\n\n  const handleInputBlur = useCallback(() => {\n    onChangeComplete?.(minValue, maxValue);\n  }, [minValue, maxValue, onChangeComplete]);\n\n  const handleMinSliderChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      const value = parseFloat(e.target.value);\n      const newMin = Math.min(value, maxValue - step);\n      setMinValue(newMin);\n      onChange?.(newMin, maxValue);\n    },\n    [maxValue, step, onChange]\n  );\n\n  const handleMaxSliderChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      const value = parseFloat(e.target.value);\n      const newMax = Math.max(value, minValue + step);\n      setMaxValue(newMax);\n      onChange?.(minValue, newMax);\n    },\n    [minValue, step, onChange]\n  );\n\n  const handleSliderComplete = useCallback(() => {\n    setIsDragging(null);\n    onChangeComplete?.(minValue, maxValue);\n  }, [minValue, maxValue, onChangeComplete]);\n\n  const handleReset = useCallback(() => {\n    setMinValue(min);\n    setMaxValue(max);\n    onChange?.(min, max);\n    onChangeComplete?.(min, max);\n  }, [min, max, onChange, onChangeComplete]);\n\n  const minPercent = getPercentage(minValue);\n  const maxPercent = getPercentage(maxValue);\n\n  return (\n    <div className={`space-y-2 ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        {label && <span className=\"text-sm font-medium text-gray-700\">{label}</span>}\n        <button\n          type=\"button\"\n          onClick={handleReset}\n          disabled={disabled}\n          className=\"text-xs text-blue-600 hover:text-blue-800 disabled:text-gray-400\"\n        >\n          Reset\n        </button>\n      </div>\n\n      {/* Histogram overlay (optional) */}\n      {histogram && histogram.length > 0 && (\n        <div className=\"h-8 flex items-end gap-px\">\n          {histogram.map((value, index) => {\n            const maxHist = Math.max(...histogram);\n            const height = maxHist > 0 ? (value / maxHist) * 100 : 0;\n            const barMin = min + (index / histogram.length) * (max - min);\n            const barMax = min + ((index + 1) / histogram.length) * (max - min);\n            const isInRange = barMax >= minValue && barMin <= maxValue;\n\n            return (\n              <div\n                key={index}\n                className={`flex-1 rounded-t transition-colors ${\n                  isInRange ? \"bg-blue-400\" : \"bg-gray-300\"\n                }`}\n                style={{ height: `${height}%`, minHeight: value > 0 ? \"2px\" : \"0\" }}\n              />\n            );\n          })}\n        </div>\n      )}\n\n      {/* Slider track */}\n      <div className=\"relative h-6 flex items-center\">\n        <div\n          ref={trackRef}\n          className=\"absolute w-full h-2 bg-gray-200 rounded-full cursor-pointer\"\n          onClick={handleTrackClick}\n        >\n          {/* Selected range */}\n          <div\n            className=\"absolute h-full bg-blue-500 rounded-full\"\n            style={{\n              left: `${minPercent}%`,\n              width: `${maxPercent - minPercent}%`,\n            }}\n          />\n        </div>\n\n        {/* Min handle */}\n        <input\n          type=\"range\"\n          min={min}\n          max={max}\n          step={step}\n          value={minValue}\n          onChange={handleMinSliderChange}\n          onMouseUp={handleSliderComplete}\n          onTouchEnd={handleSliderComplete}\n          onMouseDown={() => setIsDragging(\"min\")}\n          disabled={disabled}\n          className=\"absolute w-full h-2 appearance-none bg-transparent pointer-events-none\n            [&::-webkit-slider-thumb]:pointer-events-auto\n            [&::-webkit-slider-thumb]:appearance-none\n            [&::-webkit-slider-thumb]:w-5\n            [&::-webkit-slider-thumb]:h-5\n            [&::-webkit-slider-thumb]:bg-white\n            [&::-webkit-slider-thumb]:border-2\n            [&::-webkit-slider-thumb]:border-blue-500\n            [&::-webkit-slider-thumb]:rounded-full\n            [&::-webkit-slider-thumb]:shadow\n            [&::-webkit-slider-thumb]:cursor-grab\n            [&::-webkit-slider-thumb]:active:cursor-grabbing\n            [&::-webkit-slider-thumb]:hover:scale-110\n            [&::-webkit-slider-thumb]:transition-transform\n            [&::-moz-range-thumb]:pointer-events-auto\n            [&::-moz-range-thumb]:appearance-none\n            [&::-moz-range-thumb]:w-5\n            [&::-moz-range-thumb]:h-5\n            [&::-moz-range-thumb]:bg-white\n            [&::-moz-range-thumb]:border-2\n            [&::-moz-range-thumb]:border-blue-500\n            [&::-moz-range-thumb]:rounded-full\n            [&::-moz-range-thumb]:shadow\n            [&::-moz-range-thumb]:cursor-grab\"\n          style={{ zIndex: isDragging === \"min\" ? 2 : 1 }}\n        />\n\n        {/* Max handle */}\n        <input\n          type=\"range\"\n          min={min}\n          max={max}\n          step={step}\n          value={maxValue}\n          onChange={handleMaxSliderChange}\n          onMouseUp={handleSliderComplete}\n          onTouchEnd={handleSliderComplete}\n          onMouseDown={() => setIsDragging(\"max\")}\n          disabled={disabled}\n          className=\"absolute w-full h-2 appearance-none bg-transparent pointer-events-none\n            [&::-webkit-slider-thumb]:pointer-events-auto\n            [&::-webkit-slider-thumb]:appearance-none\n            [&::-webkit-slider-thumb]:w-5\n            [&::-webkit-slider-thumb]:h-5\n            [&::-webkit-slider-thumb]:bg-white\n            [&::-webkit-slider-thumb]:border-2\n            [&::-webkit-slider-thumb]:border-blue-500\n            [&::-webkit-slider-thumb]:rounded-full\n            [&::-webkit-slider-thumb]:shadow\n            [&::-webkit-slider-thumb]:cursor-grab\n            [&::-webkit-slider-thumb]:active:cursor-grabbing\n            [&::-webkit-slider-thumb]:hover:scale-110\n            [&::-webkit-slider-thumb]:transition-transform\n            [&::-moz-range-thumb]:pointer-events-auto\n            [&::-moz-range-thumb]:appearance-none\n            [&::-moz-range-thumb]:w-5\n            [&::-moz-range-thumb]:h-5\n            [&::-moz-range-thumb]:bg-white\n            [&::-moz-range-thumb]:border-2\n            [&::-moz-range-thumb]:border-blue-500\n            [&::-moz-range-thumb]:rounded-full\n            [&::-moz-range-thumb]:shadow\n            [&::-moz-range-thumb]:cursor-grab\"\n          style={{ zIndex: isDragging === \"max\" ? 2 : 1 }}\n        />\n      </div>\n\n      {/* Value display / inputs */}\n      {showInputs ? (\n        <div className=\"flex items-center gap-2 text-sm\">\n          <div className=\"flex-1\">\n            <label className=\"sr-only\">Minimum value</label>\n            <div className=\"relative\">\n              <input\n                type=\"number\"\n                min={min}\n                max={maxValue - step}\n                step={step}\n                value={minValue}\n                onChange={handleMinChange}\n                onBlur={handleInputBlur}\n                disabled={disabled}\n                className=\"w-full px-2 py-1 pr-8 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100\"\n              />\n              {unit && (\n                <span className=\"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 text-xs\">\n                  {unit}\n                </span>\n              )}\n            </div>\n          </div>\n          <span className=\"text-gray-400\">—</span>\n          <div className=\"flex-1\">\n            <label className=\"sr-only\">Maximum value</label>\n            <div className=\"relative\">\n              <input\n                type=\"number\"\n                min={minValue + step}\n                max={max}\n                step={step}\n                value={maxValue}\n                onChange={handleMaxChange}\n                onBlur={handleInputBlur}\n                disabled={disabled}\n                className=\"w-full px-2 py-1 pr-8 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100\"\n              />\n              {unit && (\n                <span className=\"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 text-xs\">\n                  {unit}\n                </span>\n              )}\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"flex justify-between text-sm text-gray-600\">\n          <span>\n            {formatDisplayValue(minValue)}\n            {unit && ` ${unit}`}\n          </span>\n          <span>\n            {formatDisplayValue(maxValue)}\n            {unit && ` ${unit}`}\n          </span>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default RangeSlider;\n","import React, { useState, useCallback, useEffect } from \"react\";\nimport FitsViewer, { FitsViewerProps } from \"./FitsViewer\";\n\nexport interface FitsViewerGridProps {\n  /** Array of FITS URLs to display */\n  fitsUrls: string[];\n  /** Number of columns in grid */\n  columns?: 1 | 2 | 3 | 4;\n  /** Size of each viewer */\n  viewerSize?: number;\n  /** Whether to synchronize pan/zoom across viewers */\n  syncViews?: boolean;\n  /** Labels for each panel */\n  labels?: string[];\n  /** Callback on coordinate click (with panel index) */\n  onCoordinateClick?: (ra: number, dec: number, panelIndex: number) => void;\n  /** Custom class name */\n  className?: string;\n}\n\n/**\n * Grid layout for multiple synchronized FITS viewers.\n * Useful for comparing images at different frequencies or epochs.\n */\nconst FitsViewerGrid: React.FC<FitsViewerGridProps> = ({\n  fitsUrls,\n  columns = 2,\n  viewerSize = 300,\n  syncViews: initialSyncViews = true,\n  labels,\n  onCoordinateClick,\n  className = \"\",\n}) => {\n  const [loadedCount, setLoadedCount] = useState(0);\n  const [syncEnabled, setSyncEnabled] = useState(initialSyncViews);\n  const [syncState, setSyncState] = useState<{\n    zoom?: number;\n    pan?: { x: number; y: number };\n  }>({});\n\n  // Handle sync across viewers\n  const handleSync = useCallback(() => {\n    if (!syncEnabled || !window.JS9) return;\n\n    // Get state from first viewer\n    const firstDisplayId = `JS9Grid_0`;\n    try {\n      const zoom = window.JS9.GetZoom({ display: firstDisplayId });\n      const pan = window.JS9.GetPan({ display: firstDisplayId });\n\n      if (zoom && pan) {\n        // Apply to all other viewers\n        for (let i = 1; i < fitsUrls.length; i++) {\n          const displayId = `JS9Grid_${i}`;\n          window.JS9.SetZoom(zoom, { display: displayId });\n          window.JS9.SetPan(pan.x, pan.y, { display: displayId });\n        }\n      }\n    } catch (err) {\n      console.warn(\"Failed to sync views:\", err);\n    }\n  }, [syncViews, fitsUrls.length]);\n\n  // Set up sync event listeners\n  useEffect(() => {\n    if (!syncEnabled || loadedCount < fitsUrls.length) return;\n\n    const handleChange = () => {\n      handleSync();\n    };\n\n    // Set up callbacks on first viewer\n    if (window.JS9) {\n      window.JS9.SetCallback(\"onzoom\", handleChange, { display: \"JS9Grid_0\" });\n      window.JS9.SetCallback(\"onpan\", handleChange, { display: \"JS9Grid_0\" });\n    }\n\n    return () => {\n      if (window.JS9) {\n        window.JS9.SetCallback(\"onzoom\", null, { display: \"JS9Grid_0\" });\n        window.JS9.SetCallback(\"onpan\", null, { display: \"JS9Grid_0\" });\n      }\n    };\n  }, [syncViews, loadedCount, fitsUrls.length, handleSync]);\n\n  const handleLoad = () => {\n    setLoadedCount((prev) => prev + 1);\n  };\n\n  const getGridClass = () => {\n    switch (columns) {\n      case 1:\n        return \"grid-cols-1\";\n      case 2:\n        return \"grid-cols-2\";\n      case 3:\n        return \"grid-cols-3\";\n      case 4:\n        return \"grid-cols-4\";\n      default:\n        return \"grid-cols-2\";\n    }\n  };\n\n  if (fitsUrls.length === 0) {\n    return <div className=\"text-center text-gray-500 py-8\">No FITS files to display</div>;\n  }\n\n  return (\n    <div className={className}>\n      {/* Header with sync toggle */}\n      <div className=\"flex items-center justify-between mb-3\">\n        <span className=\"text-sm text-gray-600\">\n          {loadedCount}/{fitsUrls.length} images loaded\n        </span>\n        <label className=\"flex items-center gap-2 text-sm cursor-pointer\">\n          <input\n            type=\"checkbox\"\n            checked={syncEnabled}\n            onChange={(e) => setSyncEnabled(e.target.checked)}\n            className=\"w-4 h-4 rounded accent-primary\"\n          />\n          <span>Sync views</span>\n        </label>\n      </div>\n\n      {/* Grid of viewers */}\n      <div className={`grid ${getGridClass()} gap-4`}>\n        {fitsUrls.map((url, index) => (\n          <div key={`${url}-${index}`} className=\"relative\">\n            {/* Label */}\n            {labels && labels[index] && (\n              <div className=\"absolute top-2 left-2 z-10 bg-black/70 text-white text-xs px-2 py-1 rounded\">\n                {labels[index]}\n              </div>\n            )}\n\n            {/* Viewer */}\n            <FitsViewer\n              fitsUrl={url}\n              displayId={`JS9Grid_${index}`}\n              width={viewerSize}\n              height={viewerSize}\n              showControls={false}\n              onLoad={handleLoad}\n              onCoordinateClick={\n                onCoordinateClick ? (ra, dec) => onCoordinateClick(ra, dec, index) : undefined\n              }\n            />\n          </div>\n        ))}\n      </div>\n\n      {/* Shared controls */}\n      <div className=\"mt-4 p-3 bg-gray-50 rounded-lg\">\n        <div className=\"flex items-center gap-4\">\n          <span className=\"text-sm font-medium text-gray-700\">Grid Controls:</span>\n          <button\n            onClick={() => {\n              if (window.JS9) {\n                for (let i = 0; i < fitsUrls.length; i++) {\n                  window.JS9.SetZoom(\"tofit\", { display: `JS9Grid_${i}` });\n                }\n              }\n            }}\n            className=\"px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100 transition-colors\"\n          >\n            Fit All\n          </button>\n          <button\n            onClick={() => {\n              if (window.JS9) {\n                for (let i = 0; i < fitsUrls.length; i++) {\n                  window.JS9.SetZoom(\"in\", { display: `JS9Grid_${i}` });\n                }\n              }\n            }}\n            className=\"px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100 transition-colors\"\n          >\n            Zoom In All\n          </button>\n          <button\n            onClick={() => {\n              if (window.JS9) {\n                for (let i = 0; i < fitsUrls.length; i++) {\n                  window.JS9.SetZoom(\"out\", { display: `JS9Grid_${i}` });\n                }\n              }\n            }}\n            className=\"px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100 transition-colors\"\n          >\n            Zoom Out All\n          </button>\n          <select\n            onChange={(e) => {\n              if (window.JS9 && e.target.value) {\n                for (let i = 0; i < fitsUrls.length; i++) {\n                  window.JS9.SetColormap(e.target.value, {\n                    display: `JS9Grid_${i}`,\n                  });\n                }\n              }\n            }}\n            className=\"px-2 py-1 text-sm border border-gray-300 rounded\"\n            defaultValue=\"\"\n          >\n            <option value=\"\" disabled>\n              Color map...\n            </option>\n            <option value=\"grey\">Grey</option>\n            <option value=\"heat\">Heat</option>\n            <option value=\"cool\">Cool</option>\n            <option value=\"viridis\">Viridis</option>\n            <option value=\"rainbow\">Rainbow</option>\n          </select>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default FitsViewerGrid;\n","import React, { useState, useCallback } from \"react\";\n\nexport interface DownloadItem {\n  id: string;\n  name: string;\n  type?: string;\n}\n\nexport interface BulkDownloadPanelProps {\n  /** All available items for download */\n  items: DownloadItem[];\n  /** Currently selected item IDs */\n  selectedIds: string[];\n  /** Callback when selection changes */\n  onSelectionChange: (ids: string[]) => void;\n  /** Callback to trigger download */\n  onDownload: (ids: string[], format: DownloadFormat) => Promise<void>;\n  /** Custom class name */\n  className?: string;\n  /** Disable the panel */\n  disabled?: boolean;\n}\n\nexport type DownloadFormat = \"fits\" | \"csv\" | \"zip\" | \"json\";\n\nconst FORMAT_OPTIONS: { value: DownloadFormat; label: string }[] = [\n  { value: \"fits\", label: \"FITS\" },\n  { value: \"csv\", label: \"CSV\" },\n  { value: \"json\", label: \"JSON\" },\n  { value: \"zip\", label: \"ZIP Archive\" },\n];\n\n/**\n * Bulk download panel for selecting and exporting multiple items.\n */\nconst BulkDownloadPanel: React.FC<BulkDownloadPanelProps> = ({\n  items,\n  selectedIds,\n  onSelectionChange,\n  onDownload,\n  className = \"\",\n  disabled = false,\n}) => {\n  const [format, setFormat] = useState<DownloadFormat>(\"fits\");\n  const [isDownloading, setIsDownloading] = useState(false);\n\n  const handleSelectAll = useCallback(() => {\n    if (selectedIds.length === items.length) {\n      onSelectionChange([]);\n    } else {\n      onSelectionChange(items.map((i) => i.id));\n    }\n  }, [items, selectedIds.length, onSelectionChange]);\n\n  const handleToggleItem = useCallback(\n    (id: string) => {\n      if (selectedIds.includes(id)) {\n        onSelectionChange(selectedIds.filter((i) => i !== id));\n      } else {\n        onSelectionChange([...selectedIds, id]);\n      }\n    },\n    [selectedIds, onSelectionChange]\n  );\n\n  const handleDownload = useCallback(async () => {\n    if (selectedIds.length === 0) return;\n\n    setIsDownloading(true);\n    try {\n      await onDownload(selectedIds, format);\n    } finally {\n      setIsDownloading(false);\n    }\n  }, [selectedIds, format, onDownload]);\n\n  const isAllSelected = selectedIds.length === items.length && items.length > 0;\n  const isSomeSelected = selectedIds.length > 0 && selectedIds.length < items.length;\n\n  return (\n    <div className={`card ${className}`}>\n      <div className=\"card-header flex items-center justify-between\">\n        <h4 className=\"text-lg font-semibold\">Bulk Download</h4>\n        <span className=\"text-sm text-gray-500\">\n          {selectedIds.length} of {items.length} selected\n        </span>\n      </div>\n\n      <div className=\"card-body space-y-4\">\n        {/* Selection Controls */}\n        <div className=\"flex items-center gap-4\">\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              checked={isAllSelected}\n              ref={(el) => {\n                if (el) el.indeterminate = isSomeSelected;\n              }}\n              onChange={handleSelectAll}\n              disabled={disabled || items.length === 0}\n              className=\"w-4 h-4 text-vast-green rounded border-gray-300 focus:ring-vast-green\"\n            />\n            <span className=\"text-sm\">Select All</span>\n          </label>\n\n          {selectedIds.length > 0 && (\n            <button\n              onClick={() => onSelectionChange([])}\n              className=\"text-sm text-gray-500 hover:text-red-500\"\n            >\n              Clear selection\n            </button>\n          )}\n        </div>\n\n        {/* Format Selection */}\n        <div className=\"form-group\">\n          <label className=\"form-label\">Export Format</label>\n          <div className=\"grid grid-cols-4 gap-2\">\n            {FORMAT_OPTIONS.map((opt) => (\n              <button\n                key={opt.value}\n                onClick={() => setFormat(opt.value)}\n                disabled={disabled}\n                className={`py-2 px-3 rounded-md text-sm font-medium transition-all ${\n                  format === opt.value\n                    ? \"bg-vast-green text-white shadow-md\"\n                    : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\n                }`}\n              >\n                {opt.label}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Selected Items Preview */}\n        {selectedIds.length > 0 && (\n          <div className=\"bg-gray-50 rounded-lg p-3 max-h-40 overflow-y-auto\">\n            <p className=\"text-xs text-gray-500 mb-2\">Selected items:</p>\n            <div className=\"flex flex-wrap gap-1\">\n              {selectedIds.slice(0, 10).map((id) => {\n                const item = items.find((i) => i.id === id);\n                return (\n                  <span key={id} className=\"badge badge-secondary flex items-center gap-1\">\n                    {item?.name || id}\n                    <button onClick={() => handleToggleItem(id)} className=\"hover:text-red-500\">\n                      ×\n                    </button>\n                  </span>\n                );\n              })}\n              {selectedIds.length > 10 && (\n                <span className=\"badge badge-info\">+{selectedIds.length - 10} more</span>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Download Button */}\n        <button\n          onClick={handleDownload}\n          disabled={disabled || selectedIds.length === 0 || isDownloading}\n          className=\"btn btn-primary w-full\"\n        >\n          {isDownloading ? (\n            <span className=\"flex items-center justify-center gap-2\">\n              <span className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n              Preparing Download...\n            </span>\n          ) : (\n            <>\n              Download {selectedIds.length} item{selectedIds.length !== 1 ? \"s\" : \"\"} as{\" \"}\n              {format.toUpperCase()}\n            </>\n          )}\n        </button>\n\n        {/* Format Info */}\n        <div className=\"text-xs text-gray-500\">\n          {format === \"fits\" && \"Download raw FITS files individually.\"}\n          {format === \"csv\" && \"Export metadata as CSV spreadsheet.\"}\n          {format === \"json\" && \"Export metadata as JSON.\"}\n          {format === \"zip\" && \"Download all files in a single ZIP archive.\"}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default BulkDownloadPanel;\n","import React, { useState, useCallback, useMemo } from \"react\";\nimport { RangeSlider } from \"../widgets\";\n\nexport interface FilterConfig {\n  id: string;\n  label: string;\n  type: \"range\" | \"select\" | \"checkbox\" | \"text\";\n  min?: number;\n  max?: number;\n  step?: number;\n  unit?: string;\n  options?: { value: string; label: string }[];\n  defaultValue?: string | number | boolean | [number, number];\n  histogram?: number[];\n}\n\nexport interface FilterValues {\n  [key: string]: string | number | boolean | [number, number] | undefined;\n}\n\nexport interface FilterPanelProps {\n  /** Filter configurations */\n  filters: FilterConfig[];\n  /** Current filter values */\n  values: FilterValues;\n  /** Callback when filters change */\n  onChange: (values: FilterValues) => void;\n  /** Title for the panel */\n  title?: string;\n  /** Collapsible sections */\n  collapsible?: boolean;\n  /** Initially collapsed */\n  defaultCollapsed?: boolean;\n  /** Custom class name */\n  className?: string;\n}\n\n/**\n * Collapsible filter panel with support for range sliders, selects, and checkboxes.\n * Inspired by VASTER webapp's accordion filter design.\n */\nconst FilterPanel: React.FC<FilterPanelProps> = ({\n  filters,\n  values,\n  onChange,\n  title = \"Filters\",\n  collapsible = true,\n  defaultCollapsed = false,\n  className = \"\",\n}) => {\n  const [isCollapsed, setIsCollapsed] = useState(defaultCollapsed);\n  const [expandedSections, setExpandedSections] = useState<Record<string, boolean>>({});\n\n  const handleFilterChange = useCallback(\n    (filterId: string, value: FilterValues[string]) => {\n      onChange({ ...values, [filterId]: value });\n    },\n    [values, onChange]\n  );\n\n  const handleRangeChange = useCallback(\n    (filterId: string, min: number, max: number) => {\n      onChange({ ...values, [filterId]: [min, max] });\n    },\n    [values, onChange]\n  );\n\n  const handleReset = useCallback(() => {\n    const resetValues: FilterValues = {};\n    filters.forEach((filter) => {\n      if (filter.defaultValue !== undefined) {\n        resetValues[filter.id] = filter.defaultValue;\n      }\n    });\n    onChange(resetValues);\n  }, [filters, onChange]);\n\n  const toggleSection = useCallback((sectionId: string) => {\n    setExpandedSections((prev) => ({\n      ...prev,\n      [sectionId]: !prev[sectionId],\n    }));\n  }, []);\n\n  const activeFilterCount = useMemo(() => {\n    return Object.entries(values).filter(([key, value]) => {\n      const filter = filters.find((f) => f.id === key);\n      if (!filter) return false;\n\n      if (filter.type === \"range\" && Array.isArray(value)) {\n        return value[0] !== filter.min || value[1] !== filter.max;\n      }\n\n      if (filter.defaultValue !== undefined) {\n        return value !== filter.defaultValue;\n      }\n\n      return value !== undefined && value !== \"\" && value !== false;\n    }).length;\n  }, [values, filters]);\n\n  const renderFilter = (filter: FilterConfig) => {\n    const value = values[filter.id];\n\n    switch (filter.type) {\n      case \"range\": {\n        const rangeValue = Array.isArray(value) ? value : [filter.min ?? 0, filter.max ?? 100];\n        return (\n          <RangeSlider\n            key={filter.id}\n            min={filter.min ?? 0}\n            max={filter.max ?? 100}\n            step={filter.step ?? 1}\n            minValue={rangeValue[0]}\n            maxValue={rangeValue[1]}\n            label={filter.label}\n            unit={filter.unit}\n            histogram={filter.histogram}\n            onChange={(min, max) => handleRangeChange(filter.id, min, max)}\n            showInputs={true}\n          />\n        );\n      }\n\n      case \"select\":\n        return (\n          <div key={filter.id} className=\"space-y-1\">\n            <label className=\"text-sm font-medium text-gray-700\">{filter.label}</label>\n            <select\n              value={String(value ?? \"\")}\n              onChange={(e) => handleFilterChange(filter.id, e.target.value || undefined)}\n              className=\"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n            >\n              <option value=\"\">All</option>\n              {filter.options?.map((opt) => (\n                <option key={opt.value} value={opt.value}>\n                  {opt.label}\n                </option>\n              ))}\n            </select>\n          </div>\n        );\n\n      case \"checkbox\":\n        return (\n          <label key={filter.id} className=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              checked={Boolean(value)}\n              onChange={(e) => handleFilterChange(filter.id, e.target.checked)}\n              className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n            />\n            <span className=\"text-sm text-gray-700\">{filter.label}</span>\n          </label>\n        );\n\n      case \"text\":\n        return (\n          <div key={filter.id} className=\"space-y-1\">\n            <label className=\"text-sm font-medium text-gray-700\">{filter.label}</label>\n            <input\n              type=\"text\"\n              value={String(value ?? \"\")}\n              onChange={(e) => handleFilterChange(filter.id, e.target.value || undefined)}\n              placeholder={`Filter by ${filter.label.toLowerCase()}...`}\n              className=\"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n            />\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className={`bg-white rounded-lg border border-gray-200 shadow-sm ${className}`}>\n      {/* Header */}\n      <div\n        className={`flex items-center justify-between px-4 py-3 ${\n          collapsible ? \"cursor-pointer hover:bg-gray-50\" : \"\"\n        } ${!isCollapsed ? \"border-b border-gray-200\" : \"\"}`}\n        onClick={collapsible ? () => setIsCollapsed(!isCollapsed) : undefined}\n      >\n        <div className=\"flex items-center gap-2\">\n          {collapsible && (\n            <svg\n              className={`w-4 h-4 text-gray-500 transition-transform ${\n                isCollapsed ? \"\" : \"rotate-90\"\n              }`}\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M9 5l7 7-7 7\"\n              />\n            </svg>\n          )}\n          <h3 className=\"text-sm font-medium text-gray-900\">{title}</h3>\n          {activeFilterCount > 0 && (\n            <span className=\"px-2 py-0.5 text-xs font-medium text-blue-700 bg-blue-100 rounded-full\">\n              {activeFilterCount}\n            </span>\n          )}\n        </div>\n        {!isCollapsed && activeFilterCount > 0 && (\n          <button\n            type=\"button\"\n            onClick={(e) => {\n              e.stopPropagation();\n              handleReset();\n            }}\n            className=\"text-xs text-blue-600 hover:text-blue-800\"\n          >\n            Reset all\n          </button>\n        )}\n      </div>\n\n      {/* Filter content */}\n      {!isCollapsed && (\n        <div className=\"p-4 space-y-4\">{filters.map((filter) => renderFilter(filter))}</div>\n      )}\n    </div>\n  );\n};\n\nexport default FilterPanel;\n","import React, { useMemo, useCallback, useState } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { useImages } from \"../hooks/useQueries\";\nimport { LoadingSpinner, SortableTableHeader, useTableSort } from \"../components/common\";\nimport { BulkDownloadPanel } from \"../components/download\";\nimport { FitsViewerGrid } from \"../components/fits\";\nimport { FilterPanel, FilterConfig, FilterValues } from \"../components/filters\";\nimport { useSelectionStore } from \"../stores/appStore\";\n\ninterface ImageItem {\n  id: string;\n  path?: string;\n  qa_grade?: string;\n  created_at?: string;\n}\n\n/**\n * List page showing all images with sortable table headers.\n */\nconst ImagesListPage: React.FC = () => {\n  const { data: images, isLoading, error } = useImages();\n  const { sortKey, sortDirection, handleSort, sortItems } = useTableSort<ImageItem>(\n    \"created_at\",\n    \"desc\"\n  );\n\n  // View mode: list or comparison\n  const [viewMode, setViewMode] = useState<\"list\" | \"compare\">(\"list\");\n\n  // Filter state\n  const [filterValues, setFilterValues] = useState<FilterValues>({});\n  const filterConfigs: FilterConfig[] = [\n    {\n      id: \"qa_grade\",\n      label: \"QA Grade\",\n      type: \"select\",\n      options: [\n        { value: \"good\", label: \"Good\" },\n        { value: \"warn\", label: \"Warning\" },\n        { value: \"fail\", label: \"Fail\" },\n      ],\n    },\n    {\n      id: \"search\",\n      label: \"Search\",\n      type: \"text\",\n    },\n  ];\n\n  // Multi-select state from store\n  const selectedImages = useSelectionStore((s) => s.selectedImages);\n  const toggleImageSelection = useSelectionStore((s) => s.toggleImageSelection);\n  const selectAllImages = useSelectionStore((s) => s.selectAllImages);\n  const clearImageSelection = useSelectionStore((s) => s.clearImageSelection);\n\n  const selectedIds = useMemo(() => Array.from(selectedImages), [selectedImages]);\n\n  const handleSelectionChange = useCallback(\n    (ids: string[]) => {\n      if (ids.length === 0) {\n        clearImageSelection();\n      } else {\n        selectAllImages(ids);\n      }\n    },\n    [clearImageSelection, selectAllImages]\n  );\n\n  const handleBulkDownload = useCallback(async (ids: string[], format: string) => {\n    const baseUrl = import.meta.env.VITE_API_URL || \"/api\";\n    const url = `${baseUrl}/images/bulk-download?ids=${ids.join(\",\")}&format=${format}`;\n    window.open(url, \"_blank\");\n  }, []);\n\n  // Apply filters\n  const filteredImages = useMemo(() => {\n    if (!images) return [];\n    let result = images as ImageItem[];\n\n    if (filterValues.qa_grade) {\n      result = result.filter((img) => img.qa_grade === filterValues.qa_grade);\n    }\n    if (filterValues.search && typeof filterValues.search === \"string\") {\n      const term = filterValues.search.toLowerCase();\n      result = result.filter(\n        (img) => img.path?.toLowerCase().includes(term) || img.id.toLowerCase().includes(term)\n      );\n    }\n\n    return result;\n  }, [images, filterValues]);\n\n  const sortedImages = useMemo(() => {\n    if (!filteredImages) return [];\n    return sortItems(filteredImages, sortKey, sortDirection);\n  }, [filteredImages, sortKey, sortDirection, sortItems]);\n\n  if (isLoading) {\n    return <LoadingSpinner label=\"Loading images...\" />;\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\n        Failed to load images: {error.message}\n      </div>\n    );\n  }\n\n  // Prepare items for bulk download panel\n  const downloadItems = useMemo(\n    () =>\n      sortedImages.map((img) => ({\n        id: img.id,\n        name: img.path?.split(\"/\").pop() || img.id,\n        type: \"FITS\",\n      })),\n    [sortedImages]\n  );\n\n  // FITS URLs for selected images comparison\n  const comparisonUrls = useMemo(() => {\n    const baseUrl = import.meta.env.VITE_API_URL || \"/api\";\n    return selectedIds.map((id) => `${baseUrl}/images/${id}/fits`);\n  }, [selectedIds]);\n\n  const comparisonLabels = useMemo(() => {\n    return selectedIds.map((id) => {\n      const img = sortedImages.find((i) => i.id === id);\n      return img?.path?.split(\"/\").pop() || id;\n    });\n  }, [selectedIds, sortedImages]);\n\n  return (\n    <div className=\"max-w-6xl mx-auto\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center gap-4\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Images</h1>\n          {selectedIds.length > 0 && (\n            <span className=\"text-sm text-gray-500\">{selectedIds.length} selected</span>\n          )}\n        </div>\n        <div className=\"flex gap-2\">\n          {selectedIds.length >= 2 && selectedIds.length <= 4 && (\n            <button\n              onClick={() => setViewMode(viewMode === \"compare\" ? \"list\" : \"compare\")}\n              className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\n                viewMode === \"compare\"\n                  ? \"bg-purple-600 text-white\"\n                  : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\n              }`}\n            >\n              {viewMode === \"compare\" ? \"Back to List\" : \"Compare Selected\"}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Filter Panel */}\n      <div className=\"mb-4\">\n        <FilterPanel\n          filters={filterConfigs}\n          values={filterValues}\n          onChange={setFilterValues}\n          title=\"Filter Images\"\n          collapsible\n          defaultCollapsed\n        />\n      </div>\n\n      {/* Comparison View */}\n      {viewMode === \"compare\" && selectedIds.length >= 2 && (\n        <div className=\"mb-6\">\n          <div className=\"card p-4\">\n            <h3 className=\"text-lg font-semibold mb-4\">Image Comparison</h3>\n            <FitsViewerGrid\n              fitsUrls={comparisonUrls}\n              labels={comparisonLabels}\n              columns={selectedIds.length <= 2 ? 2 : selectedIds.length <= 3 ? 3 : 4}\n              viewerSize={350}\n              syncViews\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Bulk Download Panel - show when items selected */}\n      {sortedImages.length > 0 && (\n        <div className=\"mb-6\">\n          <BulkDownloadPanel\n            items={downloadItems}\n            selectedIds={selectedIds}\n            onSelectionChange={handleSelectionChange}\n            onDownload={handleBulkDownload}\n          />\n        </div>\n      )}\n\n      {sortedImages && sortedImages.length > 0 ? (\n        <div className=\"card overflow-hidden\">\n          <table className=\"table\">\n            <thead>\n              <tr>\n                <th className=\"w-10 px-3 py-3\">\n                  <input\n                    type=\"checkbox\"\n                    checked={selectedIds.length === sortedImages.length && sortedImages.length > 0}\n                    ref={(el) => {\n                      if (el)\n                        el.indeterminate =\n                          selectedIds.length > 0 && selectedIds.length < sortedImages.length;\n                    }}\n                    onChange={() => {\n                      if (selectedIds.length === sortedImages.length) {\n                        clearImageSelection();\n                      } else {\n                        selectAllImages(sortedImages.map((i) => i.id));\n                      }\n                    }}\n                    className=\"h-4 w-4 text-blue-600 rounded\"\n                  />\n                </th>\n                <SortableTableHeader\n                  label=\"Name\"\n                  sortKey=\"path\"\n                  currentSortKey={sortKey}\n                  direction={sortDirection}\n                  onSort={handleSort}\n                />\n                <SortableTableHeader\n                  label=\"QA Grade\"\n                  sortKey=\"qa_grade\"\n                  currentSortKey={sortKey}\n                  direction={sortDirection}\n                  onSort={handleSort}\n                  className=\"text-center\"\n                />\n                <SortableTableHeader\n                  label=\"Created\"\n                  sortKey=\"created_at\"\n                  currentSortKey={sortKey}\n                  direction={sortDirection}\n                  onSort={handleSort}\n                  className=\"text-right\"\n                />\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-200\">\n              {sortedImages.map((image) => (\n                <tr key={image.id} className={selectedImages.has(image.id) ? \"bg-blue-50\" : \"\"}>\n                  <td className=\"px-3\">\n                    <input\n                      type=\"checkbox\"\n                      checked={selectedImages.has(image.id)}\n                      onChange={() => toggleImageSelection(image.id)}\n                      className=\"h-4 w-4 text-blue-600 rounded\"\n                    />\n                  </td>\n                  <td>\n                    <Link\n                      to={`/images/${image.id}`}\n                      className=\"text-blue-600 hover:text-blue-800 font-medium\"\n                    >\n                      {image.path?.split(\"/\").pop() || image.id}\n                    </Link>\n                  </td>\n                  <td className=\"text-center\">\n                    {image.qa_grade && (\n                      <span\n                        className={`badge ${\n                          image.qa_grade === \"good\"\n                            ? \"badge-success\"\n                            : image.qa_grade === \"warn\"\n                            ? \"badge-warning\"\n                            : \"badge-error\"\n                        }`}\n                      >\n                        {image.qa_grade}\n                      </span>\n                    )}\n                  </td>\n                  <td className=\"text-right text-gray-500\">\n                    {image.created_at ? new Date(image.created_at).toLocaleDateString() : \"—\"}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      ) : (\n        <p className=\"text-gray-500\">No images found.</p>\n      )}\n    </div>\n  );\n};\n\nexport default ImagesListPage;\n"],"names":["RangeSlider","min","max","initialMinValue","initialMaxValue","step","label","unit","onChange","onChangeComplete","showInputs","histogram","className","decimals","disabled","formatValue","minValue","setMinValue","useState","maxValue","setMaxValue","isDragging","setIsDragging","trackRef","useRef","useEffect","formatDisplayValue","useCallback","value","getPercentage","getValueFromPercentage","percentage","rawValue","steppedValue","handleTrackClick","e","rect","clickedValue","distToMin","distToMax","newMin","newMax","handleMinChange","handleMaxChange","handleInputBlur","handleMinSliderChange","handleMaxSliderChange","handleSliderComplete","handleReset","minPercent","maxPercent","jsxs","jsx","index","maxHist","height","barMin","isInRange","FitsViewerGrid","fitsUrls","columns","viewerSize","initialSyncViews","labels","onCoordinateClick","loadedCount","setLoadedCount","syncEnabled","setSyncEnabled","syncState","setSyncState","handleSync","firstDisplayId","zoom","pan","i","displayId","err","handleChange","handleLoad","prev","getGridClass","url","FitsViewer","ra","dec","FORMAT_OPTIONS","BulkDownloadPanel","items","selectedIds","onSelectionChange","onDownload","format","setFormat","isDownloading","setIsDownloading","handleSelectAll","handleToggleItem","id","handleDownload","isAllSelected","isSomeSelected","el","opt","item","Fragment","FilterPanel","filters","values","title","collapsible","defaultCollapsed","isCollapsed","setIsCollapsed","expandedSections","setExpandedSections","handleFilterChange","filterId","handleRangeChange","resetValues","filter","sectionId","activeFilterCount","useMemo","key","renderFilter","rangeValue","ImagesListPage","images","isLoading","error","useImages","sortKey","sortDirection","handleSort","sortItems","useTableSort","viewMode","setViewMode","filterValues","setFilterValues","filterConfigs","selectedImages","useSelectionStore","s","toggleImageSelection","selectAllImages","clearImageSelection","handleSelectionChange","ids","handleBulkDownload","filteredImages","result","img","term","sortedImages","LoadingSpinner","downloadItems","comparisonUrls","baseUrl","comparisonLabels","SortableTableHeader","image","Link"],"mappings":"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"}