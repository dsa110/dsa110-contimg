import{r as c,j as e,u as U,L as q}from"./index-DJCdKSO1.js";import{E as W,C as $,P as G,a as K}from"./CoordinateDisplay-DFRLhW8a.js";import{u as Z,L as Y}from"./appStore-B4B387X2.js";import{A as X}from"./AladinLiteViewer-C-G-lLpR.js";import{b as ee}from"./provenanceMappers-Dk7u1RY2.js";import{r as te}from"./relativeTime-Dp84ug83.js";import{e as se}from"./useQueries-HkAdx01S.js";const re=({data:t,title:i,yAxisLabel:x="Flux (Jy)",xAxisLabel:o="Time",height:p=350,enableZoom:u=!0,showErrorBars:b=!0,className:w="",onPointClick:h,isLoading:y=!1})=>{const m=c.useRef(null),g=c.useRef(null),[v,f]=c.useState(!0),[n,I]=c.useState(null);c.useEffect(()=>{(async()=>{if(window.echarts){f(!1);return}try{document.querySelector(`script[src="${ECHARTS_URL}"]`)||await new Promise((E,D)=>{const l=document.createElement("script");l.src=ECHARTS_URL,l.async=!0,l.onload=()=>E(),l.onerror=()=>D(new Error("Failed to load ECharts")),document.head.appendChild(l)});let S=0;for(;!window.echarts&&S<50;)await new Promise(E=>setTimeout(E,100)),S++;if(!window.echarts)throw new Error("ECharts failed to initialize");f(!1)}catch(S){I(S instanceof Error?S.message:"Failed to load chart library"),f(!1)}})()},[]),c.useEffect(()=>{if(v||n||!m.current||!window.echarts||y)return;g.current||(g.current=window.echarts.init(m.current));const N=t.map(l=>[typeof l.time=="string"?new Date(l.time).getTime():l.time,l.flux]),S=[];b&&t.forEach((l,k)=>{if(l.fluxError!==void 0){const R=N[k][0];S.push({coord:[R,l.flux-l.fluxError,R,l.flux+l.fluxError]})}});const E=l=>Math.abs(l)<.001?`${(l*1e6).toFixed(1)} μJy`:Math.abs(l)<1?`${(l*1e3).toFixed(2)} mJy`:`${l.toFixed(3)} Jy`,D={title:i?{text:i,left:"center",textStyle:{fontSize:14,fontWeight:"bold"}}:void 0,tooltip:{trigger:"item",formatter:l=>{const k=t[l.dataIndex];let s=`<div class="text-sm">
            <div class="font-medium">${new Date(l.data[0]).toLocaleString()}</div>
            <div>Flux: ${E(l.data[1])}</div>`;return k?.fluxError&&(s+=`<div>Error: ±${E(k.fluxError)}</div>`),k?.label&&(s+=`<div class="text-gray-500">${k.label}</div>`),s+="</div>",s},axisPointer:{type:"cross"}},xAxis:{type:"time",name:o,nameLocation:"middle",axisLabel:{formatter:l=>{const k=new Date(l);return`${k.getMonth()+1}/${k.getDate()}`}}},yAxis:{type:"value",name:x,nameLocation:"middle",axisLabel:{formatter:E}},series:[{type:"line",data:N,symbolSize:8,itemStyle:{color:"#3b82f6"},lineStyle:{width:2},showSymbol:!0,emphasis:{focus:"series",itemStyle:{shadowBlur:10,shadowColor:"rgba(59, 130, 246, 0.5)"}}}],dataZoom:u?[{type:"inside",start:0,end:100,xAxisIndex:0},{type:"slider",start:0,end:100,xAxisIndex:0}]:void 0,grid:{left:"15%",right:"10%",bottom:u?"20%":"15%",top:i?"15%":"10%",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none",title:{zoom:"Zoom",back:"Reset"}},restore:{title:"Restore"},saveAsImage:{title:"Save"}}}};return g.current.setOption(D),h&&(g.current.off("click"),g.current.on("click",l=>{l.dataIndex!==void 0&&h(t[l.dataIndex],l.dataIndex)})),()=>{g.current&&g.current.off("click")}},[v,n,t,i,x,o,u,b,h,y]),c.useEffect(()=>{const N=()=>{g.current&&g.current.resize()};return window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]),c.useEffect(()=>()=>{g.current&&(g.current.dispose(),g.current=null)},[]);const a=c.useCallback(()=>{g.current&&g.current.dispatchAction({type:"dataZoom",dataZoomIndex:0,start:0,end:100})},[]),d=typeof p=="number"?`${p}px`:p;return n?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${w}`,style:{height:d},children:e.jsxs("div",{className:"text-center text-gray-500 p-4",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("p",{className:"text-sm",children:n})]})}):v||y?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${w}`,style:{height:d},children:e.jsxs("div",{className:"flex flex-col items-center text-gray-500",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("span",{className:"text-sm",children:"Loading light curve..."})]})}):!t||t.length===0?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${w}`,style:{height:d},children:e.jsxs("div",{className:"text-center text-gray-500 p-4",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("p",{className:"text-sm",children:"No light curve data available"})]})}):e.jsxs("div",{className:`relative ${w}`,children:[e.jsx("div",{ref:m,style:{height:d,width:"100%"}}),u&&e.jsx("button",{type:"button",onClick:a,className:"absolute top-2 right-2 bg-white/90 hover:bg-white px-2 py-1 rounded shadow text-xs text-gray-700 hover:text-gray-900 transition-colors",title:"Reset zoom",children:"Reset Zoom"})]})},z=[{id:"gaia",name:"Gaia DR3",vizierTable:"I/355/gaiadr3",raColumn:"RA_ICRS",decColumn:"DE_ICRS",color:"#ff0000",symbol:"circle",description:"Gaia Data Release 3 - optical astrometry and photometry",defaultEnabled:!1},{id:"tess",name:"TESS TIC v8.2",vizierTable:"IV/39/tic82",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#db01fd",symbol:"diamond",description:"TESS Input Catalog - stars observed by TESS",defaultEnabled:!1},{id:"ps1",name:"Pan-STARRS DR1",vizierTable:"II/349/ps1",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#0066ff",symbol:"square",description:"Pan-STARRS1 Survey - optical photometry",defaultEnabled:!1},{id:"2mass",name:"2MASS",vizierTable:"II/246/out",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ff9900",symbol:"triangle",description:"Two Micron All Sky Survey - near-infrared",defaultEnabled:!1},{id:"wise",name:"AllWISE",vizierTable:"II/328/allwise",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#00cc66",symbol:"star",description:"Wide-field Infrared Survey Explorer",defaultEnabled:!1},{id:"nvss",name:"NVSS",vizierTable:"VIII/65/nvss",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#00cccc",symbol:"plus",description:"NRAO VLA Sky Survey - 1.4 GHz radio",defaultEnabled:!1},{id:"first",name:"FIRST",vizierTable:"VIII/92/first14",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#cc00cc",symbol:"cross",description:"Faint Images of the Radio Sky at Twenty-cm",defaultEnabled:!1},{id:"sumss",name:"SUMSS",vizierTable:"VIII/81B/sumss212",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ffcc00",symbol:"circle",description:"Sydney University Molonglo Sky Survey - 843 MHz",defaultEnabled:!1},{id:"racs",name:"RACS-Low",vizierTable:"J/other/PASA/38.58/gausscut",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#66ff66",symbol:"diamond",description:"Rapid ASKAP Continuum Survey - 887 MHz",defaultEnabled:!1},{id:"vlass",name:"VLASS",vizierTable:"J/ApJS/255/30/table1",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ff6666",symbol:"square",description:"VLA Sky Survey - 3 GHz radio",defaultEnabled:!1},{id:"atnf",name:"ATNF Pulsars",vizierTable:"B/psr/psr",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ffffff",symbol:"star",description:"Australia Telescope National Facility Pulsar Catalogue",defaultEnabled:!1}],ae=({catalogs:t,className:i=""})=>{if(t.length===0)return null;const x=o=>{const u={fill:o.color,stroke:o.color};switch(o.symbol){case"circle":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("circle",{cx:"6",cy:"6",r:"5",...u,fillOpacity:.3,strokeWidth:1.5})});case"square":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("rect",{x:"1",y:"1",width:"10",height:"10",...u,fillOpacity:.3,strokeWidth:1.5})});case"diamond":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 11,6 6,11 1,6",...u,fillOpacity:.3,strokeWidth:1.5})});case"triangle":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 11,11 1,11",...u,fillOpacity:.3,strokeWidth:1.5})});case"star":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 7.5,4.5 11,5 8.5,7.5 9,11 6,9 3,11 3.5,7.5 1,5 4.5,4.5",...u,fillOpacity:.3,strokeWidth:1})});case"plus":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("path",{d:"M6,1 L6,11 M1,6 L11,6",stroke:o.color,strokeWidth:2,fill:"none"})});case"cross":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("path",{d:"M1,1 L11,11 M11,1 L1,11",stroke:o.color,strokeWidth:2,fill:"none"})});default:return e.jsx("span",{className:"inline-block w-3 h-3 rounded-full",style:{backgroundColor:o.color}})}};return e.jsx("div",{className:`flex flex-wrap gap-3 text-xs ${i}`,children:t.map(o=>e.jsxs("div",{className:"flex items-center gap-1",title:o.description,children:[x(o),e.jsx("span",{style:{color:o.color},children:o.name})]},o.id))})},ne="https://tapvizier.cds.unistra.fr/TAPVizieR/tap/sync",V=1e3,P=200;class ie{queue=[];processing=!1;lastRequestTime=0;async enqueue(i){return new Promise((x,o)=>{this.queue.push(async()=>{try{const p=await i();x(p)}catch(p){o(p)}}),this.processQueue()})}async processQueue(){if(!this.processing){for(this.processing=!0;this.queue.length>0;){const x=Date.now()-this.lastRequestTime;x<P&&await new Promise(p=>setTimeout(p,P-x));const o=this.queue.shift();o&&(this.lastRequestTime=Date.now(),await o())}this.processing=!1}}}const oe=new ie;function ce(t,i,x,o){const p=t.raColumn||"RAJ2000",u=t.decColumn||"DEJ2000";return`
    SELECT TOP ${V} 
      ${p} as ra, 
      ${u} as dec,
      *
    FROM "${t.vizierTable}"
    WHERE 1=CONTAINS(
      POINT('ICRS', ${p}, ${u}),
      CIRCLE('ICRS', ${i}, ${x}, ${o})
    )
  `.trim()}function le(t,i,x,o){const u=new DOMParser().parseFromString(t,"text/xml"),b=u.querySelector("INFO[name='QUERY_STATUS'][value='ERROR']");if(b)throw new Error(b.textContent||"Query failed");const h=Array.from(u.querySelectorAll("FIELD")).map(f=>f.getAttribute("name")||"");let y=h.findIndex(f=>f.toLowerCase()==="ra"),m=h.findIndex(f=>f.toLowerCase()==="dec");if(y===-1&&(y=h.findIndex(f=>f===x)),m===-1&&(m=h.findIndex(f=>f===o)),y===-1||m===-1)return console.warn(`Could not find RA/Dec columns for ${i}`,h),[];const g=u.querySelectorAll("TR"),v=[];return g.forEach((f,n)=>{const I=f.querySelectorAll("TD");if(I.length>Math.max(y,m)){const a=parseFloat(I[y].textContent||""),d=parseFloat(I[m].textContent||"");!isNaN(a)&&!isNaN(d)&&v.push({ra:a,dec:d,id:`${i}_${n}`,catalog:i})}}),v}async function de(t,i,x,o,p){return oe.enqueue(async()=>{const u=o/60,b=t.raColumn||"RAJ2000",w=t.decColumn||"DEJ2000";try{const h=ce(t,i,x,u),y=new URLSearchParams({REQUEST:"doQuery",LANG:"ADQL",FORMAT:"votable",QUERY:h}),m=await fetch(`${ne}?${y}`,{signal:p,headers:{Accept:"application/xml"}});if(!m.ok)throw new Error(`HTTP ${m.status}: ${m.statusText}`);const g=await m.text(),v=le(g,t.id,b,w);return{catalogId:t.id,sources:v,count:v.length,truncated:v.length>=V}}catch(h){if(h instanceof Error&&h.name==="AbortError")throw h;return{catalogId:t.id,sources:[],count:0,truncated:!1,error:h instanceof Error?h.message:"Query failed"}}})}const B=new Map,ue=300*1e3;async function me(t,i,x,o,p){const u=`${t.id}:${i.toFixed(4)}:${x.toFixed(4)}:${o.toFixed(1)}`,b=B.get(u);if(b&&Date.now()-b.timestamp<ue)return b.result;const w=await de(t,i,x,o,p);return w.error||B.set(u,{result:w,timestamp:Date.now()}),w}const xe=({enabledCatalogs:t,onCatalogChange:i,centerRa:x,centerDec:o,searchRadius:p=5,onSourcesLoaded:u,aladinRef:b,className:w=""})=>{const[h,y]=c.useState(!1),[m,g]=c.useState(p),[v,f]=c.useState(new Map),[n,I]=c.useState(new Set),[a,d]=c.useState(p),N=c.useRef(null),S=c.useRef(new Map);c.useEffect(()=>{m!==a&&(f(new Map),d(m))},[m,a]),c.useEffect(()=>()=>{N.current&&N.current.abort()},[]),c.useEffect(()=>{if(x===void 0||o===void 0)return;if(t.length===0){D(),f(new Map);return}N.current&&N.current.abort(),N.current=new AbortController;const r=N.current.signal,j=t.filter(C=>!v.has(C)||v.get(C)?.error);if(j.length!==0)return I(C=>new Set([...C,...j])),j.forEach(async C=>{const T=z.find(A=>A.id===C);if(T)try{const A=await me(T,x,o,m,r);if(r.aborted)return;f(M=>{const F=new Map(M);return F.set(C,A),F}),b?.current&&A.sources.length>0&&E(T,A.sources)}catch(A){if(A instanceof Error&&A.name==="AbortError")return;console.error(`Failed to query ${C}:`,A)}finally{r.aborted||I(A=>{const M=new Set(A);return M.delete(C),M})}}),()=>{N.current?.abort()}},[t,x,o,m]),c.useEffect(()=>{if(u){const r=new Map;v.forEach((j,C)=>{j.sources.length>0&&r.set(C,j.sources)}),u(r)}},[v,u]);const E=c.useCallback((r,j)=>{if(!b?.current)return;const C=b.current,T=S.current.get(r.id);T&&C.removeLayer(T);const A=window.A?.catalog({name:r.name,sourceSize:12,color:r.color,shape:r.symbol==="circle"?"circle":r.symbol==="square"?"square":r.symbol==="diamond"?"rhomb":"circle"});A&&(j.forEach(M=>{const F=window.A?.source(M.ra,M.dec,{name:M.id,catalog:r.name});F&&A.addSources([F])}),C.addCatalog(A),S.current.set(r.id,A))},[b]),D=c.useCallback(()=>{b?.current&&(S.current.forEach(r=>{try{b.current.removeLayer(r)}catch{}}),S.current.clear())},[b]);c.useEffect(()=>{S.current.forEach((r,j)=>{if(!t.includes(j)&&b?.current)try{b.current.removeLayer(r),S.current.delete(j)}catch{}})},[t,b]);const l=c.useCallback(r=>{t.includes(r)?i(t.filter(j=>j!==r)):i([...t,r])},[t,i]),k=c.useCallback(()=>{t.length===z.length?i([]):i(z.map(r=>r.id))},[t.length,i]),R=z.filter(r=>t.includes(r.id)),s=n.size>0,_=z.filter(r=>["gaia","tess","ps1","2mass","wise"].includes(r.id)),L=z.filter(r=>["nvss","first","sumss","racs","vlass","atnf"].includes(r.id)),H=r=>{const j=v.get(r);return j?j.error?"!":j.truncated?`${j.count}+`:j.count.toString():null},J=r=>{const j=H(r.id),C=n.has(r.id),T=v.get(r.id)?.error;return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm hover:bg-gray-50 p-1 rounded",title:T||r.description,children:[e.jsx("input",{type:"checkbox",checked:t.includes(r.id),onChange:()=>l(r.id),className:"w-4 h-4 rounded",style:{accentColor:r.color}}),e.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:r.color}}),e.jsx("span",{className:"flex-1",children:r.name}),C&&e.jsx("span",{className:"w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin"}),!C&&j&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${T?"bg-red-100 text-red-600":"bg-gray-100 text-gray-600"}`,children:j})]},r.id)},Q=x!==void 0&&o!==void 0;return e.jsxs("div",{className:`${w}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-700",children:"VizieR Catalogues"}),s&&e.jsx("span",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),t.length>0&&e.jsx("span",{className:"badge badge-secondary text-xs",children:t.length})]}),e.jsxs("button",{onClick:()=>y(!h),className:"text-sm text-blue-600 hover:text-blue-800",children:[h?"Hide":"Show"," options"]})]}),R.length>0&&e.jsx(ae,{catalogs:R,className:"mb-2"}),h&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 bg-white space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx("label",{className:"text-xs text-gray-600 whitespace-nowrap",children:"Search radius:"}),e.jsx("input",{type:"number",min:.5,max:60,step:.5,value:m,onChange:r=>g(Math.max(.5,Math.min(60,parseFloat(r.target.value)||5))),className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded"}),e.jsx("span",{className:"text-xs text-gray-500",children:"arcmin"})]}),!Q&&e.jsx("div",{className:"text-xs text-amber-600 bg-amber-50 p-2 rounded",children:"Set center coordinates to query catalogs"}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-100",children:[e.jsx("button",{onClick:k,className:"text-xs text-blue-600 hover:text-blue-800",children:t.length===z.length?"Deselect all":"Select all"}),e.jsx("button",{onClick:()=>{i([]),f(new Map)},className:"text-xs text-gray-500 hover:text-red-500",children:"Clear"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Optical / Infrared"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:_.map(J)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Radio"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:L.map(J)})]}),v.size>0&&e.jsxs("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-100",children:[Array.from(v.values()).reduce((r,j)=>r+j.count,0)," sources loaded",Array.from(v.values()).some(r=>r.truncated)&&" (some truncated)"]})]})]})},he=({raDeg:t,decDeg:i,initialRadius:x=2,maxRadius:o=60,onSearch:p,className:u="",excludeId:b})=>{const[w,h]=c.useState(x),[y,m]=c.useState([]),[g,v]=c.useState(!1),[f,n]=c.useState(null),[I,a]=c.useState("separation"),[d,N]=c.useState("asc"),S=c.useCallback(async()=>{v(!0),n(null);try{const s=await p(t,i,w);m(s)}catch(s){n(s instanceof Error?s.message:"Search failed"),m([])}finally{v(!1)}},[t,i,w,p]);c.useEffect(()=>{S()},[]);const E=c.useCallback(s=>{a(_=>(N(_===s?L=>L==="asc"?"desc":"asc":"asc"),s))},[]),D=[...y].sort((s,_)=>{let L=0;switch(I){case"name":L=s.name.localeCompare(_.name);break;case"database":L=s.database.localeCompare(_.database);break;case"separation":L=s.separation-_.separation;break}return d==="asc"?L:-L}),l=s=>{switch(s){case"SIMBAD":return"badge-info";case"NED":return"badge-success";case"ATNF":return"badge-warning";case"Local":return"badge-secondary"}},k=s=>{if(s.url)return s.url;switch(s.database){case"SIMBAD":return`https://simbad.u-strasbg.fr/simbad/sim-id?Ident=${encodeURIComponent(s.name)}`;case"NED":return`https://ned.ipac.caltech.edu/byname?objname=${encodeURIComponent(s.name)}`;case"ATNF":return`https://www.atnf.csiro.au/research/pulsar/psrcat/proc_form.php?pulsar_names=${encodeURIComponent(s.name)}`;default:return}},R=({column:s})=>I!==s?e.jsxs("svg",{className:"w-3 h-3 text-gray-300 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:[e.jsx("path",{d:"M5 2l2 2H3z",fill:"currentColor"}),e.jsx("path",{d:"M5 8L3 6h4z",fill:"currentColor"})]}):d==="asc"?e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:e.jsx("path",{d:"M5 2l3 4H2z",fill:"currentColor"})}):e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:e.jsx("path",{d:"M5 8L2 4h6z",fill:"currentColor"})});return e.jsxs("div",{className:`card ${u}`,children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"text-lg font-semibold",children:"Nearby Objects"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("label",{className:"text-sm text-gray-600 whitespace-nowrap",children:"Search within"}),e.jsx("input",{type:"number",value:w,onChange:s=>h(Math.min(Number(s.target.value),o)),min:.1,max:o,step:.5,className:"form-control w-20"}),e.jsx("span",{className:"text-sm text-gray-600",children:"arcmin"}),e.jsx("button",{onClick:S,disabled:g,className:"btn btn-primary btn-sm",children:g?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Searching..."]}):"Search"})]}),f&&e.jsx("div",{className:"alert alert-danger mb-4",children:e.jsx("p",{children:f})}),g?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Searching databases..."})]}):y.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsxs("p",{children:["No nearby objects found within ",w," arcmin"]})]}):e.jsx("div",{className:"overflow-x-auto max-h-80 overflow-y-auto",children:e.jsxs("table",{className:"table table-compact",children:[e.jsx("thead",{className:"sticky top-0",children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>E("name"),className:"cursor-pointer hover:bg-opacity-80",children:["Name ",e.jsx(R,{column:"name"})]}),e.jsxs("th",{onClick:()=>E("database"),className:"cursor-pointer hover:bg-opacity-80",children:["Database ",e.jsx(R,{column:"database"})]}),e.jsx("th",{className:"text-center",children:"RA"}),e.jsx("th",{className:"text-center",children:"Dec"}),e.jsxs("th",{onClick:()=>E("separation"),className:"cursor-pointer hover:bg-opacity-80 text-right",children:["Sep (″) ",e.jsx(R,{column:"separation"})]})]})}),e.jsx("tbody",{children:D.map((s,_)=>{const L=k(s);return e.jsxs("tr",{children:[e.jsxs("td",{children:[L?e.jsx("a",{href:L,target:"_blank",rel:"noreferrer",className:"link",children:s.name}):s.name,s.type&&e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",s.type,")"]})]}),e.jsx("td",{children:e.jsx("span",{className:`badge ${l(s.database)}`,children:s.database})}),e.jsx("td",{className:"text-center font-mono text-xs",children:s.ra}),e.jsx("td",{className:"text-center font-mono text-xs",children:s.dec}),e.jsx("td",{className:"text-right font-mono",children:s.separation.toFixed(2)})]},`${s.database}-${s.name}-${_}`)})})]})}),y.length>0&&e.jsxs("div",{className:"mt-3 text-xs text-gray-500 flex justify-between",children:[e.jsxs("span",{children:[y.length," object",y.length!==1?"s":""," found"]}),e.jsxs("span",{children:["SIMBAD: ",y.filter(s=>s.database==="SIMBAD").length," | NED:"," ",y.filter(s=>s.database==="NED").length," | ATNF:"," ",y.filter(s=>s.database==="ATNF").length," | Local:"," ",y.filter(s=>s.database==="Local").length]})]})]})]})},O=({className:t="w-4 h-4"})=>e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),we=()=>{const{sourceId:t}=U(),{data:i,isLoading:x,error:o,refetch:p}=se(t),u=Z(a=>a.addRecentSource),[b,w]=c.useState(void 0),[h,y]=c.useState(!0),[m,g]=c.useState(!1),v=async(a,d,N)=>{const S=[];try{const E=`SELECT TOP 20 main_id, ra, dec, otype_longname
        FROM basic
        WHERE CONTAINS(POINT('ICRS', ra, dec), CIRCLE('ICRS', ${a}, ${d}, ${N/60})) = 1`,D=await fetch(`https://simbad.u-strasbg.fr/simbad/sim-tap/sync?REQUEST=doQuery&LANG=ADQL&FORMAT=json&QUERY=${encodeURIComponent(E)}`);if(D.ok){const k=(await D.json()).data||[];for(const R of k){const s=parseFloat(R[1]),_=parseFloat(R[2]),L=Math.sqrt(Math.pow((a-s)*Math.cos(d*Math.PI/180),2)+Math.pow(d-_,2))*3600;S.push({name:R[0],ra:s.toFixed(6),dec:_.toFixed(6),separation:L,database:"SIMBAD",type:R[3]||void 0,url:`https://simbad.u-strasbg.fr/simbad/sim-id?Ident=${encodeURIComponent(R[0])}`})}}}catch(E){console.warn("SIMBAD query failed:",E)}return S};c.useEffect(()=>{i&&t&&u(t)},[i,t,u]),c.useEffect(()=>{const a=i;a?.contributing_images?.length&&w(a.contributing_images[0].image_id)},[i]);const f=c.useMemo(()=>{const a=i;return a?.contributing_images?a.contributing_images.filter(d=>d.flux_jy!==void 0&&d.created_at).map(d=>({time:d.created_at,flux:d.flux_jy,fluxError:d.flux_error_jy,label:d.path?.split("/").pop()||d.image_id})).sort((d,N)=>new Date(d.time).getTime()-new Date(N.time).getTime()):[]},[i]);if(x)return e.jsx(Y,{label:"Loading source details..."});if(o)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx(W,{error:o,onRetry:()=>p()})});if(!i)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs($,{children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"Source not found."}),e.jsx(q,{to:"/sources",className:"link",children:"Back to Sources"})]})});const n=i,I=ee(n,b);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(q,{to:"/sources",className:"text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block",children:"Back to Sources"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:n.name||`Source ${n.id}`}),I&&e.jsx(G,{...I})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 sticky-sidebar",children:[e.jsxs($,{title:"Position",children:[e.jsx(K,{raDeg:n.ra_deg,decDeg:n.dec_deg,showDecimal:!0,allowFormatToggle:!0}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-2",children:[e.jsxs("a",{href:`https://simbad.u-strasbg.fr/simbad/sim-coo?Coord=${n.ra_deg}+${n.dec_deg}&CooFrame=FK5&CooEpoch=2000&CooEqui=2000&Radius=2&Radius.unit=arcmin`,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-800 hover:underline",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),"Search in SIMBAD",e.jsx(O,{className:"w-3 h-3"})]}),e.jsxs("a",{href:`https://ned.ipac.caltech.edu/conesearch?search_type=Near%20Position%20Search&ra=${n.ra_deg}&dec=${n.dec_deg}&radius=2&in_csys=Equatorial&in_equinox=J2000`,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-800 hover:underline",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"})}),"Search in NED",e.jsx(O,{className:"w-3 h-3"})]})]})]}),e.jsx($,{title:"Actions",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${t}/lightcurve`,"_blank"),children:"View Lightcurve"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${t}/postage_stamps`,"_blank"),children:"Download Postage Stamps"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${t}/variability`,"_blank"),children:"Variability Analysis"})]})}),e.jsx($,{title:"Details",children:e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Source ID"}),e.jsx("dd",{className:"font-mono text-sm text-gray-900",children:n.id})]}),n.name&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Name"}),e.jsx("dd",{className:"text-sm text-gray-900",children:n.name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Detections"}),e.jsxs("dd",{className:"text-sm text-gray-900",children:[n.contributing_images?.length||0," images"]})]})]})})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx($,{title:"Sky View",subtitle:e.jsx("button",{type:"button",onClick:()=>y(!h),className:"text-xs text-blue-600 hover:text-blue-800",children:h?"Hide":"Show"}),children:h&&e.jsx(X,{raDeg:n.ra_deg,decDeg:n.dec_deg,fov:.1,height:300,sourceName:n.name||`Source ${n.id}`,className:"rounded-lg overflow-hidden"})}),e.jsx($,{title:"Catalog Crossmatch",children:e.jsx(xe,{centerRa:n.ra_deg,centerDec:n.dec_deg,defaultRadius:2})}),e.jsxs($,{title:"Nearby Objects",subtitle:e.jsx("button",{type:"button",onClick:()=>g(!m),className:"text-xs text-blue-600 hover:text-blue-800",children:m?"Hide":"Search SIMBAD"}),children:[m&&e.jsx(he,{raDeg:n.ra_deg,decDeg:n.dec_deg,initialRadius:2,maxRadius:30,onSearch:v}),!m&&e.jsx("p",{className:"text-sm text-gray-500",children:'Click "Search SIMBAD" to find nearby objects in external catalogs.'})]}),f.length>1&&e.jsx($,{title:"Light Curve",subtitle:`${f.length} measurements`,children:e.jsx(re,{data:f,height:300,yAxisLabel:"Flux",xAxisLabel:"Observation Date",enableZoom:!0,showErrorBars:!0,onPointClick:a=>{const d=n.contributing_images?.find(N=>N.created_at===a.time);d&&w(d.image_id)}})}),n.contributing_images&&n.contributing_images.length>0&&e.jsx($,{title:"Contributing Images",subtitle:`${n.contributing_images.length} detection${n.contributing_images.length!==1?"s":""}`,children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:n.contributing_images.map(a=>e.jsxs("div",{className:`p-3 rounded-lg border-2 cursor-pointer transition-all ${b===a.image_id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}`,onClick:()=>w(a.image_id),onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&w(a.image_id)},role:"button",tabIndex:0,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(q,{to:`/images/${a.image_id}`,className:"font-medium text-gray-900 hover:text-blue-600 truncate block",onClick:d=>d.stopPropagation(),children:a.path?.split("/").pop()||a.image_id}),a.ms_path&&e.jsxs("div",{className:"text-xs text-gray-500 truncate mt-0.5",children:["MS: ",a.ms_path.split("/").pop()]})]}),a.qa_grade&&e.jsx("span",{className:`badge ml-2 ${a.qa_grade==="good"?"badge-success":a.qa_grade==="warn"?"badge-warning":"badge-error"}`,children:a.qa_grade})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500",children:[a.flux_jy!==void 0&&e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"Flux:"})," ",a.flux_jy<.001?`${(a.flux_jy*1e6).toFixed(1)} μJy`:a.flux_jy<1?`${(a.flux_jy*1e3).toFixed(2)} mJy`:`${a.flux_jy.toFixed(3)} Jy`]}),a.created_at&&e.jsx("span",{title:new Date(a.created_at).toLocaleString(),children:te(a.created_at)})]})]},a.image_id))})}),(!n.contributing_images||n.contributing_images.length===0)&&e.jsx($,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{children:"No contributing images found for this source."})]})})]})]})]})};export{we as default};
//# sourceMappingURL=SourceDetailPage-BcAnAhzb.js.map
