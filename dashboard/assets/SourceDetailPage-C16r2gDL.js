var Z=Object.defineProperty;var Y=(t,n,m)=>n in t?Z(t,n,{enumerable:!0,configurable:!0,writable:!0,value:m}):t[n]=m;var q=(t,n,m)=>Y(t,typeof n!="symbol"?n+"":n,m);import{r as l,j as e,u as X,L as P}from"./index-QjjBz54k.js";import{E as ee,C as T,P as te,a as se}from"./CoordinateDisplay-By72WkfT.js";import{u as re,L as ae}from"./appStore-9AaCbw7y.js";import{A as ne}from"./AladinLiteViewer-tUYcmmwG.js";import{b as ie}from"./provenanceMappers-BvXM4jp-.js";import{r as oe}from"./relativeTime-Dp84ug83.js";import{e as ce}from"./useQueries-D0hkDoVR.js";const Q="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js",le=({data:t,title:n,yAxisLabel:m="Flux (Jy)",xAxisLabel:c="Time",height:g=350,enableZoom:x=!0,showErrorBars:u=!0,className:N="",onPointClick:p,isLoading:v=!1})=>{const f=l.useRef(null),y=l.useRef(null),[j,b]=l.useState(!0),[i,I]=l.useState(null);l.useEffect(()=>{(async()=>{if(window.echarts){b(!1);return}try{document.querySelector(`script[src="${Q}"]`)||await new Promise((k,D)=>{const d=document.createElement("script");d.src=Q,d.async=!0,d.onload=()=>k(),d.onerror=()=>D(new Error("Failed to load ECharts")),document.head.appendChild(d)});let h=0;for(;!window.echarts&&h<50;)await new Promise(k=>setTimeout(k,100)),h++;if(!window.echarts)throw new Error("ECharts failed to initialize");b(!1)}catch(h){I(h instanceof Error?h.message:"Failed to load chart library"),b(!1)}})()},[]),l.useEffect(()=>{if(j||i||!f.current||!window.echarts||v)return;y.current||(y.current=window.echarts.init(f.current));const o=t.map(d=>[typeof d.time=="string"?new Date(d.time).getTime():d.time,d.flux]),h=[];u&&t.forEach((d,C)=>{if(d.fluxError!==void 0){const _=o[C][0];h.push({coord:[_,d.flux-d.fluxError,_,d.flux+d.fluxError]})}});const k=d=>Math.abs(d)<.001?`${(d*1e6).toFixed(1)} μJy`:Math.abs(d)<1?`${(d*1e3).toFixed(2)} mJy`:`${d.toFixed(3)} Jy`,D={title:n?{text:n,left:"center",textStyle:{fontSize:14,fontWeight:"bold"}}:void 0,tooltip:{trigger:"item",formatter:d=>{const C=t[d.dataIndex];let s=`<div class="text-sm">
            <div class="font-medium">${new Date(d.data[0]).toLocaleString()}</div>
            <div>Flux: ${k(d.data[1])}</div>`;return C!=null&&C.fluxError&&(s+=`<div>Error: ±${k(C.fluxError)}</div>`),C!=null&&C.label&&(s+=`<div class="text-gray-500">${C.label}</div>`),s+="</div>",s},axisPointer:{type:"cross"}},xAxis:{type:"time",name:c,nameLocation:"middle",axisLabel:{formatter:d=>{const C=new Date(d);return`${C.getMonth()+1}/${C.getDate()}`}}},yAxis:{type:"value",name:m,nameLocation:"middle",axisLabel:{formatter:k}},series:[{type:"line",data:o,symbolSize:8,itemStyle:{color:"#3b82f6"},lineStyle:{width:2},showSymbol:!0,emphasis:{focus:"series",itemStyle:{shadowBlur:10,shadowColor:"rgba(59, 130, 246, 0.5)"}}}],dataZoom:x?[{type:"inside",start:0,end:100,xAxisIndex:0},{type:"slider",start:0,end:100,xAxisIndex:0}]:void 0,grid:{left:"15%",right:"10%",bottom:x?"20%":"15%",top:n?"15%":"10%",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none",title:{zoom:"Zoom",back:"Reset"}},restore:{title:"Restore"},saveAsImage:{title:"Save"}}}};return y.current.setOption(D),p&&(y.current.off("click"),y.current.on("click",d=>{d.dataIndex!==void 0&&p(t[d.dataIndex],d.dataIndex)})),()=>{y.current&&y.current.off("click")}},[j,i,t,n,m,c,x,u,p,v]),l.useEffect(()=>{const o=()=>{y.current&&y.current.resize()};return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),l.useEffect(()=>()=>{y.current&&(y.current.dispose(),y.current=null)},[]);const L=l.useCallback(()=>{y.current&&y.current.dispatchAction({type:"dataZoom",dataZoomIndex:0,start:0,end:100})},[]),r=typeof g=="number"?`${g}px`:g;return i?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${N}`,style:{height:r},children:e.jsxs("div",{className:"text-center text-gray-500 p-4",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("p",{className:"text-sm",children:i})]})}):j||v?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${N}`,style:{height:r},children:e.jsxs("div",{className:"flex flex-col items-center text-gray-500",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("span",{className:"text-sm",children:"Loading light curve..."})]})}):!t||t.length===0?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${N}`,style:{height:r},children:e.jsxs("div",{className:"text-center text-gray-500 p-4",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("p",{className:"text-sm",children:"No light curve data available"})]})}):e.jsxs("div",{className:`relative ${N}`,children:[e.jsx("div",{ref:f,style:{height:r,width:"100%"}}),x&&e.jsx("button",{type:"button",onClick:L,className:"absolute top-2 right-2 bg-white/90 hover:bg-white px-2 py-1 rounded shadow text-xs text-gray-700 hover:text-gray-900 transition-colors",title:"Reset zoom",children:"Reset Zoom"})]})},z=[{id:"gaia",name:"Gaia DR3",vizierTable:"I/355/gaiadr3",raColumn:"RA_ICRS",decColumn:"DE_ICRS",color:"#ff0000",symbol:"circle",description:"Gaia Data Release 3 - optical astrometry and photometry",defaultEnabled:!1},{id:"tess",name:"TESS TIC v8.2",vizierTable:"IV/39/tic82",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#db01fd",symbol:"diamond",description:"TESS Input Catalog - stars observed by TESS",defaultEnabled:!1},{id:"ps1",name:"Pan-STARRS DR1",vizierTable:"II/349/ps1",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#0066ff",symbol:"square",description:"Pan-STARRS1 Survey - optical photometry",defaultEnabled:!1},{id:"2mass",name:"2MASS",vizierTable:"II/246/out",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ff9900",symbol:"triangle",description:"Two Micron All Sky Survey - near-infrared",defaultEnabled:!1},{id:"wise",name:"AllWISE",vizierTable:"II/328/allwise",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#00cc66",symbol:"star",description:"Wide-field Infrared Survey Explorer",defaultEnabled:!1},{id:"nvss",name:"NVSS",vizierTable:"VIII/65/nvss",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#00cccc",symbol:"plus",description:"NRAO VLA Sky Survey - 1.4 GHz radio",defaultEnabled:!1},{id:"first",name:"FIRST",vizierTable:"VIII/92/first14",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#cc00cc",symbol:"cross",description:"Faint Images of the Radio Sky at Twenty-cm",defaultEnabled:!1},{id:"sumss",name:"SUMSS",vizierTable:"VIII/81B/sumss212",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ffcc00",symbol:"circle",description:"Sydney University Molonglo Sky Survey - 843 MHz",defaultEnabled:!1},{id:"racs",name:"RACS-Low",vizierTable:"J/other/PASA/38.58/gausscut",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#66ff66",symbol:"diamond",description:"Rapid ASKAP Continuum Survey - 887 MHz",defaultEnabled:!1},{id:"vlass",name:"VLASS",vizierTable:"J/ApJS/255/30/table1",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ff6666",symbol:"square",description:"VLA Sky Survey - 3 GHz radio",defaultEnabled:!1},{id:"atnf",name:"ATNF Pulsars",vizierTable:"B/psr/psr",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ffffff",symbol:"star",description:"Australia Telescope National Facility Pulsar Catalogue",defaultEnabled:!1}],de=({catalogs:t,className:n=""})=>{if(t.length===0)return null;const m=c=>{const x={fill:c.color,stroke:c.color};switch(c.symbol){case"circle":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("circle",{cx:"6",cy:"6",r:"5",...x,fillOpacity:.3,strokeWidth:1.5})});case"square":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("rect",{x:"1",y:"1",width:"10",height:"10",...x,fillOpacity:.3,strokeWidth:1.5})});case"diamond":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 11,6 6,11 1,6",...x,fillOpacity:.3,strokeWidth:1.5})});case"triangle":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 11,11 1,11",...x,fillOpacity:.3,strokeWidth:1.5})});case"star":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 7.5,4.5 11,5 8.5,7.5 9,11 6,9 3,11 3.5,7.5 1,5 4.5,4.5",...x,fillOpacity:.3,strokeWidth:1})});case"plus":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("path",{d:"M6,1 L6,11 M1,6 L11,6",stroke:c.color,strokeWidth:2,fill:"none"})});case"cross":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("path",{d:"M1,1 L11,11 M11,1 L1,11",stroke:c.color,strokeWidth:2,fill:"none"})});default:return e.jsx("span",{className:"inline-block w-3 h-3 rounded-full",style:{backgroundColor:c.color}})}};return e.jsx("div",{className:`flex flex-wrap gap-3 text-xs ${n}`,children:t.map(c=>e.jsxs("div",{className:"flex items-center gap-1",title:c.description,children:[m(c),e.jsx("span",{style:{color:c.color},children:c.name})]},c.id))})},ue="https://tapvizier.cds.unistra.fr/TAPVizieR/tap/sync",G=1e3,H=200;class me{constructor(){q(this,"queue",[]);q(this,"processing",!1);q(this,"lastRequestTime",0)}async enqueue(n){return new Promise((m,c)=>{this.queue.push(async()=>{try{const g=await n();m(g)}catch(g){c(g)}}),this.processQueue()})}async processQueue(){if(!this.processing){for(this.processing=!0;this.queue.length>0;){const m=Date.now()-this.lastRequestTime;m<H&&await new Promise(g=>setTimeout(g,H-m));const c=this.queue.shift();c&&(this.lastRequestTime=Date.now(),await c())}this.processing=!1}}}const he=new me;function xe(t,n,m,c){const g=t.raColumn||"RAJ2000",x=t.decColumn||"DEJ2000";return`
    SELECT TOP ${G} 
      ${g} as ra, 
      ${x} as dec,
      *
    FROM "${t.vizierTable}"
    WHERE 1=CONTAINS(
      POINT('ICRS', ${g}, ${x}),
      CIRCLE('ICRS', ${n}, ${m}, ${c})
    )
  `.trim()}function fe(t,n,m,c){const x=new DOMParser().parseFromString(t,"text/xml"),u=x.querySelector("INFO[name='QUERY_STATUS'][value='ERROR']");if(u)throw new Error(u.textContent||"Query failed");const p=Array.from(x.querySelectorAll("FIELD")).map(b=>b.getAttribute("name")||"");let v=p.findIndex(b=>b.toLowerCase()==="ra"),f=p.findIndex(b=>b.toLowerCase()==="dec");if(v===-1&&(v=p.findIndex(b=>b===m)),f===-1&&(f=p.findIndex(b=>b===c)),v===-1||f===-1)return console.warn(`Could not find RA/Dec columns for ${n}`,p),[];const y=x.querySelectorAll("TR"),j=[];return y.forEach((b,i)=>{const I=b.querySelectorAll("TD");if(I.length>Math.max(v,f)){const L=parseFloat(I[v].textContent||""),r=parseFloat(I[f].textContent||"");!isNaN(L)&&!isNaN(r)&&j.push({ra:L,dec:r,id:`${n}_${i}`,catalog:n})}}),j}async function pe(t,n,m,c,g){return he.enqueue(async()=>{const x=c/60,u=t.raColumn||"RAJ2000",N=t.decColumn||"DEJ2000";try{const p=xe(t,n,m,x),v=new URLSearchParams({REQUEST:"doQuery",LANG:"ADQL",FORMAT:"votable",QUERY:p}),f=await fetch(`${ue}?${v}`,{signal:g,headers:{Accept:"application/xml"}});if(!f.ok)throw new Error(`HTTP ${f.status}: ${f.statusText}`);const y=await f.text(),j=fe(y,t.id,u,N);return{catalogId:t.id,sources:j,count:j.length,truncated:j.length>=G}}catch(p){if(p instanceof Error&&p.name==="AbortError")throw p;return{catalogId:t.id,sources:[],count:0,truncated:!1,error:p instanceof Error?p.message:"Query failed"}}})}const U=new Map,be=5*60*1e3;async function ge(t,n,m,c,g){const x=`${t.id}:${n.toFixed(4)}:${m.toFixed(4)}:${c.toFixed(1)}`,u=U.get(x);if(u&&Date.now()-u.timestamp<be)return u.result;const N=await pe(t,n,m,c,g);return N.error||U.set(x,{result:N,timestamp:Date.now()}),N}const ye=({enabledCatalogs:t,onCatalogChange:n,centerRa:m,centerDec:c,searchRadius:g=5,onSourcesLoaded:x,aladinRef:u,className:N=""})=>{const[p,v]=l.useState(!1),[f,y]=l.useState(g),[j,b]=l.useState(new Map),[i,I]=l.useState(new Set),[L,r]=l.useState(g),o=l.useRef(null),h=l.useRef(new Map);l.useEffect(()=>{f!==L&&(b(new Map),r(f))},[f,L]),l.useEffect(()=>()=>{o.current&&o.current.abort()},[]),l.useEffect(()=>{if(m===void 0||c===void 0)return;if(t.length===0){D(),b(new Map);return}o.current&&o.current.abort(),o.current=new AbortController;const a=o.current.signal,w=t.filter(S=>{var $;return!j.has(S)||(($=j.get(S))==null?void 0:$.error)});if(w.length!==0)return I(S=>new Set([...S,...w])),w.forEach(async S=>{const $=z.find(E=>E.id===S);if($)try{const E=await ge($,m,c,f,a);if(a.aborted)return;b(M=>{const F=new Map(M);return F.set(S,E),F}),u!=null&&u.current&&E.sources.length>0&&k($,E.sources)}catch(E){if(E instanceof Error&&E.name==="AbortError")return;console.error(`Failed to query ${S}:`,E)}finally{a.aborted||I(E=>{const M=new Set(E);return M.delete(S),M})}}),()=>{var S;(S=o.current)==null||S.abort()}},[t,m,c,f]),l.useEffect(()=>{if(x){const a=new Map;j.forEach((w,S)=>{w.sources.length>0&&a.set(S,w.sources)}),x(a)}},[j,x]);const k=l.useCallback((a,w)=>{var M;if(!(u!=null&&u.current))return;const S=u.current,$=h.current.get(a.id);$&&S.removeLayer($);const E=(M=window.A)==null?void 0:M.catalog({name:a.name,sourceSize:12,color:a.color,shape:a.symbol==="circle"?"circle":a.symbol==="square"?"square":a.symbol==="diamond"?"rhomb":"circle"});E&&(w.forEach(F=>{var V;const O=(V=window.A)==null?void 0:V.source(F.ra,F.dec,{name:F.id,catalog:a.name});O&&E.addSources([O])}),S.addCatalog(E),h.current.set(a.id,E))},[u]),D=l.useCallback(()=>{u!=null&&u.current&&(h.current.forEach(a=>{try{u.current.removeLayer(a)}catch{}}),h.current.clear())},[u]);l.useEffect(()=>{h.current.forEach((a,w)=>{if(!t.includes(w)&&(u!=null&&u.current))try{u.current.removeLayer(a),h.current.delete(w)}catch{}})},[t,u]);const d=l.useCallback(a=>{t.includes(a)?n(t.filter(w=>w!==a)):n([...t,a])},[t,n]),C=l.useCallback(()=>{t.length===z.length?n([]):n(z.map(a=>a.id))},[t.length,n]),_=z.filter(a=>t.includes(a.id)),s=i.size>0,R=z.filter(a=>["gaia","tess","ps1","2mass","wise"].includes(a.id)),A=z.filter(a=>["nvss","first","sumss","racs","vlass","atnf"].includes(a.id)),J=a=>{const w=j.get(a);return w?w.error?"!":w.truncated?`${w.count}+`:w.count.toString():null},B=a=>{var E;const w=J(a.id),S=i.has(a.id),$=(E=j.get(a.id))==null?void 0:E.error;return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm hover:bg-gray-50 p-1 rounded",title:$||a.description,children:[e.jsx("input",{type:"checkbox",checked:t.includes(a.id),onChange:()=>d(a.id),className:"w-4 h-4 rounded",style:{accentColor:a.color}}),e.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:a.color}}),e.jsx("span",{className:"flex-1",children:a.name}),S&&e.jsx("span",{className:"w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin"}),!S&&w&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${$?"bg-red-100 text-red-600":"bg-gray-100 text-gray-600"}`,children:w})]},a.id)},K=m!==void 0&&c!==void 0;return e.jsxs("div",{className:`${N}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-700",children:"VizieR Catalogues"}),s&&e.jsx("span",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),t.length>0&&e.jsx("span",{className:"badge badge-secondary text-xs",children:t.length})]}),e.jsxs("button",{onClick:()=>v(!p),className:"text-sm text-blue-600 hover:text-blue-800",children:[p?"Hide":"Show"," options"]})]}),_.length>0&&e.jsx(de,{catalogs:_,className:"mb-2"}),p&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 bg-white space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx("label",{className:"text-xs text-gray-600 whitespace-nowrap",children:"Search radius:"}),e.jsx("input",{type:"number",min:.5,max:60,step:.5,value:f,onChange:a=>y(Math.max(.5,Math.min(60,parseFloat(a.target.value)||5))),className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded"}),e.jsx("span",{className:"text-xs text-gray-500",children:"arcmin"})]}),!K&&e.jsx("div",{className:"text-xs text-amber-600 bg-amber-50 p-2 rounded",children:"Set center coordinates to query catalogs"}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-100",children:[e.jsx("button",{onClick:C,className:"text-xs text-blue-600 hover:text-blue-800",children:t.length===z.length?"Deselect all":"Select all"}),e.jsx("button",{onClick:()=>{n([]),b(new Map)},className:"text-xs text-gray-500 hover:text-red-500",children:"Clear"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Optical / Infrared"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:R.map(B)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Radio"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:A.map(B)})]}),j.size>0&&e.jsxs("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-100",children:[Array.from(j.values()).reduce((a,w)=>a+w.count,0)," sources loaded",Array.from(j.values()).some(a=>a.truncated)&&" (some truncated)"]})]})]})},ve=({raDeg:t,decDeg:n,initialRadius:m=2,maxRadius:c=60,onSearch:g,className:x="",excludeId:u})=>{const[N,p]=l.useState(m),[v,f]=l.useState([]),[y,j]=l.useState(!1),[b,i]=l.useState(null),[I,L]=l.useState("separation"),[r,o]=l.useState("asc"),h=l.useCallback(async()=>{j(!0),i(null);try{const s=await g(t,n,N);f(s)}catch(s){i(s instanceof Error?s.message:"Search failed"),f([])}finally{j(!1)}},[t,n,N,g]);l.useEffect(()=>{h()},[]);const k=l.useCallback(s=>{L(R=>(o(R===s?A=>A==="asc"?"desc":"asc":"asc"),s))},[]),D=[...v].sort((s,R)=>{let A=0;switch(I){case"name":A=s.name.localeCompare(R.name);break;case"database":A=s.database.localeCompare(R.database);break;case"separation":A=s.separation-R.separation;break}return r==="asc"?A:-A}),d=s=>{switch(s){case"SIMBAD":return"badge-info";case"NED":return"badge-success";case"ATNF":return"badge-warning";case"Local":return"badge-secondary"}},C=s=>{if(s.url)return s.url;switch(s.database){case"SIMBAD":return`https://simbad.u-strasbg.fr/simbad/sim-id?Ident=${encodeURIComponent(s.name)}`;case"NED":return`https://ned.ipac.caltech.edu/byname?objname=${encodeURIComponent(s.name)}`;case"ATNF":return`https://www.atnf.csiro.au/research/pulsar/psrcat/proc_form.php?pulsar_names=${encodeURIComponent(s.name)}`;default:return}},_=({column:s})=>I!==s?e.jsxs("svg",{className:"w-3 h-3 text-gray-300 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:[e.jsx("path",{d:"M5 2l2 2H3z",fill:"currentColor"}),e.jsx("path",{d:"M5 8L3 6h4z",fill:"currentColor"})]}):r==="asc"?e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:e.jsx("path",{d:"M5 2l3 4H2z",fill:"currentColor"})}):e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:e.jsx("path",{d:"M5 8L2 4h6z",fill:"currentColor"})});return e.jsxs("div",{className:`card ${x}`,children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"text-lg font-semibold",children:"Nearby Objects"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("label",{className:"text-sm text-gray-600 whitespace-nowrap",children:"Search within"}),e.jsx("input",{type:"number",value:N,onChange:s=>p(Math.min(Number(s.target.value),c)),min:.1,max:c,step:.5,className:"form-control w-20"}),e.jsx("span",{className:"text-sm text-gray-600",children:"arcmin"}),e.jsx("button",{onClick:h,disabled:y,className:"btn btn-primary btn-sm",children:y?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Searching..."]}):"Search"})]}),b&&e.jsx("div",{className:"alert alert-danger mb-4",children:e.jsx("p",{children:b})}),y?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Searching databases..."})]}):v.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsxs("p",{children:["No nearby objects found within ",N," arcmin"]})]}):e.jsx("div",{className:"overflow-x-auto max-h-80 overflow-y-auto",children:e.jsxs("table",{className:"table table-compact",children:[e.jsx("thead",{className:"sticky top-0",children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>k("name"),className:"cursor-pointer hover:bg-opacity-80",children:["Name ",e.jsx(_,{column:"name"})]}),e.jsxs("th",{onClick:()=>k("database"),className:"cursor-pointer hover:bg-opacity-80",children:["Database ",e.jsx(_,{column:"database"})]}),e.jsx("th",{className:"text-center",children:"RA"}),e.jsx("th",{className:"text-center",children:"Dec"}),e.jsxs("th",{onClick:()=>k("separation"),className:"cursor-pointer hover:bg-opacity-80 text-right",children:["Sep (″) ",e.jsx(_,{column:"separation"})]})]})}),e.jsx("tbody",{children:D.map((s,R)=>{const A=C(s);return e.jsxs("tr",{children:[e.jsxs("td",{children:[A?e.jsx("a",{href:A,target:"_blank",rel:"noreferrer",className:"link",children:s.name}):s.name,s.type&&e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",s.type,")"]})]}),e.jsx("td",{children:e.jsx("span",{className:`badge ${d(s.database)}`,children:s.database})}),e.jsx("td",{className:"text-center font-mono text-xs",children:s.ra}),e.jsx("td",{className:"text-center font-mono text-xs",children:s.dec}),e.jsx("td",{className:"text-right font-mono",children:s.separation.toFixed(2)})]},`${s.database}-${s.name}-${R}`)})})]})}),v.length>0&&e.jsxs("div",{className:"mt-3 text-xs text-gray-500 flex justify-between",children:[e.jsxs("span",{children:[v.length," object",v.length!==1?"s":""," found"]}),e.jsxs("span",{children:["SIMBAD: ",v.filter(s=>s.database==="SIMBAD").length," | NED:"," ",v.filter(s=>s.database==="NED").length," | ATNF:"," ",v.filter(s=>s.database==="ATNF").length," | Local:"," ",v.filter(s=>s.database==="Local").length]})]})]})]})},W=({className:t="w-4 h-4"})=>e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),Ie=()=>{var L;const{sourceId:t}=X(),{data:n,isLoading:m,error:c,refetch:g}=ce(t),x=re(r=>r.addRecentSource),[u,N]=l.useState(void 0),[p,v]=l.useState(!0),[f,y]=l.useState(!1),j=async(r,o,h)=>{const k=[];try{const D=`SELECT TOP 20 main_id, ra, dec, otype_longname
        FROM basic
        WHERE CONTAINS(POINT('ICRS', ra, dec), CIRCLE('ICRS', ${r}, ${o}, ${h/60})) = 1`,d=await fetch(`https://simbad.u-strasbg.fr/simbad/sim-tap/sync?REQUEST=doQuery&LANG=ADQL&FORMAT=json&QUERY=${encodeURIComponent(D)}`);if(d.ok){const _=(await d.json()).data||[];for(const s of _){const R=parseFloat(s[1]),A=parseFloat(s[2]),J=Math.sqrt(Math.pow((r-R)*Math.cos(o*Math.PI/180),2)+Math.pow(o-A,2))*3600;k.push({name:s[0],ra:R.toFixed(6),dec:A.toFixed(6),separation:J,database:"SIMBAD",type:s[3]||void 0,url:`https://simbad.u-strasbg.fr/simbad/sim-id?Ident=${encodeURIComponent(s[0])}`})}}}catch(D){console.warn("SIMBAD query failed:",D)}return k};l.useEffect(()=>{n&&t&&x(t)},[n,t,x]),l.useEffect(()=>{var o;const r=n;(o=r==null?void 0:r.contributing_images)!=null&&o.length&&N(r.contributing_images[0].image_id)},[n]);const b=l.useMemo(()=>{const r=n;return r!=null&&r.contributing_images?r.contributing_images.filter(o=>o.flux_jy!==void 0&&o.created_at).map(o=>{var h;return{time:o.created_at,flux:o.flux_jy,fluxError:o.flux_error_jy,label:((h=o.path)==null?void 0:h.split("/").pop())||o.image_id}}).sort((o,h)=>new Date(o.time).getTime()-new Date(h.time).getTime()):[]},[n]);if(m)return e.jsx(ae,{label:"Loading source details..."});if(c)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx(ee,{error:c,onRetry:()=>g()})});if(!n)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs(T,{children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"Source not found."}),e.jsx(P,{to:"/sources",className:"link",children:"Back to Sources"})]})});const i=n,I=ie(i,u);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(P,{to:"/sources",className:"text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block",children:"Back to Sources"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:i.name||`Source ${i.id}`}),I&&e.jsx(te,{...I})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 sticky-sidebar",children:[e.jsxs(T,{title:"Position",children:[e.jsx(se,{raDeg:i.ra_deg,decDeg:i.dec_deg,showDecimal:!0,allowFormatToggle:!0}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-2",children:[e.jsxs("a",{href:`https://simbad.u-strasbg.fr/simbad/sim-coo?Coord=${i.ra_deg}+${i.dec_deg}&CooFrame=FK5&CooEpoch=2000&CooEqui=2000&Radius=2&Radius.unit=arcmin`,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-800 hover:underline",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),"Search in SIMBAD",e.jsx(W,{className:"w-3 h-3"})]}),e.jsxs("a",{href:`https://ned.ipac.caltech.edu/conesearch?search_type=Near%20Position%20Search&ra=${i.ra_deg}&dec=${i.dec_deg}&radius=2&in_csys=Equatorial&in_equinox=J2000`,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-800 hover:underline",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"})}),"Search in NED",e.jsx(W,{className:"w-3 h-3"})]})]})]}),e.jsx(T,{title:"Actions",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${t}/lightcurve`,"_blank"),children:"View Lightcurve"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${t}/postage_stamps`,"_blank"),children:"Download Postage Stamps"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${t}/variability`,"_blank"),children:"Variability Analysis"})]})}),e.jsx(T,{title:"Details",children:e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Source ID"}),e.jsx("dd",{className:"font-mono text-sm text-gray-900",children:i.id})]}),i.name&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Name"}),e.jsx("dd",{className:"text-sm text-gray-900",children:i.name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Detections"}),e.jsxs("dd",{className:"text-sm text-gray-900",children:[((L=i.contributing_images)==null?void 0:L.length)||0," images"]})]})]})})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(T,{title:"Sky View",subtitle:e.jsx("button",{type:"button",onClick:()=>v(!p),className:"text-xs text-blue-600 hover:text-blue-800",children:p?"Hide":"Show"}),children:p&&e.jsx(ne,{raDeg:i.ra_deg,decDeg:i.dec_deg,fov:.1,height:300,sourceName:i.name||`Source ${i.id}`,className:"rounded-lg overflow-hidden"})}),e.jsx(T,{title:"Catalog Crossmatch",children:e.jsx(ye,{centerRa:i.ra_deg,centerDec:i.dec_deg,defaultRadius:2})}),e.jsxs(T,{title:"Nearby Objects",subtitle:e.jsx("button",{type:"button",onClick:()=>y(!f),className:"text-xs text-blue-600 hover:text-blue-800",children:f?"Hide":"Search SIMBAD"}),children:[f&&e.jsx(ve,{raDeg:i.ra_deg,decDeg:i.dec_deg,initialRadius:2,maxRadius:30,onSearch:j}),!f&&e.jsx("p",{className:"text-sm text-gray-500",children:'Click "Search SIMBAD" to find nearby objects in external catalogs.'})]}),b.length>1&&e.jsx(T,{title:"Light Curve",subtitle:`${b.length} measurements`,children:e.jsx(le,{data:b,height:300,yAxisLabel:"Flux",xAxisLabel:"Observation Date",enableZoom:!0,showErrorBars:!0,onPointClick:r=>{var h;const o=(h=i.contributing_images)==null?void 0:h.find(k=>k.created_at===r.time);o&&N(o.image_id)}})}),i.contributing_images&&i.contributing_images.length>0&&e.jsx(T,{title:"Contributing Images",subtitle:`${i.contributing_images.length} detection${i.contributing_images.length!==1?"s":""}`,children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:i.contributing_images.map(r=>{var o;return e.jsxs("div",{className:`p-3 rounded-lg border-2 cursor-pointer transition-all ${u===r.image_id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}`,onClick:()=>N(r.image_id),onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&N(r.image_id)},role:"button",tabIndex:0,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(P,{to:`/images/${r.image_id}`,className:"font-medium text-gray-900 hover:text-blue-600 truncate block",onClick:h=>h.stopPropagation(),children:((o=r.path)==null?void 0:o.split("/").pop())||r.image_id}),r.ms_path&&e.jsxs("div",{className:"text-xs text-gray-500 truncate mt-0.5",children:["MS: ",r.ms_path.split("/").pop()]})]}),r.qa_grade&&e.jsx("span",{className:`badge ml-2 ${r.qa_grade==="good"?"badge-success":r.qa_grade==="warn"?"badge-warning":"badge-error"}`,children:r.qa_grade})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500",children:[r.flux_jy!==void 0&&e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"Flux:"})," ",r.flux_jy<.001?`${(r.flux_jy*1e6).toFixed(1)} μJy`:r.flux_jy<1?`${(r.flux_jy*1e3).toFixed(2)} mJy`:`${r.flux_jy.toFixed(3)} Jy`]}),r.created_at&&e.jsx("span",{title:new Date(r.created_at).toLocaleString(),children:oe(r.created_at)})]})]},r.image_id)})})}),(!i.contributing_images||i.contributing_images.length===0)&&e.jsx(T,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{children:"No contributing images found for this source."})]})})]})]})]})};export{Ie as default};
//# sourceMappingURL=SourceDetailPage-C16r2gDL.js.map
