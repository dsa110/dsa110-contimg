import{r as n,j as e,u as U,R as Q,L}from"./index-CnKM1lPu.js";import{E as G,C,P as K,a as Y}from"./CoordinateDisplay-jAVESCC7.js";import{u as X,L as ee}from"./appStore--CVtLTkT.js";import{Q as se}from"./QAMetrics-DjrdXlUB.js";import{A as ae}from"./AladinLiteViewer-DZLiVG5m.js";import{m as te}from"./provenanceMappers-BvXM4jp-.js";import{r as re}from"./relativeTime-Dp84ug83.js";import{c as ne}from"./useQueries-DCqY91tB.js";const le={sm:"w-24 h-24",md:"w-48 h-48",lg:"w-72 h-72"},ie=({imageId:o,alt:s="Image preview",size:v="md",onClick:r,expandable:g=!0,apiUrl:j="https://ronnie-unsectarian-antone.ngrok-free.dev/api"})=>{const[c,y]=n.useState(!0),[d,m]=n.useState(!1),[p,x]=n.useState(!1),u=`${j}/images/${o}/thumbnail`,t=()=>{y(!1),m(!1)},a=()=>{y(!1),m(!0)},N=()=>{r?r():g&&x(!p)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`relative ${le[v]} bg-gray-100 rounded-lg overflow-hidden border border-gray-200 ${r||g?"cursor-pointer hover:border-blue-400 transition-colors":""}`,onClick:N,role:r||g?"button":void 0,tabIndex:r||g?0:void 0,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(r||g)&&N()},children:[c&&!d&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center",children:[e.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"text-xs text-gray-400 mt-1",children:"Loading..."})]})}),d&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"flex flex-col items-center text-gray-400",children:[e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"text-xs mt-1",children:"No preview"})]})}),e.jsx("img",{src:u,alt:s,className:`w-full h-full object-cover ${c||d?"hidden":""}`,onLoad:t,onError:a}),g&&!d&&!c&&e.jsx("div",{className:"absolute bottom-1 right-1 bg-black/50 rounded p-1",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),p&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80",onClick:()=>x(!1),role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] p-4",children:[e.jsx("img",{src:u,alt:s,className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),e.jsx("button",{className:"absolute top-2 right-2 bg-white/90 rounded-full p-2 hover:bg-white transition-colors",onClick:()=>x(!1),"aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]})},oe=["grey","heat","cool","rainbow","viridis","plasma","magma","inferno","cubehelix","red","green","blue"],ce=["linear","log","sqrt","squared","asinh","sinh","histeq","power"],de=({colorMap:o,scale:s,contrast:v,bias:r,showRegions:g,showCrosshair:j,onChange:c,onZoomIn:y,onZoomOut:d,onZoomFit:m,onExport:p})=>{const[x,u]=n.useState(!0);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>u(!x),className:"w-full flex items-center justify-between px-3 py-2 bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-700",children:"Display Settings"}),e.jsx("svg",{className:`w-4 h-4 text-gray-500 transition-transform ${x?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),x&&e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,className:"flex-1 px-2 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded transition-colors",title:"Zoom in",children:e.jsx("svg",{className:"w-4 h-4 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})})}),e.jsx("button",{onClick:d,className:"flex-1 px-2 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded transition-colors",title:"Zoom out",children:e.jsx("svg",{className:"w-4 h-4 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM7 10h6"})})}),e.jsx("button",{onClick:m,className:"flex-1 px-2 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded transition-colors",title:"Fit to window",children:e.jsx("svg",{className:"w-4 h-4 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Color Map"}),e.jsx("select",{value:o,onChange:t=>c({colorMap:t.target.value}),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm",children:oe.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Scale"}),e.jsx("select",{value:s,onChange:t=>c({scale:t.target.value}),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-sm",children:ce.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"Contrast"}),e.jsxs("span",{className:"text-gray-400",children:[(v*100).toFixed(0),"%"]})]}),e.jsx("input",{type:"range",min:0,max:1,step:.01,value:v,onChange:t=>c({contrast:parseFloat(t.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"Bias"}),e.jsxs("span",{className:"text-gray-400",children:[(r*100).toFixed(0),"%"]})]}),e.jsx("input",{type:"range",min:0,max:1,step:.01,value:r,onChange:t=>c({bias:parseFloat(t.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-100",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:t=>c({showRegions:t.target.checked}),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Show regions"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:t=>c({showCrosshair:t.target.checked}),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Show crosshair"})]})]}),p&&e.jsxs("div",{className:"flex gap-2 pt-2 border-t border-gray-100",children:[e.jsx("button",{onClick:()=>p("png"),className:"flex-1 px-2 py-1.5 text-sm bg-primary text-white rounded hover:bg-primary-dark transition-colors",children:"Export PNG"}),e.jsx("button",{onClick:()=>p("fits"),className:"flex-1 px-2 py-1.5 text-sm border border-primary text-primary rounded hover:bg-primary/10 transition-colors",children:"Export FITS"})]})]})]})},me=({fitsUrl:o,displayId:s="JS9",width:v=512,height:r=512,showControls:g=!0,initialCenter:j,initialFov:c,onCoordinateClick:y,onLoad:d,onError:m,className:p=""})=>{var q;const x=n.useRef(null),[u,t]=n.useState(!0),[a,N]=n.useState(null),[h,_]=n.useState(!1),[b,k]=n.useState(null),M=n.useRef(null),[f,F]=n.useState({colorMap:"grey",scale:"log",contrast:.5,bias:.5,showRegions:!0,showCrosshair:!1});M.current===null&&(M.current={...f}),n.useEffect(()=>{const i=()=>window.JS9&&window.JS9.Load?(_(!0),!0):!1;if(i())return;const w=setInterval(()=>{i()&&clearInterval(w)},100),J=setTimeout(()=>{clearInterval(w),h||(N("JS9 library failed to load. Make sure JS9 CDN is included."),t(!1))},1e4);return()=>{clearInterval(w),clearTimeout(J)}},[h]),n.useEffect(()=>{if(!(!h||!o)){t(!0),N(null);try{window.JS9.Load(o,{display:s,onload:i=>{t(!1),j&&window.JS9.SetPan(j.ra,j.dec,{display:s}),c&&window.JS9.SetZoom("tofit",{display:s});const w=M.current;w&&(window.JS9.SetColormap(w.colorMap,{display:s}),window.JS9.SetScale(w.scale,{display:s})),d==null||d()},onerror:i=>{N(i||"Failed to load FITS file"),t(!1),m==null||m(i)}}),y&&window.JS9.SetCallback("onclick",(i,w,J)=>{const S=window.JS9.PixToWCS(J.x,J.y,{display:s});S&&y(S.ra,S.dec)},{display:s}),window.JS9.SetCallback("onmousemove",(i,w,J)=>{try{const S=window.JS9.PixToWCS(J.x,J.y,{display:s});if(S&&S.ra!==void 0&&S.dec!==void 0){const A=S.ra/15,I=Math.floor(A),B=Math.floor((A-I)*60),W=((A-I)*60-B)*60,Z=`${I.toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}:${W.toFixed(2).padStart(5,"0")}`,O=S.dec>=0?"+":"-",V=Math.abs(S.dec),E=Math.floor(V),R=Math.floor((V-E)*60),z=((V-E)*60-R)*60,H=`${O}${E.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}:${z.toFixed(1).padStart(4,"0")}`;k({ra:Z,dec:H})}}catch{}},{display:s})}catch(i){N(String(i)),t(!1),m==null||m(String(i))}return()=>{var i;(i=window.JS9)!=null&&i.CloseImage&&window.JS9.CloseImage({display:s})}}},[h,o,s,j,c,d,m,y]),n.useEffect(()=>{if(!(!h||u))try{window.JS9.SetColormap(f.colorMap,{display:s}),window.JS9.SetScale(f.scale,{display:s}),window.JS9.SetParam("contrast",f.contrast,{display:s}),window.JS9.SetParam("bias",f.bias,{display:s});try{const i=window.JS9.GetRegions("all",{display:s});i&&i.length>0&&i.forEach(w=>{window.JS9.ChangeRegions(w.id,{visibility:f.showRegions},{display:s})})}catch(i){console.debug("Region visibility toggle:",i)}window.JS9.SetParam("crosshair",f.showCrosshair,{display:s})}catch(i){console.warn("Failed to apply JS9 settings:",i)}},[f,h,u,s]);const T=n.useCallback(()=>{window.JS9&&window.JS9.SetZoom("in",{display:s})},[s]),D=n.useCallback(()=>{window.JS9&&window.JS9.SetZoom("out",{display:s})},[s]),P=n.useCallback(()=>{window.JS9&&window.JS9.SetZoom("tofit",{display:s})},[s]),$=n.useCallback(i=>{window.JS9&&(i==="png"?window.JS9.SavePNG({display:s}):window.JS9.SaveFITS({display:s}))},[s]),l=i=>{F(w=>({...w,...i}))};return e.jsxs("div",{className:`flex gap-4 ${p}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{ref:x,className:"relative bg-black rounded-lg overflow-hidden",style:{width:v,height:r},children:[e.jsx("div",{className:"JS9",id:s,style:{width:"100%",height:"100%"}}),u&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("span",{className:"text-white text-sm",children:"Loading FITS..."})]})}),a&&e.jsx("div",{className:"absolute inset-0 bg-red-900/80 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-8 h-8 text-red-300 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-red-100 text-sm",children:a})]})}),!h&&!u&&!a&&e.jsx("div",{className:"absolute inset-0 bg-gray-800 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-300 text-sm",children:"JS9 library not loaded. Add the following to your index.html:"}),e.jsx("code",{className:"text-xs text-gray-400 mt-2 block",children:'<script src="https://js9.si.edu/js9/js9.min.js"><\/script>'})]})})]}),e.jsxs("div",{className:"mt-2 flex justify-between items-center text-xs text-gray-500 bg-gray-100 rounded px-2 py-1",children:[e.jsx("span",{className:"font-mono",children:b?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-700",children:"RA:"})," ",b.ra," ",e.jsx("span",{className:"text-gray-700 ml-2",children:"Dec:"})," ",b.dec]}):e.jsx("span",{className:"text-gray-400",children:"Move cursor over image for coordinates"})}),e.jsx("span",{className:"text-gray-400 truncate max-w-[150px]",title:o,children:((q=o.split("/").pop())==null?void 0:q.substring(0,25))||"No file"})]})]}),g&&e.jsx("div",{className:"w-48 flex-shrink-0",children:e.jsx(de,{...f,onChange:l,onZoomIn:T,onZoomOut:D,onZoomFit:P,onExport:$})})]})},xe=[{value:"true",label:"True",color:"bg-green-500"},{value:"false",label:"False",color:"bg-red-500"},{value:"unsure",label:"Unsure",color:"bg-yellow-500"}],he=({itemId:o,itemName:s,tags:v,previousRating:r,onSubmit:g,onNextUnrated:j,onCreateTag:c,isLoading:y=!1,className:d=""})=>{var $;const[m,p]=n.useState((r==null?void 0:r.confidence)||"false"),[x,u]=n.useState((r==null?void 0:r.tag.id)||(($=v[0])==null?void 0:$.id)||""),[t,a]=n.useState((r==null?void 0:r.notes)||""),[N,h]=n.useState(!1),[_,b]=n.useState(!1),[k,M]=n.useState(""),[f,F]=n.useState(""),T=n.useCallback(async l=>{if(l.preventDefault(),!!x){h(!0);try{await g({itemId:o,confidence:m,tagId:x,notes:t})}finally{h(!1)}}},[o,m,x,t,g]),D=n.useCallback(async()=>{if(!(!k.trim()||!c))try{const l=await c(k.trim(),f.trim());u(l.id),M(""),F(""),b(!1)}catch(l){console.error("Failed to create tag:",l)}},[k,f,c]),P=l=>new Date(l).toLocaleString();return e.jsxs("div",{className:`card ${d}`,children:[e.jsx("div",{className:"card-header",children:e.jsxs("h4",{className:"text-lg font-semibold",children:["Rate: ",s]})}),e.jsxs("div",{className:"card-body space-y-4",children:[r&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Your previous rating:"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"font-medium",children:"Real variable?"}),e.jsx("span",{className:`badge ${r.confidence==="true"?"badge-success":r.confidence==="false"?"badge-error":"badge-warning"}`,children:r.confidence.charAt(0).toUpperCase()+r.confidence.slice(1)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"font-medium",children:"Tag:"}),e.jsx("span",{className:"badge badge-info",children:r.tag.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{children:P(r.date)})]}),r.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Notes:"}),e.jsx("p",{className:"mt-1 text-gray-600 bg-white p-2 rounded border max-h-24 overflow-y-auto",children:r.notes})]})]})]}),e.jsx("hr",{className:"border-gray-200"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Real variable?"}),e.jsx("div",{className:"flex gap-2",children:xe.map(l=>e.jsx("button",{type:"button",onClick:()=>p(l.value),className:`flex-1 py-2 px-3 rounded-md font-medium transition-all ${m===l.value?`${l.color} text-white shadow-md`:"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:l.label},l.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Classification Tag"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:x,onChange:l=>u(l.target.value),className:"form-select flex-1",children:[e.jsx("option",{value:"",children:"Select a tag..."}),v.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),c&&e.jsx("button",{type:"button",onClick:()=>b(!_),className:"btn btn-success btn-sm",title:"Create new tag",children:"+"})]})]}),_&&c&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200 space-y-2",children:[e.jsx("input",{type:"text",value:k,onChange:l=>M(l.target.value),placeholder:"Tag name",className:"form-control"}),e.jsx("textarea",{value:f,onChange:l=>F(l.target.value),placeholder:"Description (optional)",rows:2,className:"form-control"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn btn-secondary btn-sm",children:"Cancel"}),e.jsx("button",{type:"button",onClick:D,disabled:!k.trim(),className:"btn btn-primary btn-sm",children:"Add Tag"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Notes"}),e.jsx("textarea",{value:t,onChange:l=>a(l.target.value),placeholder:"Add any observations or notes...",rows:4,className:"form-control"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{type:"submit",disabled:N||y||!x,className:"btn btn-primary w-full",children:N?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):r?"Update Rating":"Submit Rating"}),j&&e.jsx("button",{type:"button",onClick:j,className:"btn btn-success w-full",children:"Next Unrated Candidate â†’"})]})]})]})]})},Ne=()=>{var _;const{imageId:o}=U(),{data:s,isLoading:v,error:r,refetch:g}=ne(o),j=X(b=>b.addRecentImage),[c,y]=n.useState(!0),[d,m]=n.useState(!1),[p,x]=n.useState(!1),u=[{id:"artifact",name:"Artifact",color:"#EF4444",description:"Image contains artifacts"},{id:"good",name:"Good Quality",color:"#22C55E",description:"Image passes QA"},{id:"marginal",name:"Marginal",color:"#F59E0B",description:"Borderline quality"},{id:"rfi",name:"RFI",color:"#8B5CF6",description:"Radio frequency interference"}],t=async b=>{await fetch(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/images/${b.itemId}/rating`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}),g()};if(Q.useEffect(()=>{s&&o&&j(o)},[s,o,j]),v)return e.jsx(ee,{label:"Loading image details..."});if(r)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx(G,{error:r,onRetry:()=>g()})});if(!s)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs(C,{children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"Image not found."}),e.jsx(L,{to:"/images",className:"link",children:"Back to Images"})]})});const a=s,N=te(a),h=((_=s.path)==null?void 0:_.split("/").pop())||s.id;return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(L,{to:"/images",className:"text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block",children:"Back to Images"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:h}),e.jsx(K,{...N})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 sticky-sidebar",children:[e.jsx(C,{title:"Preview",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ie,{imageId:o||"",size:"lg",alt:h})})}),e.jsx(C,{title:"Actions",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("a",{href:`https://ronnie-unsectarian-antone.ngrok-free.dev/api/images/${o}/fits`,target:"_blank",rel:"noreferrer",className:"btn btn-primary text-center",children:"Download FITS"}),e.jsxs("button",{type:"button",className:`btn ${d?"btn-primary":"btn-secondary"}`,onClick:()=>m(!d),children:[d?"Hide":"Show"," FITS Viewer"]}),e.jsxs("button",{type:"button",className:`btn ${p?"btn-primary":"btn-secondary"}`,onClick:()=>x(!p),children:[p?"Hide":"Show"," Rating"]}),a.qa_grade&&e.jsx(L,{to:`/qa/image/${o}`,className:"btn btn-secondary text-center",children:"View QA Report"})]})})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[d&&e.jsx(C,{title:"FITS Viewer",children:e.jsx(me,{fitsUrl:`https://ronnie-unsectarian-antone.ngrok-free.dev/api/images/${o}/fits`,displayId:`fits-${o}`,width:600,height:500,showControls:!0,initialCenter:a.pointing_ra_deg!=null&&a.pointing_dec_deg!=null?{ra:a.pointing_ra_deg,dec:a.pointing_dec_deg}:void 0})}),p&&e.jsx(C,{title:"Image Rating",children:e.jsx(he,{itemId:o||"",itemName:h,tags:u,previousRating:a.qa_grade?{id:`rating-${o}`,confidence:a.qa_grade==="good"?"true":a.qa_grade==="fail"?"false":"unsure",tag:u.find(b=>b.id===(a.qa_grade==="good"?"good":a.qa_grade==="fail"?"artifact":"marginal"))||u[0],user:"system",date:a.created_at||new Date().toISOString()}:void 0,onSubmit:t})}),(a.qa_grade||a.noise_jy||a.dynamic_range)&&e.jsx(C,{title:"Quality Assessment",children:e.jsx(se,{grade:a.qa_grade,summary:a.qa_summary,noiseJy:a.noise_jy,dynamicRange:a.dynamic_range,beamMajorArcsec:a.beam_major_arcsec,beamMinorArcsec:a.beam_minor_arcsec,beamPaDeg:a.beam_pa_deg})}),a.pointing_ra_deg!=null&&a.pointing_dec_deg!=null&&e.jsxs(C,{title:"Pointing",subtitle:e.jsx("button",{type:"button",onClick:()=>y(!c),className:"text-xs text-blue-600 hover:text-blue-800",children:c?"Hide Sky View":"Show Sky View"}),children:[e.jsx(Y,{raDeg:a.pointing_ra_deg,decDeg:a.pointing_dec_deg,showDecimal:!0,allowFormatToggle:!0}),c&&e.jsx("div",{className:"mt-4",children:e.jsx(ae,{raDeg:a.pointing_ra_deg,decDeg:a.pointing_dec_deg,fov:.5,height:250,className:"rounded-lg overflow-hidden"})})]}),e.jsx(C,{title:"Metadata",children:e.jsxs("dl",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Image ID"}),e.jsx("dd",{className:"font-mono text-sm text-gray-900 break-all",children:s.id})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created"}),e.jsx("dd",{className:"text-sm text-gray-900",children:s.created_at?e.jsxs(e.Fragment,{children:[new Date(s.created_at).toLocaleString(),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",re(s.created_at),")"]})]}):e.jsx("span",{className:"text-gray-400",children:"Unknown"})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Path"}),e.jsx("dd",{className:"font-mono text-sm text-gray-900 break-all",children:s.path})]}),s.ms_path&&e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Source Measurement Set"}),e.jsx("dd",{className:"font-mono text-sm break-all",children:e.jsx(L,{to:`/ms/${encodeURIComponent(s.ms_path)}`,className:"text-blue-600 hover:text-blue-800 hover:underline",children:s.ms_path})})]}),s.cal_table&&e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Calibration Table"}),e.jsx("dd",{className:"font-mono text-sm text-gray-900 break-all",children:s.cal_table})]}),s.run_id&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Pipeline Run"}),e.jsx("dd",{className:"text-sm",children:e.jsx(L,{to:`/jobs/${s.run_id}`,className:"text-blue-600 hover:text-blue-800 hover:underline",children:s.run_id})})]})]})})]})]})]})};export{Ne as default};
//# sourceMappingURL=ImageDetailPage-DHISEv8R.js.map
