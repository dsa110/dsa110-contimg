{"version":3,"file":"ImagesListPage-BKj4j8Sg.js","sources":["../../src/components/fits/FitsViewerGrid.tsx","../../src/components/download/BulkDownloadPanel.tsx","../../src/components/filters/FilterPanel.tsx","../../src/pages/ImagesListPage.tsx"],"sourcesContent":["import React, { useState, useCallback, useEffect } from \"react\";\nimport FitsViewer, { FitsViewerProps } from \"./FitsViewer\";\n\nexport interface FitsViewerGridProps {\n  /** Array of FITS URLs to display */\n  fitsUrls: string[];\n  /** Number of columns in grid */\n  columns?: 1 | 2 | 3 | 4;\n  /** Size of each viewer */\n  viewerSize?: number;\n  /** Whether to synchronize pan/zoom across viewers */\n  syncViews?: boolean;\n  /** Labels for each panel */\n  labels?: string[];\n  /** Callback on coordinate click (with panel index) */\n  onCoordinateClick?: (ra: number, dec: number, panelIndex: number) => void;\n  /** Custom class name */\n  className?: string;\n}\n\n/**\n * Grid layout for multiple synchronized FITS viewers.\n * Useful for comparing images at different frequencies or epochs.\n */\nconst FitsViewerGrid: React.FC<FitsViewerGridProps> = ({\n  fitsUrls,\n  columns = 2,\n  viewerSize = 300,\n  syncViews: initialSyncViews = true,\n  labels,\n  onCoordinateClick,\n  className = \"\",\n}) => {\n  const [loadedCount, setLoadedCount] = useState(0);\n  const [syncEnabled, setSyncEnabled] = useState(initialSyncViews);\n  const [syncState, setSyncState] = useState<{\n    zoom?: number;\n    pan?: { x: number; y: number };\n  }>({});\n\n  // Handle sync across viewers\n  const handleSync = useCallback(() => {\n    if (!syncEnabled || !window.JS9) return;\n\n    // Get state from first viewer\n    const firstDisplayId = `JS9Grid_0`;\n    try {\n      const zoom = window.JS9.GetZoom({ display: firstDisplayId });\n      const pan = window.JS9.GetPan({ display: firstDisplayId });\n\n      if (zoom && pan) {\n        // Apply to all other viewers\n        for (let i = 1; i < fitsUrls.length; i++) {\n          const displayId = `JS9Grid_${i}`;\n          window.JS9.SetZoom(zoom, { display: displayId });\n          window.JS9.SetPan(pan.x, pan.y, { display: displayId });\n        }\n      }\n    } catch (err) {\n      console.warn(\"Failed to sync views:\", err);\n    }\n  }, [syncViews, fitsUrls.length]);\n\n  // Set up sync event listeners\n  useEffect(() => {\n    if (!syncEnabled || loadedCount < fitsUrls.length) return;\n\n    const handleChange = () => {\n      handleSync();\n    };\n\n    // Set up callbacks on first viewer\n    if (window.JS9) {\n      window.JS9.SetCallback(\"onzoom\", handleChange, { display: \"JS9Grid_0\" });\n      window.JS9.SetCallback(\"onpan\", handleChange, { display: \"JS9Grid_0\" });\n    }\n\n    return () => {\n      if (window.JS9) {\n        window.JS9.SetCallback(\"onzoom\", null, { display: \"JS9Grid_0\" });\n        window.JS9.SetCallback(\"onpan\", null, { display: \"JS9Grid_0\" });\n      }\n    };\n  }, [syncViews, loadedCount, fitsUrls.length, handleSync]);\n\n  const handleLoad = () => {\n    setLoadedCount((prev) => prev + 1);\n  };\n\n  const getGridClass = () => {\n    switch (columns) {\n      case 1:\n        return \"grid-cols-1\";\n      case 2:\n        return \"grid-cols-2\";\n      case 3:\n        return \"grid-cols-3\";\n      case 4:\n        return \"grid-cols-4\";\n      default:\n        return \"grid-cols-2\";\n    }\n  };\n\n  if (fitsUrls.length === 0) {\n    return <div className=\"text-center text-gray-500 py-8\">No FITS files to display</div>;\n  }\n\n  return (\n    <div className={className}>\n      {/* Header with sync toggle */}\n      <div className=\"flex items-center justify-between mb-3\">\n        <span className=\"text-sm text-gray-600\">\n          {loadedCount}/{fitsUrls.length} images loaded\n        </span>\n        <label className=\"flex items-center gap-2 text-sm cursor-pointer\">\n          <input\n            type=\"checkbox\"\n            checked={syncEnabled}\n            onChange={(e) => setSyncEnabled(e.target.checked)}\n            className=\"w-4 h-4 rounded accent-primary\"\n          />\n          <span>Sync views</span>\n        </label>\n      </div>\n\n      {/* Grid of viewers */}\n      <div className={`grid ${getGridClass()} gap-4`}>\n        {fitsUrls.map((url, index) => (\n          <div key={`${url}-${index}`} className=\"relative\">\n            {/* Label */}\n            {labels && labels[index] && (\n              <div className=\"absolute top-2 left-2 z-10 bg-black/70 text-white text-xs px-2 py-1 rounded\">\n                {labels[index]}\n              </div>\n            )}\n\n            {/* Viewer */}\n            <FitsViewer\n              fitsUrl={url}\n              displayId={`JS9Grid_${index}`}\n              width={viewerSize}\n              height={viewerSize}\n              showControls={false}\n              onLoad={handleLoad}\n              onCoordinateClick={\n                onCoordinateClick ? (ra, dec) => onCoordinateClick(ra, dec, index) : undefined\n              }\n            />\n          </div>\n        ))}\n      </div>\n\n      {/* Shared controls */}\n      <div className=\"mt-4 p-3 bg-gray-50 rounded-lg\">\n        <div className=\"flex items-center gap-4\">\n          <span className=\"text-sm font-medium text-gray-700\">Grid Controls:</span>\n          <button\n            onClick={() => {\n              if (window.JS9) {\n                for (let i = 0; i < fitsUrls.length; i++) {\n                  window.JS9.SetZoom(\"tofit\", { display: `JS9Grid_${i}` });\n                }\n              }\n            }}\n            className=\"px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100 transition-colors\"\n          >\n            Fit All\n          </button>\n          <button\n            onClick={() => {\n              if (window.JS9) {\n                for (let i = 0; i < fitsUrls.length; i++) {\n                  window.JS9.SetZoom(\"in\", { display: `JS9Grid_${i}` });\n                }\n              }\n            }}\n            className=\"px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100 transition-colors\"\n          >\n            Zoom In All\n          </button>\n          <button\n            onClick={() => {\n              if (window.JS9) {\n                for (let i = 0; i < fitsUrls.length; i++) {\n                  window.JS9.SetZoom(\"out\", { display: `JS9Grid_${i}` });\n                }\n              }\n            }}\n            className=\"px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100 transition-colors\"\n          >\n            Zoom Out All\n          </button>\n          <select\n            onChange={(e) => {\n              if (window.JS9 && e.target.value) {\n                for (let i = 0; i < fitsUrls.length; i++) {\n                  window.JS9.SetColormap(e.target.value, {\n                    display: `JS9Grid_${i}`,\n                  });\n                }\n              }\n            }}\n            className=\"px-2 py-1 text-sm border border-gray-300 rounded\"\n            defaultValue=\"\"\n          >\n            <option value=\"\" disabled>\n              Color map...\n            </option>\n            <option value=\"grey\">Grey</option>\n            <option value=\"heat\">Heat</option>\n            <option value=\"cool\">Cool</option>\n            <option value=\"viridis\">Viridis</option>\n            <option value=\"rainbow\">Rainbow</option>\n          </select>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default FitsViewerGrid;\n","import React, { useState, useCallback } from \"react\";\n\nexport interface DownloadItem {\n  id: string;\n  name: string;\n  type?: string;\n}\n\nexport interface BulkDownloadPanelProps {\n  /** All available items for download */\n  items: DownloadItem[];\n  /** Currently selected item IDs */\n  selectedIds: string[];\n  /** Callback when selection changes */\n  onSelectionChange: (ids: string[]) => void;\n  /** Callback to trigger download */\n  onDownload: (ids: string[], format: DownloadFormat) => Promise<void>;\n  /** Custom class name */\n  className?: string;\n  /** Disable the panel */\n  disabled?: boolean;\n}\n\nexport type DownloadFormat = \"fits\" | \"csv\" | \"zip\" | \"json\";\n\nconst FORMAT_OPTIONS: { value: DownloadFormat; label: string }[] = [\n  { value: \"fits\", label: \"FITS\" },\n  { value: \"csv\", label: \"CSV\" },\n  { value: \"json\", label: \"JSON\" },\n  { value: \"zip\", label: \"ZIP Archive\" },\n];\n\n/**\n * Bulk download panel for selecting and exporting multiple items.\n */\nconst BulkDownloadPanel: React.FC<BulkDownloadPanelProps> = ({\n  items,\n  selectedIds,\n  onSelectionChange,\n  onDownload,\n  className = \"\",\n  disabled = false,\n}) => {\n  const [format, setFormat] = useState<DownloadFormat>(\"fits\");\n  const [isDownloading, setIsDownloading] = useState(false);\n\n  const handleSelectAll = useCallback(() => {\n    if (selectedIds.length === items.length) {\n      onSelectionChange([]);\n    } else {\n      onSelectionChange(items.map((i) => i.id));\n    }\n  }, [items, selectedIds.length, onSelectionChange]);\n\n  const handleToggleItem = useCallback(\n    (id: string) => {\n      if (selectedIds.includes(id)) {\n        onSelectionChange(selectedIds.filter((i) => i !== id));\n      } else {\n        onSelectionChange([...selectedIds, id]);\n      }\n    },\n    [selectedIds, onSelectionChange]\n  );\n\n  const handleDownload = useCallback(async () => {\n    if (selectedIds.length === 0) return;\n\n    setIsDownloading(true);\n    try {\n      await onDownload(selectedIds, format);\n    } finally {\n      setIsDownloading(false);\n    }\n  }, [selectedIds, format, onDownload]);\n\n  const isAllSelected = selectedIds.length === items.length && items.length > 0;\n  const isSomeSelected = selectedIds.length > 0 && selectedIds.length < items.length;\n\n  return (\n    <div className={`card ${className}`}>\n      <div className=\"card-header flex items-center justify-between\">\n        <h4 className=\"text-lg font-semibold\">Bulk Download</h4>\n        <span className=\"text-sm text-gray-500\">\n          {selectedIds.length} of {items.length} selected\n        </span>\n      </div>\n\n      <div className=\"card-body space-y-4\">\n        {/* Selection Controls */}\n        <div className=\"flex items-center gap-4\">\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              checked={isAllSelected}\n              ref={(el) => {\n                if (el) el.indeterminate = isSomeSelected;\n              }}\n              onChange={handleSelectAll}\n              disabled={disabled || items.length === 0}\n              className=\"w-4 h-4 text-vast-green rounded border-gray-300 focus:ring-vast-green\"\n            />\n            <span className=\"text-sm\">Select All</span>\n          </label>\n\n          {selectedIds.length > 0 && (\n            <button\n              onClick={() => onSelectionChange([])}\n              className=\"text-sm text-gray-500 hover:text-red-500\"\n            >\n              Clear selection\n            </button>\n          )}\n        </div>\n\n        {/* Format Selection */}\n        <div className=\"form-group\">\n          <label className=\"form-label\">Export Format</label>\n          <div className=\"grid grid-cols-4 gap-2\">\n            {FORMAT_OPTIONS.map((opt) => (\n              <button\n                key={opt.value}\n                onClick={() => setFormat(opt.value)}\n                disabled={disabled}\n                className={`py-2 px-3 rounded-md text-sm font-medium transition-all ${\n                  format === opt.value\n                    ? \"bg-vast-green text-white shadow-md\"\n                    : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\n                }`}\n              >\n                {opt.label}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Selected Items Preview */}\n        {selectedIds.length > 0 && (\n          <div className=\"bg-gray-50 rounded-lg p-3 max-h-40 overflow-y-auto\">\n            <p className=\"text-xs text-gray-500 mb-2\">Selected items:</p>\n            <div className=\"flex flex-wrap gap-1\">\n              {selectedIds.slice(0, 10).map((id) => {\n                const item = items.find((i) => i.id === id);\n                return (\n                  <span key={id} className=\"badge badge-secondary flex items-center gap-1\">\n                    {item?.name || id}\n                    <button onClick={() => handleToggleItem(id)} className=\"hover:text-red-500\">\n                      ×\n                    </button>\n                  </span>\n                );\n              })}\n              {selectedIds.length > 10 && (\n                <span className=\"badge badge-info\">+{selectedIds.length - 10} more</span>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Download Button */}\n        <button\n          onClick={handleDownload}\n          disabled={disabled || selectedIds.length === 0 || isDownloading}\n          className=\"btn btn-primary w-full\"\n        >\n          {isDownloading ? (\n            <span className=\"flex items-center justify-center gap-2\">\n              <span className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n              Preparing Download...\n            </span>\n          ) : (\n            <>\n              Download {selectedIds.length} item{selectedIds.length !== 1 ? \"s\" : \"\"} as{\" \"}\n              {format.toUpperCase()}\n            </>\n          )}\n        </button>\n\n        {/* Format Info */}\n        <div className=\"text-xs text-gray-500\">\n          {format === \"fits\" && \"Download raw FITS files individually.\"}\n          {format === \"csv\" && \"Export metadata as CSV spreadsheet.\"}\n          {format === \"json\" && \"Export metadata as JSON.\"}\n          {format === \"zip\" && \"Download all files in a single ZIP archive.\"}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default BulkDownloadPanel;\n","import React, { useState, useCallback, useMemo } from \"react\";\nimport { RangeSlider } from \"../widgets\";\n\nexport interface FilterConfig {\n  id: string;\n  label: string;\n  type: \"range\" | \"select\" | \"checkbox\" | \"text\";\n  min?: number;\n  max?: number;\n  step?: number;\n  unit?: string;\n  options?: { value: string; label: string }[];\n  defaultValue?: string | number | boolean | [number, number];\n  histogram?: number[];\n}\n\nexport interface FilterValues {\n  [key: string]: string | number | boolean | [number, number] | undefined;\n}\n\nexport interface FilterPanelProps {\n  /** Filter configurations */\n  filters: FilterConfig[];\n  /** Current filter values */\n  values: FilterValues;\n  /** Callback when filters change */\n  onChange: (values: FilterValues) => void;\n  /** Title for the panel */\n  title?: string;\n  /** Collapsible sections */\n  collapsible?: boolean;\n  /** Initially collapsed */\n  defaultCollapsed?: boolean;\n  /** Custom class name */\n  className?: string;\n}\n\n/**\n * Collapsible filter panel with support for range sliders, selects, and checkboxes.\n * Inspired by VASTER webapp's accordion filter design.\n */\nconst FilterPanel: React.FC<FilterPanelProps> = ({\n  filters,\n  values,\n  onChange,\n  title = \"Filters\",\n  collapsible = true,\n  defaultCollapsed = false,\n  className = \"\",\n}) => {\n  const [isCollapsed, setIsCollapsed] = useState(defaultCollapsed);\n  const [expandedSections, setExpandedSections] = useState<Record<string, boolean>>({});\n\n  const handleFilterChange = useCallback(\n    (filterId: string, value: FilterValues[string]) => {\n      onChange({ ...values, [filterId]: value });\n    },\n    [values, onChange]\n  );\n\n  const handleRangeChange = useCallback(\n    (filterId: string, min: number, max: number) => {\n      onChange({ ...values, [filterId]: [min, max] });\n    },\n    [values, onChange]\n  );\n\n  const handleReset = useCallback(() => {\n    const resetValues: FilterValues = {};\n    filters.forEach((filter) => {\n      if (filter.defaultValue !== undefined) {\n        resetValues[filter.id] = filter.defaultValue;\n      }\n    });\n    onChange(resetValues);\n  }, [filters, onChange]);\n\n  const toggleSection = useCallback((sectionId: string) => {\n    setExpandedSections((prev) => ({\n      ...prev,\n      [sectionId]: !prev[sectionId],\n    }));\n  }, []);\n\n  const activeFilterCount = useMemo(() => {\n    return Object.entries(values).filter(([key, value]) => {\n      const filter = filters.find((f) => f.id === key);\n      if (!filter) return false;\n\n      if (filter.type === \"range\" && Array.isArray(value)) {\n        return value[0] !== filter.min || value[1] !== filter.max;\n      }\n\n      if (filter.defaultValue !== undefined) {\n        return value !== filter.defaultValue;\n      }\n\n      return value !== undefined && value !== \"\" && value !== false;\n    }).length;\n  }, [values, filters]);\n\n  const renderFilter = (filter: FilterConfig) => {\n    const value = values[filter.id];\n\n    switch (filter.type) {\n      case \"range\": {\n        const rangeValue = Array.isArray(value) ? value : [filter.min ?? 0, filter.max ?? 100];\n        return (\n          <RangeSlider\n            key={filter.id}\n            min={filter.min ?? 0}\n            max={filter.max ?? 100}\n            step={filter.step ?? 1}\n            minValue={rangeValue[0]}\n            maxValue={rangeValue[1]}\n            label={filter.label}\n            unit={filter.unit}\n            histogram={filter.histogram}\n            onChange={(min, max) => handleRangeChange(filter.id, min, max)}\n            showInputs={true}\n          />\n        );\n      }\n\n      case \"select\":\n        return (\n          <div key={filter.id} className=\"space-y-1\">\n            <label className=\"text-sm font-medium text-gray-700\">{filter.label}</label>\n            <select\n              value={String(value ?? \"\")}\n              onChange={(e) => handleFilterChange(filter.id, e.target.value || undefined)}\n              className=\"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n            >\n              <option value=\"\">All</option>\n              {filter.options?.map((opt) => (\n                <option key={opt.value} value={opt.value}>\n                  {opt.label}\n                </option>\n              ))}\n            </select>\n          </div>\n        );\n\n      case \"checkbox\":\n        return (\n          <label key={filter.id} className=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              checked={Boolean(value)}\n              onChange={(e) => handleFilterChange(filter.id, e.target.checked)}\n              className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n            />\n            <span className=\"text-sm text-gray-700\">{filter.label}</span>\n          </label>\n        );\n\n      case \"text\":\n        return (\n          <div key={filter.id} className=\"space-y-1\">\n            <label className=\"text-sm font-medium text-gray-700\">{filter.label}</label>\n            <input\n              type=\"text\"\n              value={String(value ?? \"\")}\n              onChange={(e) => handleFilterChange(filter.id, e.target.value || undefined)}\n              placeholder={`Filter by ${filter.label.toLowerCase()}...`}\n              className=\"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500\"\n            />\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className={`bg-white rounded-lg border border-gray-200 shadow-sm ${className}`}>\n      {/* Header */}\n      <div\n        className={`flex items-center justify-between px-4 py-3 ${\n          collapsible ? \"cursor-pointer hover:bg-gray-50\" : \"\"\n        } ${!isCollapsed ? \"border-b border-gray-200\" : \"\"}`}\n        onClick={collapsible ? () => setIsCollapsed(!isCollapsed) : undefined}\n      >\n        <div className=\"flex items-center gap-2\">\n          {collapsible && (\n            <svg\n              className={`w-4 h-4 text-gray-500 transition-transform ${\n                isCollapsed ? \"\" : \"rotate-90\"\n              }`}\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M9 5l7 7-7 7\"\n              />\n            </svg>\n          )}\n          <h3 className=\"text-sm font-medium text-gray-900\">{title}</h3>\n          {activeFilterCount > 0 && (\n            <span className=\"px-2 py-0.5 text-xs font-medium text-blue-700 bg-blue-100 rounded-full\">\n              {activeFilterCount}\n            </span>\n          )}\n        </div>\n        {!isCollapsed && activeFilterCount > 0 && (\n          <button\n            type=\"button\"\n            onClick={(e) => {\n              e.stopPropagation();\n              handleReset();\n            }}\n            className=\"text-xs text-blue-600 hover:text-blue-800\"\n          >\n            Reset all\n          </button>\n        )}\n      </div>\n\n      {/* Filter content */}\n      {!isCollapsed && (\n        <div className=\"p-4 space-y-4\">{filters.map((filter) => renderFilter(filter))}</div>\n      )}\n    </div>\n  );\n};\n\nexport default FilterPanel;\n","import React, { useMemo, useCallback, useState } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { useImages } from \"../hooks/useQueries\";\nimport { LoadingSpinner, SortableTableHeader, useTableSort } from \"../components/common\";\nimport { BulkDownloadPanel } from \"../components/download\";\nimport { FitsViewerGrid } from \"../components/fits\";\nimport { FilterPanel, FilterConfig, FilterValues } from \"../components/filters\";\nimport { useSelectionStore } from \"../stores/appStore\";\n\ninterface ImageItem {\n  id: string;\n  path?: string;\n  qa_grade?: string;\n  created_at?: string;\n}\n\n/**\n * List page showing all images with sortable table headers.\n */\nconst ImagesListPage: React.FC = () => {\n  const { data: images, isLoading, error } = useImages();\n\n  // View mode: list or comparison\n  const [viewMode, setViewMode] = useState<\"list\" | \"compare\">(\"list\");\n\n  // Filter state\n  const [filterValues, setFilterValues] = useState<FilterValues>({});\n  const filterConfigs: FilterConfig[] = [\n    {\n      id: \"qa_grade\",\n      label: \"QA Grade\",\n      type: \"select\",\n      options: [\n        { value: \"good\", label: \"Good\" },\n        { value: \"warn\", label: \"Warning\" },\n        { value: \"fail\", label: \"Fail\" },\n      ],\n    },\n    {\n      id: \"search\",\n      label: \"Search\",\n      type: \"text\",\n    },\n  ];\n\n  // Multi-select state from store\n  const selectedImages = useSelectionStore((s) => s.selectedImages);\n  const toggleImageSelection = useSelectionStore((s) => s.toggleImageSelection);\n  const selectAllImages = useSelectionStore((s) => s.selectAllImages);\n  const clearImageSelection = useSelectionStore((s) => s.clearImageSelection);\n\n  const selectedIds = useMemo(() => Array.from(selectedImages), [selectedImages]);\n\n  const handleSelectionChange = useCallback(\n    (ids: string[]) => {\n      if (ids.length === 0) {\n        clearImageSelection();\n      } else {\n        selectAllImages(ids);\n      }\n    },\n    [clearImageSelection, selectAllImages]\n  );\n\n  const handleBulkDownload = useCallback(async (ids: string[], format: string) => {\n    const baseUrl = import.meta.env.VITE_API_URL || \"/api\";\n    const url = `${baseUrl}/images/bulk-download?ids=${ids.join(\",\")}&format=${format}`;\n    window.open(url, \"_blank\");\n  }, []);\n\n  // Apply filters\n  const filteredImages = useMemo(() => {\n    if (!images) return [];\n    let result = images as ImageItem[];\n\n    if (filterValues.qa_grade) {\n      result = result.filter((img) => img.qa_grade === filterValues.qa_grade);\n    }\n    if (filterValues.search && typeof filterValues.search === \"string\") {\n      const term = filterValues.search.toLowerCase();\n      result = result.filter(\n        (img) => img.path?.toLowerCase().includes(term) || img.id.toLowerCase().includes(term)\n      );\n    }\n\n    return result;\n  }, [images, filterValues]);\n\n  // Apply sorting using the hook with filtered data\n  const {\n    sortColumn,\n    sortDirection,\n    handleSort,\n    sortedData: sortedImages,\n  } = useTableSort<ImageItem>(filteredImages, \"created_at\", \"desc\");\n\n  if (isLoading) {\n    return <LoadingSpinner label=\"Loading images...\" />;\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\n        Failed to load images: {error.message}\n      </div>\n    );\n  }\n\n  // Prepare items for bulk download panel\n  const downloadItems = useMemo(\n    () =>\n      sortedImages.map((img) => ({\n        id: img.id,\n        name: img.path?.split(\"/\").pop() || img.id,\n        type: \"FITS\",\n      })),\n    [sortedImages]\n  );\n\n  // FITS URLs for selected images comparison\n  const comparisonUrls = useMemo(() => {\n    const baseUrl = import.meta.env.VITE_API_URL || \"/api\";\n    return selectedIds.map((id) => `${baseUrl}/images/${id}/fits`);\n  }, [selectedIds]);\n\n  const comparisonLabels = useMemo(() => {\n    return selectedIds.map((id) => {\n      const img = sortedImages.find((i) => i.id === id);\n      return img?.path?.split(\"/\").pop() || id;\n    });\n  }, [selectedIds, sortedImages]);\n\n  return (\n    <div className=\"max-w-6xl mx-auto\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center gap-4\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Images</h1>\n          {selectedIds.length > 0 && (\n            <span className=\"text-sm text-gray-500\">{selectedIds.length} selected</span>\n          )}\n        </div>\n        <div className=\"flex gap-2\">\n          {selectedIds.length >= 2 && selectedIds.length <= 4 && (\n            <button\n              onClick={() => setViewMode(viewMode === \"compare\" ? \"list\" : \"compare\")}\n              className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\n                viewMode === \"compare\"\n                  ? \"bg-purple-600 text-white\"\n                  : \"bg-gray-100 text-gray-700 hover:bg-gray-200\"\n              }`}\n            >\n              {viewMode === \"compare\" ? \"Back to List\" : \"Compare Selected\"}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Filter Panel */}\n      <div className=\"mb-4\">\n        <FilterPanel\n          filters={filterConfigs}\n          values={filterValues}\n          onChange={setFilterValues}\n          title=\"Filter Images\"\n          collapsible\n          defaultCollapsed\n        />\n      </div>\n\n      {/* Comparison View */}\n      {viewMode === \"compare\" && selectedIds.length >= 2 && (\n        <div className=\"mb-6\">\n          <div className=\"card p-4\">\n            <h3 className=\"text-lg font-semibold mb-4\">Image Comparison</h3>\n            <FitsViewerGrid\n              fitsUrls={comparisonUrls}\n              labels={comparisonLabels}\n              columns={selectedIds.length <= 2 ? 2 : selectedIds.length <= 3 ? 3 : 4}\n              viewerSize={350}\n              syncViews\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Bulk Download Panel - show when items selected */}\n      {sortedImages.length > 0 && (\n        <div className=\"mb-6\">\n          <BulkDownloadPanel\n            items={downloadItems}\n            selectedIds={selectedIds}\n            onSelectionChange={handleSelectionChange}\n            onDownload={handleBulkDownload}\n          />\n        </div>\n      )}\n\n      {sortedImages && sortedImages.length > 0 ? (\n        <div className=\"card overflow-hidden\">\n          <table className=\"table\">\n            <thead>\n              <tr>\n                <th className=\"w-10 px-3 py-3\">\n                  <input\n                    type=\"checkbox\"\n                    checked={selectedIds.length === sortedImages.length && sortedImages.length > 0}\n                    ref={(el) => {\n                      if (el)\n                        el.indeterminate =\n                          selectedIds.length > 0 && selectedIds.length < sortedImages.length;\n                    }}\n                    onChange={() => {\n                      if (selectedIds.length === sortedImages.length) {\n                        clearImageSelection();\n                      } else {\n                        selectAllImages(sortedImages.map((i) => i.id));\n                      }\n                    }}\n                    className=\"h-4 w-4 text-blue-600 rounded\"\n                  />\n                </th>\n                <SortableTableHeader\n                  columnKey=\"path\"\n                  sortColumn={sortColumn}\n                  sortDirection={sortDirection}\n                  onSort={handleSort}\n                >\n                  Name\n                </SortableTableHeader>\n                <SortableTableHeader\n                  columnKey=\"qa_grade\"\n                  sortColumn={sortColumn}\n                  sortDirection={sortDirection}\n                  onSort={handleSort}\n                  className=\"text-center\"\n                >\n                  QA Grade\n                </SortableTableHeader>\n                <SortableTableHeader\n                  columnKey=\"created_at\"\n                  sortColumn={sortColumn}\n                  sortDirection={sortDirection}\n                  onSort={handleSort}\n                  className=\"text-right\"\n                >\n                  Created\n                </SortableTableHeader>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-200\">\n              {sortedImages.map((image) => (\n                <tr key={image.id} className={selectedImages.has(image.id) ? \"bg-blue-50\" : \"\"}>\n                  <td className=\"px-3\">\n                    <input\n                      type=\"checkbox\"\n                      checked={selectedImages.has(image.id)}\n                      onChange={() => toggleImageSelection(image.id)}\n                      className=\"h-4 w-4 text-blue-600 rounded\"\n                    />\n                  </td>\n                  <td>\n                    <Link\n                      to={`/images/${image.id}`}\n                      className=\"text-blue-600 hover:text-blue-800 font-medium\"\n                    >\n                      {image.path?.split(\"/\").pop() || image.id}\n                    </Link>\n                  </td>\n                  <td className=\"text-center\">\n                    {image.qa_grade && (\n                      <span\n                        className={`badge ${\n                          image.qa_grade === \"good\"\n                            ? \"badge-success\"\n                            : image.qa_grade === \"warn\"\n                            ? \"badge-warning\"\n                            : \"badge-error\"\n                        }`}\n                      >\n                        {image.qa_grade}\n                      </span>\n                    )}\n                  </td>\n                  <td className=\"text-right text-gray-500\">\n                    {image.created_at ? new Date(image.created_at).toLocaleDateString() : \"—\"}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      ) : (\n        <p className=\"text-gray-500\">No images found.</p>\n      )}\n    </div>\n  );\n};\n\nexport default ImagesListPage;\n"],"names":["FitsViewerGrid","fitsUrls","columns","viewerSize","initialSyncViews","labels","onCoordinateClick","className","loadedCount","setLoadedCount","useState","syncEnabled","setSyncEnabled","syncState","setSyncState","handleSync","useCallback","firstDisplayId","zoom","pan","i","displayId","err","useEffect","handleChange","handleLoad","prev","getGridClass","jsx","jsxs","e","url","index","FitsViewer","ra","dec","FORMAT_OPTIONS","BulkDownloadPanel","items","selectedIds","onSelectionChange","onDownload","disabled","format","setFormat","isDownloading","setIsDownloading","handleSelectAll","handleToggleItem","id","handleDownload","isAllSelected","isSomeSelected","el","opt","item","Fragment","FilterPanel","filters","values","onChange","title","collapsible","defaultCollapsed","isCollapsed","setIsCollapsed","expandedSections","setExpandedSections","handleFilterChange","filterId","value","handleRangeChange","min","max","handleReset","resetValues","filter","sectionId","activeFilterCount","useMemo","key","f","renderFilter","rangeValue","RangeSlider","ImagesListPage","images","isLoading","error","useImages","viewMode","setViewMode","filterValues","setFilterValues","filterConfigs","selectedImages","useSelectionStore","toggleImageSelection","selectAllImages","clearImageSelection","handleSelectionChange","ids","handleBulkDownload","filteredImages","result","img","term","sortColumn","sortDirection","handleSort","sortedImages","useTableSort","LoadingSpinner","downloadItems","comparisonUrls","baseUrl","comparisonLabels","SortableTableHeader","image","Link"],"mappings":"qUAwBA,MAAMA,EAAgD,CAAC,CACrD,SAAAC,EACA,QAAAC,EAAU,EACV,WAAAC,EAAa,IACb,UAAWC,EAAmB,GAC9B,OAAAC,EACA,kBAAAC,EACA,UAAAC,EAAY,EACd,IAAM,CACJ,KAAM,CAACC,EAAaC,CAAc,EAAIC,EAAAA,SAAS,CAAC,EAC1C,CAACC,EAAaC,CAAc,EAAIF,EAAAA,SAASN,CAAgB,EACzD,CAACS,EAAWC,CAAY,EAAIJ,EAAAA,SAG/B,CAAA,CAAE,EAGCK,EAAaC,EAAAA,YAAY,IAAM,CACnC,GAAI,CAACL,GAAe,CAAC,OAAO,IAAK,OAGjC,MAAMM,EAAiB,YACvB,GAAI,CACF,MAAMC,EAAO,OAAO,IAAI,QAAQ,CAAE,QAASD,EAAgB,EACrDE,EAAM,OAAO,IAAI,OAAO,CAAE,QAASF,EAAgB,EAEzD,GAAIC,GAAQC,EAEV,QAASC,EAAI,EAAGA,EAAInB,EAAS,OAAQmB,IAAK,CACxC,MAAMC,EAAY,WAAWD,CAAC,GAC9B,OAAO,IAAI,QAAQF,EAAM,CAAE,QAASG,EAAW,EAC/C,OAAO,IAAI,OAAOF,EAAI,EAAGA,EAAI,EAAG,CAAE,QAASE,EAAW,CACxD,CAEJ,OAASC,EAAK,CACZ,QAAQ,KAAK,wBAAyBA,CAAG,CAC3C,CACF,EAAG,CAAC,UAAWrB,EAAS,MAAM,CAAC,EAG/BsB,EAAAA,UAAU,IAAM,CACd,GAAI,CAACZ,GAAeH,EAAcP,EAAS,OAAQ,OAEnD,MAAMuB,EAAe,IAAM,CACzBT,EAAA,CACF,EAGA,OAAI,OAAO,MACT,OAAO,IAAI,YAAY,SAAUS,EAAc,CAAE,QAAS,YAAa,EACvE,OAAO,IAAI,YAAY,QAASA,EAAc,CAAE,QAAS,YAAa,GAGjE,IAAM,CACP,OAAO,MACT,OAAO,IAAI,YAAY,SAAU,KAAM,CAAE,QAAS,YAAa,EAC/D,OAAO,IAAI,YAAY,QAAS,KAAM,CAAE,QAAS,YAAa,EAElE,CACF,EAAG,CAAC,UAAWhB,EAAaP,EAAS,OAAQc,CAAU,CAAC,EAExD,MAAMU,EAAa,IAAM,CACvBhB,EAAgBiB,GAASA,EAAO,CAAC,CACnC,EAEMC,EAAe,IAAM,CACzB,OAAQzB,EAAA,CACN,IAAK,GACH,MAAO,cACT,IAAK,GACH,MAAO,cACT,IAAK,GACH,MAAO,cACT,IAAK,GACH,MAAO,cACT,QACE,MAAO,aAAA,CAEb,EAEA,OAAID,EAAS,SAAW,EACf2B,EAAAA,IAAC,MAAA,CAAI,UAAU,iCAAiC,SAAA,2BAAwB,EAI/EC,OAAC,OAAI,UAAAtB,EAEH,SAAA,CAAAsB,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,wBACb,SAAA,CAAArB,EAAY,IAAEP,EAAS,OAAO,gBAAA,EACjC,EACA4B,EAAAA,KAAC,QAAA,CAAM,UAAU,iDACf,SAAA,CAAAD,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,QAASjB,EACT,SAAWmB,GAAMlB,EAAekB,EAAE,OAAO,OAAO,EAChD,UAAU,gCAAA,CAAA,EAEZF,EAAAA,IAAC,QAAK,SAAA,YAAA,CAAU,CAAA,CAAA,CAClB,CAAA,EACF,EAGAA,MAAC,MAAA,CAAI,UAAW,QAAQD,GAAc,SACnC,SAAA1B,EAAS,IAAI,CAAC8B,EAAKC,IAClBH,EAAAA,KAAC,MAAA,CAA4B,UAAU,WAEpC,SAAA,CAAAxB,GAAUA,EAAO2B,CAAK,GACrBJ,EAAAA,IAAC,OAAI,UAAU,8EACZ,SAAAvB,EAAO2B,CAAK,CAAA,CACf,EAIFJ,EAAAA,IAACK,EAAA,CACC,QAASF,EACT,UAAW,WAAWC,CAAK,GAC3B,MAAO7B,EACP,OAAQA,EACR,aAAc,GACd,OAAQsB,EACR,kBACEnB,EAAoB,CAAC4B,EAAIC,IAAQ7B,EAAkB4B,EAAIC,EAAKH,CAAK,EAAI,MAAA,CAAA,CAEzE,CAAA,EAnBQ,GAAGD,CAAG,IAAIC,CAAK,EAoBzB,CACD,EACH,QAGC,MAAA,CAAI,UAAU,iCACb,SAAAH,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAD,EAAAA,IAAC,OAAA,CAAK,UAAU,oCAAoC,SAAA,iBAAc,EAClEA,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,CACb,GAAI,OAAO,IACT,QAASR,EAAI,EAAGA,EAAInB,EAAS,OAAQmB,IACnC,OAAO,IAAI,QAAQ,QAAS,CAAE,QAAS,WAAWA,CAAC,GAAI,CAG7D,EACA,UAAU,gGACX,SAAA,SAAA,CAAA,EAGDQ,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,CACb,GAAI,OAAO,IACT,QAASR,EAAI,EAAGA,EAAInB,EAAS,OAAQmB,IACnC,OAAO,IAAI,QAAQ,KAAM,CAAE,QAAS,WAAWA,CAAC,GAAI,CAG1D,EACA,UAAU,gGACX,SAAA,aAAA,CAAA,EAGDQ,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,CACb,GAAI,OAAO,IACT,QAASR,EAAI,EAAGA,EAAInB,EAAS,OAAQmB,IACnC,OAAO,IAAI,QAAQ,MAAO,CAAE,QAAS,WAAWA,CAAC,GAAI,CAG3D,EACA,UAAU,gGACX,SAAA,cAAA,CAAA,EAGDS,EAAAA,KAAC,SAAA,CACC,SAAWC,GAAM,CACf,GAAI,OAAO,KAAOA,EAAE,OAAO,MACzB,QAASV,EAAI,EAAGA,EAAInB,EAAS,OAAQmB,IACnC,OAAO,IAAI,YAAYU,EAAE,OAAO,MAAO,CACrC,QAAS,WAAWV,CAAC,EAAA,CACtB,CAGP,EACA,UAAU,mDACV,aAAa,GAEb,SAAA,CAAAQ,MAAC,SAAA,CAAO,MAAM,GAAG,SAAQ,GAAC,SAAA,eAE1B,EACAA,EAAAA,IAAC,SAAA,CAAO,MAAM,OAAO,SAAA,OAAI,EACzBA,EAAAA,IAAC,SAAA,CAAO,MAAM,OAAO,SAAA,OAAI,EACzBA,EAAAA,IAAC,SAAA,CAAO,MAAM,OAAO,SAAA,OAAI,EACzBA,EAAAA,IAAC,SAAA,CAAO,MAAM,UAAU,SAAA,UAAO,EAC/BA,EAAAA,IAAC,SAAA,CAAO,MAAM,UAAU,SAAA,SAAA,CAAO,CAAA,CAAA,CAAA,CACjC,CAAA,CACF,CAAA,CACF,CAAA,EACF,CAEJ,EClMMQ,EAA6D,CACjE,CAAE,MAAO,OAAQ,MAAO,MAAA,EACxB,CAAE,MAAO,MAAO,MAAO,KAAA,EACvB,CAAE,MAAO,OAAQ,MAAO,MAAA,EACxB,CAAE,MAAO,MAAO,MAAO,aAAA,CACzB,EAKMC,EAAsD,CAAC,CAC3D,MAAAC,EACA,YAAAC,EACA,kBAAAC,EACA,WAAAC,EACA,UAAAlC,EAAY,GACZ,SAAAmC,EAAW,EACb,IAAM,CACJ,KAAM,CAACC,EAAQC,CAAS,EAAIlC,EAAAA,SAAyB,MAAM,EACrD,CAACmC,EAAeC,CAAgB,EAAIpC,EAAAA,SAAS,EAAK,EAElDqC,EAAkB/B,EAAAA,YAAY,IAAM,CACpCuB,EAAY,SAAWD,EAAM,OAC/BE,EAAkB,CAAA,CAAE,EAEpBA,EAAkBF,EAAM,IAAK,GAAM,EAAE,EAAE,CAAC,CAE5C,EAAG,CAACA,EAAOC,EAAY,OAAQC,CAAiB,CAAC,EAE3CQ,EAAmBhC,EAAAA,YACtBiC,GAAe,CACVV,EAAY,SAASU,CAAE,EACzBT,EAAkBD,EAAY,OAAQnB,GAAMA,IAAM6B,CAAE,CAAC,EAErDT,EAAkB,CAAC,GAAGD,EAAaU,CAAE,CAAC,CAE1C,EACA,CAACV,EAAaC,CAAiB,CAAA,EAG3BU,EAAiBlC,EAAAA,YAAY,SAAY,CAC7C,GAAIuB,EAAY,SAAW,EAE3B,CAAAO,EAAiB,EAAI,EACrB,GAAI,CACF,MAAML,EAAWF,EAAaI,CAAM,CACtC,QAAA,CACEG,EAAiB,EAAK,CACxB,EACF,EAAG,CAACP,EAAaI,EAAQF,CAAU,CAAC,EAE9BU,EAAgBZ,EAAY,SAAWD,EAAM,QAAUA,EAAM,OAAS,EACtEc,EAAiBb,EAAY,OAAS,GAAKA,EAAY,OAASD,EAAM,OAE5E,OACET,EAAAA,KAAC,MAAA,CAAI,UAAW,QAAQtB,CAAS,GAC/B,SAAA,CAAAsB,EAAAA,KAAC,MAAA,CAAI,UAAU,gDACb,SAAA,CAAAD,EAAAA,IAAC,KAAA,CAAG,UAAU,wBAAwB,SAAA,gBAAa,EACnDC,EAAAA,KAAC,OAAA,CAAK,UAAU,wBACb,SAAA,CAAAU,EAAY,OAAO,OAAKD,EAAM,OAAO,WAAA,CAAA,CACxC,CAAA,EACF,EAEAT,EAAAA,KAAC,MAAA,CAAI,UAAU,sBAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAA,EAAAA,KAAC,QAAA,CAAM,UAAU,yCACf,SAAA,CAAAD,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,QAASuB,EACT,IAAME,GAAO,CACPA,MAAO,cAAgBD,EAC7B,EACA,SAAUL,EACV,SAAUL,GAAYJ,EAAM,SAAW,EACvC,UAAU,uEAAA,CAAA,EAEZV,EAAAA,IAAC,OAAA,CAAK,UAAU,UAAU,SAAA,YAAA,CAAU,CAAA,EACtC,EAECW,EAAY,OAAS,GACpBX,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMY,EAAkB,EAAE,EACnC,UAAU,2CACX,SAAA,iBAAA,CAAA,CAED,EAEJ,EAGAX,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAD,EAAAA,IAAC,QAAA,CAAM,UAAU,aAAa,SAAA,gBAAa,QAC1C,MAAA,CAAI,UAAU,yBACZ,SAAAQ,EAAe,IAAKkB,GACnB1B,EAAAA,IAAC,SAAA,CAEC,QAAS,IAAMgB,EAAUU,EAAI,KAAK,EAClC,SAAAZ,EACA,UAAW,2DACTC,IAAWW,EAAI,MACX,qCACA,6CACN,GAEC,SAAAA,EAAI,KAAA,EATAA,EAAI,KAAA,CAWZ,CAAA,CACH,CAAA,EACF,EAGCf,EAAY,OAAS,GACpBV,EAAAA,KAAC,MAAA,CAAI,UAAU,qDACb,SAAA,CAAAD,EAAAA,IAAC,IAAA,CAAE,UAAU,6BAA6B,SAAA,kBAAe,EACzDC,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACZ,SAAA,CAAAU,EAAY,MAAM,EAAG,EAAE,EAAE,IAAKU,GAAO,CACpC,MAAMM,EAAOjB,EAAM,KAAMlB,GAAMA,EAAE,KAAO6B,CAAE,EAC1C,OACEpB,EAAAA,KAAC,OAAA,CAAc,UAAU,gDACtB,SAAA,CAAA0B,GAAM,MAAQN,EACfrB,EAAAA,IAAC,UAAO,QAAS,IAAMoB,EAAiBC,CAAE,EAAG,UAAU,qBAAqB,SAAA,GAAA,CAE5E,CAAA,CAAA,EAJSA,CAKX,CAEJ,CAAC,EACAV,EAAY,OAAS,IACpBV,EAAAA,KAAC,OAAA,CAAK,UAAU,mBAAmB,SAAA,CAAA,IAAEU,EAAY,OAAS,GAAG,OAAA,CAAA,CAAK,CAAA,CAAA,CAEtE,CAAA,EACF,EAIFX,EAAAA,IAAC,SAAA,CACC,QAASsB,EACT,SAAUR,GAAYH,EAAY,SAAW,GAAKM,EAClD,UAAU,yBAET,SAAAA,EACChB,OAAC,OAAA,CAAK,UAAU,yCACd,SAAA,CAAAD,EAAAA,IAAC,OAAA,CAAK,UAAU,8EAAA,CAA+E,EAAE,uBAAA,CAAA,CAEnG,EAEAC,EAAAA,KAAA2B,EAAAA,SAAA,CAAE,SAAA,CAAA,YACUjB,EAAY,OAAO,QAAMA,EAAY,SAAW,EAAI,IAAM,GAAG,MAAI,IAC1EI,EAAO,YAAA,CAAY,CAAA,CACtB,CAAA,CAAA,EAKJd,EAAAA,KAAC,MAAA,CAAI,UAAU,wBACZ,SAAA,CAAAc,IAAW,QAAU,wCACrBA,IAAW,OAAS,sCACpBA,IAAW,QAAU,2BACrBA,IAAW,OAAS,6CAAA,CAAA,CACvB,CAAA,CAAA,CACF,CAAA,EACF,CAEJ,ECnJMc,EAA0C,CAAC,CAC/C,QAAAC,EACA,OAAAC,EACA,SAAAC,EACA,MAAAC,EAAQ,UACR,YAAAC,EAAc,GACd,iBAAAC,EAAmB,GACnB,UAAAxD,EAAY,EACd,IAAM,CACJ,KAAM,CAACyD,EAAaC,CAAc,EAAIvD,EAAAA,SAASqD,CAAgB,EACzD,CAACG,EAAkBC,CAAmB,EAAIzD,EAAAA,SAAkC,CAAA,CAAE,EAE9E0D,EAAqBpD,EAAAA,YACzB,CAACqD,EAAkBC,IAAgC,CACjDV,EAAS,CAAE,GAAGD,EAAQ,CAACU,CAAQ,EAAGC,EAAO,CAC3C,EACA,CAACX,EAAQC,CAAQ,CAAA,EAGbW,EAAoBvD,EAAAA,YACxB,CAACqD,EAAkBG,EAAaC,IAAgB,CAC9Cb,EAAS,CAAE,GAAGD,EAAQ,CAACU,CAAQ,EAAG,CAACG,EAAKC,CAAG,EAAG,CAChD,EACA,CAACd,EAAQC,CAAQ,CAAA,EAGbc,EAAc1D,EAAAA,YAAY,IAAM,CACpC,MAAM2D,EAA4B,CAAA,EAClCjB,EAAQ,QAASkB,GAAW,CACtBA,EAAO,eAAiB,SAC1BD,EAAYC,EAAO,EAAE,EAAIA,EAAO,aAEpC,CAAC,EACDhB,EAASe,CAAW,CACtB,EAAG,CAACjB,EAASE,CAAQ,CAAC,EAEA5C,EAAAA,YAAa6D,GAAsB,CACvDV,EAAqBzC,IAAU,CAC7B,GAAGA,EACH,CAACmD,CAAS,EAAG,CAACnD,EAAKmD,CAAS,CAAA,EAC5B,CACJ,EAAG,CAAA,CAAE,EAEL,MAAMC,EAAoBC,EAAAA,QAAQ,IACzB,OAAO,QAAQpB,CAAM,EAAE,OAAO,CAAC,CAACqB,EAAKV,CAAK,IAAM,CACrD,MAAMM,EAASlB,EAAQ,KAAMuB,GAAMA,EAAE,KAAOD,CAAG,EAC/C,OAAKJ,EAEDA,EAAO,OAAS,SAAW,MAAM,QAAQN,CAAK,EACzCA,EAAM,CAAC,IAAMM,EAAO,KAAON,EAAM,CAAC,IAAMM,EAAO,IAGpDA,EAAO,eAAiB,OACnBN,IAAUM,EAAO,aAGnBN,IAAU,QAAaA,IAAU,IAAMA,IAAU,GAVpC,EAWtB,CAAC,EAAE,OACF,CAACX,EAAQD,CAAO,CAAC,EAEdwB,EAAgBN,GAAyB,CAC7C,MAAMN,EAAQX,EAAOiB,EAAO,EAAE,EAE9B,OAAQA,EAAO,KAAA,CACb,IAAK,QAAS,CACZ,MAAMO,EAAa,MAAM,QAAQb,CAAK,EAAIA,EAAQ,CAACM,EAAO,KAAO,EAAGA,EAAO,KAAO,GAAG,EACrF,OACEhD,EAAAA,IAACwD,EAAA,CAEC,IAAKR,EAAO,KAAO,EACnB,IAAKA,EAAO,KAAO,IACnB,KAAMA,EAAO,MAAQ,EACrB,SAAUO,EAAW,CAAC,EACtB,SAAUA,EAAW,CAAC,EACtB,MAAOP,EAAO,MACd,KAAMA,EAAO,KACb,UAAWA,EAAO,UAClB,SAAU,CAACJ,EAAKC,IAAQF,EAAkBK,EAAO,GAAIJ,EAAKC,CAAG,EAC7D,WAAY,EAAA,EAVPG,EAAO,EAAA,CAalB,CAEA,IAAK,SACH,OACE/C,EAAAA,KAAC,MAAA,CAAoB,UAAU,YAC7B,SAAA,CAAAD,EAAAA,IAAC,QAAA,CAAM,UAAU,oCAAqC,SAAAgD,EAAO,MAAM,EACnE/C,EAAAA,KAAC,SAAA,CACC,MAAO,OAAOyC,GAAS,EAAE,EACzB,SAAWxC,GAAMsC,EAAmBQ,EAAO,GAAI9C,EAAE,OAAO,OAAS,MAAS,EAC1E,UAAU,oHAEV,SAAA,CAAAF,EAAAA,IAAC,SAAA,CAAO,MAAM,GAAG,SAAA,MAAG,EACnBgD,EAAO,SAAS,IAAKtB,GACpB1B,EAAAA,IAAC,SAAA,CAAuB,MAAO0B,EAAI,MAChC,SAAAA,EAAI,KAAA,EADMA,EAAI,KAEjB,CACD,CAAA,CAAA,CAAA,CACH,CAAA,EAbQsB,EAAO,EAcjB,EAGJ,IAAK,WACH,OACE/C,EAAAA,KAAC,QAAA,CAAsB,UAAU,yCAC/B,SAAA,CAAAD,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,QAAS,EAAQ0C,EACjB,SAAWxC,GAAMsC,EAAmBQ,EAAO,GAAI9C,EAAE,OAAO,OAAO,EAC/D,UAAU,mEAAA,CAAA,EAEZF,EAAAA,IAAC,OAAA,CAAK,UAAU,wBAAyB,WAAO,KAAA,CAAM,CAAA,CAAA,EAP5CgD,EAAO,EAQnB,EAGJ,IAAK,OACH,OACE/C,EAAAA,KAAC,MAAA,CAAoB,UAAU,YAC7B,SAAA,CAAAD,EAAAA,IAAC,QAAA,CAAM,UAAU,oCAAqC,SAAAgD,EAAO,MAAM,EACnEhD,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,MAAO,OAAO0C,GAAS,EAAE,EACzB,SAAWxC,GAAMsC,EAAmBQ,EAAO,GAAI9C,EAAE,OAAO,OAAS,MAAS,EAC1E,YAAa,aAAa8C,EAAO,MAAM,aAAa,MACpD,UAAU,mHAAA,CAAA,CACZ,CAAA,EARQA,EAAO,EASjB,EAGJ,QACE,OAAO,IAAA,CAEb,EAEA,OACE/C,EAAAA,KAAC,MAAA,CAAI,UAAW,wDAAwDtB,CAAS,GAE/E,SAAA,CAAAsB,EAAAA,KAAC,MAAA,CACC,UAAW,+CACTiC,EAAc,kCAAoC,EACpD,IAAKE,EAA2C,GAA7B,0BAA+B,GAClD,QAASF,EAAc,IAAMG,EAAe,CAACD,CAAW,EAAI,OAE5D,SAAA,CAAAnC,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACZ,SAAA,CAAAiC,GACClC,EAAAA,IAAC,MAAA,CACC,UAAW,8CACToC,EAAc,GAAK,WACrB,GACA,KAAK,OACL,OAAO,eACP,QAAQ,YAER,SAAApC,EAAAA,IAAC,OAAA,CACC,cAAc,QACd,eAAe,QACf,YAAa,EACb,EAAE,cAAA,CAAA,CACJ,CAAA,EAGJA,EAAAA,IAAC,KAAA,CAAG,UAAU,oCAAqC,SAAAiC,EAAM,EACxDiB,EAAoB,GACnBlD,EAAAA,IAAC,OAAA,CAAK,UAAU,yEACb,SAAAkD,CAAA,CACH,CAAA,EAEJ,EACC,CAACd,GAAec,EAAoB,GACnClD,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAUE,GAAM,CACdA,EAAE,gBAAA,EACF4C,EAAA,CACF,EACA,UAAU,4CACX,SAAA,WAAA,CAAA,CAED,CAAA,CAAA,EAKH,CAACV,GACApC,EAAAA,IAAC,MAAA,CAAI,UAAU,gBAAiB,SAAA8B,EAAQ,IAAKkB,GAAWM,EAAaN,CAAM,CAAC,CAAA,CAAE,CAAA,EAElF,CAEJ,EClNMS,EAA2B,IAAM,CACrC,KAAM,CAAE,KAAMC,EAAQ,UAAAC,EAAW,MAAAC,CAAA,EAAUC,EAAA,EAGrC,CAACC,EAAUC,CAAW,EAAIjF,EAAAA,SAA6B,MAAM,EAG7D,CAACkF,EAAcC,CAAe,EAAInF,EAAAA,SAAuB,CAAA,CAAE,EAC3DoF,EAAgC,CACpC,CACE,GAAI,WACJ,MAAO,WACP,KAAM,SACN,QAAS,CACP,CAAE,MAAO,OAAQ,MAAO,MAAA,EACxB,CAAE,MAAO,OAAQ,MAAO,SAAA,EACxB,CAAE,MAAO,OAAQ,MAAO,MAAA,CAAO,CACjC,EAEF,CACE,GAAI,SACJ,MAAO,SACP,KAAM,MAAA,CACR,EAIIC,EAAiBC,EAAmB,GAAM,EAAE,cAAc,EAC1DC,EAAuBD,EAAmB,GAAM,EAAE,oBAAoB,EACtEE,EAAkBF,EAAmB,GAAM,EAAE,eAAe,EAC5DG,EAAsBH,EAAmB,GAAM,EAAE,mBAAmB,EAEpEzD,EAAcwC,EAAAA,QAAQ,IAAM,MAAM,KAAKgB,CAAc,EAAG,CAACA,CAAc,CAAC,EAExEK,EAAwBpF,EAAAA,YAC3BqF,GAAkB,CACbA,EAAI,SAAW,EACjBF,EAAA,EAEAD,EAAgBG,CAAG,CAEvB,EACA,CAACF,EAAqBD,CAAe,CAAA,EAGjCI,EAAqBtF,EAAAA,YAAY,MAAOqF,EAAe1D,IAAmB,CAE9E,MAAMZ,EAAM,iFAAuCsE,EAAI,KAAK,GAAG,CAAC,WAAW1D,CAAM,GACjF,OAAO,KAAKZ,EAAK,QAAQ,CAC3B,EAAG,CAAA,CAAE,EAGCwE,EAAiBxB,EAAAA,QAAQ,IAAM,CACnC,GAAI,CAACO,EAAQ,MAAO,CAAA,EACpB,IAAIkB,EAASlB,EAKb,GAHIM,EAAa,WACfY,EAASA,EAAO,OAAQC,GAAQA,EAAI,WAAab,EAAa,QAAQ,GAEpEA,EAAa,QAAU,OAAOA,EAAa,QAAW,SAAU,CAClE,MAAMc,EAAOd,EAAa,OAAO,YAAA,EACjCY,EAASA,EAAO,OACbC,GAAQA,EAAI,MAAM,cAAc,SAASC,CAAI,GAAKD,EAAI,GAAG,YAAA,EAAc,SAASC,CAAI,CAAA,CAEzF,CAEA,OAAOF,CACT,EAAG,CAAClB,EAAQM,CAAY,CAAC,EAGnB,CACJ,WAAAe,EACA,cAAAC,EACA,WAAAC,EACA,WAAYC,CAAA,EACVC,EAAwBR,EAAgB,aAAc,MAAM,EAEhE,GAAIhB,EACF,OAAO3D,EAAAA,IAACoF,EAAA,CAAe,MAAM,oBAAoB,EAGnD,GAAIxB,EACF,OACE3D,EAAAA,KAAC,MAAA,CAAI,UAAU,oEAAoE,SAAA,CAAA,0BACzD2D,EAAM,OAAA,EAChC,EAKJ,MAAMyB,EAAgBlC,EAAAA,QACpB,IACE+B,EAAa,IAAKL,IAAS,CACzB,GAAIA,EAAI,GACR,KAAMA,EAAI,MAAM,MAAM,GAAG,EAAE,IAAA,GAASA,EAAI,GACxC,KAAM,MAAA,EACN,EACJ,CAACK,CAAY,CAAA,EAITI,EAAiBnC,EAAAA,QAAQ,IAAM,CACnC,MAAMoC,EAAU,uDAChB,OAAO5E,EAAY,IAAKU,GAAO,GAAGkE,CAAO,WAAWlE,CAAE,OAAO,CAC/D,EAAG,CAACV,CAAW,CAAC,EAEV6E,EAAmBrC,EAAAA,QAAQ,IACxBxC,EAAY,IAAKU,GACV6D,EAAa,KAAM1F,GAAMA,EAAE,KAAO6B,CAAE,GACpC,MAAM,MAAM,GAAG,EAAE,OAASA,CACvC,EACA,CAACV,EAAauE,CAAY,CAAC,EAE9B,OACEjF,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,OAAC,KAAA,CAAG,UAAU,mCAAmC,SAAA,SAAM,EACtDU,EAAY,OAAS,GACpBV,EAAAA,KAAC,OAAA,CAAK,UAAU,wBAAyB,SAAA,CAAAU,EAAY,OAAO,WAAA,EAAS,CAAA,EAEzE,EACAX,EAAAA,IAAC,OAAI,UAAU,aACZ,WAAY,QAAU,GAAKW,EAAY,QAAU,GAChDX,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM+D,EAAYD,IAAa,UAAY,OAAS,SAAS,EACtE,UAAW,8DACTA,IAAa,UACT,2BACA,6CACN,GAEC,SAAAA,IAAa,UAAY,eAAiB,kBAAA,CAAA,EAGjD,CAAA,EACF,EAGA9D,EAAAA,IAAC,MAAA,CAAI,UAAU,OACb,SAAAA,EAAAA,IAAC6B,EAAA,CACC,QAASqC,EACT,OAAQF,EACR,SAAUC,EACV,MAAM,gBACN,YAAW,GACX,iBAAgB,EAAA,CAAA,EAEpB,EAGCH,IAAa,WAAanD,EAAY,QAAU,SAC9C,MAAA,CAAI,UAAU,OACb,SAAAV,OAAC,MAAA,CAAI,UAAU,WACb,SAAA,OAAC,KAAA,CAAG,UAAU,6BAA6B,SAAA,mBAAgB,EAC3DD,EAAAA,IAAC5B,EAAA,CACC,SAAUkH,EACV,OAAQE,EACR,QAAS7E,EAAY,QAAU,EAAI,EAAIA,EAAY,QAAU,EAAI,EAAI,EACrE,WAAY,IACZ,UAAS,EAAA,CAAA,CACX,CAAA,CACF,CAAA,CACF,EAIDuE,EAAa,OAAS,GACrBlF,EAAAA,IAAC,MAAA,CAAI,UAAU,OACb,SAAAA,EAAAA,IAACS,EAAA,CACC,MAAO4E,EACP,YAAA1E,EACA,kBAAmB6D,EACnB,WAAYE,CAAA,CAAA,EAEhB,EAGDQ,GAAgBA,EAAa,OAAS,QACpC,MAAA,CAAI,UAAU,uBACb,SAAAjF,EAAAA,KAAC,QAAA,CAAM,UAAU,QACf,SAAA,OAAC,QAAA,CACC,gBAAC,KAAA,CACC,SAAA,CAAAD,EAAAA,IAAC,KAAA,CAAG,UAAU,iBACZ,SAAAA,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,QAASW,EAAY,SAAWuE,EAAa,QAAUA,EAAa,OAAS,EAC7E,IAAMzD,GAAO,CACPA,IACFA,EAAG,cACDd,EAAY,OAAS,GAAKA,EAAY,OAASuE,EAAa,OAClE,EACA,SAAU,IAAM,CACVvE,EAAY,SAAWuE,EAAa,OACtCX,EAAA,EAEAD,EAAgBY,EAAa,IAAK1F,GAAMA,EAAE,EAAE,CAAC,CAEjD,EACA,UAAU,+BAAA,CAAA,EAEd,EACAQ,EAAAA,IAACyF,EAAA,CACC,UAAU,OACV,WAAAV,EACA,cAAAC,EACA,OAAQC,EACT,SAAA,MAAA,CAAA,EAGDjF,EAAAA,IAACyF,EAAA,CACC,UAAU,WACV,WAAAV,EACA,cAAAC,EACA,OAAQC,EACR,UAAU,cACX,SAAA,UAAA,CAAA,EAGDjF,EAAAA,IAACyF,EAAA,CACC,UAAU,aACV,WAAAV,EACA,cAAAC,EACA,OAAQC,EACR,UAAU,aACX,SAAA,SAAA,CAAA,CAED,CAAA,CACF,CAAA,CACF,QACC,QAAA,CAAM,UAAU,2BACd,SAAAC,EAAa,IAAKQ,UAChB,KAAA,CAAkB,UAAWvB,EAAe,IAAIuB,EAAM,EAAE,EAAI,aAAe,GAC1E,SAAA,CAAA1F,EAAAA,IAAC,KAAA,CAAG,UAAU,OACZ,SAAAA,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,QAASmE,EAAe,IAAIuB,EAAM,EAAE,EACpC,SAAU,IAAMrB,EAAqBqB,EAAM,EAAE,EAC7C,UAAU,+BAAA,CAAA,EAEd,QACC,KAAA,CACC,SAAA1F,EAAAA,IAAC2F,EAAA,CACC,GAAI,WAAWD,EAAM,EAAE,GACvB,UAAU,gDAET,WAAM,MAAM,MAAM,GAAG,EAAE,IAAA,GAASA,EAAM,EAAA,CAAA,EAE3C,QACC,KAAA,CAAG,UAAU,cACX,WAAM,UACL1F,EAAAA,IAAC,OAAA,CACC,UAAW,SACT0F,EAAM,WAAa,OACf,gBACAA,EAAM,WAAa,OACnB,gBACA,aACN,GAEC,SAAAA,EAAM,QAAA,CAAA,EAGb,QACC,KAAA,CAAG,UAAU,2BACX,SAAAA,EAAM,WAAa,IAAI,KAAKA,EAAM,UAAU,EAAE,mBAAA,EAAuB,IACxE,CAAA,GAlCOA,EAAM,EAmCf,CACD,EACH,CAAA,EACF,CAAA,CACF,EAEA1F,MAAC,IAAA,CAAE,UAAU,gBAAgB,SAAA,kBAAA,CAAgB,CAAA,EAEjD,CAEJ"}