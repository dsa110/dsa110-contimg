{"version":3,"file":"provenanceMappers-BvXM4jp-.js","sources":["../../src/utils/provenanceMappers.ts"],"sourcesContent":["import type { ProvenanceStripProps } from \"../types/provenance\";\n\n/**\n * Response shapes from backend API endpoints.\n * These represent the data structures returned by the API.\n */\n\nexport interface ImageDetailResponse {\n  id: string;\n  path: string;\n  ms_path?: string;\n  cal_table?: string;\n  pointing_ra_deg?: number | null;\n  pointing_dec_deg?: number | null;\n  qa_grade?: \"good\" | \"warn\" | \"fail\" | null;\n  qa_summary?: string;\n  run_id?: string;\n  created_at?: string;\n  // QA metrics fields\n  noise_jy?: number;\n  dynamic_range?: number;\n  beam_major_arcsec?: number;\n  beam_minor_arcsec?: number;\n  beam_pa_deg?: number;\n  peak_flux_jy?: number;\n}\n\nexport interface MSDetailResponse {\n  path: string;\n  pointing_ra_deg?: number | null;\n  pointing_dec_deg?: number | null;\n  calibrator_matches?: Array<{ cal_table: string; type: string }>;\n  qa_grade?: \"good\" | \"warn\" | \"fail\" | null;\n  qa_summary?: string;\n  run_id?: string;\n  created_at?: string;\n}\n\nexport interface SourceDetailResponse {\n  id: string;\n  name?: string;\n  ra_deg: number;\n  dec_deg: number;\n  contributing_images?: Array<{\n    image_id: string;\n    path: string;\n    ms_path?: string;\n    qa_grade?: \"good\" | \"warn\" | \"fail\" | null;\n    created_at?: string;\n    flux_jy?: number;\n  }>;\n  latest_image_id?: string;\n}\n\n/**\n * Maps an image detail API response to ProvenanceStripProps.\n * Handles missing fields gracefully by omitting them from the result.\n */\nexport function mapProvenanceFromImageDetail(image: ImageDetailResponse): ProvenanceStripProps {\n  return {\n    runId: image.run_id,\n    msPath: image.ms_path,\n    calTable: image.cal_table,\n    calUrl: image.cal_table ? `/cal/${encodeURIComponent(image.cal_table)}` : undefined,\n    pointingRaDeg: image.pointing_ra_deg,\n    pointingDecDeg: image.pointing_dec_deg,\n    qaGrade: image.qa_grade,\n    qaSummary: image.qa_summary,\n    logsUrl: image.run_id ? `/logs/${image.run_id}` : undefined,\n    qaUrl: image.id ? `/qa/image/${image.id}` : undefined,\n    msUrl: image.ms_path ? `/ms/${encodeURIComponent(image.ms_path)}` : undefined,\n    imageUrl: `/images/${image.id}`,\n    createdAt: image.created_at,\n  };\n}\n\n/**\n * Maps an MS detail API response to ProvenanceStripProps.\n * Extracts the first calibrator table if available.\n */\nexport function mapProvenanceFromMSDetail(ms: MSDetailResponse): ProvenanceStripProps {\n  const firstCal = ms.calibrator_matches?.[0]?.cal_table;\n\n  return {\n    runId: ms.run_id,\n    msPath: ms.path,\n    calTable: firstCal,\n    calUrl: firstCal ? `/cal/${encodeURIComponent(firstCal)}` : undefined,\n    pointingRaDeg: ms.pointing_ra_deg,\n    pointingDecDeg: ms.pointing_dec_deg,\n    qaGrade: ms.qa_grade,\n    qaSummary: ms.qa_summary,\n    logsUrl: ms.run_id ? `/logs/${ms.run_id}` : undefined,\n    qaUrl: ms.path ? `/qa/ms/${encodeURIComponent(ms.path)}` : undefined,\n    msUrl: `/ms/${encodeURIComponent(ms.path)}`,\n    createdAt: ms.created_at,\n  };\n}\n\n/**\n * Maps a source detail API response to ProvenanceStripProps.\n * Uses the latest contributing image for provenance data.\n */\nexport function mapProvenanceFromSourceDetail(\n  source: SourceDetailResponse,\n  selectedImageId?: string\n): ProvenanceStripProps | null {\n  // Find the selected image or use the latest\n  const images = source.contributing_images ?? [];\n  const image = selectedImageId\n    ? images.find((img) => img.image_id === selectedImageId)\n    : images[0];\n\n  if (!image) {\n    return null; // No contributing images, hide provenance strip\n  }\n\n  return {\n    msPath: image.ms_path,\n    qaGrade: image.qa_grade,\n    imageUrl: `/images/${image.image_id}`,\n    msUrl: image.ms_path ? `/ms/${encodeURIComponent(image.ms_path)}` : undefined,\n    createdAt: image.created_at,\n  };\n}\n"],"names":["mapProvenanceFromImageDetail","image","mapProvenanceFromMSDetail","ms","_a","_b","firstCal","mapProvenanceFromSourceDetail","source","selectedImageId","images","img"],"mappings":"AA0DO,SAASA,EAA6BC,EAAkD,CAC7F,MAAO,CACL,MAAOA,EAAM,OACb,OAAQA,EAAM,QACd,SAAUA,EAAM,UAChB,OAAQA,EAAM,UAAY,QAAQ,mBAAmBA,EAAM,SAAS,CAAC,GAAK,OAC1E,cAAeA,EAAM,gBACrB,eAAgBA,EAAM,iBACtB,QAASA,EAAM,SACf,UAAWA,EAAM,WACjB,QAASA,EAAM,OAAS,SAASA,EAAM,MAAM,GAAK,OAClD,MAAOA,EAAM,GAAK,aAAaA,EAAM,EAAE,GAAK,OAC5C,MAAOA,EAAM,QAAU,OAAO,mBAAmBA,EAAM,OAAO,CAAC,GAAK,OACpE,SAAU,WAAWA,EAAM,EAAE,GAC7B,UAAWA,EAAM,UAAA,CAErB,CAMO,SAASC,EAA0BC,EAA4C,CAtB/E,IAAAC,EAAAC,EAuBL,MAAMC,GAAWD,GAAAD,EAAAD,EAAG,qBAAH,YAAAC,EAAwB,KAAxB,YAAAC,EAA4B,UAE7C,MAAO,CACL,MAAOF,EAAG,OACV,OAAQA,EAAG,KACX,SAAUG,EACV,OAAQA,EAAW,QAAQ,mBAAmBA,CAAQ,CAAC,GAAK,OAC5D,cAAeH,EAAG,gBAClB,eAAgBA,EAAG,iBACnB,QAASA,EAAG,SACZ,UAAWA,EAAG,WACd,QAASA,EAAG,OAAS,SAASA,EAAG,MAAM,GAAK,OAC5C,MAAOA,EAAG,KAAO,UAAU,mBAAmBA,EAAG,IAAI,CAAC,GAAK,OAC3D,MAAO,OAAO,mBAAmBA,EAAG,IAAI,CAAC,GACzC,UAAWA,EAAG,UAAA,CAElB,CAMO,SAASI,EACdC,EACAC,EAC6B,CAE7B,MAAMC,EAASF,EAAO,qBAAuB,CAAA,EACvCP,EAAQQ,EACVC,EAAO,KAAMC,GAAQA,EAAI,WAAaF,CAAe,EACrDC,EAAO,CAAC,EAEZ,OAAKT,EAIE,CACL,OAAQA,EAAM,QACd,QAASA,EAAM,SACf,SAAU,WAAWA,EAAM,QAAQ,GACnC,MAAOA,EAAM,QAAU,OAAO,mBAAmBA,EAAM,OAAO,CAAC,GAAK,OACpE,UAAWA,EAAM,UAAA,EARV,IAUX"}