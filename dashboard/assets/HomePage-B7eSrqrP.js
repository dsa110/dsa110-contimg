import{j as t,L as H,r as S,R as K}from"./index-cmp6pl3b.js";import{g as Q,m as V,a as W,b as Y,r as U,s as X,i as Z,c as tt,l as T,d as G,z as et,e as at}from"./d3-LaDgEivr.js";import{u as st,a as rt,b as ot}from"./useQueries-DwCFsMFx.js";const q={primary:"border-l-blue-500 text-blue-500",info:"border-l-teal-500 text-teal-500",warning:"border-l-yellow-500 text-yellow-500",success:"border-l-green-500 text-green-500",danger:"border-l-red-500 text-red-500",secondary:"border-l-gray-500 text-gray-500"},nt={primary:"text-blue-200",info:"text-teal-200",warning:"text-yellow-200",success:"text-green-200",danger:"text-red-200",secondary:"text-gray-200"};function lt(s){const n=(a,e)=>`${a.toFixed(1)}${e}`;return s>=1e9?n(s/1e9,"B"):s>=1e6?n(s/1e6,"M"):s>=1e3?n(s/1e3,"K"):s.toString()}const ct=({label:s,value:n,subtitle:a,variant:e="primary",icon:d,href:l,onClick:f,formatNumber:u=!0,compactFormat:i=!1,isLoading:$=!1,error:y,ariaLabel:N,className:v=""})=>{let h;y?h="—":typeof n=="number"?i?h=lt(n):u?h=n.toLocaleString():h=n.toString():h=n;const I=!!(l||f),m=N||`${s}: ${h}${a?`, ${a}`:""}`,w=t.jsx("div",{className:`
        card border-l-4 ${q[e]} 
        py-3 px-4 h-full transition-all
        ${I?"hover:shadow-lg cursor-pointer focus-within:ring-2 focus-within:ring-blue-300":""}
        ${y?"opacity-75":""}
        ${v}
      `,role:I?"button":void 0,tabIndex:f&&!l?0:void 0,onClick:f&&!l?f:void 0,onKeyDown:f&&!l?L=>{(L.key==="Enter"||L.key===" ")&&(L.preventDefault(),f())}:void 0,"aria-label":m,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:`text-xs font-bold uppercase mb-1 ${q[e].split(" ")[1]}`,children:s}),$?t.jsx("div",{className:"h-7 w-20 bg-gray-200 animate-pulse rounded",role:"status","aria-label":"Loading..."}):y?t.jsx("p",{className:"text-xl font-bold text-red-500",title:y,children:"—"}):t.jsx("p",{className:"text-xl font-bold text-gray-800",children:h}),a&&t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a})]}),d&&t.jsx("div",{className:`text-3xl ${nt[e]}`,"aria-hidden":"true",children:d})]})});return l?l.startsWith("http")?t.jsx("a",{href:l,target:"_blank",rel:"noreferrer",className:"block no-underline focus:outline-none","aria-label":m,children:w}):t.jsx(H,{to:l,className:"block no-underline focus:outline-none","aria-label":m,children:w}):w},it={2:"grid-cols-1 sm:grid-cols-2",3:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-4"},dt=({cards:s,columns:n=4,isLoading:a=!1,className:e=""})=>t.jsx("div",{className:`grid ${it[n]} gap-4 ${e}`,children:s.map((d,l)=>t.jsx(ct,{...d,isLoading:a},d.label||l))});function xt(s,n){const a=s*Math.PI/180,e=n*Math.PI/180,d=192.85948*Math.PI/180,l=27.12825*Math.PI/180,f=32.93192*Math.PI/180,u=Math.sin(e)*Math.sin(l)+Math.cos(e)*Math.cos(l)*Math.sin(a-f),i=Math.asin(u),$=Math.cos(e)*Math.cos(a-f),y=Math.sin(e)*Math.cos(l)-Math.cos(e)*Math.sin(l)*Math.sin(a-f);let N=d+Math.atan2($,y);N=(N*180/Math.PI%360+360)%360;const v=i*180/Math.PI;return[N,v]}function ut(s){const a=23.4392911*Math.PI/180,e=s*Math.PI/180,d=Math.sin(e)*Math.sin(a),l=Math.asin(d)*180/Math.PI,f=Math.sin(e)*Math.cos(a),u=Math.cos(e);let i=Math.atan2(f,u)*180/Math.PI;return i=(i%360+360)%360,[i,l]}const pt=Array.from({length:361},(s,n)=>xt(n,0)),ft=Array.from({length:361},(s,n)=>ut(n)),mt=({pointings:s,projection:n="aitoff",width:a=800,height:e=400,showGalacticPlane:d=!0,showEcliptic:l=!1,showConstellations:f=!1,colorScheme:u="status",defaultRadius:i=1.5,onPointingClick:$,onPointingHover:y,className:N=""})=>{const v=S.useRef(null),[h,I]=S.useState(n),[m,w]=S.useState(null),[L,J]=S.useState({x:0,y:0}),E=S.useCallback(()=>{const r=Math.min(a,e*2)/6;switch(h){case"mollweide":return Y().scale(r*1.4).translate([a/2,e/2]).rotate([-180,0,0]);case"hammer":return W().scale(r*1.4).translate([a/2,e/2]).rotate([-180,0,0]);case"mercator":return V().scale(r*.8).translate([a/2,e/2]).rotate([-180,0,0]);case"aitoff":default:return Q().scale(r*1.4).translate([a/2,e/2]).rotate([-180,0,0])}},[h,a,e]),P=S.useCallback(r=>{if(u==="uniform")return"#4fc3a1";if(u==="status")switch(r.status){case"completed":return"#4fc3a1";case"scheduled":return"#f0c674";case"failed":return"#ff6b6b";default:return"#4fc3a1"}if(u==="epoch"&&r.epoch){const p=r.epoch.split("").reduce((b,k)=>(b=(b<<5)-b+k.charCodeAt(0),b&b),0);return U(Math.abs(p%100)/100)}return"#4fc3a1"},[u]);S.useEffect(()=>{if(!v.current)return;const r=X(v.current);r.selectAll("*").remove();const p=E(),b=Z(p);r.append("rect").attr("width",a).attr("height",e).attr("fill","#1a1a2e");const k=tt().step([30,15]);if(r.append("path").datum(k()).attr("d",b).attr("fill","none").attr("stroke","#333").attr("stroke-width",.5).attr("stroke-opacity",.5),r.append("path").datum(k.outline()).attr("d",b).attr("fill","none").attr("stroke","#555").attr("stroke-width",1),d){const c=T().x(o=>{const x=p(o);return x?x[0]:0}).y(o=>{const x=p(o);return x?x[1]:0}).defined(o=>p(o)!==null).curve(G);r.append("path").datum(pt).attr("d",c).attr("fill","none").attr("stroke","#ff6b6b").attr("stroke-width",1.5).attr("stroke-dasharray","5,3").attr("opacity",.7)}if(l){const c=T().x(o=>{const x=p(o);return x?x[0]:0}).y(o=>{const x=p(o);return x?x[1]:0}).defined(o=>p(o)!==null).curve(G);r.append("path").datum(ft).attr("d",c).attr("fill","none").attr("stroke","#f0c674").attr("stroke-width",1.5).attr("stroke-dasharray","3,3").attr("opacity",.7)}[0,3,6,9,12,15,18,21].forEach(c=>{const o=p([c*15,0]);o&&r.append("text").attr("x",o[0]).attr("y",e-10).attr("text-anchor","middle").attr("fill","#888").attr("font-size",10).text(`${c}h`)}),[-60,-30,0,30,60].forEach(c=>{const o=p([180,c]);o&&o[0]>0&&o[0]<a&&r.append("text").attr("x",10).attr("y",o[1]).attr("fill","#888").attr("font-size",10).text(`${c}°`)});const A=r.append("g").attr("class","pointings");s.forEach(c=>{const o=p([c.ra,c.dec]);if(!o)return;const F=(c.radius??i)/180*Math.min(a,e),C=A.append("g").attr("class","pointing").attr("cursor","pointer");C.append("circle").attr("cx",o[0]).attr("cy",o[1]).attr("r",Math.max(F,3)).attr("fill",P(c)).attr("fill-opacity",.3).attr("stroke",P(c)).attr("stroke-width",1.5).attr("stroke-opacity",.8),C.append("circle").attr("cx",o[0]).attr("cy",o[1]).attr("r",2).attr("fill",P(c)),C.on("mouseenter",O=>{w(c),J({x:O.clientX,y:O.clientY}),y?.(c),C.select("circle").attr("fill-opacity",.6).attr("stroke-width",2.5)}).on("mouseleave",()=>{w(null),y?.(null),C.select("circle").attr("fill-opacity",.3).attr("stroke-width",1.5)}).on("click",()=>{$?.(c)})});const j=r.append("g").attr("transform",`translate(${a-120}, 20)`);let M=10;u==="status"&&(M+=45),d&&(M+=18),l&&(M+=18),M=Math.max(M,30),j.append("rect").attr("width",110).attr("height",M).attr("fill","rgba(0,0,0,0.5)").attr("rx",4);let g=15;u==="status"&&([{label:"Completed",color:"#4fc3a1"},{label:"Scheduled",color:"#f0c674"},{label:"Failed",color:"#ff6b6b"}].forEach((o,x)=>{j.append("circle").attr("cx",15).attr("cy",g+x*15).attr("r",5).attr("fill",o.color),j.append("text").attr("x",28).attr("y",g+x*15+4).attr("fill","#ccc").attr("font-size",10).text(o.label)}),g+=45),d&&(j.append("line").attr("x1",8).attr("y1",g).attr("x2",22).attr("y2",g).attr("stroke","#ff6b6b").attr("stroke-width",1.5).attr("stroke-dasharray","5,3"),j.append("text").attr("x",28).attr("y",g+4).attr("fill","#ccc").attr("font-size",10).text("Galactic plane"),g+=15),l&&(j.append("line").attr("x1",8).attr("y1",g).attr("x2",22).attr("y2",g).attr("stroke","#f0c674").attr("stroke-width",1.5).attr("stroke-dasharray","3,3"),j.append("text").attr("x",28).attr("y",g+4).attr("fill","#ccc").attr("font-size",10).text("Ecliptic")),r.select("g.map-content"),r.selectAll("*:not(.legend-group)");const D=et().scaleExtent([.5,8]).on("zoom",c=>{r.selectAll("path, circle, text:not(.legend-text), line:not(.legend-line)").attr("transform",c.transform.toString())});r.call(D),r.on("dblclick.zoom",()=>{r.transition().duration(500).call(D.transform,at)})},[s,h,a,e,d,l,u,i,E,P,$,y]);const B=(r,p)=>{const b=r/15,k=Math.floor(b),R=Math.floor((b-k)*60),z=`${k}h ${R}m`,A=p>=0?"+":"",j=Math.floor(Math.abs(p)),M=Math.floor((Math.abs(p)-j)*60),g=`${A}${j}° ${M}'`;return`${z}, ${g}`};return t.jsxs("div",{className:`relative ${N}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("div",{className:"flex items-center gap-4",children:t.jsxs("label",{className:"text-sm text-gray-600",children:["Projection:",t.jsxs("select",{value:h,onChange:r=>I(r.target.value),className:"ml-2 px-2 py-1 border border-gray-300 rounded text-sm",children:[t.jsx("option",{value:"aitoff",children:"Aitoff"}),t.jsx("option",{value:"mollweide",children:"Mollweide"}),t.jsx("option",{value:"hammer",children:"Hammer"}),t.jsx("option",{value:"mercator",children:"Mercator"})]})]})}),t.jsxs("div",{className:"text-sm text-gray-500",children:[s.length," pointings"]})]}),t.jsx("svg",{ref:v,width:a,height:e,className:"rounded-lg shadow-md"}),m&&t.jsxs("div",{className:"fixed bg-white border border-gray-200 rounded-lg shadow-lg p-3 z-50 pointer-events-none",style:{left:L.x+15,top:L.y+15},children:[t.jsx("p",{className:"font-semibold text-sm",children:m.label||m.id}),t.jsx("p",{className:"text-xs text-gray-500",children:B(m.ra,m.dec)}),m.status&&t.jsxs("p",{className:"text-xs mt-1",children:["Status:"," ",t.jsx("span",{className:`font-medium ${m.status==="completed"?"text-green-600":m.status==="scheduled"?"text-yellow-600":"text-red-600"}`,children:m.status})]}),m.epoch&&t.jsxs("p",{className:"text-xs text-gray-400",children:["Epoch: ",m.epoch]})]})]})},yt=()=>{const{data:s,isLoading:n}=st(),{data:a,isLoading:e}=rt(),{data:d,isLoading:l}=ot(),f=[{label:"Total Images",value:s?.length??0,icon:"IMG",href:"/images",variant:"primary"},{label:"Detected Sources",value:a?.length??0,icon:"SRC",href:"/sources",variant:"success"},{label:"Pipeline Jobs",value:d?.length??0,icon:"JOB",href:"/jobs",variant:"info"}],u=K.useMemo(()=>s?s.filter(i=>i.pointing_ra_deg!=null&&i.pointing_dec_deg!=null).map(i=>({id:i.id,ra:i.pointing_ra_deg,dec:i.pointing_dec_deg,label:i.path?.split("/").pop()||i.id,status:i.qa_grade==="good"?"completed":i.qa_grade==="fail"?"failed":"scheduled"})):[],[s]);return t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"DSA-110 Continuum Imaging Pipeline"}),t.jsx("p",{className:"text-gray-600 mb-8",children:"Monitor and manage the radio imaging pipeline for the Deep Synoptic Array."}),t.jsxs("section",{className:"mb-8",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Pipeline Overview"}),t.jsx(dt,{cards:f,isLoading:n||e||l})]}),u.length>0&&t.jsxs("section",{className:"mb-8",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Sky Coverage"}),t.jsx("div",{className:"card p-4",children:t.jsx(mt,{pointings:u,height:350,showGalacticPlane:!0,showEcliptic:!0,colorScheme:"status"})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-10",children:[t.jsx(_,{title:"Images",description:"Browse processed FITS images and view QA assessments.",link:"/images",icon:"IMG"}),t.jsx(_,{title:"Sources",description:"Explore detected radio sources and lightcurves.",link:"/sources",icon:"SRC"}),t.jsx(_,{title:"Jobs",description:"Monitor pipeline jobs and view provenance.",link:"/jobs",icon:"JOB"})]}),t.jsxs("section",{className:"card p-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Quick Links"}),t.jsxs("ul",{className:"space-y-2",children:[t.jsx("li",{children:t.jsx("a",{href:"/docs/troubleshooting.md",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline",children:"Troubleshooting Guide"})}),t.jsx("li",{children:t.jsx("a",{href:"/api/health",target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline",children:"API Health Check"})})]})]})]})},_=({title:s,description:n,link:a,icon:e})=>t.jsxs(H,{to:a,className:"card p-6 hover:shadow-lg transition-shadow group",children:[t.jsx("div",{className:"text-3xl mb-3",children:e}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 group-hover:text-blue-600 transition-colors mb-2",children:s}),t.jsx("p",{className:"text-gray-600 text-sm",children:n})]});export{yt as default};
//# sourceMappingURL=HomePage-B7eSrqrP.js.map
