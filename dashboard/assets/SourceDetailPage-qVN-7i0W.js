import{r as c,j as e,u as U,L as J}from"./index-rXVEaW0a.js";import{E as W,C as D,P as G,a as K}from"./CoordinateDisplay-T50UYqpN.js";import{u as Z,L as Y}from"./appStore-CYaC2mfb.js";import{A as X}from"./AladinLiteViewer-B-ZotVd2.js";import{i as ee}from"./echarts-COlWhqYE.js";import{b as te}from"./provenanceMappers-Dk7u1RY2.js";import{r as se}from"./relativeTime-Dp84ug83.js";import{e as re}from"./useQueries-BWf6tOCn.js";const ae=({data:t,title:i,yAxisLabel:h="Flux (Jy)",xAxisLabel:o="Time",height:p=350,enableZoom:u=!0,showErrorBars:b=!0,className:j="",onPointClick:f,isLoading:y=!1})=>{const x=c.useRef(null),m=c.useRef(null),[g,w]=c.useState(null),C=c.useCallback(r=>r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),[]);c.useEffect(()=>{if(g||!x.current||y)return;if(!m.current)try{m.current=ee(x.current)}catch(l){w(l instanceof Error?l.message:"Failed to initialize chart");return}const r=t.map(l=>[typeof l.time=="string"?new Date(l.time).getTime():l.time,l.flux]),d=[];b&&t.forEach((l,E)=>{if(l.fluxError!==void 0){const $=r[E][0];d.push({coord:[$,l.flux-l.fluxError,$,l.flux+l.fluxError]})}});const N=l=>Math.abs(l)<.001?`${(l*1e6).toFixed(1)} μJy`:Math.abs(l)<1?`${(l*1e3).toFixed(2)} mJy`:`${l.toFixed(3)} Jy`,_={title:i?{text:i,left:"center",textStyle:{fontSize:14,fontWeight:"bold"}}:void 0,tooltip:{trigger:"item",formatter:l=>{const E=t[l.dataIndex],$=new Date(l.data[0]);let I=`<div class="text-sm">
            <div class="font-medium">${C($.toLocaleString())}</div>
            <div>Flux: ${C(N(l.data[1]))}</div>`;return E?.fluxError&&(I+=`<div>Error: ±${C(N(E.fluxError))}</div>`),E?.label&&(I+=`<div class="text-gray-500">${C(E.label)}</div>`),I+="</div>",I},axisPointer:{type:"cross"}},xAxis:{type:"time",name:o,nameLocation:"middle",axisLabel:{formatter:l=>{const E=new Date(l);return`${E.getMonth()+1}/${E.getDate()}`}}},yAxis:{type:"value",name:h,nameLocation:"middle",axisLabel:{formatter:N}},series:[{type:"line",data:r,symbolSize:8,itemStyle:{color:"#3b82f6"},lineStyle:{width:2},showSymbol:!0,emphasis:{focus:"series",itemStyle:{shadowBlur:10,shadowColor:"rgba(59, 130, 246, 0.5)"}}}],dataZoom:u?[{type:"inside",start:0,end:100,xAxisIndex:0},{type:"slider",start:0,end:100,xAxisIndex:0}]:void 0,grid:{left:"15%",right:"10%",bottom:u?"20%":"15%",top:i?"15%":"10%",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none",title:{zoom:"Zoom",back:"Reset"}},restore:{title:"Restore"},saveAsImage:{title:"Save"}}}};return m.current.setOption(_),f&&(m.current.off("click"),m.current.on("click",l=>{l.dataIndex!==void 0&&f(t[l.dataIndex],l.dataIndex)})),()=>{m.current&&m.current.off("click")}},[g,t,i,h,o,u,b,f,y,C]),c.useEffect(()=>{const r=()=>{m.current&&m.current.resize()};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),c.useEffect(()=>()=>{m.current&&(m.current.dispose(),m.current=null)},[]);const n=c.useCallback(()=>{m.current&&m.current.dispatchAction({type:"dataZoom",dataZoomIndex:0,start:0,end:100})},[]),R=typeof p=="number"?`${p}px`:p;return g?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${j}`,style:{height:R},children:e.jsxs("div",{className:"text-center text-gray-500 p-4",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("p",{className:"text-sm",children:g})]})}):y?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${j}`,style:{height:R},children:e.jsxs("div",{className:"flex flex-col items-center text-gray-500",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("span",{className:"text-sm",children:"Loading light curve..."})]})}):!t||t.length===0?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${j}`,style:{height:R},children:e.jsxs("div",{className:"text-center text-gray-500 p-4",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("p",{className:"text-sm",children:"No light curve data available"})]})}):e.jsxs("div",{className:`relative ${j}`,children:[e.jsx("div",{ref:x,style:{height:R,width:"100%"}}),u&&e.jsx("button",{type:"button",onClick:n,className:"absolute top-2 right-2 bg-white/90 hover:bg-white px-2 py-1 rounded shadow text-xs text-gray-700 hover:text-gray-900 transition-colors",title:"Reset zoom",children:"Reset Zoom"})]})},z=[{id:"gaia",name:"Gaia DR3",vizierTable:"I/355/gaiadr3",raColumn:"RA_ICRS",decColumn:"DE_ICRS",color:"#ff0000",symbol:"circle",description:"Gaia Data Release 3 - optical astrometry and photometry",defaultEnabled:!1},{id:"tess",name:"TESS TIC v8.2",vizierTable:"IV/39/tic82",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#db01fd",symbol:"diamond",description:"TESS Input Catalog - stars observed by TESS",defaultEnabled:!1},{id:"ps1",name:"Pan-STARRS DR1",vizierTable:"II/349/ps1",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#0066ff",symbol:"square",description:"Pan-STARRS1 Survey - optical photometry",defaultEnabled:!1},{id:"2mass",name:"2MASS",vizierTable:"II/246/out",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ff9900",symbol:"triangle",description:"Two Micron All Sky Survey - near-infrared",defaultEnabled:!1},{id:"wise",name:"AllWISE",vizierTable:"II/328/allwise",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#00cc66",symbol:"star",description:"Wide-field Infrared Survey Explorer",defaultEnabled:!1},{id:"nvss",name:"NVSS",vizierTable:"VIII/65/nvss",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#00cccc",symbol:"plus",description:"NRAO VLA Sky Survey - 1.4 GHz radio",defaultEnabled:!1},{id:"first",name:"FIRST",vizierTable:"VIII/92/first14",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#cc00cc",symbol:"cross",description:"Faint Images of the Radio Sky at Twenty-cm",defaultEnabled:!1},{id:"sumss",name:"SUMSS",vizierTable:"VIII/81B/sumss212",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ffcc00",symbol:"circle",description:"Sydney University Molonglo Sky Survey - 843 MHz",defaultEnabled:!1},{id:"racs",name:"RACS-Low",vizierTable:"J/other/PASA/38.58/gausscut",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#66ff66",symbol:"diamond",description:"Rapid ASKAP Continuum Survey - 887 MHz",defaultEnabled:!1},{id:"vlass",name:"VLASS",vizierTable:"J/ApJS/255/30/table1",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ff6666",symbol:"square",description:"VLA Sky Survey - 3 GHz radio",defaultEnabled:!1},{id:"atnf",name:"ATNF Pulsars",vizierTable:"B/psr/psr",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ffffff",symbol:"star",description:"Australia Telescope National Facility Pulsar Catalogue",defaultEnabled:!1}],ne=({catalogs:t,className:i=""})=>{if(t.length===0)return null;const h=o=>{const u={fill:o.color,stroke:o.color};switch(o.symbol){case"circle":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("circle",{cx:"6",cy:"6",r:"5",...u,fillOpacity:.3,strokeWidth:1.5})});case"square":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("rect",{x:"1",y:"1",width:"10",height:"10",...u,fillOpacity:.3,strokeWidth:1.5})});case"diamond":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 11,6 6,11 1,6",...u,fillOpacity:.3,strokeWidth:1.5})});case"triangle":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 11,11 1,11",...u,fillOpacity:.3,strokeWidth:1.5})});case"star":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 7.5,4.5 11,5 8.5,7.5 9,11 6,9 3,11 3.5,7.5 1,5 4.5,4.5",...u,fillOpacity:.3,strokeWidth:1})});case"plus":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("path",{d:"M6,1 L6,11 M1,6 L11,6",stroke:o.color,strokeWidth:2,fill:"none"})});case"cross":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("path",{d:"M1,1 L11,11 M11,1 L1,11",stroke:o.color,strokeWidth:2,fill:"none"})});default:return e.jsx("span",{className:"inline-block w-3 h-3 rounded-full",style:{backgroundColor:o.color}})}};return e.jsx("div",{className:`flex flex-wrap gap-3 text-xs ${i}`,children:t.map(o=>e.jsxs("div",{className:"flex items-center gap-1",title:o.description,children:[h(o),e.jsx("span",{style:{color:o.color},children:o.name})]},o.id))})},ie="https://tapvizier.cds.unistra.fr/TAPVizieR/tap/sync",Q=1e3,P=200;class oe{queue=[];processing=!1;lastRequestTime=0;async enqueue(i){return new Promise((h,o)=>{this.queue.push(async()=>{try{const p=await i();h(p)}catch(p){o(p)}}),this.processQueue()})}async processQueue(){if(!this.processing){for(this.processing=!0;this.queue.length>0;){const h=Date.now()-this.lastRequestTime;h<P&&await new Promise(p=>setTimeout(p,P-h));const o=this.queue.shift();o&&(this.lastRequestTime=Date.now(),await o())}this.processing=!1}}}const ce=new oe;function le(t,i,h,o){const p=t.raColumn||"RAJ2000",u=t.decColumn||"DEJ2000";return`
    SELECT TOP ${Q} 
      ${p} as ra, 
      ${u} as dec,
      *
    FROM "${t.vizierTable}"
    WHERE 1=CONTAINS(
      POINT('ICRS', ${p}, ${u}),
      CIRCLE('ICRS', ${i}, ${h}, ${o})
    )
  `.trim()}function de(t,i,h,o){const u=new DOMParser().parseFromString(t,"text/xml"),b=u.querySelector("INFO[name='QUERY_STATUS'][value='ERROR']");if(b)throw new Error(b.textContent||"Query failed");const f=Array.from(u.querySelectorAll("FIELD")).map(w=>w.getAttribute("name")||"");let y=f.findIndex(w=>w.toLowerCase()==="ra"),x=f.findIndex(w=>w.toLowerCase()==="dec");if(y===-1&&(y=f.findIndex(w=>w===h)),x===-1&&(x=f.findIndex(w=>w===o)),y===-1||x===-1)return console.warn(`Could not find RA/Dec columns for ${i}`,f),[];const m=u.querySelectorAll("TR"),g=[];return m.forEach((w,C)=>{const n=w.querySelectorAll("TD");if(n.length>Math.max(y,x)){const R=parseFloat(n[y].textContent||""),r=parseFloat(n[x].textContent||"");!isNaN(R)&&!isNaN(r)&&g.push({ra:R,dec:r,id:`${i}_${C}`,catalog:i})}}),g}async function ue(t,i,h,o,p){return ce.enqueue(async()=>{const u=o/60,b=t.raColumn||"RAJ2000",j=t.decColumn||"DEJ2000";try{const f=le(t,i,h,u),y=new URLSearchParams({REQUEST:"doQuery",LANG:"ADQL",FORMAT:"votable",QUERY:f}),x=await fetch(`${ie}?${y}`,{signal:p,headers:{Accept:"application/xml"}});if(!x.ok)throw new Error(`HTTP ${x.status}: ${x.statusText}`);const m=await x.text(),g=de(m,t.id,b,j);return{catalogId:t.id,sources:g,count:g.length,truncated:g.length>=Q}}catch(f){if(f instanceof Error&&f.name==="AbortError")throw f;return{catalogId:t.id,sources:[],count:0,truncated:!1,error:f instanceof Error?f.message:"Query failed"}}})}const O=new Map,me=300*1e3;async function xe(t,i,h,o,p){const u=`${t.id}:${i.toFixed(4)}:${h.toFixed(4)}:${o.toFixed(1)}`,b=O.get(u);if(b&&Date.now()-b.timestamp<me)return b.result;const j=await ue(t,i,h,o,p);return j.error||O.set(u,{result:j,timestamp:Date.now()}),j}const he=({enabledCatalogs:t,onCatalogChange:i,centerRa:h,centerDec:o,searchRadius:p=5,onSourcesLoaded:u,aladinRef:b,className:j=""})=>{const[f,y]=c.useState(!1),[x,m]=c.useState(p),[g,w]=c.useState(new Map),[C,n]=c.useState(new Set),[R,r]=c.useState(p),d=c.useRef(null),N=c.useRef(new Map);c.useEffect(()=>{x!==R&&(w(new Map),r(x))},[x,R]),c.useEffect(()=>()=>{d.current&&d.current.abort()},[]),c.useEffect(()=>{if(h===void 0||o===void 0)return;if(t.length===0){l(),w(new Map);return}d.current&&d.current.abort(),d.current=new AbortController;const a=d.current.signal,v=t.filter(S=>!g.has(S)||g.get(S)?.error);if(v.length!==0)return n(S=>new Set([...S,...v])),v.forEach(async S=>{const T=z.find(k=>k.id===S);if(T)try{const k=await xe(T,h,o,x,a);if(a.aborted)return;w(M=>{const F=new Map(M);return F.set(S,k),F}),b?.current&&k.sources.length>0&&_(T,k.sources)}catch(k){if(k instanceof Error&&k.name==="AbortError")return;console.error(`Failed to query ${S}:`,k)}finally{a.aborted||n(k=>{const M=new Set(k);return M.delete(S),M})}}),()=>{d.current?.abort()}},[t,h,o,x]),c.useEffect(()=>{if(u){const a=new Map;g.forEach((v,S)=>{v.sources.length>0&&a.set(S,v.sources)}),u(a)}},[g,u]);const _=c.useCallback((a,v)=>{if(!b?.current)return;const S=b.current,T=N.current.get(a.id);T&&S.removeLayer(T);const k=window.A?.catalog({name:a.name,sourceSize:12,color:a.color,shape:a.symbol==="circle"?"circle":a.symbol==="square"?"square":a.symbol==="diamond"?"rhomb":"circle"});k&&(v.forEach(M=>{const F=window.A?.source(M.ra,M.dec,{name:M.id,catalog:a.name});F&&k.addSources([F])}),S.addCatalog(k),N.current.set(a.id,k))},[b]),l=c.useCallback(()=>{b?.current&&(N.current.forEach(a=>{try{b.current.removeLayer(a)}catch{}}),N.current.clear())},[b]);c.useEffect(()=>{N.current.forEach((a,v)=>{if(!t.includes(v)&&b?.current)try{b.current.removeLayer(a),N.current.delete(v)}catch{}})},[t,b]);const E=c.useCallback(a=>{t.includes(a)?i(t.filter(v=>v!==a)):i([...t,a])},[t,i]),$=c.useCallback(()=>{t.length===z.length?i([]):i(z.map(a=>a.id))},[t.length,i]),I=z.filter(a=>t.includes(a.id)),s=C.size>0,L=z.filter(a=>["gaia","tess","ps1","2mass","wise"].includes(a.id)),A=z.filter(a=>["nvss","first","sumss","racs","vlass","atnf"].includes(a.id)),q=a=>{const v=g.get(a);return v?v.error?"!":v.truncated?`${v.count}+`:v.count.toString():null},B=a=>{const v=q(a.id),S=C.has(a.id),T=g.get(a.id)?.error;return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm hover:bg-gray-50 p-1 rounded",title:T||a.description,children:[e.jsx("input",{type:"checkbox",checked:t.includes(a.id),onChange:()=>E(a.id),className:"w-4 h-4 rounded",style:{accentColor:a.color}}),e.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:a.color}}),e.jsx("span",{className:"flex-1",children:a.name}),S&&e.jsx("span",{className:"w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin"}),!S&&v&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${T?"bg-red-100 text-red-600":"bg-gray-100 text-gray-600"}`,children:v})]},a.id)},H=h!==void 0&&o!==void 0;return e.jsxs("div",{className:`${j}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-700",children:"VizieR Catalogues"}),s&&e.jsx("span",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),t.length>0&&e.jsx("span",{className:"badge badge-secondary text-xs",children:t.length})]}),e.jsxs("button",{onClick:()=>y(!f),className:"text-sm text-blue-600 hover:text-blue-800",children:[f?"Hide":"Show"," options"]})]}),I.length>0&&e.jsx(ne,{catalogs:I,className:"mb-2"}),f&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 bg-white space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx("label",{className:"text-xs text-gray-600 whitespace-nowrap",children:"Search radius:"}),e.jsx("input",{type:"number",min:.5,max:60,step:.5,value:x,onChange:a=>m(Math.max(.5,Math.min(60,parseFloat(a.target.value)||5))),className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded"}),e.jsx("span",{className:"text-xs text-gray-500",children:"arcmin"})]}),!H&&e.jsx("div",{className:"text-xs text-amber-600 bg-amber-50 p-2 rounded",children:"Set center coordinates to query catalogs"}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-100",children:[e.jsx("button",{onClick:$,className:"text-xs text-blue-600 hover:text-blue-800",children:t.length===z.length?"Deselect all":"Select all"}),e.jsx("button",{onClick:()=>{i([]),w(new Map)},className:"text-xs text-gray-500 hover:text-red-500",children:"Clear"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Optical / Infrared"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:L.map(B)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Radio"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:A.map(B)})]}),g.size>0&&e.jsxs("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-100",children:[Array.from(g.values()).reduce((a,v)=>a+v.count,0)," sources loaded",Array.from(g.values()).some(a=>a.truncated)&&" (some truncated)"]})]})]})},fe=({raDeg:t,decDeg:i,initialRadius:h=2,maxRadius:o=60,onSearch:p,className:u="",excludeId:b})=>{const[j,f]=c.useState(h),[y,x]=c.useState([]),[m,g]=c.useState(!1),[w,C]=c.useState(null),[n,R]=c.useState("separation"),[r,d]=c.useState("asc"),N=c.useCallback(async()=>{g(!0),C(null);try{const s=await p(t,i,j);x(s)}catch(s){C(s instanceof Error?s.message:"Search failed"),x([])}finally{g(!1)}},[t,i,j,p]);c.useEffect(()=>{N()},[]);const _=c.useCallback(s=>{R(L=>(d(L===s?A=>A==="asc"?"desc":"asc":"asc"),s))},[]),l=[...y].sort((s,L)=>{let A=0;switch(n){case"name":A=s.name.localeCompare(L.name);break;case"database":A=s.database.localeCompare(L.database);break;case"separation":A=s.separation-L.separation;break}return r==="asc"?A:-A}),E=s=>{switch(s){case"SIMBAD":return"badge-info";case"NED":return"badge-success";case"ATNF":return"badge-warning";case"Local":return"badge-secondary"}},$=s=>{if(s.url)return s.url;switch(s.database){case"SIMBAD":return`https://simbad.u-strasbg.fr/simbad/sim-id?Ident=${encodeURIComponent(s.name)}`;case"NED":return`https://ned.ipac.caltech.edu/byname?objname=${encodeURIComponent(s.name)}`;case"ATNF":return`https://www.atnf.csiro.au/research/pulsar/psrcat/proc_form.php?pulsar_names=${encodeURIComponent(s.name)}`;default:return}},I=({column:s})=>n!==s?e.jsxs("svg",{className:"w-3 h-3 text-gray-300 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:[e.jsx("path",{d:"M5 2l2 2H3z",fill:"currentColor"}),e.jsx("path",{d:"M5 8L3 6h4z",fill:"currentColor"})]}):r==="asc"?e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:e.jsx("path",{d:"M5 2l3 4H2z",fill:"currentColor"})}):e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:e.jsx("path",{d:"M5 8L2 4h6z",fill:"currentColor"})});return e.jsxs("div",{className:`card ${u}`,children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"text-lg font-semibold",children:"Nearby Objects"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("label",{className:"text-sm text-gray-600 whitespace-nowrap",children:"Search within"}),e.jsx("input",{type:"number",value:j,onChange:s=>f(Math.min(Number(s.target.value),o)),min:.1,max:o,step:.5,className:"form-control w-20"}),e.jsx("span",{className:"text-sm text-gray-600",children:"arcmin"}),e.jsx("button",{onClick:N,disabled:m,className:"btn btn-primary btn-sm",children:m?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Searching..."]}):"Search"})]}),w&&e.jsx("div",{className:"alert alert-danger mb-4",children:e.jsx("p",{children:w})}),m?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Searching databases..."})]}):y.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsxs("p",{children:["No nearby objects found within ",j," arcmin"]})]}):e.jsx("div",{className:"overflow-x-auto max-h-80 overflow-y-auto",children:e.jsxs("table",{className:"table table-compact",children:[e.jsx("thead",{className:"sticky top-0",children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>_("name"),className:"cursor-pointer hover:bg-opacity-80",children:["Name ",e.jsx(I,{column:"name"})]}),e.jsxs("th",{onClick:()=>_("database"),className:"cursor-pointer hover:bg-opacity-80",children:["Database ",e.jsx(I,{column:"database"})]}),e.jsx("th",{className:"text-center",children:"RA"}),e.jsx("th",{className:"text-center",children:"Dec"}),e.jsxs("th",{onClick:()=>_("separation"),className:"cursor-pointer hover:bg-opacity-80 text-right",children:["Sep (″) ",e.jsx(I,{column:"separation"})]})]})}),e.jsx("tbody",{children:l.map((s,L)=>{const A=$(s);return e.jsxs("tr",{children:[e.jsxs("td",{children:[A?e.jsx("a",{href:A,target:"_blank",rel:"noreferrer",className:"link",children:s.name}):s.name,s.type&&e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",s.type,")"]})]}),e.jsx("td",{children:e.jsx("span",{className:`badge ${E(s.database)}`,children:s.database})}),e.jsx("td",{className:"text-center font-mono text-xs",children:s.ra}),e.jsx("td",{className:"text-center font-mono text-xs",children:s.dec}),e.jsx("td",{className:"text-right font-mono",children:s.separation.toFixed(2)})]},`${s.database}-${s.name}-${L}`)})})]})}),y.length>0&&e.jsxs("div",{className:"mt-3 text-xs text-gray-500 flex justify-between",children:[e.jsxs("span",{children:[y.length," object",y.length!==1?"s":""," found"]}),e.jsxs("span",{children:["SIMBAD: ",y.filter(s=>s.database==="SIMBAD").length," | NED:"," ",y.filter(s=>s.database==="NED").length," | ATNF:"," ",y.filter(s=>s.database==="ATNF").length," | Local:"," ",y.filter(s=>s.database==="Local").length]})]})]})]})},V=({className:t="w-4 h-4"})=>e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),Se=()=>{const{sourceId:t}=U(),{data:i,isLoading:h,error:o,refetch:p}=re(t),u=Z(r=>r.addRecentSource),[b,j]=c.useState(void 0),[f,y]=c.useState(!0),x=t?encodeURIComponent(t):"",[m,g]=c.useState(!1),w=async(r,d,N)=>{const _=[];try{const l=`SELECT TOP 20 main_id, ra, dec, otype_longname
        FROM basic
        WHERE CONTAINS(POINT('ICRS', ra, dec), CIRCLE('ICRS', ${r}, ${d}, ${N/60})) = 1`,E=await fetch(`https://simbad.u-strasbg.fr/simbad/sim-tap/sync?REQUEST=doQuery&LANG=ADQL&FORMAT=json&QUERY=${encodeURIComponent(l)}`);if(E.ok){const I=(await E.json()).data||[];for(const s of I){const L=parseFloat(s[1]),A=parseFloat(s[2]),q=Math.sqrt(Math.pow((r-L)*Math.cos(d*Math.PI/180),2)+Math.pow(d-A,2))*3600;_.push({name:s[0],ra:L.toFixed(6),dec:A.toFixed(6),separation:q,database:"SIMBAD",type:s[3]||void 0,url:`https://simbad.u-strasbg.fr/simbad/sim-id?Ident=${encodeURIComponent(s[0])}`})}}}catch(l){console.warn("SIMBAD query failed:",l)}return _};c.useEffect(()=>{i&&t&&u(t)},[i,t,u]),c.useEffect(()=>{const r=i;r?.contributing_images?.length&&j(r.contributing_images[0].image_id)},[i]);const C=c.useMemo(()=>{const r=i;return r?.contributing_images?r.contributing_images.filter(d=>d.flux_jy!==void 0&&d.created_at).map(d=>({time:d.created_at,flux:d.flux_jy,fluxError:d.flux_error_jy,label:d.path?.split("/").pop()||d.image_id})).sort((d,N)=>new Date(d.time).getTime()-new Date(N.time).getTime()):[]},[i]);if(h)return e.jsx(Y,{label:"Loading source details..."});if(o)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx(W,{error:o,onRetry:()=>p()})});if(!i)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs(D,{children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"Source not found."}),e.jsx(J,{to:"/sources",className:"link",children:"Back to Sources"})]})});const n=i,R=te(n,b);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(J,{to:"/sources",className:"text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block",children:"Back to Sources"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:n.name||`Source ${n.id}`}),R&&e.jsx(G,{...R})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 sticky-sidebar",children:[e.jsxs(D,{title:"Position",children:[e.jsx(K,{raDeg:n.ra_deg,decDeg:n.dec_deg,showDecimal:!0,allowFormatToggle:!0}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-2",children:[e.jsxs("a",{href:`https://simbad.u-strasbg.fr/simbad/sim-coo?Coord=${n.ra_deg}+${n.dec_deg}&CooFrame=FK5&CooEpoch=2000&CooEqui=2000&Radius=2&Radius.unit=arcmin`,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-800 hover:underline",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),"Search in SIMBAD",e.jsx(V,{className:"w-3 h-3"})]}),e.jsxs("a",{href:`https://ned.ipac.caltech.edu/conesearch?search_type=Near%20Position%20Search&ra=${n.ra_deg}&dec=${n.dec_deg}&radius=2&in_csys=Equatorial&in_equinox=J2000`,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-800 hover:underline",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"})}),"Search in NED",e.jsx(V,{className:"w-3 h-3"})]})]})]}),e.jsx(D,{title:"Actions",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${x}/lightcurve`,"_blank"),children:"View Lightcurve"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${x}/postage_stamps`,"_blank"),children:"Download Postage Stamps"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${x}/variability`,"_blank"),children:"Variability Analysis"})]})}),e.jsx(D,{title:"Details",children:e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Source ID"}),e.jsx("dd",{className:"font-mono text-sm text-gray-900",children:n.id})]}),n.name&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Name"}),e.jsx("dd",{className:"text-sm text-gray-900",children:n.name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Detections"}),e.jsxs("dd",{className:"text-sm text-gray-900",children:[n.contributing_images?.length||0," images"]})]})]})})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(D,{title:"Sky View",subtitle:e.jsx("button",{type:"button",onClick:()=>y(!f),className:"text-xs text-blue-600 hover:text-blue-800",children:f?"Hide":"Show"}),children:f&&e.jsx(X,{raDeg:n.ra_deg,decDeg:n.dec_deg,fov:.1,height:300,sourceName:n.name||`Source ${n.id}`,className:"rounded-lg overflow-hidden"})}),e.jsx(D,{title:"Catalog Crossmatch",children:e.jsx(he,{centerRa:n.ra_deg,centerDec:n.dec_deg,defaultRadius:2})}),e.jsxs(D,{title:"Nearby Objects",subtitle:e.jsx("button",{type:"button",onClick:()=>g(!m),className:"text-xs text-blue-600 hover:text-blue-800",children:m?"Hide":"Search SIMBAD"}),children:[m&&e.jsx(fe,{raDeg:n.ra_deg,decDeg:n.dec_deg,initialRadius:2,maxRadius:30,onSearch:w}),!m&&e.jsx("p",{className:"text-sm text-gray-500",children:'Click "Search SIMBAD" to find nearby objects in external catalogs.'})]}),C.length>1&&e.jsx(D,{title:"Light Curve",subtitle:`${C.length} measurements`,children:e.jsx(ae,{data:C,height:300,yAxisLabel:"Flux",xAxisLabel:"Observation Date",enableZoom:!0,showErrorBars:!0,onPointClick:r=>{const d=n.contributing_images?.find(N=>N.created_at===r.time);d&&j(d.image_id)}})}),n.contributing_images&&n.contributing_images.length>0&&e.jsx(D,{title:"Contributing Images",subtitle:`${n.contributing_images.length} detection${n.contributing_images.length!==1?"s":""}`,children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:n.contributing_images.map(r=>e.jsxs("div",{className:`p-3 rounded-lg border-2 cursor-pointer transition-all ${b===r.image_id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}`,onClick:()=>j(r.image_id),onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&j(r.image_id)},role:"button",tabIndex:0,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(J,{to:`/images/${r.image_id}`,className:"font-medium text-gray-900 hover:text-blue-600 truncate block",onClick:d=>d.stopPropagation(),children:r.path?.split("/").pop()||r.image_id}),r.ms_path&&e.jsxs("div",{className:"text-xs text-gray-500 truncate mt-0.5",children:["MS: ",r.ms_path.split("/").pop()]})]}),r.qa_grade&&e.jsx("span",{className:`badge ml-2 ${r.qa_grade==="good"?"badge-success":r.qa_grade==="warn"?"badge-warning":"badge-error"}`,children:r.qa_grade})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500",children:[r.flux_jy!==void 0&&e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"Flux:"})," ",r.flux_jy<.001?`${(r.flux_jy*1e6).toFixed(1)} μJy`:r.flux_jy<1?`${(r.flux_jy*1e3).toFixed(2)} mJy`:`${r.flux_jy.toFixed(3)} Jy`]}),r.created_at&&e.jsx("span",{title:new Date(r.created_at).toLocaleString(),children:se(r.created_at)})]})]},r.image_id))})}),(!n.contributing_images||n.contributing_images.length===0)&&e.jsx(D,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{children:"No contributing images found for this source."})]})})]})]})]})};export{Se as default};
//# sourceMappingURL=SourceDetailPage-qVN-7i0W.js.map
