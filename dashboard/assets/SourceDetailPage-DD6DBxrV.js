import{_ as G,r as l,j as e,u as K,L as B}from"./index-a6McjROp.js";import{E as Z,C as I,P as Y,a as X}from"./CoordinateDisplay-CxElOcW1.js";import{u as ee,L as te}from"./appStore-B5qSIe6K.js";import{A as se}from"./AladinLiteViewer-4ddxAsek.js";import{b as re}from"./provenanceMappers-Dk7u1RY2.js";import{r as ae}from"./relativeTime-Dp84ug83.js";import{e as ne}from"./useQueries-Cs64MlL7.js";let O=null;const ie=async()=>(O||(O=G(()=>import("./echarts-BlxdVhSE.js"),[])),O),P=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),oe=({data:t,title:i,yAxisLabel:h="Flux (Jy)",xAxisLabel:o="Time",height:x=350,enableZoom:m=!0,showErrorBars:p=!0,className:w="",onPointClick:f,isLoading:v=!1,autoLoad:b=!1})=>{const S=l.useRef(null),u=l.useRef(null),[g,k]=l.useState(null),[n,R]=l.useState(b);l.useEffect(()=>{if(!n||g||!S.current||v)return;let N=!1;return(async()=>{try{const _=await ie();if(!S.current||N)return;u.current||(u.current=_.init(S.current));const D=t.map(c=>[typeof c.time=="string"?new Date(c.time).getTime():c.time,c.flux]),q=[];p&&t.forEach((c,y)=>{if(c.fluxError!==void 0){const T=D[y][0];q.push({coord:[T,c.flux-c.fluxError,T,c.flux+c.fluxError]})}});const A=c=>Math.abs(c)<.001?`${(c*1e6).toFixed(1)} μJy`:Math.abs(c)<1?`${(c*1e3).toFixed(2)} mJy`:`${c.toFixed(3)} Jy`,s={title:i?{text:i,left:"center",textStyle:{fontSize:14,fontWeight:"bold"}}:void 0,tooltip:{trigger:"item",formatter:c=>{const y=t[c.dataIndex],T=new Date(c.data[0]);let z=`<div class="text-sm">
                <div class="font-medium">${P(T.toLocaleString())}</div>
                <div>Flux: ${P(A(c.data[1]))}</div>`;return y?.fluxError&&(z+=`<div>Error: ±${P(A(y.fluxError))}</div>`),y?.label&&(z+=`<div class="text-gray-500">${P(y.label)}</div>`),z+="</div>",z},axisPointer:{type:"cross"}},xAxis:{type:"time",name:o,nameLocation:"middle",axisLabel:{formatter:c=>{const y=new Date(c);return`${y.getMonth()+1}/${y.getDate()}`}}},yAxis:{type:"value",name:h,nameLocation:"middle",axisLabel:{formatter:A}},series:[{type:"line",data:D,symbolSize:8,itemStyle:{color:"#3b82f6"},lineStyle:{width:2},showSymbol:!0,emphasis:{focus:"series",itemStyle:{shadowBlur:10,shadowColor:"rgba(59, 130, 246, 0.5)"}}}],dataZoom:m?[{type:"inside",start:0,end:100,xAxisIndex:0},{type:"slider",start:0,end:100,xAxisIndex:0}]:void 0,grid:{left:"15%",right:"10%",bottom:m?"20%":"15%",top:i?"15%":"10%",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none",title:{zoom:"Zoom",back:"Reset"}},restore:{title:"Restore"},saveAsImage:{title:"Save"}}}};u.current.setOption(s),f&&(u.current.off("click"),u.current.on("click",c=>{c.dataIndex!==void 0&&f(t[c.dataIndex],c.dataIndex)}))}catch(_){N||k(_ instanceof Error?_.message:"Failed to render chart")}})(),()=>{N=!0,u.current&&u.current.off("click")}},[n,g,t,i,h,o,m,p,f,v]),l.useEffect(()=>{const N=()=>{u.current&&u.current.resize()};return window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]),l.useEffect(()=>()=>{u.current&&(u.current.dispose(),u.current=null)},[]);const a=l.useCallback(()=>{u.current&&u.current.dispatchAction({type:"dataZoom",dataZoomIndex:0,start:0,end:100})},[]),d=typeof x=="number"?`${x}px`:x;return n?g?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${w}`,style:{height:d},children:e.jsxs("div",{className:"text-center text-gray-500 p-4",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("p",{className:"text-sm",children:g})]})}):v?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${w}`,style:{height:d},children:e.jsxs("div",{className:"flex flex-col items-center text-gray-500",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("span",{className:"text-sm",children:"Loading light curve..."})]})}):!t||t.length===0?e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${w}`,style:{height:d},children:e.jsxs("div",{className:"text-center text-gray-500 p-4",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("p",{className:"text-sm",children:"No light curve data available"})]})}):e.jsxs("div",{className:`relative ${w}`,children:[e.jsx("div",{ref:S,style:{height:d,width:"100%"}}),m&&e.jsx("button",{type:"button",onClick:a,className:"absolute top-2 right-2 bg-white/90 hover:bg-white px-2 py-1 rounded shadow text-xs text-gray-700 hover:text-gray-900 transition-colors",title:"Reset zoom",children:"Reset Zoom"})]}):e.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${w}`,style:{height:typeof x=="number"?`${x}px`:x},children:e.jsxs("div",{className:"flex flex-col items-center text-gray-600 gap-2",children:[e.jsx("p",{className:"text-sm",children:"Chart library is not loaded."}),e.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>R(!0),"aria-label":"Load chart",children:"Load chart"})]})})},F=[{id:"gaia",name:"Gaia DR3",vizierTable:"I/355/gaiadr3",raColumn:"RA_ICRS",decColumn:"DE_ICRS",color:"#ff0000",symbol:"circle",description:"Gaia Data Release 3 - optical astrometry and photometry",defaultEnabled:!1},{id:"tess",name:"TESS TIC v8.2",vizierTable:"IV/39/tic82",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#db01fd",symbol:"diamond",description:"TESS Input Catalog - stars observed by TESS",defaultEnabled:!1},{id:"ps1",name:"Pan-STARRS DR1",vizierTable:"II/349/ps1",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#0066ff",symbol:"square",description:"Pan-STARRS1 Survey - optical photometry",defaultEnabled:!1},{id:"2mass",name:"2MASS",vizierTable:"II/246/out",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ff9900",symbol:"triangle",description:"Two Micron All Sky Survey - near-infrared",defaultEnabled:!1},{id:"wise",name:"AllWISE",vizierTable:"II/328/allwise",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#00cc66",symbol:"star",description:"Wide-field Infrared Survey Explorer",defaultEnabled:!1},{id:"nvss",name:"NVSS",vizierTable:"VIII/65/nvss",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#00cccc",symbol:"plus",description:"NRAO VLA Sky Survey - 1.4 GHz radio",defaultEnabled:!1},{id:"first",name:"FIRST",vizierTable:"VIII/92/first14",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#cc00cc",symbol:"cross",description:"Faint Images of the Radio Sky at Twenty-cm",defaultEnabled:!1},{id:"sumss",name:"SUMSS",vizierTable:"VIII/81B/sumss212",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ffcc00",symbol:"circle",description:"Sydney University Molonglo Sky Survey - 843 MHz",defaultEnabled:!1},{id:"racs",name:"RACS-Low",vizierTable:"J/other/PASA/38.58/gausscut",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#66ff66",symbol:"diamond",description:"Rapid ASKAP Continuum Survey - 887 MHz",defaultEnabled:!1},{id:"vlass",name:"VLASS",vizierTable:"J/ApJS/255/30/table1",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ff6666",symbol:"square",description:"VLA Sky Survey - 3 GHz radio",defaultEnabled:!1},{id:"atnf",name:"ATNF Pulsars",vizierTable:"B/psr/psr",raColumn:"RAJ2000",decColumn:"DEJ2000",color:"#ffffff",symbol:"star",description:"Australia Telescope National Facility Pulsar Catalogue",defaultEnabled:!1}],ce=({catalogs:t,className:i=""})=>{if(t.length===0)return null;const h=o=>{const m={fill:o.color,stroke:o.color};switch(o.symbol){case"circle":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("circle",{cx:"6",cy:"6",r:"5",...m,fillOpacity:.3,strokeWidth:1.5})});case"square":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("rect",{x:"1",y:"1",width:"10",height:"10",...m,fillOpacity:.3,strokeWidth:1.5})});case"diamond":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 11,6 6,11 1,6",...m,fillOpacity:.3,strokeWidth:1.5})});case"triangle":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 11,11 1,11",...m,fillOpacity:.3,strokeWidth:1.5})});case"star":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("polygon",{points:"6,1 7.5,4.5 11,5 8.5,7.5 9,11 6,9 3,11 3.5,7.5 1,5 4.5,4.5",...m,fillOpacity:.3,strokeWidth:1})});case"plus":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("path",{d:"M6,1 L6,11 M1,6 L11,6",stroke:o.color,strokeWidth:2,fill:"none"})});case"cross":return e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",children:e.jsx("path",{d:"M1,1 L11,11 M11,1 L1,11",stroke:o.color,strokeWidth:2,fill:"none"})});default:return e.jsx("span",{className:"inline-block w-3 h-3 rounded-full",style:{backgroundColor:o.color}})}};return e.jsx("div",{className:`flex flex-wrap gap-3 text-xs ${i}`,children:t.map(o=>e.jsxs("div",{className:"flex items-center gap-1",title:o.description,children:[h(o),e.jsx("span",{style:{color:o.color},children:o.name})]},o.id))})},le="https://tapvizier.cds.unistra.fr/TAPVizieR/tap/sync",U=1e3,V=200;class de{queue=[];processing=!1;lastRequestTime=0;async enqueue(i){return new Promise((h,o)=>{this.queue.push(async()=>{try{const x=await i();h(x)}catch(x){o(x)}}),this.processQueue()})}async processQueue(){if(!this.processing){for(this.processing=!0;this.queue.length>0;){const h=Date.now()-this.lastRequestTime;h<V&&await new Promise(x=>setTimeout(x,V-h));const o=this.queue.shift();o&&(this.lastRequestTime=Date.now(),await o())}this.processing=!1}}}const ue=new de;function me(t,i,h,o){const x=t.raColumn||"RAJ2000",m=t.decColumn||"DEJ2000";return`
    SELECT TOP ${U} 
      ${x} as ra, 
      ${m} as dec,
      *
    FROM "${t.vizierTable}"
    WHERE 1=CONTAINS(
      POINT('ICRS', ${x}, ${m}),
      CIRCLE('ICRS', ${i}, ${h}, ${o})
    )
  `.trim()}function xe(t,i,h,o){const m=new DOMParser().parseFromString(t,"text/xml"),p=m.querySelector("INFO[name='QUERY_STATUS'][value='ERROR']");if(p)throw new Error(p.textContent||"Query failed");const f=Array.from(m.querySelectorAll("FIELD")).map(g=>g.getAttribute("name")||"");let v=f.findIndex(g=>g.toLowerCase()==="ra"),b=f.findIndex(g=>g.toLowerCase()==="dec");if(v===-1&&(v=f.findIndex(g=>g===h)),b===-1&&(b=f.findIndex(g=>g===o)),v===-1||b===-1)return console.warn(`Could not find RA/Dec columns for ${i}`,f),[];const S=m.querySelectorAll("TR"),u=[];return S.forEach((g,k)=>{const n=g.querySelectorAll("TD");if(n.length>Math.max(v,b)){const R=parseFloat(n[v].textContent||""),a=parseFloat(n[b].textContent||"");!isNaN(R)&&!isNaN(a)&&u.push({ra:R,dec:a,id:`${i}_${k}`,catalog:i})}}),u}async function he(t,i,h,o,x){return ue.enqueue(async()=>{const m=o/60,p=t.raColumn||"RAJ2000",w=t.decColumn||"DEJ2000";try{const f=me(t,i,h,m),v=new URLSearchParams({REQUEST:"doQuery",LANG:"ADQL",FORMAT:"votable",QUERY:f}),b=await fetch(`${le}?${v}`,{signal:x,headers:{Accept:"application/xml"}});if(!b.ok)throw new Error(`HTTP ${b.status}: ${b.statusText}`);const S=await b.text(),u=xe(S,t.id,p,w);return{catalogId:t.id,sources:u,count:u.length,truncated:u.length>=U}}catch(f){if(f instanceof Error&&f.name==="AbortError")throw f;return{catalogId:t.id,sources:[],count:0,truncated:!1,error:f instanceof Error?f.message:"Query failed"}}})}const Q=new Map,fe=300*1e3;async function pe(t,i,h,o,x){const m=`${t.id}:${i.toFixed(4)}:${h.toFixed(4)}:${o.toFixed(1)}`,p=Q.get(m);if(p&&Date.now()-p.timestamp<fe)return p.result;const w=await he(t,i,h,o,x);return w.error||Q.set(m,{result:w,timestamp:Date.now()}),w}const be=({enabledCatalogs:t,onCatalogChange:i,centerRa:h,centerDec:o,searchRadius:x=5,onSourcesLoaded:m,aladinRef:p,className:w=""})=>{const[f,v]=l.useState(!1),[b,S]=l.useState(x),[u,g]=l.useState(new Map),[k,n]=l.useState(new Set),[R,a]=l.useState(x),d=l.useRef(null),N=l.useRef(new Map);l.useEffect(()=>{b!==R&&(g(new Map),a(b))},[b,R]),l.useEffect(()=>()=>{d.current&&d.current.abort()},[]),l.useEffect(()=>{if(h===void 0||o===void 0)return;if(t.length===0){_(),g(new Map);return}d.current&&d.current.abort(),d.current=new AbortController;const r=d.current.signal,j=t.filter(C=>!u.has(C)||u.get(C)?.error);if(j.length!==0)return n(C=>new Set([...C,...j])),j.forEach(async C=>{const $=F.find(E=>E.id===C);if($)try{const E=await pe($,h,o,b,r);if(r.aborted)return;g(M=>{const J=new Map(M);return J.set(C,E),J}),p?.current&&E.sources.length>0&&L($,E.sources)}catch(E){if(E instanceof Error&&E.name==="AbortError")return;console.error(`Failed to query ${C}:`,E)}finally{r.aborted||n(E=>{const M=new Set(E);return M.delete(C),M})}}),()=>{d.current?.abort()}},[t,h,o,b]),l.useEffect(()=>{if(m){const r=new Map;u.forEach((j,C)=>{j.sources.length>0&&r.set(C,j.sources)}),m(r)}},[u,m]);const L=l.useCallback((r,j)=>{if(!p?.current)return;const C=p.current,$=N.current.get(r.id);$&&C.removeLayer($);const E=window.A?.catalog({name:r.name,sourceSize:12,color:r.color,shape:r.symbol==="circle"?"circle":r.symbol==="square"?"square":r.symbol==="diamond"?"rhomb":"circle"});E&&(j.forEach(M=>{const J=window.A?.source(M.ra,M.dec,{name:M.id,catalog:r.name});J&&E.addSources([J])}),C.addCatalog(E),N.current.set(r.id,E))},[p]),_=l.useCallback(()=>{p?.current&&(N.current.forEach(r=>{try{p.current.removeLayer(r)}catch{}}),N.current.clear())},[p]);l.useEffect(()=>{N.current.forEach((r,j)=>{if(!t.includes(j)&&p?.current)try{p.current.removeLayer(r),N.current.delete(j)}catch{}})},[t,p]);const D=l.useCallback(r=>{t.includes(r)?i(t.filter(j=>j!==r)):i([...t,r])},[t,i]),q=l.useCallback(()=>{t.length===F.length?i([]):i(F.map(r=>r.id))},[t.length,i]),A=F.filter(r=>t.includes(r.id)),s=k.size>0,c=F.filter(r=>["gaia","tess","ps1","2mass","wise"].includes(r.id)),y=F.filter(r=>["nvss","first","sumss","racs","vlass","atnf"].includes(r.id)),T=r=>{const j=u.get(r);return j?j.error?"!":j.truncated?`${j.count}+`:j.count.toString():null},z=r=>{const j=T(r.id),C=k.has(r.id),$=u.get(r.id)?.error;return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-sm hover:bg-gray-50 p-1 rounded",title:$||r.description,children:[e.jsx("input",{type:"checkbox",checked:t.includes(r.id),onChange:()=>D(r.id),className:"w-4 h-4 rounded",style:{accentColor:r.color}}),e.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:r.color}}),e.jsx("span",{className:"flex-1",children:r.name}),C&&e.jsx("span",{className:"w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin"}),!C&&j&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${$?"bg-red-100 text-red-600":"bg-gray-100 text-gray-600"}`,children:j})]},r.id)},W=h!==void 0&&o!==void 0;return e.jsxs("div",{className:`${w}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-700",children:"VizieR Catalogues"}),s&&e.jsx("span",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),t.length>0&&e.jsx("span",{className:"badge badge-secondary text-xs",children:t.length})]}),e.jsxs("button",{onClick:()=>v(!f),className:"text-sm text-blue-600 hover:text-blue-800",children:[f?"Hide":"Show"," options"]})]}),A.length>0&&e.jsx(ce,{catalogs:A,className:"mb-2"}),f&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 bg-white space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-100",children:[e.jsx("label",{className:"text-xs text-gray-600 whitespace-nowrap",children:"Search radius:"}),e.jsx("input",{type:"number",min:.5,max:60,step:.5,value:b,onChange:r=>S(Math.max(.5,Math.min(60,parseFloat(r.target.value)||5))),className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded"}),e.jsx("span",{className:"text-xs text-gray-500",children:"arcmin"})]}),!W&&e.jsx("div",{className:"text-xs text-amber-600 bg-amber-50 p-2 rounded",children:"Set center coordinates to query catalogs"}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-100",children:[e.jsx("button",{onClick:q,className:"text-xs text-blue-600 hover:text-blue-800",children:t.length===F.length?"Deselect all":"Select all"}),e.jsx("button",{onClick:()=>{i([]),g(new Map)},className:"text-xs text-gray-500 hover:text-red-500",children:"Clear"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Optical / Infrared"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:c.map(z)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase mb-1",children:"Radio"}),e.jsx("div",{className:"grid grid-cols-2 gap-1",children:y.map(z)})]}),u.size>0&&e.jsxs("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-100",children:[Array.from(u.values()).reduce((r,j)=>r+j.count,0)," sources loaded",Array.from(u.values()).some(r=>r.truncated)&&" (some truncated)"]})]})]})},ge=({raDeg:t,decDeg:i,initialRadius:h=2,maxRadius:o=60,onSearch:x,className:m="",excludeId:p})=>{const[w,f]=l.useState(h),[v,b]=l.useState([]),[S,u]=l.useState(!1),[g,k]=l.useState(null),[n,R]=l.useState("separation"),[a,d]=l.useState("asc"),N=l.useCallback(async()=>{u(!0),k(null);try{const s=await x(t,i,w);b(s)}catch(s){k(s instanceof Error?s.message:"Search failed"),b([])}finally{u(!1)}},[t,i,w,x]);l.useEffect(()=>{N()},[]);const L=l.useCallback(s=>{R(c=>(d(c===s?y=>y==="asc"?"desc":"asc":"asc"),s))},[]),_=[...v].sort((s,c)=>{let y=0;switch(n){case"name":y=s.name.localeCompare(c.name);break;case"database":y=s.database.localeCompare(c.database);break;case"separation":y=s.separation-c.separation;break}return a==="asc"?y:-y}),D=s=>{switch(s){case"SIMBAD":return"badge-info";case"NED":return"badge-success";case"ATNF":return"badge-warning";case"Local":return"badge-secondary"}},q=s=>{if(s.url)return s.url;switch(s.database){case"SIMBAD":return`https://simbad.u-strasbg.fr/simbad/sim-id?Ident=${encodeURIComponent(s.name)}`;case"NED":return`https://ned.ipac.caltech.edu/byname?objname=${encodeURIComponent(s.name)}`;case"ATNF":return`https://www.atnf.csiro.au/research/pulsar/psrcat/proc_form.php?pulsar_names=${encodeURIComponent(s.name)}`;default:return}},A=({column:s})=>n!==s?e.jsxs("svg",{className:"w-3 h-3 text-gray-300 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:[e.jsx("path",{d:"M5 2l2 2H3z",fill:"currentColor"}),e.jsx("path",{d:"M5 8L3 6h4z",fill:"currentColor"})]}):a==="asc"?e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:e.jsx("path",{d:"M5 2l3 4H2z",fill:"currentColor"})}):e.jsx("svg",{className:"w-3 h-3 text-gray-500 ml-1",viewBox:"0 0 10 10","aria-hidden":"true",children:e.jsx("path",{d:"M5 8L2 4h6z",fill:"currentColor"})});return e.jsxs("div",{className:`card ${m}`,children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"text-lg font-semibold",children:"Nearby Objects"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("label",{className:"text-sm text-gray-600 whitespace-nowrap",children:"Search within"}),e.jsx("input",{type:"number",value:w,onChange:s=>f(Math.min(Number(s.target.value),o)),min:.1,max:o,step:.5,className:"form-control w-20"}),e.jsx("span",{className:"text-sm text-gray-600",children:"arcmin"}),e.jsx("button",{onClick:N,disabled:S,className:"btn btn-primary btn-sm",children:S?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Searching..."]}):"Search"})]}),g&&e.jsx("div",{className:"alert alert-danger mb-4",children:e.jsx("p",{children:g})}),S?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Searching databases..."})]}):v.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsxs("p",{children:["No nearby objects found within ",w," arcmin"]})]}):e.jsx("div",{className:"overflow-x-auto max-h-80 overflow-y-auto",children:e.jsxs("table",{className:"table table-compact",children:[e.jsx("thead",{className:"sticky top-0",children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>L("name"),className:"cursor-pointer hover:bg-opacity-80",children:["Name ",e.jsx(A,{column:"name"})]}),e.jsxs("th",{onClick:()=>L("database"),className:"cursor-pointer hover:bg-opacity-80",children:["Database ",e.jsx(A,{column:"database"})]}),e.jsx("th",{className:"text-center",children:"RA"}),e.jsx("th",{className:"text-center",children:"Dec"}),e.jsxs("th",{onClick:()=>L("separation"),className:"cursor-pointer hover:bg-opacity-80 text-right",children:["Sep (″) ",e.jsx(A,{column:"separation"})]})]})}),e.jsx("tbody",{children:_.map((s,c)=>{const y=q(s);return e.jsxs("tr",{children:[e.jsxs("td",{children:[y?e.jsx("a",{href:y,target:"_blank",rel:"noreferrer",className:"link",children:s.name}):s.name,s.type&&e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",s.type,")"]})]}),e.jsx("td",{children:e.jsx("span",{className:`badge ${D(s.database)}`,children:s.database})}),e.jsx("td",{className:"text-center font-mono text-xs",children:s.ra}),e.jsx("td",{className:"text-center font-mono text-xs",children:s.dec}),e.jsx("td",{className:"text-right font-mono",children:s.separation.toFixed(2)})]},`${s.database}-${s.name}-${c}`)})})]})}),v.length>0&&e.jsxs("div",{className:"mt-3 text-xs text-gray-500 flex justify-between",children:[e.jsxs("span",{children:[v.length," object",v.length!==1?"s":""," found"]}),e.jsxs("span",{children:["SIMBAD: ",v.filter(s=>s.database==="SIMBAD").length," | NED:"," ",v.filter(s=>s.database==="NED").length," | ATNF:"," ",v.filter(s=>s.database==="ATNF").length," | Local:"," ",v.filter(s=>s.database==="Local").length]})]})]})]})},H=({className:t="w-4 h-4"})=>e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),Ee=()=>{const{sourceId:t}=K(),{data:i,isLoading:h,error:o,refetch:x}=ne(t),m=ee(a=>a.addRecentSource),[p,w]=l.useState(void 0),[f,v]=l.useState(!0),b=t?encodeURIComponent(t):"",[S,u]=l.useState(!1),g=async(a,d,N)=>{const L=[];try{const _=`SELECT TOP 20 main_id, ra, dec, otype_longname
        FROM basic
        WHERE CONTAINS(POINT('ICRS', ra, dec), CIRCLE('ICRS', ${a}, ${d}, ${N/60})) = 1`,D=await fetch(`https://simbad.u-strasbg.fr/simbad/sim-tap/sync?REQUEST=doQuery&LANG=ADQL&FORMAT=json&QUERY=${encodeURIComponent(_)}`);if(D.ok){const A=(await D.json()).data||[];for(const s of A){const c=parseFloat(s[1]),y=parseFloat(s[2]),T=Math.sqrt(Math.pow((a-c)*Math.cos(d*Math.PI/180),2)+Math.pow(d-y,2))*3600;L.push({name:s[0],ra:c.toFixed(6),dec:y.toFixed(6),separation:T,database:"SIMBAD",type:s[3]||void 0,url:`https://simbad.u-strasbg.fr/simbad/sim-id?Ident=${encodeURIComponent(s[0])}`})}}}catch(_){console.warn("SIMBAD query failed:",_)}return L};l.useEffect(()=>{i&&t&&m(t)},[i,t,m]),l.useEffect(()=>{const a=i;a?.contributing_images?.length&&w(a.contributing_images[0].image_id)},[i]);const k=l.useMemo(()=>{const a=i;return a?.contributing_images?a.contributing_images.filter(d=>d.flux_jy!==void 0&&d.created_at).map(d=>({time:d.created_at,flux:d.flux_jy,fluxError:d.flux_error_jy,label:d.path?.split("/").pop()||d.image_id})).sort((d,N)=>new Date(d.time).getTime()-new Date(N.time).getTime()):[]},[i]);if(h)return e.jsx(te,{label:"Loading source details..."});if(o)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx(Z,{error:o,onRetry:()=>x()})});if(!i)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs(I,{children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"Source not found."}),e.jsx(B,{to:"/sources",className:"link",children:"Back to Sources"})]})});const n=i,R=re(n,p);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(B,{to:"/sources",className:"text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block",children:"Back to Sources"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:n.name||`Source ${n.id}`}),R&&e.jsx(Y,{...R})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 sticky-sidebar",children:[e.jsxs(I,{title:"Position",children:[e.jsx(X,{raDeg:n.ra_deg,decDeg:n.dec_deg,showDecimal:!0,allowFormatToggle:!0}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 space-y-2",children:[e.jsxs("a",{href:`https://simbad.u-strasbg.fr/simbad/sim-coo?Coord=${n.ra_deg}+${n.dec_deg}&CooFrame=FK5&CooEpoch=2000&CooEqui=2000&Radius=2&Radius.unit=arcmin`,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-800 hover:underline",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),"Search in SIMBAD",e.jsx(H,{className:"w-3 h-3"})]}),e.jsxs("a",{href:`https://ned.ipac.caltech.edu/conesearch?search_type=Near%20Position%20Search&ra=${n.ra_deg}&dec=${n.dec_deg}&radius=2&in_csys=Equatorial&in_equinox=J2000`,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-800 hover:underline",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"})}),"Search in NED",e.jsx(H,{className:"w-3 h-3"})]})]})]}),e.jsx(I,{title:"Actions",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${b}/lightcurve`,"_blank"),children:"View Lightcurve"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${b}/postage_stamps`,"_blank"),children:"Download Postage Stamps"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>window.open(`https://ronnie-unsectarian-antone.ngrok-free.dev/api/sources/${b}/variability`,"_blank"),children:"Variability Analysis"})]})}),e.jsx(I,{title:"Details",children:e.jsxs("dl",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Source ID"}),e.jsx("dd",{className:"font-mono text-sm text-gray-900",children:n.id})]}),n.name&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Name"}),e.jsx("dd",{className:"text-sm text-gray-900",children:n.name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Detections"}),e.jsxs("dd",{className:"text-sm text-gray-900",children:[n.contributing_images?.length||0," images"]})]})]})})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(I,{title:"Sky View",subtitle:e.jsx("button",{type:"button",onClick:()=>v(!f),className:"text-xs text-blue-600 hover:text-blue-800",children:f?"Hide":"Show"}),children:f&&e.jsx(se,{raDeg:n.ra_deg,decDeg:n.dec_deg,fov:.1,height:300,sourceName:n.name||`Source ${n.id}`,className:"rounded-lg overflow-hidden"})}),e.jsx(I,{title:"Catalog Crossmatch",children:e.jsx(be,{centerRa:n.ra_deg,centerDec:n.dec_deg,defaultRadius:2})}),e.jsxs(I,{title:"Nearby Objects",subtitle:e.jsx("button",{type:"button",onClick:()=>u(!S),className:"text-xs text-blue-600 hover:text-blue-800",children:S?"Hide":"Search SIMBAD"}),children:[S&&e.jsx(ge,{raDeg:n.ra_deg,decDeg:n.dec_deg,initialRadius:2,maxRadius:30,onSearch:g}),!S&&e.jsx("p",{className:"text-sm text-gray-500",children:'Click "Search SIMBAD" to find nearby objects in external catalogs.'})]}),k.length>1&&e.jsx(I,{title:"Light Curve",subtitle:`${k.length} measurements`,children:e.jsx(oe,{data:k,height:300,yAxisLabel:"Flux",xAxisLabel:"Observation Date",enableZoom:!0,showErrorBars:!0,onPointClick:a=>{const d=n.contributing_images?.find(N=>N.created_at===a.time);d&&w(d.image_id)}})}),n.contributing_images&&n.contributing_images.length>0&&e.jsx(I,{title:"Contributing Images",subtitle:`${n.contributing_images.length} detection${n.contributing_images.length!==1?"s":""}`,children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:n.contributing_images.map(a=>e.jsxs("div",{className:`p-3 rounded-lg border-2 cursor-pointer transition-all ${p===a.image_id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}`,onClick:()=>w(a.image_id),onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&w(a.image_id)},role:"button",tabIndex:0,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(B,{to:`/images/${a.image_id}`,className:"font-medium text-gray-900 hover:text-blue-600 truncate block",onClick:d=>d.stopPropagation(),children:a.path?.split("/").pop()||a.image_id}),a.ms_path&&e.jsxs("div",{className:"text-xs text-gray-500 truncate mt-0.5",children:["MS: ",a.ms_path.split("/").pop()]})]}),a.qa_grade&&e.jsx("span",{className:`badge ml-2 ${a.qa_grade==="good"?"badge-success":a.qa_grade==="warn"?"badge-warning":"badge-error"}`,children:a.qa_grade})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500",children:[a.flux_jy!==void 0&&e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"Flux:"})," ",a.flux_jy<.001?`${(a.flux_jy*1e6).toFixed(1)} μJy`:a.flux_jy<1?`${(a.flux_jy*1e3).toFixed(2)} mJy`:`${a.flux_jy.toFixed(3)} Jy`]}),a.created_at&&e.jsx("span",{title:new Date(a.created_at).toLocaleString(),children:ae(a.created_at)})]})]},a.image_id))})}),(!n.contributing_images||n.contributing_images.length===0)&&e.jsx(I,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{children:"No contributing images found for this source."})]})})]})]})]})};export{Ee as default};
//# sourceMappingURL=SourceDetailPage-DD6DBxrV.js.map
