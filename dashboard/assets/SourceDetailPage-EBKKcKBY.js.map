{"version":3,"mappings":"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","names":["echartsPromise","loadEcharts","__vitePreload","escapeHtml","value","LightCurveChart","data","title","yAxisLabel","xAxisLabel","height","enableZoom","showErrorBars","className","onPointClick","isLoading","autoLoad","containerRef","useRef","chartRef","error","setError","useState","libraryLoaded","setLibraryLoaded","useEffect","echarts","err","chartData","point","errorBarData","index","time","formatFlux","option","params","date","html","handleResize","handleResetZoom","useCallback","heightStyle","jsx","jsxs","CATALOG_DEFINITIONS","CatalogLegend","catalogs","renderSymbol","catalog","style","VIZIER_TAP_URL","MAX_RESULTS","RATE_LIMIT_DELAY_MS","RateLimiter","fn","resolve","reject","result","timeSinceLastRequest","r","rateLimiter","buildConeSearchQuery","ra","dec","radiusDeg","raCol","decCol","parseVOTableResponse","xml","catalogId","raColName","decColName","doc","errorInfo","fieldNames","f","raIndex","n","decIndex","rows","sources","row","idx","cells","queryCatalog","radiusArcmin","signal","query","response","queryCache","CACHE_TTL","queryCatalogCached","cacheKey","cached","CatalogOverlayPanel","enabledCatalogs","onCatalogChange","centerRa","centerDec","searchRadius","onSourcesLoaded","aladinRef","isExpanded","setIsExpanded","radiusInput","setRadiusInput","queryResults","setQueryResults","loadingCatalogs","setLoadingCatalogs","lastQueryRadius","setLastQueryRadius","abortControllerRef","overlayLayersRef","clearAllOverlays","catalogsToQuery","id","prev","c","next","renderCatalogOverlay","sourcesMap","aladin","existingLayer","catalogLayer","src","source","layer","handleToggle","handleSelectAll","enabledCatalogDefs","opticalCatalogs","radioCatalogs","getResultCount","renderCatalogCheckbox","resultCount","isQuerying","hasError","hasCoordinates","e","sum","NearbyObjectsPanel","raDeg","decDeg","initialRadius","maxRadius","onSearch","excludeId","radius","setRadius","results","setResults","setIsLoading","sortKey","setSortKey","sortDir","setSortDir","performSearch","objects","handleSort","key","prevKey","sortedResults","a","b","cmp","getDatabaseColor","db","getDatabaseUrl","obj","SortArrow","column","url","ExternalLinkIcon","SourceDetailPage","sourceId","useParams","refetch","useSource","addRecentSource","usePreferencesStore","state","selectedImageId","setSelectedImageId","showSkyViewer","setShowSkyViewer","encodedSourceId","showNearbyPanel","setShowNearbyPanel","handleNearbySearch","simbadQuery","simbadRes","objRa","objDec","sep","sourceData","lightCurveData","useMemo","img","LoadingSpinner","ErrorDisplay","Card","Link","provenance","mapProvenanceFromSourceDetail","ProvenanceStrip","CoordinateDisplay","AladinLiteViewer","i","relativeTime"],"ignoreList":[],"sources":["../../src/lib/loadEcharts.ts","../../src/components/widgets/LightCurveChart.tsx","../../src/constants/catalogDefinitions.ts","../../src/components/catalogs/CatalogLegend.tsx","../../src/utils/vizierQuery.ts","../../src/components/catalogs/CatalogOverlayPanel.tsx","../../src/components/crossmatch/NearbyObjectsPanel.tsx","../../src/pages/SourceDetailPage.tsx"],"sourcesContent":["let echartsPromise: Promise<typeof import(\"echarts\")> | null = null;\n\n/**\n * Dynamically load ECharts to keep it out of the main bundle.\n */\nexport const loadEcharts = async (): Promise<typeof import(\"echarts\")> => {\n  if (!echartsPromise) {\n    echartsPromise = import(\"echarts\");\n  }\n  return echartsPromise;\n};\n","import React, { useEffect, useRef, useState, useCallback } from \"react\";\nimport { loadEcharts } from \"../../lib/loadEcharts\";\n\nexport interface LightCurveDataPoint {\n  /** Timestamp in ISO format or Unix milliseconds */\n  time: string | number;\n  /** Flux value */\n  flux: number;\n  /** Optional flux error (for error bars) */\n  fluxError?: number;\n  /** Optional label for the point */\n  label?: string;\n  /** Optional color override */\n  color?: string;\n}\n\nexport interface LightCurveChartProps {\n  /** Array of data points */\n  data: LightCurveDataPoint[];\n  /** Chart title */\n  title?: string;\n  /** Y-axis label (default: \"Flux (Jy)\") */\n  yAxisLabel?: string;\n  /** X-axis label (default: \"Time\") */\n  xAxisLabel?: string;\n  /** Height of the chart */\n  height?: number | string;\n  /** Enable zoom/pan (default: true) */\n  enableZoom?: boolean;\n  /** Show error bars if fluxError is provided (default: true) */\n  showErrorBars?: boolean;\n  /** Custom class name */\n  className?: string;\n  /** Callback when a point is clicked */\n  onPointClick?: (point: LightCurveDataPoint, index: number) => void;\n  /** Loading state */\n  isLoading?: boolean;\n  /** Automatically load chart library on mount (default: false) */\n  autoLoad?: boolean;\n}\n\ntype EChartsInstance = import(\"echarts\").ECharts;\ntype EChartsEventParams = import(\"echarts\").ECElementEvent;\ntype EChartsOption = import(\"echarts\").EChartsOption;\n\n/**\n * Zoomable time-series light curve chart using ECharts 5.5.\n * Displays flux measurements over time with optional error bars.\n */\nexport const escapeHtml = (value: string): string => {\n  return value\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n};\n\nconst LightCurveChart: React.FC<LightCurveChartProps> = ({\n  data,\n  title,\n  yAxisLabel = \"Flux (Jy)\",\n  xAxisLabel = \"Time\",\n  height = 350,\n  enableZoom = true,\n  showErrorBars = true,\n  className = \"\",\n  onPointClick,\n  isLoading = false,\n  autoLoad = false,\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const chartRef = useRef<EChartsInstance | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [libraryLoaded, setLibraryLoaded] = useState(autoLoad);\n\n  // Initialize and update chart\n  useEffect(() => {\n    if (!libraryLoaded || error || !containerRef.current || isLoading) return;\n\n    // Initialize or get existing instance\n    if (!chartRef.current) {\n      try {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        loadEcharts()\n          .then((echarts) => {\n            if (!containerRef.current) return;\n            chartRef.current = echarts.init(containerRef.current);\n            setError(null);\n          })\n          .catch((err) => {\n            setError(err instanceof Error ? err.message : \"Failed to initialize chart\");\n          });\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \"Failed to initialize chart\");\n        return;\n      }\n    }\n\n    // Transform data\n    const chartData: [number, number][] = data.map((point) => {\n      const time =\n        typeof point.time === \"string\" ? new Date(point.time).getTime() : point.time;\n      return [time, point.flux];\n    });\n\n    // Build error bar data if available\n    const errorBarData: { coord: [number, number, number, number] }[] = [];\n    if (showErrorBars) {\n      data.forEach((point, index) => {\n        if (point.fluxError !== undefined) {\n          const time = chartData[index][0];\n          errorBarData.push({\n            coord: [time, point.flux - point.fluxError, time, point.flux + point.fluxError],\n          });\n        }\n      });\n    }\n\n    // Format flux values smartly\n    const formatFlux = (value: number): string => {\n      if (Math.abs(value) < 0.001) {\n        return `${(value * 1e6).toFixed(1)} μJy`;\n      }\n      if (Math.abs(value) < 1) {\n        return `${(value * 1e3).toFixed(2)} mJy`;\n      }\n      return `${value.toFixed(3)} Jy`;\n    };\n\n    const option: EChartsOption = {\n      title: title\n        ? {\n            text: title,\n            left: \"center\",\n            textStyle: { fontSize: 14, fontWeight: \"bold\" },\n          }\n        : undefined,\n      tooltip: {\n        trigger: \"item\",\n        formatter: (params: EChartsTooltipParams) => {\n          const point = data[params.dataIndex];\n          const date = new Date(params.data[0]);\n          let html = `<div class=\"text-sm\">\n            <div class=\"font-medium\">${escapeHtml(date.toLocaleString())}</div>\n            <div>Flux: ${escapeHtml(formatFlux(params.data[1]))}</div>`;\n          if (point?.fluxError) {\n            html += `<div>Error: ±${escapeHtml(formatFlux(point.fluxError))}</div>`;\n          }\n          if (point?.label) {\n            html += `<div class=\"text-gray-500\">${escapeHtml(point.label)}</div>`;\n          }\n          html += \"</div>\";\n          return html;\n        },\n        axisPointer: { type: \"cross\" },\n      },\n      xAxis: {\n        type: \"time\",\n        name: xAxisLabel,\n        nameLocation: \"middle\",\n        axisLabel: {\n          formatter: (value: number) => {\n            const date = new Date(value);\n            return `${date.getMonth() + 1}/${date.getDate()}`;\n          },\n        },\n      },\n      yAxis: {\n        type: \"value\",\n        name: yAxisLabel,\n        nameLocation: \"middle\",\n        axisLabel: {\n          formatter: formatFlux,\n        },\n      },\n      series: [\n        {\n          type: \"line\",\n          data: chartData,\n          symbolSize: 8,\n          itemStyle: { color: \"#3b82f6\" },\n          lineStyle: { width: 2 },\n          showSymbol: true,\n          emphasis: {\n            focus: \"series\",\n            itemStyle: { shadowBlur: 10, shadowColor: \"rgba(59, 130, 246, 0.5)\" },\n          },\n        },\n      ],\n      dataZoom: enableZoom\n        ? [\n            { type: \"inside\", start: 0, end: 100, xAxisIndex: 0 },\n            { type: \"slider\", start: 0, end: 100, xAxisIndex: 0 },\n          ]\n        : undefined,\n      grid: {\n        left: \"15%\",\n        right: \"10%\",\n        bottom: enableZoom ? \"20%\" : \"15%\",\n        top: title ? \"15%\" : \"10%\",\n        containLabel: true,\n      },\n      toolbox: {\n        feature: {\n          dataZoom: { yAxisIndex: \"none\", title: { zoom: \"Zoom\", back: \"Reset\" } },\n          restore: { title: \"Restore\" },\n          saveAsImage: { title: \"Save\" },\n        },\n      },\n    };\n\n    chartRef.current.setOption(option);\n\n    // Handle click events\n    if (onPointClick) {\n      chartRef.current.off(\"click\");\n      chartRef.current.on(\"click\", (params: EChartsEventParams) => {\n        if (params.dataIndex !== undefined) {\n          onPointClick(data[params.dataIndex], params.dataIndex);\n        }\n      });\n    }\n\n    // Cleanup\n    return () => {\n      if (chartRef.current) {\n        chartRef.current.off(\"click\");\n      }\n    };\n  }, [\n    error,\n    data,\n    title,\n    yAxisLabel,\n    xAxisLabel,\n    enableZoom,\n    showErrorBars,\n    onPointClick,\n    isLoading,\n    escapeHtml,\n  ]);\n\n  // Handle resize\n  useEffect(() => {\n    const handleResize = () => {\n      if (chartRef.current) {\n        chartRef.current.resize();\n      }\n    };\n\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (chartRef.current) {\n        chartRef.current.dispose();\n        chartRef.current = null;\n      }\n    };\n  }, []);\n\n  const handleResetZoom = useCallback(() => {\n    if (chartRef.current) {\n      chartRef.current.dispatchAction({\n        type: \"dataZoom\",\n        dataZoomIndex: 0,\n        start: 0,\n        end: 100,\n      });\n    }\n  }, []);\n\n  const heightStyle = typeof height === \"number\" ? `${height}px` : height;\n\n  if (error) {\n    return (\n      <div\n        className={`bg-gray-100 rounded-lg flex items-center justify-center ${className}`}\n        style={{ height: heightStyle }}\n      >\n        <div className=\"text-center text-gray-500 p-4\">\n          <svg\n            className=\"w-12 h-12 mx-auto mb-2 text-gray-400\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"\n            />\n          </svg>\n          <p className=\"text-sm\">{error}</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div\n        className={`bg-gray-100 rounded-lg flex items-center justify-center ${className}`}\n        style={{ height: heightStyle }}\n      >\n        <div className=\"flex flex-col items-center text-gray-500\">\n          <div className=\"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-2\" />\n          <span className=\"text-sm\">Loading light curve...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (!data || data.length === 0) {\n    return (\n      <div\n        className={`bg-gray-100 rounded-lg flex items-center justify-center ${className}`}\n        style={{ height: heightStyle }}\n      >\n        <div className=\"text-center text-gray-500 p-4\">\n          <svg\n            className=\"w-12 h-12 mx-auto mb-2 text-gray-400\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"\n            />\n          </svg>\n          <p className=\"text-sm\">No light curve data available</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`relative ${className}`}>\n      <div ref={containerRef} style={{ height: heightStyle, width: \"100%\" }} />\n      {enableZoom && (\n        <button\n          type=\"button\"\n          onClick={handleResetZoom}\n          className=\"absolute top-2 right-2 bg-white/90 hover:bg-white px-2 py-1 rounded shadow text-xs text-gray-700 hover:text-gray-900 transition-colors\"\n          title=\"Reset zoom\"\n        >\n          Reset Zoom\n        </button>\n      )}\n    </div>\n  );\n};\n\nexport default LightCurveChart;\n","/**\n * Catalog definitions for VizieR overlay panel.\n * Colors and symbols are designed to be visually distinct.\n */\n\nexport interface CatalogDefinition {\n  id: string;\n  name: string;\n  vizierTable: string;\n  /** RA column name in VizieR table (defaults to RAJ2000) */\n  raColumn?: string;\n  /** Dec column name in VizieR table (defaults to DEJ2000) */\n  decColumn?: string;\n  color: string;\n  symbol: \"circle\" | \"square\" | \"diamond\" | \"triangle\" | \"star\" | \"plus\" | \"cross\";\n  description: string;\n  defaultEnabled: boolean;\n}\n\nexport const CATALOG_DEFINITIONS: CatalogDefinition[] = [\n  {\n    id: \"gaia\",\n    name: \"Gaia DR3\",\n    vizierTable: \"I/355/gaiadr3\",\n    raColumn: \"RA_ICRS\",\n    decColumn: \"DE_ICRS\",\n    color: \"#ff0000\",\n    symbol: \"circle\",\n    description: \"Gaia Data Release 3 - optical astrometry and photometry\",\n    defaultEnabled: false,\n  },\n  {\n    id: \"tess\",\n    name: \"TESS TIC v8.2\",\n    vizierTable: \"IV/39/tic82\",\n    raColumn: \"RAJ2000\",\n    decColumn: \"DEJ2000\",\n    color: \"#db01fd\",\n    symbol: \"diamond\",\n    description: \"TESS Input Catalog - stars observed by TESS\",\n    defaultEnabled: false,\n  },\n  {\n    id: \"ps1\",\n    name: \"Pan-STARRS DR1\",\n    vizierTable: \"II/349/ps1\",\n    raColumn: \"RAJ2000\",\n    decColumn: \"DEJ2000\",\n    color: \"#0066ff\",\n    symbol: \"square\",\n    description: \"Pan-STARRS1 Survey - optical photometry\",\n    defaultEnabled: false,\n  },\n  {\n    id: \"2mass\",\n    name: \"2MASS\",\n    vizierTable: \"II/246/out\",\n    raColumn: \"RAJ2000\",\n    decColumn: \"DEJ2000\",\n    color: \"#ff9900\",\n    symbol: \"triangle\",\n    description: \"Two Micron All Sky Survey - near-infrared\",\n    defaultEnabled: false,\n  },\n  {\n    id: \"wise\",\n    name: \"AllWISE\",\n    vizierTable: \"II/328/allwise\",\n    raColumn: \"RAJ2000\",\n    decColumn: \"DEJ2000\",\n    color: \"#00cc66\",\n    symbol: \"star\",\n    description: \"Wide-field Infrared Survey Explorer\",\n    defaultEnabled: false,\n  },\n  {\n    id: \"nvss\",\n    name: \"NVSS\",\n    vizierTable: \"VIII/65/nvss\",\n    raColumn: \"RAJ2000\",\n    decColumn: \"DEJ2000\",\n    color: \"#00cccc\",\n    symbol: \"plus\",\n    description: \"NRAO VLA Sky Survey - 1.4 GHz radio\",\n    defaultEnabled: false,\n  },\n  {\n    id: \"first\",\n    name: \"FIRST\",\n    vizierTable: \"VIII/92/first14\",\n    raColumn: \"RAJ2000\",\n    decColumn: \"DEJ2000\",\n    color: \"#cc00cc\",\n    symbol: \"cross\",\n    description: \"Faint Images of the Radio Sky at Twenty-cm\",\n    defaultEnabled: false,\n  },\n  {\n    id: \"sumss\",\n    name: \"SUMSS\",\n    vizierTable: \"VIII/81B/sumss212\",\n    raColumn: \"RAJ2000\",\n    decColumn: \"DEJ2000\",\n    color: \"#ffcc00\",\n    symbol: \"circle\",\n    description: \"Sydney University Molonglo Sky Survey - 843 MHz\",\n    defaultEnabled: false,\n  },\n  {\n    id: \"racs\",\n    name: \"RACS-Low\",\n    vizierTable: \"J/other/PASA/38.58/gausscut\",\n    raColumn: \"RAJ2000\",\n    decColumn: \"DEJ2000\",\n    color: \"#66ff66\",\n    symbol: \"diamond\",\n    description: \"Rapid ASKAP Continuum Survey - 887 MHz\",\n    defaultEnabled: false,\n  },\n  {\n    id: \"vlass\",\n    name: \"VLASS\",\n    vizierTable: \"J/ApJS/255/30/table1\",\n    raColumn: \"RAJ2000\",\n    decColumn: \"DEJ2000\",\n    color: \"#ff6666\",\n    symbol: \"square\",\n    description: \"VLA Sky Survey - 3 GHz radio\",\n    defaultEnabled: false,\n  },\n  {\n    id: \"atnf\",\n    name: \"ATNF Pulsars\",\n    vizierTable: \"B/psr/psr\",\n    raColumn: \"RAJ2000\",\n    decColumn: \"DEJ2000\",\n    color: \"#ffffff\",\n    symbol: \"star\",\n    description: \"Australia Telescope National Facility Pulsar Catalogue\",\n    defaultEnabled: false,\n  },\n];\n\nexport const getCatalogById = (id: string): CatalogDefinition | undefined => {\n  return CATALOG_DEFINITIONS.find((c) => c.id === id);\n};\n\nexport const getEnabledCatalogs = (): CatalogDefinition[] => {\n  return CATALOG_DEFINITIONS.filter((c) => c.defaultEnabled);\n};\n","import React from \"react\";\nimport { CatalogDefinition } from \"../../constants/catalogDefinitions\";\n\nexport interface CatalogLegendProps {\n  /** Enabled catalogs to display */\n  catalogs: CatalogDefinition[];\n  /** Custom class name */\n  className?: string;\n}\n\n/**\n * Color-coded legend for catalog overlays.\n */\nconst CatalogLegend: React.FC<CatalogLegendProps> = ({ catalogs, className = \"\" }) => {\n  if (catalogs.length === 0) return null;\n\n  const renderSymbol = (catalog: CatalogDefinition) => {\n    const size = 12;\n    const style = { fill: catalog.color, stroke: catalog.color };\n\n    switch (catalog.symbol) {\n      case \"circle\":\n        return (\n          <svg width={size} height={size} viewBox=\"0 0 12 12\">\n            <circle cx=\"6\" cy=\"6\" r=\"5\" {...style} fillOpacity={0.3} strokeWidth={1.5} />\n          </svg>\n        );\n      case \"square\":\n        return (\n          <svg width={size} height={size} viewBox=\"0 0 12 12\">\n            <rect\n              x=\"1\"\n              y=\"1\"\n              width=\"10\"\n              height=\"10\"\n              {...style}\n              fillOpacity={0.3}\n              strokeWidth={1.5}\n            />\n          </svg>\n        );\n      case \"diamond\":\n        return (\n          <svg width={size} height={size} viewBox=\"0 0 12 12\">\n            <polygon points=\"6,1 11,6 6,11 1,6\" {...style} fillOpacity={0.3} strokeWidth={1.5} />\n          </svg>\n        );\n      case \"triangle\":\n        return (\n          <svg width={size} height={size} viewBox=\"0 0 12 12\">\n            <polygon points=\"6,1 11,11 1,11\" {...style} fillOpacity={0.3} strokeWidth={1.5} />\n          </svg>\n        );\n      case \"star\":\n        return (\n          <svg width={size} height={size} viewBox=\"0 0 12 12\">\n            <polygon\n              points=\"6,1 7.5,4.5 11,5 8.5,7.5 9,11 6,9 3,11 3.5,7.5 1,5 4.5,4.5\"\n              {...style}\n              fillOpacity={0.3}\n              strokeWidth={1}\n            />\n          </svg>\n        );\n      case \"plus\":\n        return (\n          <svg width={size} height={size} viewBox=\"0 0 12 12\">\n            <path d=\"M6,1 L6,11 M1,6 L11,6\" stroke={catalog.color} strokeWidth={2} fill=\"none\" />\n          </svg>\n        );\n      case \"cross\":\n        return (\n          <svg width={size} height={size} viewBox=\"0 0 12 12\">\n            <path d=\"M1,1 L11,11 M11,1 L1,11\" stroke={catalog.color} strokeWidth={2} fill=\"none\" />\n          </svg>\n        );\n      default:\n        return (\n          <span\n            className=\"inline-block w-3 h-3 rounded-full\"\n            style={{ backgroundColor: catalog.color }}\n          />\n        );\n    }\n  };\n\n  return (\n    <div className={`flex flex-wrap gap-3 text-xs ${className}`}>\n      {catalogs.map((catalog) => (\n        <div key={catalog.id} className=\"flex items-center gap-1\" title={catalog.description}>\n          {renderSymbol(catalog)}\n          <span style={{ color: catalog.color }}>{catalog.name}</span>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default CatalogLegend;\n","/**\n * VizieR TAP service query utilities.\n * Provides cone search functionality for catalog overlays.\n */\n\nimport { CatalogDefinition } from \"../constants/catalogDefinitions\";\n\nexport interface CatalogSource {\n  ra: number;\n  dec: number;\n  id: string;\n  catalog: string;\n  magnitude?: number;\n  flux?: number;\n  [key: string]: any;\n}\n\nexport interface CatalogQueryResult {\n  catalogId: string;\n  sources: CatalogSource[];\n  count: number;\n  truncated: boolean;\n  error?: string;\n}\n\nconst VIZIER_TAP_URL = \"https://tapvizier.cds.unistra.fr/TAPVizieR/tap/sync\";\nconst MAX_RESULTS = 1000;\nconst RATE_LIMIT_DELAY_MS = 200; // Delay between concurrent requests\n\n/**\n * Simple rate limiter for VizieR requests\n */\nclass RateLimiter {\n  private queue: Array<() => Promise<void>> = [];\n  private processing = false;\n  private lastRequestTime = 0;\n\n  async enqueue<T>(fn: () => Promise<T>): Promise<T> {\n    return new Promise((resolve, reject) => {\n      this.queue.push(async () => {\n        try {\n          const result = await fn();\n          resolve(result);\n        } catch (err) {\n          reject(err);\n        }\n      });\n      this.processQueue();\n    });\n  }\n\n  private async processQueue() {\n    if (this.processing) return;\n    this.processing = true;\n\n    while (this.queue.length > 0) {\n      const now = Date.now();\n      const timeSinceLastRequest = now - this.lastRequestTime;\n\n      if (timeSinceLastRequest < RATE_LIMIT_DELAY_MS) {\n        await new Promise((r) => setTimeout(r, RATE_LIMIT_DELAY_MS - timeSinceLastRequest));\n      }\n\n      const fn = this.queue.shift();\n      if (fn) {\n        this.lastRequestTime = Date.now();\n        await fn();\n      }\n    }\n\n    this.processing = false;\n  }\n}\n\nconst rateLimiter = new RateLimiter();\n\n/**\n * Build an ADQL cone search query for a VizieR catalog.\n */\nfunction buildConeSearchQuery(\n  catalog: CatalogDefinition,\n  ra: number,\n  dec: number,\n  radiusDeg: number\n): string {\n  // Use catalog-specific column names or defaults\n  const raCol = catalog.raColumn || \"RAJ2000\";\n  const decCol = catalog.decColumn || \"DEJ2000\";\n\n  return `\n    SELECT TOP ${MAX_RESULTS} \n      ${raCol} as ra, \n      ${decCol} as dec,\n      *\n    FROM \"${catalog.vizierTable}\"\n    WHERE 1=CONTAINS(\n      POINT('ICRS', ${raCol}, ${decCol}),\n      CIRCLE('ICRS', ${ra}, ${dec}, ${radiusDeg})\n    )\n  `.trim();\n}\n\n/**\n * Parse VOTable XML response from VizieR TAP service.\n */\nfunction parseVOTableResponse(\n  xml: string,\n  catalogId: string,\n  raColName: string,\n  decColName: string\n): CatalogSource[] {\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(xml, \"text/xml\");\n\n  // Check for errors\n  const errorInfo = doc.querySelector(\"INFO[name='QUERY_STATUS'][value='ERROR']\");\n  if (errorInfo) {\n    throw new Error(errorInfo.textContent || \"Query failed\");\n  }\n\n  // Get field definitions\n  const fields = Array.from(doc.querySelectorAll(\"FIELD\"));\n  const fieldNames = fields.map((f) => f.getAttribute(\"name\") || \"\");\n\n  // Look for the aliased 'ra' and 'dec' columns first, then fall back to original names\n  let raIndex = fieldNames.findIndex((n) => n.toLowerCase() === \"ra\");\n  let decIndex = fieldNames.findIndex((n) => n.toLowerCase() === \"dec\");\n\n  // If not found, try the original column names\n  if (raIndex === -1) {\n    raIndex = fieldNames.findIndex((n) => n === raColName);\n  }\n  if (decIndex === -1) {\n    decIndex = fieldNames.findIndex((n) => n === decColName);\n  }\n\n  if (raIndex === -1 || decIndex === -1) {\n    console.warn(`Could not find RA/Dec columns for ${catalogId}`, fieldNames);\n    return [];\n  }\n\n  // Parse table data\n  const rows = doc.querySelectorAll(\"TR\");\n  const sources: CatalogSource[] = [];\n\n  rows.forEach((row, idx) => {\n    const cells = row.querySelectorAll(\"TD\");\n    if (cells.length > Math.max(raIndex, decIndex)) {\n      const ra = parseFloat(cells[raIndex].textContent || \"\");\n      const dec = parseFloat(cells[decIndex].textContent || \"\");\n\n      if (!isNaN(ra) && !isNaN(dec)) {\n        sources.push({\n          ra,\n          dec,\n          id: `${catalogId}_${idx}`,\n          catalog: catalogId,\n        });\n      }\n    }\n  });\n\n  return sources;\n}\n\n/**\n * Query a single VizieR catalog with cone search (rate-limited).\n */\nexport async function queryCatalog(\n  catalog: CatalogDefinition,\n  ra: number,\n  dec: number,\n  radiusArcmin: number,\n  signal?: AbortSignal\n): Promise<CatalogQueryResult> {\n  return rateLimiter.enqueue(async () => {\n    const radiusDeg = radiusArcmin / 60;\n    const raCol = catalog.raColumn || \"RAJ2000\";\n    const decCol = catalog.decColumn || \"DEJ2000\";\n\n    try {\n      const query = buildConeSearchQuery(catalog, ra, dec, radiusDeg);\n\n      const params = new URLSearchParams({\n        REQUEST: \"doQuery\",\n        LANG: \"ADQL\",\n        FORMAT: \"votable\",\n        QUERY: query,\n      });\n\n      const response = await fetch(`${VIZIER_TAP_URL}?${params}`, {\n        signal,\n        headers: {\n          Accept: \"application/xml\",\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      const xml = await response.text();\n      const sources = parseVOTableResponse(xml, catalog.id, raCol, decCol);\n\n      return {\n        catalogId: catalog.id,\n        sources,\n        count: sources.length,\n        truncated: sources.length >= MAX_RESULTS,\n      };\n    } catch (err) {\n      if (err instanceof Error && err.name === \"AbortError\") {\n        throw err;\n      }\n      return {\n        catalogId: catalog.id,\n        sources: [],\n        count: 0,\n        truncated: false,\n        error: err instanceof Error ? err.message : \"Query failed\",\n      };\n    }\n  });\n}\n\n/**\n * Query multiple catalogs in parallel.\n */\nexport async function queryMultipleCatalogs(\n  catalogs: CatalogDefinition[],\n  ra: number,\n  dec: number,\n  radiusArcmin: number,\n  signal?: AbortSignal\n): Promise<Map<string, CatalogQueryResult>> {\n  const results = await Promise.all(\n    catalogs.map((cat) => queryCatalog(cat, ra, dec, radiusArcmin, signal))\n  );\n\n  const resultMap = new Map<string, CatalogQueryResult>();\n  results.forEach((result) => {\n    resultMap.set(result.catalogId, result);\n  });\n\n  return resultMap;\n}\n\n/**\n * Cache for catalog query results.\n */\nconst queryCache = new Map<string, { result: CatalogQueryResult; timestamp: number }>();\nconst CACHE_TTL = 5 * 60 * 1000; // 5 minutes\n\n/**\n * Query catalog with caching.\n */\nexport async function queryCatalogCached(\n  catalog: CatalogDefinition,\n  ra: number,\n  dec: number,\n  radiusArcmin: number,\n  signal?: AbortSignal\n): Promise<CatalogQueryResult> {\n  // Round coordinates for cache key\n  const cacheKey = `${catalog.id}:${ra.toFixed(4)}:${dec.toFixed(4)}:${radiusArcmin.toFixed(1)}`;\n\n  const cached = queryCache.get(cacheKey);\n  if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\n    return cached.result;\n  }\n\n  const result = await queryCatalog(catalog, ra, dec, radiusArcmin, signal);\n\n  if (!result.error) {\n    queryCache.set(cacheKey, { result, timestamp: Date.now() });\n  }\n\n  return result;\n}\n","import React, { useState, useCallback, useEffect, useRef } from \"react\";\nimport { CATALOG_DEFINITIONS, CatalogDefinition } from \"../../constants/catalogDefinitions\";\nimport CatalogLegend from \"./CatalogLegend\";\nimport { queryCatalogCached, CatalogQueryResult, CatalogSource } from \"../../utils/vizierQuery\";\n\nexport interface CatalogOverlayPanelProps {\n  /** Currently enabled catalog IDs */\n  enabledCatalogs: string[];\n  /** Callback when catalog selection changes */\n  onCatalogChange: (catalogIds: string[]) => void;\n  /** Center RA in degrees (required for queries) */\n  centerRa?: number;\n  /** Center Dec in degrees (required for queries) */\n  centerDec?: number;\n  /** Search radius in arcminutes */\n  searchRadius?: number;\n  /** Callback with queried sources for overlay rendering */\n  onSourcesLoaded?: (sources: Map<string, CatalogSource[]>) => void;\n  /** Reference to Aladin Lite instance for overlay rendering */\n  aladinRef?: React.RefObject<any>;\n  /** Custom class name */\n  className?: string;\n}\n\n/**\n * Panel for toggling VizieR catalog overlays.\n * Queries VizieR TAP service and integrates with Aladin Lite for visualization.\n */\nconst CatalogOverlayPanel: React.FC<CatalogOverlayPanelProps> = ({\n  enabledCatalogs,\n  onCatalogChange,\n  centerRa,\n  centerDec,\n  searchRadius = 5, // Default 5 arcmin\n  onSourcesLoaded,\n  aladinRef,\n  className = \"\",\n}) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [radiusInput, setRadiusInput] = useState(searchRadius);\n  const [queryResults, setQueryResults] = useState<Map<string, CatalogQueryResult>>(new Map());\n  const [loadingCatalogs, setLoadingCatalogs] = useState<Set<string>>(new Set());\n  const [lastQueryRadius, setLastQueryRadius] = useState<number>(searchRadius);\n\n  const abortControllerRef = useRef<AbortController | null>(null);\n  const overlayLayersRef = useRef<Map<string, any>>(new Map());\n\n  // Clear results when radius changes\n  useEffect(() => {\n    if (radiusInput !== lastQueryRadius) {\n      setQueryResults(new Map());\n      setLastQueryRadius(radiusInput);\n    }\n  }, [radiusInput, lastQueryRadius]);\n\n  // Cleanup abort controller on unmount\n  useEffect(() => {\n    return () => {\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n    };\n  }, []);\n\n  // Query catalogs when selection or position changes\n  useEffect(() => {\n    if (centerRa === undefined || centerDec === undefined) return;\n    if (enabledCatalogs.length === 0) {\n      // Clear all overlays\n      clearAllOverlays();\n      setQueryResults(new Map());\n      return;\n    }\n\n    // Abort previous queries\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n    }\n    abortControllerRef.current = new AbortController();\n    const signal = abortControllerRef.current.signal;\n\n    // Find catalogs that need querying\n    const catalogsToQuery = enabledCatalogs.filter(\n      (id) => !queryResults.has(id) || queryResults.get(id)?.error\n    );\n\n    if (catalogsToQuery.length === 0) return;\n\n    setLoadingCatalogs((prev) => new Set([...prev, ...catalogsToQuery]));\n\n    // Query each catalog\n    catalogsToQuery.forEach(async (catalogId) => {\n      const catalog = CATALOG_DEFINITIONS.find((c) => c.id === catalogId);\n      if (!catalog) return;\n\n      try {\n        const result = await queryCatalogCached(catalog, centerRa, centerDec, radiusInput, signal);\n\n        if (signal.aborted) return;\n\n        setQueryResults((prev) => {\n          const next = new Map(prev);\n          next.set(catalogId, result);\n          return next;\n        });\n\n        // Render overlay in Aladin if available\n        if (aladinRef?.current && result.sources.length > 0) {\n          renderCatalogOverlay(catalog, result.sources);\n        }\n      } catch (err) {\n        if (err instanceof Error && err.name === \"AbortError\") return;\n        console.error(`Failed to query ${catalogId}:`, err);\n      } finally {\n        if (!signal.aborted) {\n          setLoadingCatalogs((prev) => {\n            const next = new Set(prev);\n            next.delete(catalogId);\n            return next;\n          });\n        }\n      }\n    });\n\n    return () => {\n      abortControllerRef.current?.abort();\n    };\n  }, [enabledCatalogs, centerRa, centerDec, radiusInput]);\n\n  // Notify parent of loaded sources\n  useEffect(() => {\n    if (onSourcesLoaded) {\n      const sourcesMap = new Map<string, CatalogSource[]>();\n      queryResults.forEach((result, id) => {\n        if (result.sources.length > 0) {\n          sourcesMap.set(id, result.sources);\n        }\n      });\n      onSourcesLoaded(sourcesMap);\n    }\n  }, [queryResults, onSourcesLoaded]);\n\n  // Render catalog overlay in Aladin Lite\n  const renderCatalogOverlay = useCallback(\n    (catalog: CatalogDefinition, sources: CatalogSource[]) => {\n      if (!aladinRef?.current) return;\n\n      const aladin = aladinRef.current;\n\n      // Remove existing layer for this catalog\n      const existingLayer = overlayLayersRef.current.get(catalog.id);\n      if (existingLayer) {\n        aladin.removeLayer(existingLayer);\n      }\n\n      // Create new catalog layer\n      const catalogLayer = (window as any).A?.catalog({\n        name: catalog.name,\n        sourceSize: 12,\n        color: catalog.color,\n        shape:\n          catalog.symbol === \"circle\"\n            ? \"circle\"\n            : catalog.symbol === \"square\"\n            ? \"square\"\n            : catalog.symbol === \"diamond\"\n            ? \"rhomb\"\n            : \"circle\",\n      });\n\n      if (!catalogLayer) return;\n\n      // Add sources to layer\n      sources.forEach((src) => {\n        const source = (window as any).A?.source(src.ra, src.dec, {\n          name: src.id,\n          catalog: catalog.name,\n        });\n        if (source) {\n          catalogLayer.addSources([source]);\n        }\n      });\n\n      // Add layer to Aladin\n      aladin.addCatalog(catalogLayer);\n      overlayLayersRef.current.set(catalog.id, catalogLayer);\n    },\n    [aladinRef]\n  );\n\n  // Clear all overlays\n  const clearAllOverlays = useCallback(() => {\n    if (!aladinRef?.current) return;\n\n    overlayLayersRef.current.forEach((layer) => {\n      try {\n        aladinRef.current.removeLayer(layer);\n      } catch (e) {\n        // Layer may already be removed\n      }\n    });\n    overlayLayersRef.current.clear();\n  }, [aladinRef]);\n\n  // Remove overlay when catalog is disabled\n  useEffect(() => {\n    overlayLayersRef.current.forEach((layer, catalogId) => {\n      if (!enabledCatalogs.includes(catalogId) && aladinRef?.current) {\n        try {\n          aladinRef.current.removeLayer(layer);\n          overlayLayersRef.current.delete(catalogId);\n        } catch (e) {\n          // Layer may already be removed\n        }\n      }\n    });\n  }, [enabledCatalogs, aladinRef]);\n\n  const handleToggle = useCallback(\n    (catalogId: string) => {\n      if (enabledCatalogs.includes(catalogId)) {\n        onCatalogChange(enabledCatalogs.filter((id) => id !== catalogId));\n      } else {\n        onCatalogChange([...enabledCatalogs, catalogId]);\n      }\n    },\n    [enabledCatalogs, onCatalogChange]\n  );\n\n  const handleSelectAll = useCallback(() => {\n    if (enabledCatalogs.length === CATALOG_DEFINITIONS.length) {\n      onCatalogChange([]);\n    } else {\n      onCatalogChange(CATALOG_DEFINITIONS.map((c) => c.id));\n    }\n  }, [enabledCatalogs.length, onCatalogChange]);\n\n  const enabledCatalogDefs = CATALOG_DEFINITIONS.filter((c) => enabledCatalogs.includes(c.id));\n  const isLoading = loadingCatalogs.size > 0;\n\n  // Group catalogs by type\n  const opticalCatalogs = CATALOG_DEFINITIONS.filter((c) =>\n    [\"gaia\", \"tess\", \"ps1\", \"2mass\", \"wise\"].includes(c.id)\n  );\n  const radioCatalogs = CATALOG_DEFINITIONS.filter((c) =>\n    [\"nvss\", \"first\", \"sumss\", \"racs\", \"vlass\", \"atnf\"].includes(c.id)\n  );\n\n  const getResultCount = (catalogId: string): string | null => {\n    const result = queryResults.get(catalogId);\n    if (!result) return null;\n    if (result.error) return \"!\";\n    if (result.truncated) return `${result.count}+`;\n    return result.count.toString();\n  };\n\n  const renderCatalogCheckbox = (catalog: CatalogDefinition) => {\n    const resultCount = getResultCount(catalog.id);\n    const isQuerying = loadingCatalogs.has(catalog.id);\n    const hasError = queryResults.get(catalog.id)?.error;\n\n    return (\n      <label\n        key={catalog.id}\n        className=\"flex items-center gap-2 cursor-pointer text-sm hover:bg-gray-50 p-1 rounded\"\n        title={hasError || catalog.description}\n      >\n        <input\n          type=\"checkbox\"\n          checked={enabledCatalogs.includes(catalog.id)}\n          onChange={() => handleToggle(catalog.id)}\n          className=\"w-4 h-4 rounded\"\n          style={{\n            accentColor: catalog.color,\n          }}\n        />\n        <span\n          className=\"w-3 h-3 rounded-full flex-shrink-0\"\n          style={{ backgroundColor: catalog.color }}\n        />\n        <span className=\"flex-1\">{catalog.name}</span>\n        {isQuerying && (\n          <span className=\"w-3 h-3 border border-gray-400 border-t-transparent rounded-full animate-spin\" />\n        )}\n        {!isQuerying && resultCount && (\n          <span\n            className={`text-xs px-1.5 py-0.5 rounded ${\n              hasError ? \"bg-red-100 text-red-600\" : \"bg-gray-100 text-gray-600\"\n            }`}\n          >\n            {resultCount}\n          </span>\n        )}\n      </label>\n    );\n  };\n\n  const hasCoordinates = centerRa !== undefined && centerDec !== undefined;\n\n  return (\n    <div className={`${className}`}>\n      {/* Compact header with legend */}\n      <div className=\"flex items-center justify-between mb-2\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"font-semibold text-sm text-gray-700\">VizieR Catalogues</span>\n          {isLoading && (\n            <span className=\"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\" />\n          )}\n          {enabledCatalogs.length > 0 && (\n            <span className=\"badge badge-secondary text-xs\">{enabledCatalogs.length}</span>\n          )}\n        </div>\n        <button\n          onClick={() => setIsExpanded(!isExpanded)}\n          className=\"text-sm text-blue-600 hover:text-blue-800\"\n        >\n          {isExpanded ? \"Hide\" : \"Show\"} options\n        </button>\n      </div>\n\n      {/* Active catalog legend (always visible if any enabled) */}\n      {enabledCatalogDefs.length > 0 && (\n        <CatalogLegend catalogs={enabledCatalogDefs} className=\"mb-2\" />\n      )}\n\n      {/* Expanded panel */}\n      {isExpanded && (\n        <div className=\"border border-gray-200 rounded-lg p-3 bg-white space-y-3\">\n          {/* Search radius input */}\n          <div className=\"flex items-center gap-2 pb-2 border-b border-gray-100\">\n            <label className=\"text-xs text-gray-600 whitespace-nowrap\">Search radius:</label>\n            <input\n              type=\"number\"\n              min={0.5}\n              max={60}\n              step={0.5}\n              value={radiusInput}\n              onChange={(e) =>\n                setRadiusInput(Math.max(0.5, Math.min(60, parseFloat(e.target.value) || 5)))\n              }\n              className=\"w-16 px-2 py-1 text-sm border border-gray-300 rounded\"\n            />\n            <span className=\"text-xs text-gray-500\">arcmin</span>\n          </div>\n\n          {!hasCoordinates && (\n            <div className=\"text-xs text-amber-600 bg-amber-50 p-2 rounded\">\n              Set center coordinates to query catalogs\n            </div>\n          )}\n\n          {/* Quick actions */}\n          <div className=\"flex justify-between items-center pb-2 border-b border-gray-100\">\n            <button onClick={handleSelectAll} className=\"text-xs text-blue-600 hover:text-blue-800\">\n              {enabledCatalogs.length === CATALOG_DEFINITIONS.length\n                ? \"Deselect all\"\n                : \"Select all\"}\n            </button>\n            <button\n              onClick={() => {\n                onCatalogChange([]);\n                setQueryResults(new Map());\n              }}\n              className=\"text-xs text-gray-500 hover:text-red-500\"\n            >\n              Clear\n            </button>\n          </div>\n\n          {/* Optical/IR catalogs */}\n          <div>\n            <p className=\"text-xs font-semibold text-gray-500 uppercase mb-1\">Optical / Infrared</p>\n            <div className=\"grid grid-cols-2 gap-1\">\n              {opticalCatalogs.map(renderCatalogCheckbox)}\n            </div>\n          </div>\n\n          {/* Radio catalogs */}\n          <div>\n            <p className=\"text-xs font-semibold text-gray-500 uppercase mb-1\">Radio</p>\n            <div className=\"grid grid-cols-2 gap-1\">{radioCatalogs.map(renderCatalogCheckbox)}</div>\n          </div>\n\n          {/* Summary */}\n          {queryResults.size > 0 && (\n            <div className=\"text-xs text-gray-500 pt-2 border-t border-gray-100\">\n              {Array.from(queryResults.values()).reduce((sum, r) => sum + r.count, 0)} sources\n              loaded\n              {Array.from(queryResults.values()).some((r) => r.truncated) && \" (some truncated)\"}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default CatalogOverlayPanel;\n","import React, { useState, useCallback, useEffect } from \"react\";\n\nexport interface NearbyObject {\n  name: string;\n  ra: string;\n  dec: string;\n  separation: number; // arcsec\n  database: \"SIMBAD\" | \"NED\" | \"ATNF\" | \"Local\";\n  type?: string;\n  url?: string;\n}\n\nexport interface NearbyObjectsPanelProps {\n  /** Right Ascension in degrees */\n  raDeg: number;\n  /** Declination in degrees */\n  decDeg: number;\n  /** Initial search radius in arcminutes */\n  initialRadius?: number;\n  /** Maximum allowed radius */\n  maxRadius?: number;\n  /** Callback to fetch nearby objects */\n  onSearch: (raDeg: number, decDeg: number, radiusArcmin: number) => Promise<NearbyObject[]>;\n  /** Custom class name */\n  className?: string;\n  /** Exclude specific object by ID */\n  excludeId?: string;\n}\n\ntype SortKey = \"name\" | \"database\" | \"separation\";\ntype SortDir = \"asc\" | \"desc\";\n\n/**\n * Panel for displaying nearby astronomical objects from multiple databases.\n * Queries SIMBAD, NED, ATNF Pulsars, and local database.\n */\nconst NearbyObjectsPanel: React.FC<NearbyObjectsPanelProps> = ({\n  raDeg,\n  decDeg,\n  initialRadius = 2,\n  maxRadius = 60,\n  onSearch,\n  className = \"\",\n  excludeId,\n}) => {\n  const [radius, setRadius] = useState(initialRadius);\n  const [results, setResults] = useState<NearbyObject[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [sortKey, setSortKey] = useState<SortKey>(\"separation\");\n  const [sortDir, setSortDir] = useState<SortDir>(\"asc\");\n\n  const performSearch = useCallback(async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const objects = await onSearch(raDeg, decDeg, radius);\n      setResults(objects);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Search failed\");\n      setResults([]);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [raDeg, decDeg, radius, onSearch]);\n\n  // Auto-search on mount\n  useEffect(() => {\n    performSearch();\n  }, []);\n\n  const handleSort = useCallback((key: SortKey) => {\n    setSortKey((prevKey) => {\n      if (prevKey === key) {\n        setSortDir((prev) => (prev === \"asc\" ? \"desc\" : \"asc\"));\n      } else {\n        setSortDir(\"asc\");\n      }\n      return key;\n    });\n  }, []);\n\n  const sortedResults = [...results].sort((a, b) => {\n    let cmp = 0;\n    switch (sortKey) {\n      case \"name\":\n        cmp = a.name.localeCompare(b.name);\n        break;\n      case \"database\":\n        cmp = a.database.localeCompare(b.database);\n        break;\n      case \"separation\":\n        cmp = a.separation - b.separation;\n        break;\n    }\n    return sortDir === \"asc\" ? cmp : -cmp;\n  });\n\n  const getDatabaseColor = (db: NearbyObject[\"database\"]) => {\n    switch (db) {\n      case \"SIMBAD\":\n        return \"badge-info\";\n      case \"NED\":\n        return \"badge-success\";\n      case \"ATNF\":\n        return \"badge-warning\";\n      case \"Local\":\n        return \"badge-secondary\";\n    }\n  };\n\n  const getDatabaseUrl = (obj: NearbyObject) => {\n    if (obj.url) return obj.url;\n\n    switch (obj.database) {\n      case \"SIMBAD\":\n        return `https://simbad.u-strasbg.fr/simbad/sim-id?Ident=${encodeURIComponent(obj.name)}`;\n      case \"NED\":\n        return `https://ned.ipac.caltech.edu/byname?objname=${encodeURIComponent(obj.name)}`;\n      case \"ATNF\":\n        return `https://www.atnf.csiro.au/research/pulsar/psrcat/proc_form.php?pulsar_names=${encodeURIComponent(\n          obj.name\n        )}`;\n      default:\n        return undefined;\n    }\n  };\n\n  const SortArrow: React.FC<{ column: SortKey }> = ({ column }) => {\n    if (sortKey !== column) {\n      return (\n        <svg\n          className=\"w-3 h-3 text-gray-300 ml-1\"\n          viewBox=\"0 0 10 10\"\n          aria-hidden=\"true\"\n        >\n          <path d=\"M5 2l2 2H3z\" fill=\"currentColor\" />\n          <path d=\"M5 8L3 6h4z\" fill=\"currentColor\" />\n        </svg>\n      );\n    }\n    if (sortDir === \"asc\") {\n      return (\n        <svg\n          className=\"w-3 h-3 text-gray-500 ml-1\"\n          viewBox=\"0 0 10 10\"\n          aria-hidden=\"true\"\n        >\n          <path d=\"M5 2l3 4H2z\" fill=\"currentColor\" />\n        </svg>\n      );\n    }\n    return (\n      <svg className=\"w-3 h-3 text-gray-500 ml-1\" viewBox=\"0 0 10 10\" aria-hidden=\"true\">\n        <path d=\"M5 8L2 4h6z\" fill=\"currentColor\" />\n      </svg>\n    );\n  };\n\n  return (\n    <div className={`card ${className}`}>\n      <div className=\"card-header\">\n        <h4 className=\"text-lg font-semibold\">Nearby Objects</h4>\n      </div>\n\n      <div className=\"card-body\">\n        {/* Search Controls */}\n        <div className=\"flex items-center gap-3 mb-4\">\n          <label className=\"text-sm text-gray-600 whitespace-nowrap\">Search within</label>\n          <input\n            type=\"number\"\n            value={radius}\n            onChange={(e) => setRadius(Math.min(Number(e.target.value), maxRadius))}\n            min={0.1}\n            max={maxRadius}\n            step={0.5}\n            className=\"form-control w-20\"\n          />\n          <span className=\"text-sm text-gray-600\">arcmin</span>\n          <button onClick={performSearch} disabled={isLoading} className=\"btn btn-primary btn-sm\">\n            {isLoading ? (\n              <span className=\"flex items-center gap-1\">\n                <span className=\"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                Searching...\n              </span>\n            ) : (\n              \"Search\"\n            )}\n          </button>\n        </div>\n\n        {/* Error Display */}\n        {error && (\n          <div className=\"alert alert-danger mb-4\">\n            <p>{error}</p>\n          </div>\n        )}\n\n        {/* Results Table */}\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-8\">\n            <div className=\"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\" />\n            <span className=\"ml-2 text-gray-500\">Searching databases...</span>\n          </div>\n        ) : results.length === 0 ? (\n          <div className=\"text-center py-8 text-gray-500\">\n            <svg\n              className=\"w-12 h-12 mx-auto mb-2 text-gray-300\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"\n              />\n            </svg>\n            <p>No nearby objects found within {radius} arcmin</p>\n          </div>\n        ) : (\n          <div className=\"overflow-x-auto max-h-80 overflow-y-auto\">\n            <table className=\"table table-compact\">\n              <thead className=\"sticky top-0\">\n                <tr>\n                  <th\n                    onClick={() => handleSort(\"name\")}\n                    className=\"cursor-pointer hover:bg-opacity-80\"\n                  >\n                    Name <SortArrow column=\"name\" />\n                  </th>\n                  <th\n                    onClick={() => handleSort(\"database\")}\n                    className=\"cursor-pointer hover:bg-opacity-80\"\n                  >\n                    Database <SortArrow column=\"database\" />\n                  </th>\n                  <th className=\"text-center\">RA</th>\n                  <th className=\"text-center\">Dec</th>\n                  <th\n                    onClick={() => handleSort(\"separation\")}\n                    className=\"cursor-pointer hover:bg-opacity-80 text-right\"\n                  >\n                    Sep (″) <SortArrow column=\"separation\" />\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                {sortedResults.map((obj, idx) => {\n                  const url = getDatabaseUrl(obj);\n                  return (\n                    <tr key={`${obj.database}-${obj.name}-${idx}`}>\n                      <td>\n                        {url ? (\n                          <a href={url} target=\"_blank\" rel=\"noreferrer\" className=\"link\">\n                            {obj.name}\n                          </a>\n                        ) : (\n                          obj.name\n                        )}\n                        {obj.type && (\n                          <span className=\"text-xs text-gray-500 ml-1\">({obj.type})</span>\n                        )}\n                      </td>\n                      <td>\n                        <span className={`badge ${getDatabaseColor(obj.database)}`}>\n                          {obj.database}\n                        </span>\n                      </td>\n                      <td className=\"text-center font-mono text-xs\">{obj.ra}</td>\n                      <td className=\"text-center font-mono text-xs\">{obj.dec}</td>\n                      <td className=\"text-right font-mono\">{obj.separation.toFixed(2)}</td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n        )}\n\n        {/* Results Summary */}\n        {results.length > 0 && (\n          <div className=\"mt-3 text-xs text-gray-500 flex justify-between\">\n            <span>\n              {results.length} object{results.length !== 1 ? \"s\" : \"\"} found\n            </span>\n            <span>\n              SIMBAD: {results.filter((r) => r.database === \"SIMBAD\").length} | NED:{\" \"}\n              {results.filter((r) => r.database === \"NED\").length} | ATNF:{\" \"}\n              {results.filter((r) => r.database === \"ATNF\").length} | Local:{\" \"}\n              {results.filter((r) => r.database === \"Local\").length}\n            </span>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default NearbyObjectsPanel;\n","import React, { useState, useEffect, useMemo } from \"react\";\nimport { useParams, Link } from \"react-router-dom\";\nimport ProvenanceStrip from \"../components/provenance/ProvenanceStrip\";\nimport ErrorDisplay from \"../components/errors/ErrorDisplay\";\nimport { Card, CoordinateDisplay, LoadingSpinner, QAMetrics } from \"../components/common\";\nimport { AladinLiteViewer, LightCurveChart } from \"../components/widgets\";\nimport { CatalogOverlayPanel } from \"../components/catalogs\";\nimport { NearbyObjectsPanel, NearbyObject } from \"../components/crossmatch\";\nimport type { LightCurveDataPoint } from \"../components/widgets\";\nimport { mapProvenanceFromSourceDetail, SourceDetailResponse } from \"../utils/provenanceMappers\";\nimport { relativeTime } from \"../utils/relativeTime\";\nimport type { ErrorResponse } from \"../types/errors\";\nimport type { ProvenanceStripProps } from \"../types/provenance\";\nimport { useSource } from \"../hooks/useQueries\";\nimport { usePreferencesStore } from \"../stores/appStore\";\n\n/** SIMBAD external link icon */\nconst ExternalLinkIcon: React.FC<{ className?: string }> = ({ className = \"w-4 h-4\" }) => (\n  <svg className={className} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n    <path\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n      strokeWidth={2}\n      d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"\n    />\n  </svg>\n);\n\n/**\n * Detail page for an astronomical source.\n * Displays source info, lightcurve, contributing images, and provenance.\n */\nconst SourceDetailPage: React.FC = () => {\n  const { sourceId } = useParams<{ sourceId: string }>();\n  const { data: source, isLoading, error, refetch } = useSource(sourceId);\n  const addRecentSource = usePreferencesStore((state) => state.addRecentSource);\n  const [selectedImageId, setSelectedImageId] = useState<string | undefined>(undefined);\n  const [showSkyViewer, setShowSkyViewer] = useState(true);\n  const encodedSourceId = sourceId ? encodeURIComponent(sourceId) : \"\";\n  const [showNearbyPanel, setShowNearbyPanel] = useState(false);\n\n  // Search for nearby objects in external catalogs\n  const handleNearbySearch = async (\n    raDeg: number,\n    decDeg: number,\n    radiusArcmin: number\n  ): Promise<NearbyObject[]> => {\n    const results: NearbyObject[] = [];\n\n    // Query SIMBAD via TAP\n    try {\n      const simbadQuery = `SELECT TOP 20 main_id, ra, dec, otype_longname\n        FROM basic\n        WHERE CONTAINS(POINT('ICRS', ra, dec), CIRCLE('ICRS', ${raDeg}, ${decDeg}, ${\n        radiusArcmin / 60\n      })) = 1`;\n      const simbadRes = await fetch(\n        `https://simbad.u-strasbg.fr/simbad/sim-tap/sync?REQUEST=doQuery&LANG=ADQL&FORMAT=json&QUERY=${encodeURIComponent(\n          simbadQuery\n        )}`\n      );\n      if (simbadRes.ok) {\n        const simbadData = await simbadRes.json();\n        const rows = simbadData.data || [];\n        for (const row of rows) {\n          const objRa = parseFloat(row[1]);\n          const objDec = parseFloat(row[2]);\n          const sep =\n            Math.sqrt(\n              Math.pow((raDeg - objRa) * Math.cos((decDeg * Math.PI) / 180), 2) +\n                Math.pow(decDeg - objDec, 2)\n            ) * 3600;\n          results.push({\n            name: row[0],\n            ra: objRa.toFixed(6),\n            dec: objDec.toFixed(6),\n            separation: sep,\n            database: \"SIMBAD\",\n            type: row[3] || undefined,\n            url: `https://simbad.u-strasbg.fr/simbad/sim-id?Ident=${encodeURIComponent(row[0])}`,\n          });\n        }\n      }\n    } catch (e) {\n      console.warn(\"SIMBAD query failed:\", e);\n    }\n\n    return results;\n  };\n\n  // Track in recent items when source loads\n  useEffect(() => {\n    if (source && sourceId) {\n      addRecentSource(sourceId);\n    }\n  }, [source, sourceId, addRecentSource]);\n\n  // Set default selected image when source loads\n  useEffect(() => {\n    const sourceData = source as SourceDetailResponse | undefined;\n    if (sourceData?.contributing_images?.length) {\n      setSelectedImageId(sourceData.contributing_images[0].image_id);\n    }\n  }, [source]);\n\n  // Generate light curve data from contributing images\n  const lightCurveData = useMemo((): LightCurveDataPoint[] => {\n    const sourceData = source as SourceDetailResponse | undefined;\n    if (!sourceData?.contributing_images) return [];\n\n    return sourceData.contributing_images\n      .filter((img) => img.flux_jy !== undefined && img.created_at)\n      .map((img) => ({\n        time: img.created_at!,\n        flux: img.flux_jy!,\n        fluxError: (img as { flux_error_jy?: number }).flux_error_jy,\n        label: img.path?.split(\"/\").pop() || img.image_id,\n      }))\n      .sort((a, b) => new Date(a.time).getTime() - new Date(b.time).getTime());\n  }, [source]);\n\n  if (isLoading) {\n    return <LoadingSpinner label=\"Loading source details...\" />;\n  }\n\n  if (error) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <ErrorDisplay error={error as unknown as ErrorResponse} onRetry={() => refetch()} />\n      </div>\n    );\n  }\n\n  if (!source) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <Card>\n          <p className=\"text-gray-500 mb-4\">Source not found.</p>\n          <Link to=\"/sources\" className=\"link\">\n            Back to Sources\n          </Link>\n        </Card>\n      </div>\n    );\n  }\n\n  // Cast for provenance mapper\n  const sourceData = source as unknown as SourceDetailResponse;\n  const provenance: ProvenanceStripProps | null = mapProvenanceFromSourceDetail(\n    sourceData,\n    selectedImageId\n  );\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <Link to=\"/sources\" className=\"text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block\">\n          Back to Sources\n        </Link>\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\n          {sourceData.name || `Source ${sourceData.id}`}\n        </h1>\n        {provenance && <ProvenanceStrip {...provenance} />}\n      </div>\n\n      {/* Main content grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Left column - Coordinates and actions (sticky on desktop) */}\n        <div className=\"lg:col-span-1 sticky-sidebar\">\n          {/* Coordinates */}\n          <Card title=\"Position\">\n            <CoordinateDisplay\n              raDeg={sourceData.ra_deg}\n              decDeg={sourceData.dec_deg}\n              showDecimal\n              allowFormatToggle\n            />\n            <div className=\"mt-4 pt-4 border-t border-gray-100 space-y-2\">\n              <a\n                href={`https://simbad.u-strasbg.fr/simbad/sim-coo?Coord=${sourceData.ra_deg}+${sourceData.dec_deg}&CooFrame=FK5&CooEpoch=2000&CooEqui=2000&Radius=2&Radius.unit=arcmin`}\n                target=\"_blank\"\n                rel=\"noreferrer\"\n                className=\"inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-800 hover:underline\"\n              >\n                <svg className=\"w-4 h-4\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                  <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z\" />\n                </svg>\n                Search in SIMBAD\n                <ExternalLinkIcon className=\"w-3 h-3\" />\n              </a>\n              <a\n                href={`https://ned.ipac.caltech.edu/conesearch?search_type=Near%20Position%20Search&ra=${sourceData.ra_deg}&dec=${sourceData.dec_deg}&radius=2&in_csys=Equatorial&in_equinox=J2000`}\n                target=\"_blank\"\n                rel=\"noreferrer\"\n                className=\"inline-flex items-center gap-1.5 text-sm text-blue-600 hover:text-blue-800 hover:underline\"\n              >\n                <svg className=\"w-4 h-4\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                  <path d=\"M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z\" />\n                </svg>\n                Search in NED\n                <ExternalLinkIcon className=\"w-3 h-3\" />\n              </a>\n            </div>\n          </Card>\n\n          {/* Actions */}\n          <Card title=\"Actions\">\n            <div className=\"flex flex-col gap-2\">\n              <button\n                type=\"button\"\n                className=\"btn btn-primary\"\n                onClick={() =>\n                  window.open(\n                    `${import.meta.env.VITE_API_URL || \"/api\"}/sources/${encodedSourceId}/lightcurve`,\n                    \"_blank\"\n                  )\n                }\n              >\n                View Lightcurve\n              </button>\n              <button\n                type=\"button\"\n                className=\"btn btn-secondary\"\n                onClick={() =>\n                  window.open(\n                    `${import.meta.env.VITE_API_URL || \"/api\"}/sources/${encodedSourceId}/postage_stamps`,\n                    \"_blank\"\n                  )\n                }\n              >\n                Download Postage Stamps\n              </button>\n              <button\n                type=\"button\"\n                className=\"btn btn-secondary\"\n                onClick={() =>\n                  window.open(\n                    `${import.meta.env.VITE_API_URL || \"/api\"}/sources/${encodedSourceId}/variability`,\n                    \"_blank\"\n                  )\n                }\n              >\n                Variability Analysis\n              </button>\n            </div>\n          </Card>\n\n          {/* Source metadata */}\n          <Card title=\"Details\">\n            <dl className=\"space-y-3\">\n              <div>\n                <dt className=\"text-xs text-gray-500 uppercase tracking-wide\">Source ID</dt>\n                <dd className=\"font-mono text-sm text-gray-900\">{sourceData.id}</dd>\n              </div>\n              {sourceData.name && (\n                <div>\n                  <dt className=\"text-xs text-gray-500 uppercase tracking-wide\">Name</dt>\n                  <dd className=\"text-sm text-gray-900\">{sourceData.name}</dd>\n                </div>\n              )}\n              <div>\n                <dt className=\"text-xs text-gray-500 uppercase tracking-wide\">Detections</dt>\n                <dd className=\"text-sm text-gray-900\">\n                  {sourceData.contributing_images?.length || 0} images\n                </dd>\n              </div>\n            </dl>\n          </Card>\n        </div>\n\n        {/* Right column - Interactive widgets and images */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* Sky Viewer - Aladin Lite */}\n          <Card\n            title=\"Sky View\"\n            subtitle={\n              <button\n                type=\"button\"\n                onClick={() => setShowSkyViewer(!showSkyViewer)}\n                className=\"text-xs text-blue-600 hover:text-blue-800\"\n              >\n                {showSkyViewer ? \"Hide\" : \"Show\"}\n              </button>\n            }\n          >\n            {showSkyViewer && (\n              <AladinLiteViewer\n                raDeg={sourceData.ra_deg}\n                decDeg={sourceData.dec_deg}\n                fov={0.1}\n                height={300}\n                sourceName={sourceData.name || `Source ${sourceData.id}`}\n                className=\"rounded-lg overflow-hidden\"\n              />\n            )}\n          </Card>\n\n          {/* VizieR Catalog Overlays */}\n          <Card title=\"Catalog Crossmatch\">\n            <CatalogOverlayPanel\n              centerRa={sourceData.ra_deg}\n              centerDec={sourceData.dec_deg}\n              defaultRadius={2}\n            />\n          </Card>\n\n          {/* Nearby Objects from SIMBAD/NED */}\n          <Card\n            title=\"Nearby Objects\"\n            subtitle={\n              <button\n                type=\"button\"\n                onClick={() => setShowNearbyPanel(!showNearbyPanel)}\n                className=\"text-xs text-blue-600 hover:text-blue-800\"\n              >\n                {showNearbyPanel ? \"Hide\" : \"Search SIMBAD\"}\n              </button>\n            }\n          >\n            {showNearbyPanel && (\n              <NearbyObjectsPanel\n                raDeg={sourceData.ra_deg}\n                decDeg={sourceData.dec_deg}\n                initialRadius={2}\n                maxRadius={30}\n                onSearch={handleNearbySearch}\n              />\n            )}\n            {!showNearbyPanel && (\n              <p className=\"text-sm text-gray-500\">\n                Click \"Search SIMBAD\" to find nearby objects in external catalogs.\n              </p>\n            )}\n          </Card>\n\n          {/* Light Curve Chart */}\n          {lightCurveData.length > 1 && (\n            <Card title=\"Light Curve\" subtitle={`${lightCurveData.length} measurements`}>\n              <LightCurveChart\n                data={lightCurveData}\n                height={300}\n                yAxisLabel=\"Flux\"\n                xAxisLabel=\"Observation Date\"\n                enableZoom={true}\n                showErrorBars={true}\n                onPointClick={(point) => {\n                  // Find the corresponding image and select it\n                  const img = sourceData.contributing_images?.find(\n                    (i) => i.created_at === point.time\n                  );\n                  if (img) {\n                    setSelectedImageId(img.image_id);\n                  }\n                }}\n              />\n            </Card>\n          )}\n\n          {/* Contributing Images */}\n          {sourceData.contributing_images && sourceData.contributing_images.length > 0 && (\n            <Card\n              title=\"Contributing Images\"\n              subtitle={`${sourceData.contributing_images.length} detection${\n                sourceData.contributing_images.length !== 1 ? \"s\" : \"\"\n              }`}\n            >\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                {sourceData.contributing_images.map((img) => (\n                  <div\n                    key={img.image_id}\n                    className={`p-3 rounded-lg border-2 cursor-pointer transition-all ${\n                      selectedImageId === img.image_id\n                        ? \"border-blue-500 bg-blue-50\"\n                        : \"border-gray-200 hover:border-gray-300 bg-white\"\n                    }`}\n                    onClick={() => setSelectedImageId(img.image_id)}\n                    onKeyDown={(e) => {\n                      if (e.key === \"Enter\" || e.key === \" \") {\n                        setSelectedImageId(img.image_id);\n                      }\n                    }}\n                    role=\"button\"\n                    tabIndex={0}\n                  >\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1 min-w-0\">\n                        <Link\n                          to={`/images/${img.image_id}`}\n                          className=\"font-medium text-gray-900 hover:text-blue-600 truncate block\"\n                          onClick={(e) => e.stopPropagation()}\n                        >\n                          {img.path?.split(\"/\").pop() || img.image_id}\n                        </Link>\n                        {img.ms_path && (\n                          <div className=\"text-xs text-gray-500 truncate mt-0.5\">\n                            MS: {img.ms_path.split(\"/\").pop()}\n                          </div>\n                        )}\n                      </div>\n                      {img.qa_grade && (\n                        <span\n                          className={`badge ml-2 ${\n                            img.qa_grade === \"good\"\n                              ? \"badge-success\"\n                              : img.qa_grade === \"warn\"\n                              ? \"badge-warning\"\n                              : \"badge-error\"\n                          }`}\n                        >\n                          {img.qa_grade}\n                        </span>\n                      )}\n                    </div>\n\n                    {/* Flux and date info */}\n                    <div className=\"flex items-center gap-3 mt-2 text-xs text-gray-500\">\n                      {img.flux_jy !== undefined && (\n                        <span>\n                          <span className=\"font-medium\">Flux:</span>{\" \"}\n                          {img.flux_jy < 0.001\n                            ? `${(img.flux_jy * 1e6).toFixed(1)} μJy`\n                            : img.flux_jy < 1\n                            ? `${(img.flux_jy * 1e3).toFixed(2)} mJy`\n                            : `${img.flux_jy.toFixed(3)} Jy`}\n                        </span>\n                      )}\n                      {img.created_at && (\n                        <span title={new Date(img.created_at).toLocaleString()}>\n                          {relativeTime(img.created_at)}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </Card>\n          )}\n\n          {/* Empty state */}\n          {(!sourceData.contributing_images || sourceData.contributing_images.length === 0) && (\n            <Card>\n              <div className=\"text-center py-8 text-gray-500\">\n                <svg\n                  className=\"w-12 h-12 mx-auto mb-3 text-gray-300\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"\n                  />\n                </svg>\n                <p>No contributing images found for this source.</p>\n              </div>\n            </Card>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default SourceDetailPage;\n"],"file":"SourceDetailPage-EBKKcKBY.js"}