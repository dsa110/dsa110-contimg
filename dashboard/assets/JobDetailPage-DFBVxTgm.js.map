{"version":3,"file":"JobDetailPage-DFBVxTgm.js","sources":["../../src/pages/JobDetailPage.tsx"],"sourcesContent":["import React from \"react\";\nimport { useParams, Link } from \"react-router-dom\";\nimport { useJobProvenance } from \"../hooks/useQueries\";\nimport ProvenanceStrip from \"../components/provenance/ProvenanceStrip\";\nimport ErrorDisplay from \"../components/errors/ErrorDisplay\";\nimport { Card, CoordinateDisplay, QAMetrics, LoadingSpinner } from \"../components/common\";\nimport type { ErrorResponse } from \"../types/errors\";\nimport { relativeTime } from \"../utils/relativeTime\";\nimport { usePreferencesStore } from \"../stores/appStore\";\n\ntype JobStatus = \"pending\" | \"running\" | \"completed\" | \"failed\";\n\nconst statusConfig: Record<JobStatus, { bg: string; text: string; dot: string }> = {\n  pending: { bg: \"bg-gray-100\", text: \"text-gray-700\", dot: \"bg-gray-500\" },\n  running: { bg: \"bg-blue-100\", text: \"text-blue-700\", dot: \"bg-blue-500\" },\n  completed: { bg: \"bg-green-100\", text: \"text-green-700\", dot: \"bg-green-500\" },\n  failed: { bg: \"bg-red-100\", text: \"text-red-700\", dot: \"bg-red-500\" },\n};\n\n/**\n * Job detail page showing provenance and job information.\n */\nconst JobDetailPage: React.FC = () => {\n  const { runId } = useParams<{ runId: string }>();\n  const { data: provenance, isLoading, error, refetch } = useJobProvenance(runId);\n  const addRecentJob = usePreferencesStore((state) => state.addRecentJob);\n\n  // Track in recent items when job loads\n  React.useEffect(() => {\n    if (provenance && runId) {\n      addRecentJob(runId);\n    }\n  }, [provenance, runId, addRecentJob]);\n\n  if (isLoading) {\n    return <LoadingSpinner label=\"Loading job details...\" />;\n  }\n\n  if (error) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <ErrorDisplay error={error as unknown as ErrorResponse} onRetry={() => refetch()} />\n      </div>\n    );\n  }\n\n  if (!provenance) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <Card>\n          <p className=\"text-gray-500 mb-4\">Job not found.</p>\n          <Link to=\"/jobs\" className=\"link\">\n            Back to Jobs\n          </Link>\n        </Card>\n      </div>\n    );\n  }\n\n  // Determine status from provenance data\n  const status: JobStatus = provenance.qaGrade\n    ? \"completed\"\n    : provenance.createdAt\n    ? \"running\"\n    : \"pending\";\n  const statusInfo = statusConfig[status];\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <Link to=\"/jobs\" className=\"text-sm text-gray-500 hover:text-gray-700 mb-2 inline-block\">\n          Back to Jobs\n        </Link>\n        <div className=\"flex items-center gap-3 mb-2\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Job: {runId}</h1>\n          <span\n            className={`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${statusInfo.bg} ${statusInfo.text}`}\n          >\n            <span className={`h-2.5 w-2.5 rounded-full ${statusInfo.dot}`} aria-hidden=\"true\" />\n            <span className=\"capitalize\">{status}</span>\n          </span>\n        </div>\n        <ProvenanceStrip {...provenance} />\n      </div>\n\n      {/* Main content grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Left column - Status and actions */}\n        <div className=\"lg:col-span-1 space-y-6\">\n          {/* Status card */}\n          <Card title=\"Status\">\n            <div className=\"space-y-4\">\n              <div\n                className={`p-4 rounded-lg ${statusInfo.bg} flex items-center justify-center gap-2`}\n              >\n                <span className={`h-3 w-3 rounded-full ${statusInfo.dot}`} aria-hidden=\"true\" />\n                <span className={`text-lg font-semibold ${statusInfo.text} capitalize`}>\n                  {status}\n                </span>\n              </div>\n              {provenance.createdAt && (\n                <div>\n                  <dt className=\"text-xs text-gray-500 uppercase tracking-wide\">Started</dt>\n                  <dd className=\"text-sm text-gray-900\">\n                    {new Date(provenance.createdAt).toLocaleString()}\n                    <span className=\"text-gray-500 ml-1\">\n                      ({relativeTime(provenance.createdAt)})\n                    </span>\n                  </dd>\n                </div>\n              )}\n            </div>\n          </Card>\n\n          {/* Actions */}\n          <Card title=\"Actions\">\n            <div className=\"flex flex-col gap-2\">\n              {provenance.logsUrl && (\n                <a\n                  href={provenance.logsUrl}\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                  className=\"btn btn-secondary text-center\"\n                >\n                  View Logs\n                </a>\n              )}\n              {provenance.imageUrl && (\n                <Link to={provenance.imageUrl} className=\"btn btn-primary text-center\">\n                  View Output Image\n                </Link>\n              )}\n              {provenance.qaUrl && (\n                <a\n                  href={provenance.qaUrl}\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                  className=\"btn btn-secondary text-center\"\n                >\n                  QA Report\n                </a>\n              )}\n              <button\n                type=\"button\"\n                className=\"btn btn-secondary\"\n                onClick={() => {\n                  // TODO: Implement re-run functionality\n                  alert(\"Re-run functionality not yet implemented\");\n                }}\n              >\n                Re-run Job\n              </button>\n            </div>\n          </Card>\n        </div>\n\n        {/* Right column - Details */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* QA Metrics */}\n          {provenance.qaGrade && (\n            <Card title=\"Quality Assessment\">\n              <QAMetrics\n                grade={provenance.qaGrade as \"good\" | \"warn\" | \"fail\" | undefined}\n                summary={provenance.qaSummary}\n              />\n            </Card>\n          )}\n\n          {/* Pointing coordinates */}\n          {provenance.pointingRaDeg !== undefined && provenance.pointingDecDeg !== undefined && (\n            <Card title=\"Pointing\">\n              <CoordinateDisplay\n                raDeg={provenance.pointingRaDeg}\n                decDeg={provenance.pointingDecDeg}\n                showDecimal\n              />\n            </Card>\n          )}\n\n          {/* Input/Output details */}\n          <Card title=\"Pipeline Details\">\n            <dl className=\"grid grid-cols-1 gap-4\">\n              <div>\n                <dt className=\"text-xs text-gray-500 uppercase tracking-wide\">Run ID</dt>\n                <dd className=\"font-mono text-sm text-gray-900 break-all\">\n                  {provenance.runId || runId}\n                </dd>\n              </div>\n              {provenance.msPath && (\n                <div>\n                  <dt className=\"text-xs text-gray-500 uppercase tracking-wide\">\n                    Input Measurement Set\n                  </dt>\n                  <dd className=\"font-mono text-sm break-all\">\n                    <Link\n                      to={`/ms/${encodeURIComponent(provenance.msPath)}`}\n                      className=\"text-blue-600 hover:text-blue-800 hover:underline\"\n                    >\n                      {provenance.msPath}\n                    </Link>\n                  </dd>\n                </div>\n              )}\n              {provenance.calTable && (\n                <div>\n                  <dt className=\"text-xs text-gray-500 uppercase tracking-wide\">\n                    Calibration Table\n                  </dt>\n                  <dd className=\"font-mono text-sm text-gray-900 break-all\">\n                    {provenance.calUrl ? (\n                      <a\n                        href={provenance.calUrl}\n                        className=\"text-blue-600 hover:text-blue-800 hover:underline\"\n                      >\n                        {provenance.calTable}\n                      </a>\n                    ) : (\n                      provenance.calTable\n                    )}\n                  </dd>\n                </div>\n              )}\n            </dl>\n          </Card>\n\n          {/* Related resources */}\n          <Card title=\"Related Resources\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n              {provenance.msUrl && (\n                <Link\n                  to={provenance.msUrl}\n                  className=\"p-3 rounded-lg border border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-colors flex items-center gap-3\"\n                >\n                  <span className=\"h-10 w-10 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-semibold text-sm\">\n                    MS\n                  </span>\n                  <div>\n                    <div className=\"font-medium text-gray-900\">Measurement Set</div>\n                    <div className=\"text-xs text-gray-500\">View MS details</div>\n                  </div>\n                </Link>\n              )}\n              {provenance.imageUrl && (\n                <Link\n                  to={provenance.imageUrl}\n                  className=\"p-3 rounded-lg border border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-colors flex items-center gap-3\"\n                >\n                  <span className=\"h-10 w-10 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-semibold text-sm\">\n                    IMG\n                  </span>\n                  <div>\n                    <div className=\"font-medium text-gray-900\">Output Image</div>\n                    <div className=\"text-xs text-gray-500\">View image details</div>\n                  </div>\n                </Link>\n              )}\n              {provenance.logsUrl && (\n                <a\n                  href={provenance.logsUrl}\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                  className=\"p-3 rounded-lg border border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-colors flex items-center gap-3\"\n                >\n                  <span className=\"h-10 w-10 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-semibold text-sm\">\n                    LOG\n                  </span>\n                  <div>\n                    <div className=\"font-medium text-gray-900\">Logs</div>\n                    <div className=\"text-xs text-gray-500\">View job logs</div>\n                  </div>\n                </a>\n              )}\n              {provenance.qaUrl && (\n                <a\n                  href={provenance.qaUrl}\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                  className=\"p-3 rounded-lg border border-gray-200 hover:border-blue-400 hover:bg-blue-50 transition-colors flex items-center gap-3\"\n                >\n                  <span className=\"h-10 w-10 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-semibold text-sm\">\n                    QA\n                  </span>\n                  <div>\n                    <div className=\"font-medium text-gray-900\">QA Report</div>\n                    <div className=\"text-xs text-gray-500\">Quality assessment</div>\n                  </div>\n                </a>\n              )}\n            </div>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default JobDetailPage;\n"],"names":["statusConfig","JobDetailPage","runId","useParams","provenance","isLoading","error","refetch","useJobProvenance","addRecentJob","usePreferencesStore","state","React","jsx","LoadingSpinner","ErrorDisplay","Card","Link","status","statusInfo","jsxs","ProvenanceStrip","relativeTime","QAMetrics","CoordinateDisplay"],"mappings":"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"}