
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dsa110-contimg.github.io/dsa110-contimg/legacy-overview/">
      
      
        <link rel="prev" href="../ops/deploy-docker/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Legacy Overview - DSA-110 Continuum Imaging Pipeline</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2a3383ac.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#layout-overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DSA-110 Continuum Imaging Pipeline" class="md-header__button md-logo" aria-label="DSA-110 Continuum Imaging Pipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DSA-110 Continuum Imaging Pipeline
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Legacy Overview
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dsa110/dsa110-contimg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DSA-110 Continuum Imaging Pipeline" class="md-nav__button md-logo" aria-label="DSA-110 Continuum Imaging Pipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DSA-110 Continuum Imaging Pipeline
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dsa110/dsa110-contimg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dashboard Quick Start
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline Visuals
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    End-to-End Streaming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/convert-standalone/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Convert UVH5 → MS (Standalone)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/calibrate-apply/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibrate + Apply
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    How-To Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            How-To Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howto/reprocess/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reprocess a Group
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howto/mosaic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build Nightly Mosaic
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Science
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Science
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../science/photometry_normalization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Photometry Normalization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../downsampling_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Downsampling Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline/README_uvh5_to_ms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline: UVH5 → MS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline/streaming_converter_README/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline: Streaming Converter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dashboard User Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/dashboard_development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dashboard Development
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/frontend_design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Front-End Design Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/dashboard_mockups/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UI Mockups & Specifications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/frontend_next_steps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementation Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/env/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reports
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Reports
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reports/CONTINUOUS_PIPELINE_ROADMAP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Continuous Pipeline Roadmap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reports/CONVERSION_PROCESS_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conversion Process Summary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reports/DSA110_SUBBAND_UPDATE_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subband Update Summary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reports/PYUVDATA_3.2.4_COMPATIBILITY_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PyUVData 3.2.4 Compatibility
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reports/REBUILD_CASA6_ENVIRONMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rebuild CASA6 Environment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../simulation/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Simulation
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Simulation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simulation/PHASE1_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Phase 1 Summary
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Operations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ops/deploy-systemd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploy with systemd
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ops/deploy-docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploy with Docker
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Legacy Overview
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Legacy Overview
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#directory-map-annotated" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Map (Annotated)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conversion-current-state" class="md-nav__link">
    <span class="md-ellipsis">
      Conversion: Current State
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#historical-notes-deprecated" class="md-nav__link">
    <span class="md-ellipsis">
      Historical Notes (deprecated)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#directory-map-annotated" class="md-nav__link">
    <span class="md-ellipsis">
      Directory Map (Annotated)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conversion-current-state" class="md-nav__link">
    <span class="md-ellipsis">
      Conversion: Current State
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#historical-notes-deprecated" class="md-nav__link">
    <span class="md-ellipsis">
      Historical Notes (deprecated)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<p>"""
Repository overview for the DSA-110 continuum imaging pipeline.
"""</p>
<h1 id="layout-overview">Layout Overview<a class="headerlink" href="#layout-overview" title="Permanent link">&para;</a></h1>
<ul>
<li><code>src/dsa110_contimg/</code> – Active Python package (conversion, calibration, imaging, QA, API, utils)</li>
<li><code>tests/</code> – Unit and integration tests</li>
<li><code>docs/</code> – User guides, architecture notes, templates</li>
<li><code>docs/notebooks/</code> – Interactive notebooks (e.g., measurement-set staging walkthrough)</li>
<li><code>docs/notebooks/</code> – Interactive notebooks (MS staging, calibration tests)</li>
<li><code>config/</code> – Runtime and deployment configuration templates</li>
<li><code>ops/</code> – Operational scripts and service manifests</li>
<li><code>state/</code> – Runtime artifacts (queue SQLite DBs, CASA logs, checkpoints); gitignored</li>
<li><code>data-samples/</code> – Curated measurement sets and UVH5 examples for QA</li>
<li><code>archive/legacy/</code> – Historical scripts, notebooks, and deprecated code paths</li>
</ul>
<h2 id="directory-map-annotated">Directory Map (Annotated)<a class="headerlink" href="#directory-map-annotated" title="Permanent link">&para;</a></h2>
<ul>
<li>Top level (curated)</li>
<li><code>src/</code> – all Python sources</li>
<li><code>ops/</code> – systemd units, docker, housekeeping and ops scripts</li>
<li><code>scripts/</code> – helper shell scripts (conversion/imaging/housekeeping)</li>
<li><code>state/</code> – SQLite DBs and QA artifacts at runtime</li>
<li>
<p><code>tests/</code>, <code>docs/</code>, <code>references/</code>, <code>data-samples/</code>, <code>tmp/</code> – support assets</p>
</li>
<li>
<p>Functional map: <code>src/dsa110_contimg</code> (depth 2)</p>
</li>
<li><code>src/dsa110_contimg/conversion/</code> – UVH5 → MS conversion</li>
<li><code>src/dsa110_contimg/conversion/streaming/streaming_converter.py</code> – ingest → convert → calibrate/apply → image daemon</li>
<li><code>src/dsa110_contimg/conversion/strategies/hdf5_orchestrator.py</code> – strategy orchestrator CLI<ul>
<li><code>src/dsa110_contimg/conversion/strategies/direct_subband.py</code> – per-subband MS writer + concat</li>
<li><code>src/dsa110_contimg/conversion/uvh5_to_ms.py</code> – standalone converter (utility)</li>
<li><code>src/dsa110_contimg/conversion/helpers.py</code> – UVW, antenna positions, model/weights</li>
</ul>
</li>
<li><code>src/dsa110_contimg/calibration/</code> – CASA calibration<ul>
<li><code>src/dsa110_contimg/calibration/calibration.py</code> – K/BA/BP/GA/GP/2G solves</li>
<li><code>src/dsa110_contimg/calibration/applycal.py</code> – apply caltables</li>
<li><code>src/dsa110_contimg/calibration/selection.py</code>, <code>src/dsa110_contimg/calibration/catalogs.py</code> – field+catalog helpers</li>
</ul>
</li>
<li><code>src/dsa110_contimg/imaging/</code> – tclean and imaging workers<ul>
<li><code>src/dsa110_contimg/imaging/worker.py</code> – backfill scan/daemon</li>
<li><code>src/dsa110_contimg/imaging/cli.py</code> – tclean convenience CLI</li>
</ul>
</li>
<li><code>src/dsa110_contimg/database/</code> – SQLite helpers<ul>
<li><code>src/dsa110_contimg/database/registry.py</code> – caltable registry</li>
<li><code>src/dsa110_contimg/database/products.py</code> – ms_index/images helpers + indices</li>
</ul>
</li>
<li><code>src/dsa110_contimg/api/</code> – monitoring API<ul>
<li><code>src/dsa110_contimg/api/routes.py</code> – FastAPI app + endpoints</li>
<li><code>src/dsa110_contimg/api/models.py</code>, <code>src/dsa110_contimg/api/data_access.py</code></li>
</ul>
</li>
<li><code>src/dsa110_contimg/qa/</code> – quicklooks and plots</li>
<li><code>src/dsa110_contimg/mosaic/</code> – mosaic planner/builder CLI (skeleton)</li>
<li>
<p><code>src/dsa110_contimg/utils/</code> – coordinates, logging, antpos, constants</p>
</li>
<li>
<p>Optional tree commands</p>
</li>
<li><code>tree -L 2 -I '.git|env|tmp|state|__pycache__|*.pyc|.mypy_cache|.pytest_cache'</code></li>
<li><code>find . -maxdepth 2 -type d | sed 's|^\./||' | sort</code></li>
</ul>
<h2 id="conversion-current-state">Conversion: Current State<a class="headerlink" href="#conversion-current-state" title="Permanent link">&para;</a></h2>
<ul>
<li>Orchestrator: <code>src/dsa110_contimg/conversion/strategies/hdf5_orchestrator.py</code> converts subband groups (5‑min by default) using writer strategies.</li>
<li>Writers: <code>direct-subband</code> (parallel per‑subband writes + concat) and <code>pyuvdata</code> (monolithic). <code>--writer auto</code> chooses based on subband count.</li>
<li>Staging: optional tmpfs (<code>/dev/shm</code>) staging and SSD scratch; see <code>docs/pipeline/README_uvh5_to_ms.md</code> for details.</li>
</ul>
<h2 id="historical-notes-deprecated">Historical Notes (deprecated)<a class="headerlink" href="#historical-notes-deprecated" title="Permanent link">&para;</a></h2>
<ul>
<li>An experimental dask‑ms writer was previously explored and referenced here. It is not part of the current tree and is unsupported.</li>
<li>
<p>Legacy scripts and older converters live under <code>archive/legacy/</code> for reference only; do not use for new automation.</p>
</li>
<li>
<p>Optional dask-ms writer (experimental)</p>
</li>
<li>Converter <code>dsa110_contimg/conversion/uvh5_to_ms_converter_v2.py</code> now supports <code>--dask-write</code> to write Measurement Sets via dask‑ms (python‑casacore backend) for improved parallel I/O.</li>
<li>Use <code>--dask-write-failfast</code> to abort immediately on any dask‑ms error (no fallback to the direct writer) to speed up debugging.</li>
<li>Writer order: creates the main table first, then writes and links the required subtables (SPECTRAL_WINDOW, POLARIZATION, ANTENNA, FIELD, DATA_DESCRIPTION).</li>
<li>
<p>ANTENNA subtable builder is robust to missing <code>antenna_numbers</code>, synthesizing names (<code>pad1..padN</code>) when needed; positions are required.</p>
</li>
<li>
<p>MS consistency improvements</p>
</li>
<li>POLARIZATION::CORR_TYPE is written using MS Stokes enums (XX=5, YY=6), avoiding negative AIPS codes.</li>
<li>SPECTRAL_WINDOW::EFFECTIVE_BW and ::RESOLUTION are populated (per‑channel arrays).</li>
<li>MAIN::SIGMA and ::WEIGHT are per‑row arrays of length Npol.</li>
<li>
<p>Optional <code>--field-per-integration</code> writes one FIELD row per unique integration (useful for drift scans).</p>
</li>
<li>
<p>Quick downsampling knobs (for fast testing)</p>
</li>
<li>Frequency downsample: set environment <code>DS_FREQ=&lt;int&gt;</code> to average adjacent channels (updates <code>DATA</code>, <code>FLAG</code>, <code>NSAMPLE</code>, <code>freq_array</code>, <code>channel_width</code>).</li>
<li>Time downsample: set environment <code>DS_TIME=&lt;int&gt;</code> to combine adjacent time samples per baseline (averages <code>DATA/UVW/TIME/LST</code>, ORs <code>FLAG</code>, sums <code>NSAMPLE</code> and <code>integration_time</code>).</li>
<li>Both operate in‑memory on the merged UVData object prior to writing and reduce write volume substantially (e.g., <code>DS_TIME=2</code>, <code>DS_FREQ=4</code> → ~8× reduction).</li>
</ul>
<p>Usage examples
<div class="highlight"><pre><span></span><code># Quick synthetic (2 subbands) → fast dask‑write with downsampling
export PYTHONPATH=/data/dsa110-contimg/src:$PYTHONPATH
export DS_TIME=2 DS_FREQ=4
/opt/miniforge/envs/casa6/bin/python -u -m dsa110_contimg.conversion.strategies.hdf5_orchestrator \
  /data/dsa110-contimg/synth_quick \
  /data/dsa110-contimg/out_dask_quick \
  &quot;2025-10-08 00:12:59&quot; &quot;2025-10-08 00:12:59&quot; \
  --dask-write --dask-write-failfast --no-stage-tmpfs --log-level INFO

# Validate in CASA
python - &lt;&lt;&#39;PY&#39;
from casatools import ms
m=ms(); m.open(&#39;/data/dsa110-contimg/out_dask_quick/2025-10-08T00:12:59.ms&#39;);
print(m.summary().get(&#39;nrow&#39;)); m.close()
PY
</code></pre></div></p>
<p>Notes
- Keep dask/distributed pinned to versions compatible with dask‑ms (currently dask 2024.10.x).
- The default converter path (pyuvdata write) remains unchanged; <code>--dask-write</code> is optional and can be toggled per run.</p>
<h1 id="monitoring-api">Monitoring API<a class="headerlink" href="#monitoring-api" title="Permanent link">&para;</a></h1>
<ul>
<li>FastAPI service under <code>src/dsa110_contimg/api/</code></li>
<li>Endpoints: <code>/api/status</code>, <code>/api/products</code>, <code>/api/calibrator_matches</code><ul>
<li><code>/api/calibrator_matches</code> supports <code>limit</code> and <code>matched_only</code> query params</li>
</ul>
</li>
<li>UI routes: <code>/api/ui/calibrators</code> (server‑side HTML), <code>/ui</code> (static dashboard), <code>/ui/static/calibrators.html</code> (JS view)</li>
<li>Env configuration handled via <code>ApiConfig</code></li>
<li>Tests in <code>tests/api/test_routes.py</code></li>
</ul>
<h1 id="runtime-artifact-guidance">Runtime Artifact Guidance<a class="headerlink" href="#runtime-artifact-guidance" title="Permanent link">&para;</a></h1>
<ul>
<li>All logs, queue databases, and other ephemeral outputs should live under <code>state/</code></li>
<li>Ensure operational scripts point CASA log outputs (<code>CASALOGFILE</code>) and SQLite files to <code>state/</code></li>
<li><code>state/</code> contains a <code>.gitkeep</code> so the directory persists without tracking contents</li>
</ul>
<h1 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h1>
<ul>
<li>Add documentation for pipeline execution workflows and dashboard integration</li>
<li>Expand API endpoints (e.g., live monitoring metrics, calibration registry management)</li>
</ul>
<h1 id="calibrator-matching-transits">Calibrator Matching &amp; Transits<a class="headerlink" href="#calibrator-matching-transits" title="Permanent link">&para;</a></h1>
<p>The pipeline can automatically identify VLA calibrators within the primary beam during drift scanning and expose results via the API/UI. Helpers are also provided for computing meridian transits at OVRO and ad‑hoc catalog queries.</p>
<p>What it does
- Per group (5‑min by default), the streaming worker computes the meridian RA at the group midpoint for a configured declination strip, searches a VLA calibrator catalog within a radius, and stores top matches (PB‑weighted) in the queue DB.
- Recent groups and their matches surface in <code>/api/status</code>, <code>/api/calibrator_matches</code>, and the dashboard.
- Utilities assist with reading the VLA catalog, resolving RA/Dec, and computing previous meridian transits.</p>
<p>Configure
- <code>VLA_CALIBRATOR_CSV</code> – path to a VLA calibrator CSV (parsed form). Default:
  <code>references/dsa110-contimg-main-legacy/data/catalogs/vla_calibrators_parsed.csv</code>
- <code>PIPELINE_POINTING_DEC_DEG</code> – declination of the drift strip (deg), e.g., <code>55.0</code>
- Optional: <code>CAL_MATCH_RADIUS_DEG</code> (default <code>1.0</code>), <code>CAL_MATCH_TOPN</code> (default <code>3</code>)</p>
<p>Key helpers
- Catalog: <code>read_vla_parsed_catalog_csv</code>, <code>get_calibrator_radec</code>, <code>calibrator_match</code> – <code>src/dsa110_contimg/calibration/catalogs.py</code>
- Transits: <code>previous_transits</code>, <code>next_transit_time</code>, constants <code>OVRO</code>, <code>SIDEREAL_RATE</code> – <code>src/dsa110_contimg/calibration/schedule.py</code></p>
<p>CLI examples
<div class="highlight"><pre><span></span><code># Previous 3 transits for a named calibrator
python -m dsa110_contimg.calibration.catalog_cli transit \
    --catalog references/dsa110-contimg-main-legacy/data/catalogs/vla_calibrators_parsed.csv \
    --name 0834+555 --n 3

# In‑beam matches for a drift strip (pointing dec, time)
python -m dsa110_contimg.calibration.catalog_cli inbeam \
    --catalog references/dsa110-contimg-main-legacy/data/catalogs/vla_calibrators_parsed.csv \
    --pt-dec 55.0 --time &quot;2025-10-07 15:22:00&quot; --radius 1.0 --top 5
</code></pre></div></p>
<p>Programmatic snippets
<div class="highlight"><pre><span></span><code>from astropy.time import Time
import astropy.units as u
from dsa110_contimg.calibration.catalogs import read_vla_parsed_catalog_csv, get_calibrator_radec, calibrator_match
from dsa110_contimg.calibration.schedule import previous_transits

df = read_vla_parsed_catalog_csv(&#39;references/dsa110-contimg-main-legacy/data/catalogs/vla_calibrators_parsed.csv&#39;)
ra_deg, dec_deg = get_calibrator_radec(df, &#39;0834+555&#39;)
times = previous_transits(ra_deg, n=3)  # OVRO

mid = Time(&#39;2025-10-07T15:22:00&#39;, scale=&#39;utc&#39;)
matches = calibrator_match(df, 55.0 * u.deg, mid.mjd, radius_deg=1.0, top_n=3)
</code></pre></div></p>
<p>Streaming integration
- Queue DB schema gains: <code>ingest_queue.has_calibrator</code> (INTEGER), <code>ingest_queue.calibrators</code> (TEXT, JSON array)
- Worker hook (per group): reads env config, computes group midpoint, runs <code>calibrator_match</code>, updates DB
- Logging: “Calibrator(s) in beam: [...]” or “No calibrators in beam …”</p>
<p>Monitoring/API/UI
- <code>/api/status</code> recent_groups include <code>has_calibrator</code> and <code>matches</code>; <code>matched_recent</code> summarizes recent match count.
- <code>/api/calibrator_matches?limit=50&amp;matched_only=true</code> returns recent groups with match lists.
- Dashboard: <code>/ui</code> shows queue stats and recent groups with match info; <code>/ui/static/calibrators.html</code> provides an interactive list (limit and matched_only filters).</p>
<p>Notes
- The VLA CSV should include <code>J2000_NAME</code> and either sexagesimal RA/Dec (e.g., <code>RA_J2000</code>, <code>DEC_J2000</code>) or numeric <code>RA_deg</code>, <code>DEC_deg</code>. The reader normalizes to degrees.
- Meridian computations use OVRO (<code>EarthLocation</code>) and sidereal time from Astropy; “previous transits” are spaced by one sidereal day (~23h56m).
- Primary‑beam weighting uses a simple Airy pattern at 1.4 GHz; adjust <code>radius</code>/<code>top_n</code> or substitute a different PB model if needed.</p>
<h1 id="qa-quicklooks-shadems">QA Quicklooks (shadeMS)<a class="headerlink" href="#qa-quicklooks-shadems" title="Permanent link">&para;</a></h1>
<p>Optional quicklook plots can be produced automatically after each MS is written using shadeMS (external CLI). This is disabled by default.</p>
<p>Enable via converter CLI flags (no env variables required):</p>
<div class="highlight"><pre><span></span><code>python -m dsa110_contimg.conversion.strategies.hdf5_orchestrator \
  &lt;input_dir&gt; &lt;output_dir&gt; &quot;YYYY-MM-DD HH:MM:SS&quot; &quot;YYYY-MM-DD HH:MM:SS&quot; \
  --qa-shadems \
  --qa-shadems-resid \
  --qa-shadems-max 4 \
  --qa-shadems-timeout 600 \
  --qa-state-dir state
</code></pre></div>
<p>Or, enable via environment variables before running the converter or streaming worker:</p>
<div class="highlight"><pre><span></span><code>export QA_SHADEMS_ENABLE=1            # turn on quicklooks
export QA_SHADEMS_RESID=1             # include residual plot (CORRECTED_DATA-MODEL_DATA) if MODEL_DATA exists
export QA_SHADEMS_MAX=4               # limit number of plots (default 4)
export QA_SHADEMS_TIMEOUT=600         # per-plot timeout (seconds)
export PIPELINE_STATE_DIR=state       # base dir for outputs
</code></pre></div>
<p>Artifacts are written to <code>state/qa/&lt;ms_stem&gt;/</code> alongside the measurement set name (or under the directory provided via <code>--qa-state-dir</code>). The converter invokes <code>shadems</code> as a separate process; if it is not installed or on <code>PATH</code>, quicklooks are skipped with a warning.</p>
<p>For existing Measurement Sets you can generate the same quicklooks without reconverting:</p>
<p><div class="highlight"><pre><span></span><code>python -m dsa110_contimg.qa.quicklooks \
  --ms /scratch/dsa110-contimg/data-samples/ms/run123/2025-10-03T15:15:58.ms \
  --state-dir state \
  --ragavi               # optional HTML inspector in addition to shadeMS plots

# Fast Matplotlib quicklooks

When shadeMS/ragavi are unavailable or you just need an ultra-fast view, use the built-in matplotlib helper:
</code></pre></div>
python -m dsa110_contimg.qa.fast_plots \
  --ms /scratch/dsa110-contimg/data-samples/ms/run123/2025-10-03T15:15:58.ms \
  --output-dir /data/dsa110-contimg/state/qa/run123_fast
<div class="highlight"><pre><span></span><code>You can combine everything via the quicklooks wrapper:
</code></pre></div>
python -m dsa110_contimg.qa.quicklooks \
  --ms /scratch/.../2025-10-03T15:15:58.ms \
  --state-dir /data/dsa110-contimg/state \
  --fast-plots --fast-include-residual
<div class="highlight"><pre><span></span><code>
</code></pre></div></p>
<p>Streaming service flags</p>
<p>You can enable quicklooks for the streaming path without environment variables by passing flags that are forwarded to the converter per group:</p>
<div class="highlight"><pre><span></span><code>python -m dsa110_contimg.conversion.streaming.streaming_converter \
  --input-dir /data/incoming \
  --output-dir state/ms \
  --use-subprocess \
  --qa-shadems \
  --qa-shadems-cal-only \
  --qa-shadems-resid \
  --qa-shadems-max 4 \
  --qa-shadems-timeout 600 \
  --qa-state-dir state
</code></pre></div>
<p>The dashboard links to a “quicklooks” gallery under <code>/ui/static/qa.html</code>, and individual groups link to a detail view at <code>/ui/static/group.html?group=&lt;group_id&gt;</code>.</p>
<h1 id="reference-antenna-recommendation">Reference Antenna Recommendation<a class="headerlink" href="#reference-antenna-recommendation" title="Permanent link">&para;</a></h1>
<p>The fast QA pass produces a per‑antenna quality summary and an automatic reference‑antenna ranking suitable for <code>solve_delay</code>/<code>solve_bandpass</code>.</p>
<p>How it works
- Metrics computed per antenna over the scan:
  - Mean amplitude (signal strength)
  - Phase coherence R and circular phase standard deviation σ (stability)
  - Flagged‑row fraction (data completeness)
  - Amplitude variance (sanity check)
  - Array centrality factor (distance to array centroid, favouring central dishes)
- A composite score ranks antennas (higher is better):
  - <code>score = amp_norm^0.5 × coherence^1.0 × (1 − flagged_frac)^1.0 × stability^1.0 × center_factor^0.5</code>
  - where <code>stability = 1 / (1 + phase_sigma_deg / 45)</code> and <code>amp_norm = mean_amp / max(mean_amp)</code>
- Artifacts written alongside quicklooks:
  - <code>per_antenna_metrics_fast.png</code> — bar charts for mean amp, phase σ, flagged fraction, variance
  - <code>phase_sigma_sorted_fast.png</code> — antennas sorted by phase σ
  - <code>coherence_vs_flagged_fast.png</code> — coherence vs. flagged fraction scatter (colour = mean amp)
  - <code>phase_heatmap_fast.png</code> — phase σ over time for each antenna
  - <code>refant_ranking.json</code> and <code>refant_ranking.csv</code> — full ranking and the recommended antenna</p>
<p>Usage
<div class="highlight"><pre><span></span><code>python -m dsa110_contimg.qa.fast_plots \
  --ms /scratch/.../2025-10-03T15:15:58.ms \
  --output-dir /data/dsa110-contimg/state/qa/2025-10-03T15:15:58_fast

# Inspect refant_ranking.json for the recommended antenna_id
</code></pre></div></p>
<p>Calibration with the recommended refant
<div class="highlight"><pre><span></span><code>PYTHONPATH=/data/dsa110-contimg/src \
/opt/miniforge/envs/casa6/bin/python -m dsa110_contimg.calibration.cli calibrate \
    --ms /scratch/.../2025-10-03T15:15:58.ms \
    --field &lt;cal_field&gt; \
    --refant &lt;recommended_antenna_id&gt;
</code></pre></div></p>
<p>Notes
- The weighting above is conservative and aims to avoid obviously bad choices without overfitting. If you prefer different trade‑offs (e.g., penalise flagged fraction more strongly, or ignore centrality), the scoring can be tuned.
- When several antennas tie on score, prefer the one with higher mean amplitude or closer to the array centre.</p>
<h1 id="to-develop">To Develop<a class="headerlink" href="#to-develop" title="Permanent link">&para;</a></h1>
<p>Dashboard/UI and API enhancements planned to round out monitoring and operator experience:</p>
<ul>
<li>Live refresh and UX polish</li>
<li>Auto‑refresh the dashboard and calibrator views (10–30 s)</li>
<li>Human‑friendly timestamps (local timezone, relative age) and sortable columns</li>
<li>Products and calibration sets in UI</li>
<li>Render <code>/api/products</code> on the dashboard (recent images, pbcor, noise, beam)</li>
<li>Display <code>/api/status.calibration_sets</code> with active/total and table paths</li>
<li>Group detail view</li>
<li>Add <code>/api/groups/{group_id}</code> with subbands, errors, timings, matches, artifacts</li>
<li>Link group_id on the dashboard to this detail view</li>
<li>Performance and system metrics</li>
<li>Expose performance metrics (load/phase/write/total) over API and chart on UI</li>
<li>Add lightweight system metrics (CPU/mem/disk IO) endpoint and sparklines</li>
<li>Status/errors visibility</li>
<li>Show failure reasons and highlight errored groups; add quick retry control (if applicable)</li>
<li>Calibrator UX</li>
<li>Dashboard toggle to filter “only matched”; show <code>weighted_flux</code> and a calibrator info drawer</li>
<li>Optional: sidebar for upcoming transits via <code>schedule.previous_transits</code></li>
<li>Config/health panel</li>
<li>Surface key env/config (e.g., <code>VLA_CALIBRATOR_CSV</code>, <code>PIPELINE_POINTING_DEC_DEG</code>, <code>CAL_MATCH_RADIUS_DEG</code>) and warnings when missing/disabled</li>
<li>Pagination and filters</li>
<li>Add limit/offset filters for <code>/api/status</code> and pagination in UI tables</li>
<li>Tests</li>
<li>Extend API test coverage for <code>/api/calibrator_matches</code> and expanded <code>/api/status</code></li>
<li>Security/hardening (as deployment requires)</li>
<li>Optional API/UI auth gate and CORS configuration</li>
</ul>
<p>High‑value next steps
- Implement auto‑refresh + relative time formatting
- Add Products and Calibration Sets tables to <code>/ui</code>
- Create Group Detail API and link from dashboard
- Surface performance/system metrics and basic charts</p>
<h1 id="bandpass-calibration-notebook">Bandpass Calibration (Notebook)<a class="headerlink" href="#bandpass-calibration-notebook" title="Permanent link">&para;</a></h1>
<p>An end-to-end calibration test notebook is available at:</p>
<ul>
<li><code>docs/notebooks/bandpass_calibration_test.ipynb</code></li>
</ul>
<p>What it does
- Runs fast QA on the MS to generate <code>refant_ranking.json</code> and recommends a reference antenna.
- Auto-selects a contiguous FIELD window around the PB peak using a primary‑beam gain threshold.
- Executes K/BA/BP/G solves; optional <code>combine='scan,field'</code> collapses the selected window into a single BP/G solution.</p>
<p>Prerequisites
- Run with a CASA 6 kernel (both <code>casatools</code> and <code>casatasks</code> importable).
- Ensure the package is importable from the notebook (<code>../../src</code> is pre-added to <code>sys.path</code>).</p>
<p>Quick start
1) Open <code>docs/notebooks/bandpass_calibration_test.ipynb</code> and set your MS path.
2) Run the QA cell; review <code>/tmp/qa-auto/refant_ranking.json</code>.
3) Run the catalog auto-selection cell (defaults to <code>data-samples/catalogs/vlacalibrators.txt</code>, adjustable search radius and window).
4) Run the calibration cell; it prints the produced calibration tables.</p>
<p>CLI equivalent (field auto‑selection + PB threshold)
<div class="highlight"><pre><span></span><code># Fast QA (reference antenna ranking)
python -m dsa110_contimg.qa.fast_plots \
  --ms /scratch/.../2025-10-03T15:15:58.ms \
  --output-dir /tmp/qa-auto

# Calibration with catalog-driven auto fields and recommended refant
PYTHONPATH=src:$PYTHONPATH \
python -m dsa110_contimg.calibration.cli calibrate \
  --ms /scratch/.../2025-10-03T15:15:58.ms \
  --auto-fields \
  --cal-catalog /data/dsa110-contimg/data-samples/catalogs/vlacalibrators.txt \
  --cal-search-radius-deg 2.0 \
  --bp-min-pb 0.99 \
  --bp-combine-field \
  --refant-ranking /tmp/qa-auto/refant_ranking.json
</code></pre></div></p>
<p>Notes
- The notebook plots the PB‑weighted flux per field and highlights the selected window.
- Use <code>--bp-min-pb</code> to size the window by PB gain; fall back to <code>--bp-window</code> to force a fixed width.
- Add <code>--bp-combine-field</code> to produce a single BP/G solution across the selected fields.</p>
<h1 id="bandpass-calibration-shell-script">Bandpass Calibration (Shell Script)<a class="headerlink" href="#bandpass-calibration-shell-script" title="Permanent link">&para;</a></h1>
<p>To avoid Jupyter kernel instability, use the provided shell wrapper:</p>
<div class="highlight"><pre><span></span><code>bash scripts/calibrate_bandpass.sh \
  --ms /scratch/dsa110-contimg/data-samples/ms/0834_555_transit_reconv3/2025-10-03T15:15:58.ms
</code></pre></div>
<p>Defaults in the script
- <code>--bp-min-pb 0.99</code> (PB threshold)
- <code>--bp-combine-field</code> (combine fields for BP/G)
- <code>--no-flagging</code> by default (enable with <code>--flagging</code>)
- <code>--cal-search-radius-deg 2.0</code>, <code>--bp-window 3</code> (fallback)
- Catalog path prefilled (<code>data-samples/catalogs/vlacalibrators.txt</code>)</p>
<p>Overrides
- <code>--min-pb &lt;0-1&gt;</code>, <code>--no-combine</code>, <code>--flagging</code>, <code>--radius &lt;deg&gt;</code>, <code>--window &lt;int&gt;</code>, <code>--catalog &lt;path&gt;</code></p>
<p>MS repair policy
- Calibration does not patch Measurement Sets. If an MS is malformed, prefer reconversion with the updated writer (e.g., <code>--dask-write</code>, <code>--field-per-integration</code>). On‑the‑fly repair flags have been removed.</p>
<p>Reconversion example
<div class="highlight"><pre><span></span><code>PYTHONPATH=src:$PYTHONPATH \
/opt/miniforge/envs/casa6/bin/python -m dsa110_contimg.conversion.strategies.hdf5_orchestrator \
  /data/incoming/0834_555_transit \
  /scratch/dsa110-contimg/data-samples/ms/0834_555_transit_reconv4 \
  &quot;2025-10-03 15:15:57&quot; &quot;2025-10-03 15:15:58&quot; \
  --dask-write --dask-write-failfast --field-per-integration --no-stage-tmpfs --log-level INFO
</code></pre></div></p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.indexes", "content.code.copy", "content.tabs.link"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
        <script src="../javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>